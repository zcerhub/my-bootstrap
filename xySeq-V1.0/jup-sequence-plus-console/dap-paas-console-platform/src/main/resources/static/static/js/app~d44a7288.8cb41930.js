(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~d44a7288"],{"03d8":function(e,t,a){},"04a6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("el-page-header",{staticStyle:{"margin-bottom":"20px"},attrs:{content:"部署记录"},on:{back:e.goBack}}),t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:2,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage}})],1)},o=[],i=a("c7eb"),r=a("5530"),s=a("1da1"),c=a("23a6"),l=a("ec41"),d=a("ff51"),u={name:"deploy-record",components:{},mixins:[],props:{},data:function(){return{buttonList:[],searchConfig:{searchData:{cluster:"",machineIp:""},searchItem:[{prop:"cluster",label:"集群",type:"input"},{prop:"machineIp",label:"机器",type:"input"}],rules:{}},tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"cluster",label:"集群"},{prop:"machineIp",label:"机器ip"},{prop:"machinePort",label:"机器端口"},{prop:"deployStatus",label:"部署状态"},{prop:"deployPath",label:"部署路径"},{prop:"content",label:"内容"},{prop:"detail",label:"详情"},{prop:"createDate",label:"部署时间"}],operate:{width:160,list:[]}},rowData:null}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},getList:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a,n,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableConfig.loading=!0,t.prev=1,a=Object(r["a"])(Object(r["a"])({},e.tableConfig.pagination),{},{requestObject:Object(r["a"])({componentType:"4"},e.searchConfig.searchData)}),t.next=5,Object(c["f"])(a);case 5:n=t.sent,o=Object(l["a"])(n,"data.data"),e.tableConfig.tableData=Object(d["a"])(o)?o:[],e.tableConfig.pagination.totalCount=Object(l["a"])(n,"data.totalCount")||0,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1);case 14:e.tableConfig.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()}}},p=u,f=a("2877"),m=Object(f["a"])(p,n,o,!1,null,"d60eec36",null);t["default"]=m.exports},"09e8":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{"enter-search":e.onEnterSearch,onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.total,rowKey:"id",isPage:e.tableConfig.isPage,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAdd?t("AddAndEdit",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showAdd,callback:function(t){e.showAdd=t},expression:"showAdd"}}):e._e(),e.showInit?t("DialogServiceInit",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showInit,callback:function(t){e.showInit=t},expression:"showInit"}}):e._e(),e.showExample?t("DialogDockingExample",{attrs:{rowData:e.rowData},model:{value:e.showExample,callback:function(t){e.showExample=t},expression:"showExample"}}):e._e()],1)},o=[],i=a("ade3"),r=a("5530"),s=(a("7db0"),a("14d9"),a("b0c0"),a("d3b7"),a("99af"),a("caad"),a("2532"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},[t("el-row",{staticStyle:{"flex-wrap":"wrap",display:"flex"},attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务集群名称",prop:"name"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入服务集群名称",maxlength:"30","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"地区",prop:"cityId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择地区"},on:{change:e.changeCityId},model:{value:e.formData.cityId,callback:function(t){e.$set(e.formData,"cityId",t)},expression:"formData.cityId"}},e._l(e.csMixCity,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据中心",prop:"roomId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择数据中心"},on:{change:e.changeRoomId},model:{value:e.formData.roomId,callback:function(t){e.$set(e.formData,"roomId",t)},expression:"formData.roomId"}},e._l(e.roomList,(function(e){return t("el-option",{key:e.id,attrs:{label:"".concat(e.machineRoomName,"(").concat(e.machineRoomCode,")"),value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据源类型",prop:"dbType"}},[t("el-radio",{attrs:{label:"0"},model:{value:e.formData.dbType,callback:function(t){e.$set(e.formData,"dbType",t)},expression:"formData.dbType"}},[e._v("当前管控")]),t("el-radio",{attrs:{label:"1"},model:{value:e.formData.dbType,callback:function(t){e.$set(e.formData,"dbType",t)},expression:"formData.dbType"}},[e._v("自定义")])],1)],1),"1"===e.formData.dbType?[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据库驱动",prop:"dbDriver"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},on:{change:e.changeDriver},model:{value:e.formData.dbDriver,callback:function(t){e.$set(e.formData,"dbDriver",t)},expression:"formData.dbDriver"}},e._l(e.dictcommon_dbDriver,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据库IP地址",prop:"dbIp"}},[t("el-input",{attrs:{placeholder:"请输入数据库IP地址"},on:{change:e.changeDriver},model:{value:e.formData.dbIp,callback:function(t){e.$set(e.formData,"dbIp",t)},expression:"formData.dbIp"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据库端口",prop:"dbPort"}},[t("el-input",{attrs:{placeholder:"请输入数据库端口"},on:{change:e.changeDriver},model:{value:e.formData.dbPort,callback:function(t){e.$set(e.formData,"dbPort",t)},expression:"formData.dbPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据库名",prop:"dbName"}},[t("el-input",{attrs:{placeholder:"请输入数据库名"},on:{change:e.changeDriver},model:{value:e.formData.dbName,callback:function(t){e.$set(e.formData,"dbName",t)},expression:"formData.dbName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"数据库地址",prop:"dbUrl"}},[t("el-input",{attrs:{type:"textarea",rows:4,disabled:""},model:{value:e.formData.dbUrl,callback:function(t){e.$set(e.formData,"dbUrl",t)},expression:"formData.dbUrl"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据库用户名",prop:"dbUser"}},[t("el-input",{attrs:{placeholder:"数据库用户名","auto-complete":"new-password"},model:{value:e.formData.dbUser,callback:function(t){e.$set(e.formData,"dbUser",t)},expression:"formData.dbUser"}})],1)],1),t("el-col",{attrs:{span:12}}),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"数据库密码",prop:"dbPassword"}},[t("el-input",{attrs:{placeholder:"请输入数据库密码","auto-complete":"new-password","show-password":!0},model:{value:e.formData.dbPassword,callback:function(t){e.$set(e.formData,"dbPassword",t)},expression:"formData.dbPassword"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-button",{attrs:{plain:"",type:"primary"},on:{click:e.clickTest}},[e._v("测试连接")])],1)]:e._e()],2),t("div",{staticStyle:{"margin-bottom":"20px"}},[t("el-table",{staticClass:"w-100 ruler-table table-class",attrs:{data:e.formData.infos,"cell-style":{padding:"5px 5px"}}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{prop:"appCode",label:"应用编码",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row,o=a.$index;return[t("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"","label-width":"0",prop:"infos.".concat(o,".appCode"),rules:e.rules.appCode,"show-message":!1,"status-icon":!0}},[t("el-select",{attrs:{clearable:""},model:{value:n.appCode,callback:function(t){e.$set(n,"appCode",t)},expression:"row.appCode"}},e._l(e.opts_appCode,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value,disabled:e.selectedAppCode.includes(a.value)}})})),1)],1)]}}])}),t("el-table-column",{attrs:{prop:"appName",label:"应用名称",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row,o=a.$index;return[t("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"","label-width":"0",prop:"infos.".concat(o,".appName"),rules:e.rules.appName,"show-message":!1,"status-icon":!0}},[e.opts_appCodeMap.get(n.appCode)?t("span",{staticStyle:{"font-size":"12px"}},[e._v(" "+e._s(e.opts_appCodeMap.get(n.appCode).applicationName))]):e._e()])]}}])}),t("el-table-column",{attrs:{prop:"organization",label:"所属组织",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row,o=a.$index;return[t("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"","label-width":"0",prop:"infos.".concat(o,".organization"),rules:e.rules.organization,"show-message":!1,"status-icon":!0}},[e.opts_appCodeMap.get(n.appCode)?t("span",{staticStyle:{"font-size":"12px"}},[e._v(" "+e._s(e.opts_appCodeMap.get(n.appCode).organizationName))]):e._e()])]}}])}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"100"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:e.clickInfosAdd}},[e._v("+添加")])]},proxy:!0},{key:"default",fn:function(a){var n=a.$index;a.row;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(n,e.formData.infos)}}},[e._v("删除")])]}}])})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),c=[],l=a("c7eb"),d=a("1da1"),u=a("b85c"),p=(a("d81d"),a("a434"),a("4ec9"),a("b64b"),a("3ca3"),a("159b"),a("ddb0"),a("3739")),f=a("c43b"),m=a("1f97"),h=a("bc59"),g=a("ec41"),b=a("ff51"),v=a("1b62"),y=a("934b"),w=a("80f3"),D=a("fbd2"),C=(a("61f7"),a("4879")),k=v["a"].CommonSelectCreaterMix,x="dm.jdbc.driver.DmDriver";function O(e){var t={id:"",name:"",cityId:"",roomId:"",dbType:"0",dbUrl:"",dbDriver:"",dbUser:"",dbPassword:"",dbIp:"",dbPort:"",dbName:"",applicationId:[],infos:[]};return e&&Object.keys(t).forEach((function(a){Object(h["a"])(e,a)&&(t[a]=e[a])})),t}var j={name:"AddAndEdit",components:{},mixins:[k(["csMixCity"])],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=this;return{dict_unitType:C["g"],opts_units:[],opts_appCode:[],dictcommon_dbDriver:w["b"].options,regTypeOptions:m["e"],loading:!1,roomList:[],labelPosition:"right",formData:O(),rules:{name:[{required:!0,message:"请输入服务集群名称",trigger:"blur"}],cityId:[{required:!0,message:"请选择地区",trigger:"change"}],roomId:[{required:!0,message:"请选择机房",trigger:"change"}],registerType:[{required:!0,message:"请选择注册中心类型",trigger:"change"}],registerAddress:[{required:!0,message:"请输入注册中心地址",trigger:"blur"}],dbType:[{required:!0,message:"请选择数据源类型",trigger:"blur"}],dbDriver:[{required:!0,message:"请选择数据库驱动",trigger:"blur"}],dbUser:[{required:!0,message:"请输入数据库用户名",trigger:"blur"}],dbPassword:[{required:!0,message:"请输入数据库密码",trigger:"blur"}],dbIp:[{required:!0,message:"请输入数据库ip",trigger:"blur"}],dbPort:[{required:!0,message:"请输入数据库端口",trigger:"blur"}],dbName:[{get required(){return e.formData.dbDriver!==x},message:"请输入数据库名",trigger:"blur"}],appCode:[{required:!0,message:"请选择应用编码",trigger:"change"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)},opts_appCodeMap:function(){var e,t=new Map,a=Object(u["a"])(this.opts_appCode);try{for(a.s();!(e=a.n()).done;){var n=e.value;t.set(n.value,n)}}catch(o){a.e(o)}finally{a.f()}return t},selectedAppCode:function(){return this.formData.infos.map((function(e){return e.appCode}))}},watch:{},created:function(){this.getAppOptions()},mounted:function(){this.isEdit&&(this.getRoom(),this.getUnits(),this.getDetail())},methods:{getDetail:function(){var e=this;Object(p["g"])(this.rowData.id).then((function(t){e.formData=O(t.data);var a=Object(g["a"])(t,"data.applicationId",[]);e.formData.infos=a.map((function(e){return{appCode:e}}))})).catch((function(e){}))},clickInfosAdd:function(){this.formData.infos.push({appCode:""})},clickDelete:function(e,t){t.splice(e,1)},getAppOptions:function(){var e=this;Object(f["e"])().then((function(t){e.opts_appCode=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){}))},changeDriver:function(){var e=this.formData,t=e.dbIp,a=e.dbPort,n=e.dbName,o=e.dbDriver,i=o===x||n;if(t&&a&&i)if("com.mysql.cj.jdbc.Driver"===o||"com.mysql.jdbc.Driver"===o)this.formData.dbUrl="jdbc:mysql://".concat(t,":").concat(a,"/").concat(n,"?autoReconnect=true&useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=GMT%2B8");else if("oracle.jdbc.driver.OracleDriver"===o)this.formData.dbUrl="jdbc:oracle:thin:@".concat(t,":").concat(a,":").concat(n);else if(o===x){var r=n?"/"+n:"";this.formData.dbUrl="jdbc:dm://".concat(t,":").concat(a).concat(r,"?useUnicode=true&characterEncoding=utf-8&useSSL=false")}else"org.qianbase.Driver"===o?this.formData.dbUrl="jdbc:qianbase://".concat(t,":").concat(a,"/").concat(n):"org.mariadb.jdbc.Driver"===o?this.formData.dbUrl=" jdbc:mariadb://".concat(t,":").concat(a,"/").concat(n,"?autoReconnect=true&useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=GMT%2B8"):"org.postgresql.Driver"===o?this.formData.dbUrl="jdbc:postgresql://".concat(t,":").concat(a,"/").concat(n):"com.oceanbase.jdbc.Driver"===o&&(this.formData.dbUrl="jdbc:oceanbase://".concat(t,":").concat(a,"/").concat(n,"?autoReconnect=true&useUnicode=true&characterEncoding=utf-8&useSSL=false"));else this.formData.dbUrl=""},changeCityId:function(){this.roomList=[],this.formData.roomId="",this.opts_units=[],this.getRoom()},getRoom:function(){var e=this,t={cityId:this.formData.cityId};Object(D["d"])(t).then((function(t){e.roomList=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},changeRoomId:function(e){this.getUnits()},changeUnitType:function(){this.getUnits()},getUnits:function(){var e=this,t=this.formData,a=t.roomId,n=t.unitType;this.opts_units=[],a&&n&&Object(y["b"])({machineRoomId:a,unitType:n}).then((function(t){e.opts_units=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){}))},clickTest:function(){var e=this,t=this.formData,a=t.dbUrl,n=t.dbDriver,o=t.dbUser,i=t.dbPassword,r={dbUrl:a,dbDriver:n,dbUser:o,dbPassword:i};Object(p["k"])(r).then((function(t){e.$message.success("连接测试通过")}),(function(t){e.$message.warn("连接测试不通过")}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(d["a"])(Object(l["a"])().mark((function t(a){var n;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(n=Object(r["a"])({},e.formData),n.applicationId=e.formData.infos.map((function(e){return e.appCode})),delete n.infos,"0"===n.dbType&&(delete n.dbUrl,delete n.dbDriver,delete n.dbUser,delete n.dbPassword),e.loading=!0,e.isEdit?Object(p["l"])(n).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})):(delete n.id,Object(p["e"])(n).then((function(t){200===t.code&&(e.$message({type:"success",message:"新增成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},I=j,S=(a("9bb8"),a("2877")),_=Object(S["a"])(I,s,c,!1,null,"2ca62590",null),$=_.exports,N=(a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"服务初始化",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading,loadingOptions:e.loadingOptions},on:{close:e.clickCancel}},[t("el-button",{on:{click:e.clickAdd}},[e._v("添加")]),t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"0",rules:e.rules}},[t("el-table",{attrs:{data:e.formData.tableData,"row-key":"id"}},[t("el-table-column",{attrs:{label:"机器信息",prop:"machineId",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.$index,o=a.row;return[t("el-form-item",{key:"machineId"+n,attrs:{prop:"tableData."+n+".machineId",rules:e.rules.machineId}},[t("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.machineListLoading,placeholder:"请选择机器",size:"mini",filterable:""},on:{change:function(t){return e.changeIp(t,o)}},model:{value:o.machineId,callback:function(t){e.$set(o,"machineId",t)},expression:"row.machineId"}},e._l(e.machineList,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.hostIp,"(").concat(a.hostSshAccount,")"),value:a.id}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.hostIp))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"端口",prop:"port",align:"left",width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.$index,o=a.row;return[t("el-form-item",{key:"port"+n,attrs:{label:"",prop:"tableData."+n+".port",rules:e.rules.port}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{size:"mini","controls-position":"right",min:0,max:65535,placeholder:"端口"},model:{value:o.port,callback:function(t){e.$set(o,"port",t)},expression:"row.port"}})],1)]}}])}),t("el-table-column",{attrs:{label:"路径",prop:"deployPath",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.$index,o=a.row;return[t("el-form-item",{key:"deployPath"+n,attrs:{prop:"tableData."+n+".deployPath",rules:e.rules.deployPath}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入路径",size:"mini"},model:{value:o.deployPath,callback:function(t){e.$set(o,"deployPath","string"===typeof t?t.trim():t)},expression:"row.deployPath"}})],1)]}}])}),t("el-table-column",{attrs:{label:"操作",prop:"actions",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.$index,o=a.row;return[t("el-form-item",[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(n,o)}}},[e._v("删除")])],1)]}}])})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),q=[],L=a("3835"),P=(a("dd69"),a("59b0"),a("5c8a")),z={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=this;return{machineListLoading:!1,machineList:[],props:{lazy:!0,lazyLoad:function(t,a){var n=t.level;switch(n){case 0:Object(y["b"])({machineRoomId:e.rowData.roomId,unitType:"1"}).then((function(e){var t=[];Object(b["a"])(null===e||void 0===e?void 0:e.data)&&(t=e.data.map((function(e){return{label:e.unitName,value:e.id}}))),a(t)})).catch((function(e){a([])}));break;case 1:Object(y["d"])(t.value).then((function(e){var t=[];Object(b["a"])(null===e||void 0===e?void 0:e.data)&&(t=e.data.map((function(e){return{label:"".concat(e.hostIp,"(").concat(e.hostSshAccount,")"),value:e.id,leaf:!0}}))),a(t)})).catch((function(e){a([])}))}}},formData:{tableData:[{deployPath:"",machineId:"",unitId:"",port:10001,hostIp:"",switch:!1,cascaders:[]}]},rules:{machineId:[{required:!0,message:"请选择机器",trigger:"change"}],port:[{required:!0,message:"请输入端口",trigger:"change"}],deployPath:[{required:!0,message:"请输入部署路径",trigger:"change"}]},loading:!1,loadingOptions:{text:""},opts_utils:[]}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}}},watch:{},created:function(){},mounted:function(){this.getIps()},methods:{changeCascaders:function(e,t,a){var n=Object(L["a"])(e,2);t.unitId=n[0],t.machineId=n[1];var o=this.$refs["cascaderRef_".concat(a)],i=null===o||void 0===o?void 0:o.getCheckedNodes();if(i&&i.length>0){var r=i[0]||{},s=r.data,c=void 0===s?{}:s,l=(null===c||void 0===c?void 0:c.deploymentPath)||"";this.$set(t,"hostIp",c.hostIp),l?this.$set(t,"deployPath",l+"/config-server"):this.$set(t,"deployPath","")}},changeUtil:function(){},getIps:function(){var e=this;this.machineListLoading=!0,Object(D["h"])().then((function(t){e.machineList=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){})).finally((function(){e.machineListLoading=!1}))},changeIp:function(e,t){var a=this.machineList.find((function(t){return t.id===e}));if(a){this.$set(t,"hostIp",a.hostIp);var n=a.deploymentPath;n?this.$set(t,"deployPath",n+"/config-server"):this.$set(t,"deployPath","")}},clickAdd:function(){this.formData.tableData.push({deployPath:"",machineId:"",unitId:"",port:10001,hostIp:"",switch:!1,cascaders:[]})},clickDelete:function(e,t){this.formData.tableData.length>1?this.formData.tableData.splice(e,1):this.$message.warning("至少添加一条机器")},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){e.loading=!0,e.loadingOptions.text="正在进行环境检测,请稍后";var a=Object(P["a"])(e.formData.tableData);a.forEach((function(e){delete e.cascaders,e.switch||delete e.unitId,delete e.switch}));var n={clusterId:e.rowData.id,configServiceNodeList:a};Object(p["a"])(n).then((function(t){200===t.code&&(e.loadingOptions.text="环境检测通过,正在进行初始化",e.loading=!0,Object(p["f"])(n).then((function(t){200===t.code&&(e.$message.success("初始化完毕"),e.$emit("change",!1),e.refresh())})).catch((function(t){e.loadingOptions.text=t,e.loading=!1})).finally((function(){e.loading=!1})))})).catch((function(t){e.loading=!1,e.loadingOptions.text=t}))}}))}}},E=z,R=Object(S["a"])(E,N,q,!1,null,"97bebc9e",null),T=R.exports,A=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"han-dialog-limit",attrs:{title:"对接示例",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1,top:"10vh",width:"1000px"},on:{close:e.clickCancel}},[t("h3",[e._v(" 1.引入SDK "),t("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.formData.yaml1,expression:"formData.yaml1",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onCopyError,expression:"onCopyError",arg:"error"}],attrs:{type:"text"}},[e._v(" 复制 ")])],1),t("yaml-editor",{staticClass:"yaml-editor",model:{value:e.formData.yaml1,callback:function(t){e.$set(e.formData,"yaml1",t)},expression:"formData.yaml1"}}),t("h3",[e._v(" 2.引入配置文件 "),t("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.formData.yaml2,expression:"formData.yaml2",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onCopyError,expression:"onCopyError",arg:"error"}],attrs:{type:"text"}},[e._v(" 复制 ")])],1),t("yaml-editor",{staticClass:"yaml-editor",model:{value:e.formData.yaml2,callback:function(t){e.$set(e.formData,"yaml2",t)},expression:"formData.yaml2"}}),t("h3",[e._v(" 3.调用方法 "),t("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.formData.yaml3,expression:"formData.yaml3",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onCopyError,expression:"onCopyError",arg:"error"}],attrs:{type:"text"}},[e._v(" 复制 ")])],1),t("yaml-editor",{staticClass:"yaml-editor",model:{value:e.formData.yaml3,callback:function(t){e.$set(e.formData,"yaml3",t)},expression:"formData.yaml3"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},M=[],U=a("08da"),F=a("a1ed"),B="\n<dependency>\n    <groupId>dap.paas</groupId>\n        <artifactId>dap-paas-spring-seq-client</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n";function G(e){var t=e||{},a=(t.sdkName,t.serverName),n=void 0===a?"":a,o=t.serverUrls,i=void 0===o?"":o,r=t.tenantId,s="####序列SDK相关配置\n  dap:\n    #序列配置\n    sequence:\n      #客户端名称、应用名称\n      clientName: app-name\n      #集群名称\n      seqClusterName: ".concat(n,"\n      # 集群下所有server的地址信息\n      urls: ").concat(i,"\n      #租户编号\n      tenantId: ").concat(r);return s}var H='\n/**\n * 引入Client 类\n */\n@Autowired(required = false)\nprivate SequenceGeneratorClient sequenceGeneratorClient;\n\n/**\n *根据序列编号获取全局唯一ID序\n */\n@RequestMapping(value = "getSequenceCode/{seqCode}", method = RequestMethod.GET)\npublic String test(@PathVariable("seqCode") String seqCode) throws Exception {\n    String sequence = sequenceGeneratorClient.getStringSequence(seqCode);\n    return sequence;\n}\n\n/**\n *根据序列编号获取全局唯一ID序\n */\n@RequestMapping(value = "getBigIntegerSequence/{seqCode}", method = RequestMethod.GET)\npublic Object getBigIntegerSequence(@PathVariable("seqCode") String seqCode) throws Exception {\n    BigInteger sequence = sequenceGeneratorClient.getBigIntegerSequence(seqCode);\n    return sequence;\n}\n\n/**\n * 获取每日切换序列\n */\n@RequestMapping(value = "getDaySwitchSequence/{seqCode}", method = RequestMethod.GET)\npublic String getDaySwitchSequence(@PathVariable("seqCode") String seqCode) throws Exception {\n    String sequence = sequenceGeneratorClient.getDaySwitchSequence(seqCode, new Date());\n    return sequence;\n}\n\n/**\n * 雪花算法获取全局唯一id\n *\n * @return\n */\n@RequestMapping(value = "getSnowFlake", method = RequestMethod.GET)\npublic String getSnowFlake() {\n    String sequence = sequenceGeneratorClient.getSnowFlake();\n    return sequence;\n}\n\n',V={components:{YamlEditor:U["a"],JavaEditor:F["a"]},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null}},data:function(){return{formData:{yaml1:B,yaml2:G({tenantId:this.rowData.tenantId}),yaml3:H}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}}},watch:{},created:function(){this.getDetail()},mounted:function(){},methods:{getDetail:function(){var e,t,a=this;null!==(e=this.rowData)&&void 0!==e&&e.id&&Object(p["d"])(null===(t=this.rowData)||void 0===t?void 0:t.id).then((function(e){a.formData.yaml2=G(Object(r["a"])({tenantId:a.rowData.tenantId},e.data))})).catch((function(e){}))},clickCancel:function(){this.$emit("change",!1)},onCopySuccess:function(e){this.$message.success("复制成功")},onCopyError:function(e){this.$message.success("复制失败")}}},K=V,W=Object(S["a"])(K,A,M,!1,null,"5700c473",null),Y=W.exports,J=Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({mixins:[],components:{AddAndEdit:$,DialogServiceInit:T,DialogDockingExample:Y}},"mixins",[]),"data",(function(){this.$createElement;return{clusterId:"",rowData:null,showAdd:!1,showInit:!1,showExample:!1,buttonList:[{label:"新增",type:"add",click:this.addInfo}],tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"name",label:"集群名称",align:"center"},{prop:"cityName",label:"省、市",align:"center"},{prop:"machineName",label:"数据中心",align:"center",render:function(e,t){var a=t.row;return e("span",[a.machineName,"(",a.machineRoomCode,")"])}},{prop:"node",label:"服务数量",align:"center"},{prop:"status",label:"集群状态",align:"center",render:function(e,t){var a=t.row,n=m["b"].find((function(e){return e.value===a.status}));return n?e("hubaryDot",{attrs:{text:n.label,status:n.status}}):e("span")}}],operate:{width:220,list:[{label:"服务初始化",id:"click_init",isShow:function(e){return 0==e.node}},{label:"服务管理",id:"click_manage",isShow:function(e){return e.node>0}},{label:"编辑",id:"edit"},{label:"删除",id:"delete"},{label:"一键启动",id:"start_up",isShow:function(e){return"0"===e.status&&e.node>0}},{label:"一键停止",id:"stop",isShow:function(e){return"1"===e.status}}]}},searchConfig:{searchData:{name:""},searchItem:[{type:"input",label:"集群名称",prop:"name"}],rules:{}}}})),"computed",{}),"watch",{}),"mounted",(function(){this.onSearch()})),"methods",{onEnterSearch:function(e,t){},getList:function(){var e=this,t={pageSize:this.tableConfig.pagination.pageSize,pageNo:this.tableConfig.pagination.pageNo,requestObject:Object(r["a"])({},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(p["i"])(t).then((function(t){var a=Object(g["a"])(t,"data.data");e.tableConfig.tableData=Object(b["a"])(a)?a:[],e.tableConfig.pagination.total=Object(g["a"])(t,"data.totalCount")})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.showAdd=!0,this.rowData=null},clickDeployRecord:function(){this.$router.push({path:"/environmentManagement/deploy-record"})},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getIndex:function(e){var t=this,a=(e.index,e.row),n=e.operate;switch(this.clusterId=this.searchConfig.searchData.clusterId,this.rowData=a,n.id){case"edit":this.showAdd=!0;break;case"delete":this.$confirm("确定要删除【".concat(a.name,"】吗?"),{type:"warning"}).then((function(){Object(p["c"])(a.id).then((function(e){t.$message.success("删除成功"),t.getList()})).catch((function(e){}))})).catch((function(e){}));break;case"click_init":this.showInit=!0;break;case"click_manage":this.$router.push({path:"/environmentManagement/service-cluster-manage/node-manage",query:{id:a.id,name:a.name,machineroomName:a.machineName,machineRoomId:a.roomId,node:a.node}});break;case"start_up":this.$confirm("确定要启动【".concat(a.name,"】吗?")).then((function(){var e={id:a.id};Object(p["j"])(e).then((function(e){200===e.code&&(t.$message.success("启动成功"),t.getList())})).catch((function(e){})).finally((function(){}))}));break;case"stop":this.$confirm("确定要停止【".concat(a.name,"】吗?")).then((function(){var e={id:a.id};Object(p["b"])(e).then((function(e){200===e.code&&(t.$message.success("停止成功"),t.getList())})).catch((function(e){})).finally((function(){}))}));break;case"docking_example":this.showExample=!0;break}}}),Z=J,Q=Object(S["a"])(Z,n,o,!1,null,"402cf7c0",null);t["default"]=Q.exports},"0fc2":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{style:{height:e.height,width:e.width},attrs:{id:"mountNode"}})},o=[],i=(a("cb29"),a("a15b"),a("7c3e")),r={name:"g6-dagre",components:{},mixins:[],props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},chartData:{type:Object,default:function(){return{nodes:[],edges:[]}}}},data:function(){return{graph:null}},computed:{},watch:{},created:function(){},mounted:function(){this.initDagre(),window.addEventListener("resize",this.resize)},destroyed:function(){window.removeEventListener("resize",this.resize),this.graph=null},methods:{initDagre:function(){var e=this,t=this.chartData;i["a"].registerNode("sql",{drawShape:function(e,t){var a=t.addShape("rect",{attrs:{x:-75,y:-25,width:150,height:50,radius:10,stroke:"#5B8FF9",lineWidth:1,fill:e.style.fill},name:"rect-shape"});return a}},"single-node");var a=1===t.nodes.length,n=new i["a"].Graph({container:"mountNode",fitView:!0,pixelRatio:2,maxZoom:a?3:10,layout:{type:"grid",begin:[20,20],nodeSize:150,preventOverlap:!0},animate:!0,defaultNode:{type:"sql",style:{stroke:"#C4E3B2",radius:7},labelCfg:{style:{fill:"#000",fontSize:14}}},comboStateStyles:{selected:{shadowBlur:1,lineWidth:1}},nodeStateStyles:{selected:{shadowColor:"#1d70f5",shadowBlur:10,lineWidth:2,cursor:"pointer"}},modes:{default:["drag-canvas","zoom-canvas","click-select",{type:"tooltip",formatText:function(e){var t=[];return t.join("\n")},offset:30}]}});n.data(t),n.render(),n.fitView(),this.graph=n,n.on("node:click",(function(t){t.target;var a=t.item,n=a.getModel();e.$emit("click-node",n)}))},resize:function(){var e=this.$el,t=e.offsetHeight,a=e.offsetWidth;this.graph.changeSize(a,t)}}},s=r,c=a("2877"),l=Object(c["a"])(s,n,o,!1,null,"17b08f66",null);t["default"]=l.exports},"3a2e":function(e,t,a){"use strict";a("bcab")},4836:function(e,t,a){"use strict";a("03d8")},"4eb4":function(e,t,a){"use strict";a.r(t);a("99af"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mode-page"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-content",attrs:{"element-loading-text":"加载中,请稍候......"}},[t("div",{staticClass:"main-left"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickAddNode}},[e._v("新增服务")]),t("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),!e.loading&&e.linksData.length>0?t("G6Dagre",{attrs:{"chart-data":e.chartData,height:"500px",width:"100%"},on:{"click-node":e.clickNode}}):t("el-empty",{attrs:{description:"暂无数据"}})],1),t("div",{staticClass:"main-right"},[t("el-descriptions",{staticClass:"margin-top",attrs:{title:"集群:".concat(e.baseInfo.name||""),column:2,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.refresh}},[e._v("刷新")])],1),e.currentNode?t("el-descriptions-item",{attrs:{label:"单元名称"}},[e._v(" "+e._s(e.currentNode.unitName)+" ")]):e._e()],2),e.currentNode?[t("el-descriptions",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingNode,expression:"loadingNode"}],staticClass:"mt-10",staticStyle:{"padding-top":"15px","border-top":"1px solid #c6c6c6"},attrs:{title:"服务:".concat(e.currentNode.value,":").concat(e.currentNode.port),column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"运行状态",span:2,"label-style":{lineHeight:"28px"},"content-style":{lineHeight:"28px"}}},[e._v(" "+e._s(e._f("F_registerInstanceStatusOptions")(e.currentNode.status))+" "),"1"===e.currentNode.status?t("el-button",{staticClass:"ml-10",attrs:{size:"mini",round:"",plain:"",type:"danger"},on:{click:function(t){return e.clickStop()}}},[e._v(" 停止 ")]):t("el-button",{staticClass:"ml-10",attrs:{type:"primary",size:"mini",round:"",plain:""},on:{click:function(t){return e.clickStart()}}},[e._v(" 启动 ")])],1),t("el-descriptions-item",{attrs:{label:"部署路径"}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.currentNode.deployPath,expression:"currentNode.deployPath"}],attrs:{size:"mini"}},[e._v(e._s(e.currentNode.deployPath))])],1)],1),t("el-divider"),t("button-list",{attrs:{data:e.buttonList}})]:e._e()],2)]),e.addmasternode?t("DialogAddNode",{attrs:{"cluster-id":e.clusterId,"node-type":e.nodeType_add,"row-data":e.currentNode,refresh:e.refresh},model:{value:e.addmasternode,callback:function(t){e.addmasternode=t},expression:"addmasternode"}}):e._e(),e.startLogShow?t("DrawerPrismjsLog",{attrs:{show:e.startLogShow,rowData:e.currentNode},on:{"update:show":function(t){e.startLogShow=t}}}):e._e()],1)},o=[],i=a("c7eb"),r=a("1da1"),s=a("5530"),c=(a("14d9"),a("d3b7"),a("1bf2"),a("3ca3"),a("159b"),a("ddb0"),a("0fc2")),l=a("618a"),d=a("d862"),u=a("4c3e"),p=a("ff51"),f=a("bc59"),m=a("2b0e"),h={filters:{F_registerInstanceStatusOptions:function(e){return Object(u["a"])(e,"registerInstanceStatusOptions")}},components:{G6Dagre:c["default"],DialogAddNode:d["default"],DrawerPrismjsLog:Object(m["defineAsyncComponent"])((function(){return Promise.all([a.e("chunk-7ef164fc"),a.e("ConfigServiceLog~5aea0d32")]).then(a.bind(null,"796e"))}))},data:function(){return{baseInfo:{},loading:!1,loadingNode:!1,buttonList:[{label:"移除服务",click:this.clickNodeDelete},{label:"服务日志",click:this.clickStartLog}],chartData:{edges:[],nodes:[]},addmasternode:!1,currentNode:null,currentQueryNode:g(),linksData:[],nodeType_add:0,updateTime:"",startLogShow:!1}},computed:{clusterId:function(){return this.$route.query.id},query:function(){return this.$route.query}},created:function(){this.getDetail(),this.baseInfo.name=this.query.name,this.baseInfo.machineroomName=this.query.machineroomName,this.baseInfo.node=this.query.node},methods:{changeTime:function(e){this.updateTime=e},clickCancel:function(){this.startLogShow=!1},clickStartLog:function(){this.startLogShow=!0},clickStart:function(){var e=this;this.loadingNode=!0,Object(l["h"])({id:this.currentNode.id}).then((function(t){200===t.code&&(e.refresh(),e.$message.success("启动成功"))})).finally((function(){e.loadingNode=!1}))},clickStop:function(){var e=this;this.loadingNode=!0,Object(l["g"])({id:this.currentNode.id}).then((function(t){200===t.code&&(e.refresh(),e.$message.success("停止成功"))})).finally((function(){e.loadingNode=!1}))},getDetail:function(){var e=this;this.loading=!0,this.currentNode=null,Object(l["f"])(this.$route.query.id).then((function(t){if(t){var a=Object(p["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.linksData=a;var n=[],o=[];a.forEach((function(e){var t;"1"===e.isMaster?t="main":"0"===e.isMaster&&(t="cong");var a=Object(u["a"])(e.status,"registerInstanceStatusOptions",["value","fill"]);n.push(Object(s["a"])(Object(s["a"])({},e),{},{value:e.hostIp,comboId:t,label:"".concat(e.hostIp,":").concat(e.port),style:{fill:a}}))})),e.chartData.nodes=n,e.chartData.edges=o}})).catch((function(e){})).finally((function(){e.loading=!1}))},clickAddNode:function(){this.nodeType_add=0,this.addmasternode=!0},clickNodeDelete:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!=e.currentNode.status){t.next=3;break}return e.clickConfirmDelete(),t.abrupt("return");case 3:return t.next=5,e.$confirm("确定要移除".concat(e.currentNode.hostIp,":").concat(e.currentNode.port,"吗?"),{type:"warning"}).catch((function(e){}));case 5:a=t.sent,"confirm"===a&&Object(l["b"])(e.currentNode.id).then((function(t){e.refresh(),e.$message.success("移除成功")})).catch((function(e){}));case 8:case"end":return t.stop()}}),t)})))()},clickConfirmDelete:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$confirm("节点正在运行,确认删除吗?","提示",{type:"warning"}).catch((function(){}));case 2:a=t.sent,"confirm"===a&&Object(l["c"])(e.currentNode.id).then((function(t){e.refresh(),e.$message.success("移除成功")})).catch((function(e){}));case 4:case"end":return t.stop()}}),t)})))()},clickNode:function(e){this.currentNode=e},refresh:function(){this.getDetail()}}};function g(e){var t={pid:"",usedMemory:"",usedCpuSys:"",keys:"",clients:"",expires:"",flags:""};return e&&Reflect.ownKeys(t).forEach((function(a){Object(f["a"])(e,a)&&(t[a]=e[a])})),Object.assign(t,e)}var b=h,v=(a("a60c"),a("2877")),y=Object(v["a"])(b,n,o,!1,null,"1a033e57",null);t["default"]=y.exports},5678:function(e){e.exports=JSON.parse('{"code":200,"msg":"登录成功","data":{"account":"admin","sex":null,"birthday":null,"name":null,"salt":null,"password":"$2a$10$po8hVtcGFfEIiZD/EWvheuzIjPt5xAKoXFRPgd/Ytd4uy9IgynWxO","mail":null,"phone":null,"status":null,"isDelete":null,"isFrozen":null,"address":null,"userIp":null,"idCast":null,"userName":"admin","entryDate":null,"theme":"theme-1d70f5","orgList":null,"urls":[],"allUrls":[],"userId":"190504316862201856","allSysMenuDtoList":null,"sysMenuDtoList":null,"dataPermessionList":{},"sessionId":"2D78481DB32534798171B8484269602C","appList":null,"sysOperateSignList":[],"userAppMenuMap":{}}}')},"6f8b":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"welcome-to-paas"},[t("Header"),t("div",{staticClass:"paas-content"},[t("div",{staticClass:"intro-container"},[t("div",{staticClass:"intro-text"},[t("h3",[t("span",[e._v(e._s(e.tenant.tenantCompany))]),t("span",{staticClass:"ml-10",staticStyle:{"font-weight":"500","font-size":"12px"}},[e._v(" "+e._s(e.title)+" ")])])]),t("svg-icon",{attrs:{"class-name":"middleware","icon-class":"iconsvg-dataphin"}})],1),t("div",{staticClass:"menu-container"},[t("div",[t("span",[e._v("实例标识："+e._s(e.tenant.tenantCode))])]),t("ul",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"menu-list"},e._l(e.menuList,(function(a){return t("li",{key:a.label},[t("div",{staticClass:"item-inner-box"},[t("span",{staticClass:"icon-bg"},[t("svg-icon",{attrs:{"class-name":"icon-common","icon-class":a.icon}})],1),t("div",[t("div",{staticStyle:{"margin-bottom":"5px"}},[e._v(e._s(a.label))]),t("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary",href:a.docRouter,disabled:!a.docRouter,target:"_blank"}},[e._v("文档")]),e._v(" | "),t("el-button",{staticStyle:{"margin-left":"0"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.goPage(a)}}},[e._v("控制台")])],1)])])})),0)])])],1)},o=[],i=a("c7eb"),r=a("b85c"),s=a("1da1"),c=a("5530"),l=(a("7db0"),a("14d9"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("cd4a")),d=a("72c5"),u=a("2f62"),p=a("a18c"),f=a("a6a8"),m=a("294c"),h=a("ff51"),g=a("ec41"),b=a("9dd6"),v=a("83d6"),y={name:"home-page",components:{Header:l["b"]},mixins:[d["a"]],data:function(){return{title:v["title"],appMenu:f["a"],loading:!1,remoteMenuList:[]}},computed:Object(c["a"])(Object(c["a"])(Object(c["a"])(Object(c["a"])({fixedHeader:function(){return this.$store.state.settings.fixedHeader}},Object(u["d"])(["sidebar","avatar","permission_routes"])),Object(u["e"])("router",["accessRemoteApp"])),Object(u["e"])("user",["tenant"])),{},{menuList:function(){return b["dynamicRouting"]?this.accessRemoteApp:f["a"]}}),created:function(){b["dynamicRouting"]&&0==this.accessRemoteApp.length&&this.getHomeData()},mounted:function(){},methods:Object(c["a"])(Object(c["a"])({},Object(u["c"])("router",["toggleSidebarMenuAt","generateRoutes"])),{},{getHomeData:function(){var e=this;return Object(s["a"])(Object(i["a"])().mark((function t(){var a,n,o,s,l,d;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,a=[],n=[],t.next=5,Object(m["a"])().catch((function(e){}));case 5:o=t.sent,a=Object(h["a"])(null===o||void 0===o?void 0:o.data)?o.data:[],s=Object(r["a"])(f["a"]),t.prev=8,d=Object(i["a"])().mark((function e(){var t,o;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=l.value,o=a.find((function(e){return e.code===t.code})),o){e.next=4;break}return e.abrupt("return",1);case 4:n.push(Object(c["a"])(Object(c["a"])({},t),{},{id:o.id,label:o.name}));case 5:case"end":return e.stop()}}),e)})),s.s();case 11:if((l=s.n()).done){t.next=17;break}return t.delegateYield(d(),"t0",13);case 13:if(!t.t0){t.next=15;break}return t.abrupt("continue",15);case 15:t.next=11;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t["catch"](8),s.e(t.t1);case 22:return t.prev=22,s.f(),t.finish(22);case 25:e.$store.commit("router/SET_ACCESS_REMOTE",n),e.remoteMenuList=a,e.loading=!1;case 28:case"end":return t.stop()}}),t,null,[[8,19,22,25]])})))()},goPage:function(e){var t=this;this.toggleSidebarMenuAt(e),this.loading=!0,this.generateRoutes().then((function(e){Object(p["b"])(t.permission_routes),t.loading=!1})).then((function(){var e=Object(g["a"])(t.permission_routes,"0.path");e?t.$router.push({path:e}):t.$message.warning("暂未授权菜单, 请授权后使用")}))}})},w=y,D=(a("4836"),a("2877")),C=Object(D["a"])(w,n,o,!1,null,"1ab0c036",null);t["default"]=C.exports},"773c":function(e,t,a){},"7d12":function(e,t,a){"use strict";a("d769")},"976f":function(e,t,a){},"9bb8":function(e,t,a){"use strict";a("976f")},"9ed6":function(e,t,a){"use strict";a.r(t);a("498a");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-login",class:{"is-support-webp":!1}},[t("div",{staticClass:"login-container"},[t("div",{staticClass:"left-system",attrs:{span:14}},[t("ul",[t("li",[e._v(e._s(e.siteTitle))])])]),t("div",{staticClass:"right-login",attrs:{span:10}},[t("div",{staticClass:"login-logo"}),t("div",{staticClass:"login-title"},[e._v(e._s(e.siteTitle))]),t("el-form",{ref:"formRef",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"auto-complete":"on","label-position":"left"}},[t("el-form-item",{attrs:{prop:"tenantCode"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{"value-key":"tenantCode",placeholder:"请选择租户",size:"login"},model:{value:e.loginForm.tenantItem,callback:function(t){e.$set(e.loginForm,"tenantItem",t)},expression:"loginForm.tenantItem"}},[t("span",{attrs:{slot:"prefix"},slot:"prefix"},[t("i",{staticClass:"el-input__icon el-icon-school"})]),e._l(e.tentandList,(function(e){return t("el-option",{key:e.tenantCode,attrs:{label:e.tenantName,value:e}})}))],2)],1),t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{placeholder:"用户名","prefix-icon":"el-icon-user",size:"login",type:"text",tabindex:"1","auto-complete":"on"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username","string"===typeof t?t.trim():t)},expression:"loginForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入密码","prefix-icon":"el-icon-lock",tabindex:"2",size:"login","auto-complete":"on","show-password":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password","string"===typeof t?t.trim():t)},expression:"loginForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{loading:e.loading,type:"login"},on:{click:e.handleLogin}},[e._v("登录 ")])],1)],1)],1)])])},o=[],i=a("c7eb"),r=a("1da1"),s=(a("d9e2"),a("d3b7"),a("07ac"),a("ac1f"),a("5319"),a("159b"),a("c24f")),c=a("ec41"),l=a("83d6"),d=a("5678"),u={name:"Login",data:function(){var e=function(e,t,a){t?a():a(new Error("请输入用户名"))},t=function(e,t,a){t.length<6?a(new Error("密码不能少于6位")):a()};return{tentandList:[],siteTitle:l["title"],loginForm:{username:"",password:"",get tenantCode(){return this.tenantItem?this.tenantItem.tenantCode:""},tenantItem:null},loginRules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}],tenantCode:[{required:!0,trigger:"blur",message:"请选择租户"}]},loading:!1}},watch:{},created:function(){this.getTenant()},methods:{getTenant:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(s["b"])();case 2:a=t.sent,e.tentandList=Object(c["a"])(a,"data",[]);case 4:case"end":return t.stop()}}),t)})))()},handleLogin:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a,n,o,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.formRef.validate();case 2:if(a=t.sent,a){t.next=5;break}return t.abrupt("return");case 5:if(n=null,e.loading=!0,!l["isLogin"]){t.next=22;break}return t.next=10,Object(s["a"])({username:e.loginForm.username,password:e.loginForm.password,tenantCode:e.loginForm.tenantCode});case 10:if(o=t.sent,200!==(null===o||void 0===o?void 0:o.code)){t.next=17;break}e.$store.commit("user/SET_TENANT",e.loginForm.tenantItem),n=o.data,t.next=20;break;case 17:return e.$message.error(o.msg),e.loading=!1,t.abrupt("return");case 20:t.next=23;break;case 22:n=d.data;case 23:if(n){t.next=26;break}throw new Error("登录数据错误!");case 26:return r={},n.userAppMenuMap&&Object.values(n.userAppMenuMap).forEach((function(e){r[e.id]=(null===e||void 0===e?void 0:e.children)||[]})),delete n.userAppMenuMap,n.userMenuMap=r,t.next=33,e.$store.dispatch("user/login",n);case 33:e.$router.replace({path:"/"});case 35:case"end":return t.stop()}}),t)})))()}}},p=u,f=(a("3a2e"),a("2877")),m=Object(f["a"])(p,n,o,!1,null,"d11bf030",null);t["default"]=m.exports},a60c:function(e,t,a){"use strict";a("773c")},bcab:function(e,t,a){},d769:function(e,t,a){},d862:function(e,t,a){"use strict";a.r(t);a("99af"),a("498a");var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"新增服务",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1,loadingOptions:e.loadingOptions,loading:e.loading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"机器",prop:"machineId"}},[t("el-select",{staticClass:"w-100",attrs:{loading:e.machineListLoading,size:"mini",placeholder:"请选择机器",filterable:""},on:{change:e.changeIp},model:{value:e.formData.machineId,callback:function(t){e.$set(e.formData,"machineId",t)},expression:"formData.machineId"}},e._l(e.machineList,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.hostIp,"(").concat(a.hostSshAccount,")"),value:a.id}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.hostIp))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1)],1),t("el-form-item",{attrs:{label:"节点端口",prop:"port"}},[t("el-input-number",{staticClass:"w-100",attrs:{size:"mini","controls-position":"right",min:1e3,max:65535,placeholder:"端口"},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",t)},expression:"formData.port"}})],1),t("el-form-item",{attrs:{label:"部署路径"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入部署路径",size:"mini"},model:{value:e.formData.deployPath,callback:function(t){e.$set(e.formData,"deployPath","string"===typeof t?t.trim():t)},expression:"formData.deployPath"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("c7eb"),r=a("1da1"),s=a("5530"),c=a("3835"),l=(a("7db0"),a("d81d"),a("a9e3"),a("d3b7"),a("dd69"),a("fbd2")),d=a("618a"),u=a("934b"),p=a("ff51"),f={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,refresh:Function,rowData:{type:Object,default:function(){return{}}},clusterId:{type:String,default:void 0},nodeType:{type:Number,default:void 0}},data:function(){return{cascaders:[],formData:{machineId:"",deployPath:"",port:10001,hostIp:"",unitId:""},machineListLoading:!1,machineList:[],rules:{machineId:[{required:!0,trigger:"change",message:"请选择节点"}],unitId:[{required:!0,trigger:"change",message:"请选择单元"}],port:[{required:!0,trigger:"blur",message:"请输入端口"}]},options:[],loading:!1,loadingOptions:{text:""},props:{lazy:!0,lazyLoad:this.lazyLoad}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},machineRoomId:function(){return this.$route.query.machineRoomId}},watch:{},created:function(){},mounted:function(){this.getIps()},methods:{changeCascaders:function(e){var t=Object(c["a"])(e,2);this.formData.unitId=t[0],this.formData.machineId=t[1];var a=this.$refs.cascaderRef,n=null===a||void 0===a?void 0:a.getCheckedNodes();if(n&&n.length>0){var o=n[0]||{},i=o.data,r=void 0===i?{}:i,s=(null===r||void 0===r?void 0:r.deploymentPath)||"";this.formData.hostIp=(null===r||void 0===r?void 0:r.hostIp)||"",s?this.$set(this.formData,"deployPath",s+"/config-server"):this.$set(this.formData,"deployPath","")}},getIps:function(){var e=this;this.machineListLoading=!0,Object(l["h"])().then((function(t){e.machineList=Object(p["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){})).finally((function(){e.machineListLoading=!1}))},changeIp:function(e){var t=this.machineList.find((function(t){return t.id===e})),a=(null===t||void 0===t?void 0:t.deploymentPath)||"";this.formData.hostIp=(null===t||void 0===t?void 0:t.hostIp)||"",a?this.$set(this.formData,"deployPath",a+"/config-server"):this.$set(this.formData,"deployPath","")},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){e.loading=!0,e.loadingOptions.text="正在进行环境检测,请稍后";var a=Object(s["a"])({clusterId:e.clusterId},e.formData);a.switch||delete a.unitId,Object(d["a"])(a).then((function(t){200===t.code&&(e.loadingOptions.text="环境检测通过,正在进行初始化",e.loading=!0,Object(d["e"])(a).then((function(t){200===t.code&&(e.$message.success("初始化完毕"),e.$emit("change",!1),e.refresh())})).catch((function(t){e.loadingOptions.text=t,e.loading=!1})).finally((function(){e.loading=!1})))})).catch((function(t){e.loading=!1,e.loadingOptions.text=t}))}}))},lazyLoad:function(e,t){var a=this;return Object(r["a"])(Object(i["a"])().mark((function n(){var o,r,c,l;return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=e.level,r=[],n.t0=o,n.next=0===n.t0?7:1===n.t0?18:29;break;case 7:return n.prev=7,n.next=10,Object(u["b"])({machineRoomId:a.machineRoomId,unitType:"1"});case 10:c=n.sent,Object(p["a"])(null===c||void 0===c?void 0:c.data)&&(r=c.data.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{label:e.unitName,value:e.id})}))),n.next=17;break;case 14:n.prev=14,n.t1=n["catch"](7);case 17:return n.abrupt("break",29);case 18:return n.prev=18,n.next=21,Object(u["d"])(e.value);case 21:l=n.sent,Object(p["a"])(null===l||void 0===l?void 0:l.data)&&(r=l.data.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{label:"".concat(e.hostIp,"(").concat(e.hostSshAccount,")"),value:e.id,leaf:!0})}))),n.next=28;break;case 25:n.prev=25,n.t2=n["catch"](18);case 28:return n.abrupt("break",29);case 29:t(r);case 30:case"end":return n.stop()}}),n,null,[[7,14],[18,25]])})))()}}},m=f,h=(a("7d12"),a("2877")),g=Object(h["a"])(m,n,o,!1,null,"6c5fa5e2",null);t["default"]=g.exports}}]);