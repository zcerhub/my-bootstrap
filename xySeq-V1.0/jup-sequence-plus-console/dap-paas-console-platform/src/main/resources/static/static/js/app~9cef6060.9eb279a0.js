(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~9cef6060"],{"143f":function(e,t,a){},"14c32":function(e,t,a){},21631:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flow-minitoring-page"},[t("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:20}},[t("el-col",{attrs:{span:5}},[t("el-select",{staticClass:"w-100",attrs:{size:"small",placeholder:"请选择"},on:{change:e.getServiceOptions},model:{value:e.resourcesName,callback:function(t){e.resourcesName=t},expression:"resourcesName"}},e._l(e.resourcesOptions,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-col",{attrs:{span:5}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",size:"small"},on:{change:e.getServiceDetail},model:{value:e.serviceName,callback:function(t){e.serviceName=t},expression:"serviceName"}},e._l(e.serviceOptions,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-col",{attrs:{span:5}},[t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")])],1)],1),t("el-card",[t("div",{staticClass:"header-section"},[t("span",[e._v("实时监控")]),t("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getServiceDetail(e.serviceName)}}},[e._v("刷新")])],1),t("el-card",{staticClass:"content-section"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(e.chartResName))])]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("LineCharts",{directives:[{name:"loading",rawName:"v-loading",value:e.chartsLoading,expression:"chartsLoading"}],attrs:{height:"350px",lineData:e.dataPut}})],1),t("el-col",{attrs:{span:12}},[t("tableView",{ref:"tableView",staticClass:"tableView",attrs:{loading:e.tableConfig.loading,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,rowKey:"id",height:"320px",isPage:e.tableConfig.isPage}})],1)],1)],1)],1)],1)},o=[],r=(a("d81d"),a("14d9"),a("fb6a"),a("4e82"),a("d3b7"),a("2a0d")),n=a("9e25"),l=a("ec41"),s=a("ff51"),c=a("5c8a"),u=a("f926"),f={components:{LineCharts:r["default"]},data:function(){this.$createElement;return{chartResName:"",resourcesCurrent:"",resourcesResult:{},resourcesName:"",resourcesOptions:[],serviceResult:{},serviceName:"",serviceOptions:[],chartsLoading:!1,dataPut:{name:"",legend:{data:["通过QPS","拒绝QPS"],left:"center",top:5},xAxisData:[],data:[],color:["rgba(18,61,172,0.5)"]},tableConfig:{loading:!1,isPage:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"date",label:"时间",align:"center",render:function(e,t){var a=t.row;return e("span",[a.passedQPS&&a.blockedQPS?Object(u["a"])(a.date,"HH:mm:ss"):"-"])}},{prop:"passedQPS",label:"通过QPS",align:"center",render:function(e,t){var a=t.row;return e("span",[a.passedQPS&&a.blockedQPS?a.passedQPS:"-"])}},{prop:"blockedQPS",label:"拒绝QPS",align:"center",render:function(e,t){var a=t.row;return e("span",[a.passedQPS&&a.blockedQPS?a.blockedQPS:"-"])}},{prop:"rt",label:"响应时间",align:"center",render:function(e,t){var a=t.row;return e("span",[a.passedQPS&&a.blockedQPS?a.rt:"-"])}}],operate:{width:220,list:[]}}}},computed:{rowData:function(){return this.$route.query}},mounted:function(){this.getResourcesOptions()},methods:{getResourcesOptions:function(){var e=this;Object(n["b"])({baseId:this.rowData.baseId,appCode:this.rowData.appCode}).then((function(t){var a=Object(l["a"])(t,"data"),i=[];for(var o in a)i.push(o);e.resourcesOptions=i,e.resourcesName=e.resourcesOptions[0],e.resourcesCurrent=a[e.resourcesName],e.getServiceOptions(e.resourcesName)}))},getServiceOptions:function(e){var t=this;Object(n["c"])({id:this.resourcesCurrent.id,appCode:this.resourcesCurrent.appCode,resourceName:e}).then((function(e){t.serviceResult=Object(l["a"])(e,"data");var a=[];for(var i in t.serviceResult)a.unshift(i);t.serviceOptions=a,t.serviceName=t.serviceOptions[0],t.getServiceDetail(t.serviceName)}))},getServiceDetail:function(e){var t=this;this.tableConfig.loading=!0,this.chartsLoading=!0;var a=this.serviceResult[e];Object(n["a"])(a).then((function(e){var a;t.$message.success(e.msg);var i=Object(l["a"])(e,"data"),o=Object(s["a"])(i)?Object(c["a"])(i):[],r=o.slice().sort((function(e,t){return new Date(t.date)-new Date(e.date)}));t.dataPut.xAxisData=o.map((function(e){return Object(u["a"])(e.date,"HH:mm:ss")}));var n=o.map((function(e){return e.passedQPS})),f=o.map((function(e){return e.blockedQPS})),p=[{name:"通过QPS",value:n},{name:"拒绝QPS",value:f}];t.dataPut.data=p,t.chartResName=(null===(a=o[0])||void 0===a?void 0:a.resourceName)||"",t.tableConfig.tableData=r.slice(0,6)})).finally((function(){t.tableConfig.loading=!1,t.chartsLoading=!1}))}}},p=f,m=(a("4ead"),a("2877")),d=Object(m["a"])(p,i,o,!1,null,"62fe25b4",null);t["default"]=d.exports},2630:function(e,t,a){},2666:function(e,t,a){},"281e":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.total,operateSlice:3,rowKey:"id",isPage:e.tableConfig.isPage,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAddDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e(),e.showConfigDialog?t("FrameConfig",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showConfigDialog,callback:function(t){e.showConfigDialog=t},expression:"showConfigDialog"}}):e._e(),e.showWhiteListDialog?t("WhiteListConfig",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showWhiteListDialog,callback:function(t){e.showWhiteListDialog=t},expression:"showWhiteListDialog"}}):e._e(),e.showFuse?t("SwitchFuse",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showFuse,callback:function(t){e.showFuse=t},expression:"showFuse"}}):e._e(),e.showResourceDialog?t("ResourceMatching",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showResourceDialog,callback:function(t){e.showResourceDialog=t},expression:"showResourceDialog"}}):e._e()],1)},o=[],r=a("5530"),n=(a("d81d"),a("14d9"),a("d3b7"),a("a4d3"),a("e01a"),function(){var e=this,t=e._self._c;return t("div",[t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"所属应用",prop:"baseId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:e.isEdit,placeholder:"请选择"},on:{change:e.appChange},model:{value:e.form.baseId,callback:function(t){e.$set(e.form,"baseId",t)},expression:"form.baseId"}},e._l(e.appOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.appName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"流控框架",prop:"limitFrame"}},[t("el-input",{attrs:{disabled:"",size:"mini"},model:{value:e.form.limitFrame,callback:function(t){e.$set(e.form,"limitFrame",t)},expression:"form.limitFrame"}})],1),t("el-form-item",{attrs:{label:"应用框架",prop:"appFrame"}},[t("el-input",{attrs:{disabled:"",size:"mini"},model:{value:e.form.appFrame,callback:function(t){e.$set(e.form,"appFrame",t)},expression:"form.appFrame"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",size:"mini"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)],1)}),l=[],s=a("c7eb"),c=a("1da1"),u=(a("d9e2"),a("7db0"),a("b64b"),a("159b"),a("cba0")),f=a("dcf6"),p=a("bc59"),m=a("ec41");function d(e){var t={id:"",baseId:"",limitFrame:"",appFrame:"",description:"",blackWhiteState:0,consumerProviderFlag:1,fuseState:0,resAppFlag:1,matchType:0};return e&&Object.keys(t).forEach((function(a){Object(p["a"])(e,a)&&(t[a]=e[a])})),t}var g={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=this,t=function(t,a,i){e.isEdit?i():Object(f["j"])(a).then((function(e){"该数据已存在"===e.msg?i(new Error(e.msg)):i()})).catch((function(e){i(e)}))};return{appOptions:[],showDialog:!1,loading:!1,labelPosition:"right",form:d(),rules:{baseId:[{required:!0,message:"请选择所属应用",trigger:"change"},{validator:t,trigger:"change"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.isEdit&&(this.form=d(this.rowData)),this.getAppOptions()},methods:{appChange:function(e){var t=this.appOptions.find((function(t){return t.id===e}));this.form.limitFrame=t.limitFrame,this.form.appFrame=t.appFrame},getAppOptions:function(){var e=this;Object(u["c"])().then((function(t){e.appOptions=Object(m["a"])(t,"data")}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(a){var i;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(i=Object(r["a"])({},e.form),e.loading=!0,e.isEdit?Object(f["h"])({govAppConfigPo:i,typeList:[]}).then((function(t){200===t.code&&(e.$message({type:"success",message:"编辑成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1})):(delete i.id,Object(f["e"])({govAppConfigPo:i,typeList:[]}).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},b=g,h=(a("c936"),a("2877")),v=Object(h["a"])(b,n,l,!1,null,"25b5d6e9",null),D=v.exports,w=a("fe3a"),y=a("5048"),C=a("7c2b"),k=a("ff51"),x=a("44a4"),O={name:"ComponentName",components:{AddAndEdit:D,FrameConfig:w["default"],WhiteListConfig:y["default"],SwitchFuse:x["default"],ResourceMatching:C["default"]},mixins:[],props:{},data:function(){var e=this,t=(this.$createElement,this);return{appList:[],showWhiteListDialog:!1,showAddDialog:!1,showConfigDialog:!1,showResourceDialog:!1,rowData:null,buttonList:[{label:"新增",type:"add",click:this.addInfo}],tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"appName",label:"应用名称"},{prop:"appCode",label:"应用编码"},{prop:"limitFrame",label:"限流框架"},{prop:"appFrame",label:"应用框架"},{prop:"description",label:"描述"},{prop:"switchFuseProp",label:"启用熔断",width:100,align:"center",render:function(t,a){var i=a.row;return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(){return e.openFuse(i)}}},["配置"]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.switchFuse(i)}}},[i.fuseState?"暂停":"启动"])])}},{prop:"partitionCount",label:"限流状态",width:100,align:"center",render:function(t,a){var i=a.row;return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(){return e.openConfig(i)}}},["配置"]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickRowStart(i,"flowState")}}},[i.flowState?"暂停":"启动"])])}},{prop:"blackWhiteState",label:"黑白名单状态",align:"center",render:function(t,a){var i=a.row;return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(){return e.openWhiteList(i)}}},["配置"]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickRowStart(i,"blackWhiteState")}}},[i.blackWhiteState?"暂停":"启动"])])}},{prop:"realLook",label:"监控",align:"center",render:function(t,a){var i=a.row;return"SENTINEL"===i.limitFrame?t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickRealLook(i)}}},["实时查看"]):t("span",["-"])}}],operate:{width:220,list:[{label:"资源匹配",id:"resource"},{label:"编辑",id:"edit"},{label:"删除",id:"delete"}]}},searchConfig:{searchData:{baseId:"",consumerProviderFlag:1,resAppFlag:1},searchItem:[{type:"select",label:"应用名称",prop:"baseId",get options(){return t.appList}}],rules:{}},showFuse:!1}},computed:{},watch:{},created:function(){},mounted:function(){this.getList(),this.getAppOptions()},methods:{clickRealLook:function(e){this.$router.push({path:"/govern-flow-control-server/app-flow-monitoring",query:{id:e.id,appCode:e.appCode,resourceName:e.resourceName,baseId:e.baseId}})},openFuse:function(e){this.showFuse=!0,this.rowData=e},switchFuse:function(e){var t=this;this.tableConfig.loading=!0,Object(f["f"])({baseId:e.baseId,fuseState:+!e.fuseState,id:e.id}).then((function(e){t.$message.success(e.msg),t.getList()})).finally((function(){t.tableConfig.loading=!1}))},getAppOptions:function(){var e=this;Object(u["c"])().then((function(t){var a=Object(m["a"])(t,"data");e.appList=a.map((function(e){return{label:e.appName,value:e.id}}))}))},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(r["a"])({},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(f["c"])(t).then((function(t){Object(k["a"])(null===t||void 0===t?void 0:t.data.data)&&(e.tableConfig.tableData=t.data.data,e.tableConfig.pagination.total=Object(m["a"])(t,"data.totalCount")||0)})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.rowData=null,this.showAddDialog=!0},openConfig:function(e){this.rowData=e,this.showConfigDialog=!0},clickRowStart:function(e,t){var a=this,i={baseId:e.baseId,id:e.id};switch(t){case"blackWhiteState":i.blackWhiteState=+!e.blackWhiteState;break;case"flowState":i.flowState=+!e.flowState;break}this.tableConfig.loading=!0,Object(f["f"])(i).then((function(e){a.$message.success(e.msg),a.getList()})).finally((function(){a.tableConfig.loading=!1}))},openWhiteList:function(e){this.rowData=e,this.showWhiteListDialog=!0},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getIndex:function(e){var t=this,a=(e.index,e.row),i=e.operate;this.rowData=a,"delete"===i.id?this.$confirm("确定要删除【".concat(a.appName,"】吗?"),{type:"warning"}).then((function(){t.tableConfig.loading=!0,Object(f["a"])(a.id).then((function(e){t.$message.success("删除成功"),t.getList()})).catch((function(e){})).finally((function(){t.tableConfig.loading=!1}))})).catch((function(e){})):"edit"===i.id?this.showAddDialog=!0:"resource"===i.id&&(this.showResourceDialog=!0)}}},S=O,_=(a("38de"),Object(h["a"])(S,i,o,!1,null,"897d1ff6",null));t["default"]=_.exports},"2a0d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{class:e.className,style:{height:e.height,width:e.width}})},o=[],r=(a("14d9"),a("b0c0"),a("d3b7"),a("159b"),a("313e")),n=a.n(r),l=a("f42c");a("817d");var s={mixins:[l["a"]],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"250px"},lineData:{type:Object,default:function(){return{xAxisData:[],data:[]}}}},data:function(){return{chart:null}},watch:{lineData:{handler:function(e){this.initChart()},deep:!0}},mounted:function(){this.initChart()},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=n.a.init(this.$el,"macarons");var e=["#123dac","#73e2e2","#ff7e85","#9b52ff","#fac524","#46caff","#a1e867","#10b2b2","#ec87f7","#f4905a","#00baba","#facf24","#e89d67","#23c6c6","#fa8699","#40b7fc","#006d75","#595959","#f4764f","#a640fc","#fda23f","#2d7ae4","#5092ff","#9351ed","#8a89fe","#df89e8","#2797ff","#6ad089","#7c92e8 "],t=this.lineData.xAxisData,a=[];this.lineData.data.forEach((function(t,i){a.push({name:t.name,data:t.value,type:"line",smooth:!1,smoothMonotone:"x",cursor:"pointer",showSymbol:!1,lineStyle:{color:e[i]}})}));var i={textStyle:{fontFamily:"Din-Light"},color:e,title:{text:this.lineData.name,textStyle:{fontSize:14,color:"#000",fontWeight:600}},legend:this.lineData.legend,tooltip:{trigger:"axis",axisPointer:{type:"none"},confine:!0,extraCssText:"box-shadow: 0px 2px 8px 0px #cacaca;border-radius: 4px;opacity: 0.9;z-index:9999"},grid:{left:"7%"},xAxis:{type:"category",boundaryGap:!0,data:t,axisLabel:{color:"#a0a9bc",formatter:function(e,a){return 0===a||a===t.length-1?"":e}},axisLine:{show:!1},axisTick:{show:!1}},yAxis:{name:"",nameTextStyle:{color:"#242e42",fontWeight:"bold",fontSize:14,lineHeight:30},type:"value",axisLabel:{color:"#a0a9bc",inside:!0,margin:0,verticalAlign:"bottom"},splitLine:{lineStyle:{type:"dashed"}},minInterval:1,axisLine:{show:!1},axisTick:{show:!1}},series:a};this.chart.setOption(i)}}},c=s,u=a("2877"),f=Object(u["a"])(c,i,o,!1,null,"2b591cb2",null);t["default"]=f.exports},"2c33":function(e,t,a){"use strict";a("7a13")},3229:function(e,t,a){"use strict";a.r(t);a("caad");var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"匹配方式",prop:"matchType"}},[t("el-radio",{attrs:{label:1},model:{value:e.form.matchType,callback:function(t){e.$set(e.form,"matchType",t)},expression:"form.matchType"}},[e._v("方法/数据")]),t("el-radio",{attrs:{label:2},model:{value:e.form.matchType,callback:function(t){e.$set(e.form,"matchType",t)},expression:"form.matchType"}},[e._v("自定义")])],1),t("el-form-item",{attrs:{label:"所属应用",prop:"baseId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:"",placeholder:"请选择"},model:{value:e.form.baseId,callback:function(t){e.$set(e.form,"baseId",t)},expression:"form.baseId"}},e._l(e.appOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.appName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"流控框架",prop:"limitFrame"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.limitFrame,callback:function(t){e.$set(e.form,"limitFrame",t)},expression:"form.limitFrame"}},e._l(e.dict_flowFrame,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"应用框架",prop:"appFrame"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.appFrame,callback:function(t){e.$set(e.form,"appFrame",t)},expression:"form.appFrame"}})],1),2==e.form.matchType?t("el-form-item",{attrs:{label:"处理引擎",prop:"customizeEngine"}},[t("el-input",{attrs:{placeholder:"请输入处理引擎"},model:{value:e.form.customizeEngine,callback:function(t){e.$set(e.form,"customizeEngine",t)},expression:"form.customizeEngine"}})],1):e._e(),"GATEWAY"===e.appType.appFrame?[t("el-form-item",{attrs:{label:"路由ID",prop:"resourceName"}},[t("el-input",{attrs:{placeholder:"请输入对应网关配置的RouteID"},model:{value:e.form.resourceName,callback:function(t){e.$set(e.form,"resourceName",t)},expression:"form.resourceName"}})],1)]:"WEB"===e.appType.appFrame?[t("el-form-item",{attrs:{label:"请求方法",prop:"methodName"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择请求方法"},model:{value:e.form.methodName,callback:function(t){e.$set(e.form,"methodName",t)},expression:"form.methodName"}},[t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1),t("el-form-item",{attrs:{label:"请求路径",prop:"className"}},[t("el-input",{model:{value:e.form.className,callback:function(t){e.$set(e.form,"className",t)},expression:"form.className"}})],1),[1,2].includes(e.form.matchType)?t("el-form-item",{attrs:{label:"参数类型",prop:"typeList_form"}},[t("FlowParamsType",{model:{value:e.typeList_form,callback:function(t){e.typeList_form=t},expression:"typeList_form"}})],1):e._e()]:e._e()],2),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)],1)},o=[],r=a("5530"),n=a("c7eb"),l=a("1da1"),s=(a("99af"),a("d81d"),a("b64b"),a("d3b7"),a("159b"),a("bc59")),c=a("ec41"),u=a("cba0"),f=a("dcf6"),p=a("d1cd"),m=a("f14a"),d=a("aee7");function g(e,t){var a={id:"",matchType:1,baseId:"",limitFrame:"",appFrame:"",methodName:"",className:"",consumerProviderFlag:1,fuseState:0,resAppFlag:2,blackWhiteState:0};return e&&Object.keys(a).forEach((function(t){Object(s["a"])(e,t)&&(a[t]=e[t])})),a}var b={components:{FlowParamsType:m["default"]},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},appType:{type:Object,default:null},refresh:Function},data:function(){return{typeList_form:[],typeList_hiddenExtra:null,appOptions:[],dict_flowFrame:p["c"],showDialog:!1,loading:!1,labelPosition:"right",form:g(),rules:{matchType:[{required:!0,message:"请选择匹配方式",trigger:"change"}],baseId:[{required:!0,message:"请选择所属应用",trigger:"change"}],limitFrame:[{required:!0,message:"请选择流控框架",trigger:"change"}],customizeEngine:[{required:!0,message:"请选择流处理引擎",trigger:"change"}],className:[{required:!0,message:"请填写请求路径",trigger:"blur"}],methodName:[{required:!0,message:"请选择请求方法",trigger:"change"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.getAppOptions(),this.isEdit?(this.form=g(this.rowData,this.rowData.matchType),this.form.className=this.rowData.resourceName.split("|")[0],this.form.methodName=this.rowData.resourceName.split("|")[1]||"",this.getDetail()):(this.form.baseId=this.appType.value,this.form.limitFrame=this.appType.limitFrame,this.form.appFrame=this.appType.appFrame)},methods:{getDetail:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var a,i,o,r;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.rowData)&&void 0!==a&&a.id){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Object(f["b"])(e.rowData.id);case 4:i=t.sent,o=Object(c["a"])(i,"data.typeList"),e.typeList_hiddenExtra=Object(d["b"])(o),r=Object(d["a"])(o).map((function(e){return{states:e.states,parameterType:e.parameterType}})),e.typeList_form=r;case 9:case"end":return t.stop()}}),t)})))()},getAppOptions:function(){var e=this;Object(u["c"])().then((function(t){e.appOptions=Object(c["a"])(t,"data")}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(n["a"])().mark((function t(a){var i,o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(i=Object(r["a"])({resourceName:"".concat(e.form.className).concat(""!==e.form.methodName?"|"+e.form.methodName:"")},e.form),delete i.methodName,delete i.className,o={govAppConfigPo:i,typeList:[]},[1,2].includes(e.form.matchType)&&(o.typeList=e.typeList_form.map((function(e,t){return Object(r["a"])(Object(r["a"])({},e),{},{paramNo:t+1})}))),e.loading=!0,e.isEdit?(e.typeList_hiddenExtra&&o.typeList.unshift(e.typeList_hiddenExtra),Object(f["h"])(o).then((function(t){200===t.code&&(e.$message({type:"success",message:"编辑成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))):Object(f["e"])(o).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},h=b,v=(a("8887"),a("2877")),D=Object(v["a"])(h,i,o,!1,null,"3493dc7a",null);t["default"]=D.exports},"33d4":function(e,t,a){"use strict";a.r(t);a("caad");var i=function(){var e=this,t=e._self._c;return t("div",[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("el-form",{ref:"addRef",attrs:{inline:!0,model:e.formData}},[t("el-form-item",{attrs:{label:"应用",rules:[{required:!0,message:"请选择应用",trigger:"change"}],prop:"appType"}},[t("el-select",{model:{value:e.appType,callback:function(t){e.appType=t},expression:"appType"}},e._l(e.appList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e}})})),1)],1),t("el-form-item",{attrs:{label:""}},[t("el-button",{attrs:{type:"primary",disabled:!Boolean(e.appType)},on:{click:e.clickAdd}},[e._v("新增")])],1)],1),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.total,operateSlice:2,rowKey:"id",isPage:e.tableConfig.isPage,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAddDialog&&["WEB","GATEWAY"].includes(e.appType.appFrame)?t("AddWeb",{attrs:{rowData:e.rowData,appType:e.appType,refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e(),e.showAddDialog&&"DUBBO"===e.appType.appFrame?t("AddDobble",{attrs:{rowData:e.rowData,appType:e.appType,refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e(),e.showConfigDialog?t("FrameConfig",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showConfigDialog,callback:function(t){e.showConfigDialog=t},expression:"showConfigDialog"}}):e._e(),e.showWhiteListDialog?t("WhiteListConfig",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showWhiteListDialog,callback:function(t){e.showWhiteListDialog=t},expression:"showWhiteListDialog"}}):e._e(),e.showMatchDialog?t("ParamsMatching",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showMatchDialog,callback:function(t){e.showMatchDialog=t},expression:"showMatchDialog"}}):e._e(),e.showFuse?t("SwitchFuse",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showFuse,callback:function(t){e.showFuse=t},expression:"showFuse"}}):e._e(),e.showResourceDialog?t("ResourceMatching",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showResourceDialog,callback:function(t){e.showResourceDialog=t},expression:"showResourceDialog"}}):e._e()],1)},o=[],r=a("c7eb"),n=a("1da1"),l=a("5530"),s=(a("7db0"),a("d81d"),a("14d9"),a("d3b7"),a("aedf")),c=a("3229"),u=a("61e0"),f=a("7c2b"),p=a("3682"),m=a("e6ff"),d=a("dcf6"),g=a("cba0"),b=a("ec41"),h=a("ff51"),v=a("44a4"),D=[{label:"类",value:0},{label:"方法/数据",value:1},{label:"自定义",value:2}],w={name:"resource-flow-config",components:{AddDobble:s["default"],AddWeb:c["default"],ParamsMatching:u["default"],FrameConfig:p["default"],WhiteListConfig:m["default"],SwitchFuse:v["default"],ResourceMatching:f["default"]},mixins:[],props:{},data:function(){var e=this,t=(this.$createElement,this);return{showFuse:!1,appList:[],appType:null,showWhiteListDialog:!1,showAddDialog:!1,showConfigDialog:!1,showMatchDialog:!1,showResourceDialog:!1,rowData:null,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"resourceName",label:"资源名称",fix:"left"},{prop:"matchType",label:"匹配方式",render:function(e,t){var a=t.row,i=D.find((function(e){return e.value===a.matchType}));return e("span",[i.label])}},{prop:"appName",label:"所属应用"},{prop:"appCode",label:"应用编码"},{prop:"limitFrame",label:"限流框架"},{prop:"appFrame",label:"应用框架"},{prop:"switchFuseProp",label:"启用熔断",width:100,align:"center",render:function(t,a){var i=a.row;return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(){return e.openFuse(i)}}},["配置"]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.switchFuse(i)}}},[i.fuseState?"暂停":"启动"])])}},{prop:"partitionCount",label:"限流状态",width:100,align:"center",render:function(t,a){var i=a.row;return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(){return e.openConfig(i)}}},["配置"]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickRowStart(i,"flowState")}}},[i.flowState?"暂停":"启动"])])}},{prop:"whitelistStatus",label:"黑白名单状态",align:"center",render:function(t,a){var i=a.row;return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(){return e.openWhiteList(i)}}},["配置"]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickRowStart(i,"blackWhiteState")}}},[i.blackWhiteState?"暂停":"启动"])])}}],operate:{width:220,columnAlign:"left",list:[{label:"资源匹配",id:"resource"},{label:"参数匹配",id:"matching",isShow:function(e){return 1==e.matchType}},{label:"编辑",id:"edit"},{label:"删除",id:"delete"}]}},searchConfig:{searchData:{baseId:"",resourceName:"",consumerProviderFlag:1,resAppFlag:2},searchItem:[{type:"select",label:"应用名称",prop:"baseId",get options(){return t.appList}},{type:"input",label:"资源名称",prop:"resourceName"}],rules:{}}}},computed:{formData:function(){return{appType:this.appType}}},watch:{},created:function(){},mounted:function(){this.getList(),this.getAppOptions()},methods:{clickRealLook:function(e){this.$router.push({path:"/govern-flow-control-server/app-flow-monitoring",query:{id:e.id,appCode:e.appCode,resourceName:e.resourceName,baseId:e.baseId}})},openFuse:function(e){this.showFuse=!0,this.rowData=e},switchFuse:function(e){var t=this;this.tableConfig.loading=!0,Object(d["f"])({baseId:e.baseId,fuseState:+!e.fuseState,id:e.id}).then((function(e){t.$message.success(e.msg),t.getList()})).finally((function(){t.tableConfig.loading=!1}))},getAppOptions:function(){var e=this;Object(g["c"])().then((function(t){var a=Object(b["a"])(t,"data");e.appList=a.map((function(e){return{label:e.appName,value:e.id,appFrame:e.appFrame,limitFrame:e.limitFrame,limitModel:e.limitModel}}))}))},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(l["a"])({},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(d["c"])(t).then((function(t){Object(h["a"])(null===t||void 0===t?void 0:t.data.data)&&(e.tableConfig.tableData=t.data.data,e.tableConfig.pagination.total=Object(b["a"])(t,"data.totalCount")||0)})).finally((function(){e.tableConfig.loading=!1}))},clickAdd:function(){var e=this;return Object(n["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.addRef.validate().catch((function(){}));case 2:t.sent,null!==(a=e.appType)&&void 0!==a&&a.value&&(e.rowData=null,e.showAddDialog=!0);case 5:case"end":return t.stop()}}),t)})))()},openConfig:function(e){this.rowData=e,this.showConfigDialog=!0},clickRowStart:function(e,t){var a=this,i={baseId:e.baseId,id:e.id};switch(t){case"blackWhiteState":i.blackWhiteState=+!e.blackWhiteState;break;case"flowState":i.flowState=+!e.flowState;break}this.tableConfig.loading=!0,Object(d["f"])(i).then((function(e){a.$message.success(e.msg),a.getList()})).finally((function(){a.tableConfig.loading=!1}))},openWhiteList:function(e){this.rowData=e,this.showWhiteListDialog=!0},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getIndex:function(e){var t=this,a=(e.index,e.row),i=e.operate;switch(this.rowData=a,i.id){case"delete":this.$confirm("确定要删除【".concat(a.resourceName,"】吗?"),{type:"warning"}).then((function(){t.tableConfig.loading=!0,Object(d["a"])(a.id).then((function(e){t.$message.success("删除成功"),t.getList()})).catch((function(e){})).finally((function(){t.tableConfig.loading=!1}))})).catch((function(e){}));break;case"edit":this.appType=a,1==a.matchType?this.$confirm("编辑后,已配置的参数匹配将被清空","确认信息",{type:"warning",confirmButtonText:"继续"}).then((function(){t.showAddDialog=!0})):this.showAddDialog=!0;break;case"matching":this.showMatchDialog=!0;break;case"resource":this.showResourceDialog=!0;break;default:}}}},y=w,C=a("2877"),k=Object(C["a"])(y,i,o,!1,null,"fcb14e16",null);t["default"]=k.exports},3682:function(e,t,a){"use strict";a.r(t);a("caad");var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"配置-".concat(e.rowData.limitFrame),visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"SENTINEL"===e.rowData.limitFrame?"140px":"170px",model:e.formData,rules:e.rules}},["SENTINEL"===e.rowData.limitFrame?t("div",[t("el-form-item",{attrs:{label:"限流方式",prop:"senGrade"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},model:{value:e.formData.senGrade,callback:function(t){e.$set(e.formData,"senGrade",t)},expression:"formData.senGrade"}},e._l(e.dict_limitWay,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{prop:"senCount"}},[t("template",{slot:"label"},[t("span",[e._v("限流阈值")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(e.formData.senGrade?"集群允许最高QPS数":"集群允许最大并发线程数")+" ")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.senCount,callback:function(t){e.$set(e.formData,"senCount",e._n(t))},expression:"formData.senCount"}})],2),1==e.formData.senGrade?[t("el-form-item",{attrs:{label:"QPS限流策略",prop:"senControlBehavior"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择QPS限流策略"},model:{value:e.formData.senControlBehavior,callback:function(t){e.$set(e.formData,"senControlBehavior",t)},expression:"formData.senControlBehavior"}},e._l(e.dict_QPSlimitStrategy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),[2,4].includes(e.formData.senControlBehavior)?t("el-form-item",{attrs:{label:"预热时长(s)",prop:"senWarmUpPeriodSec"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.senWarmUpPeriodSec,callback:function(t){e.$set(e.formData,"senWarmUpPeriodSec",e._n(t))},expression:"formData.senWarmUpPeriodSec"}})],1):e._e(),[3,4].includes(e.formData.senControlBehavior)?t("el-form-item",{attrs:{label:"队列超时时间(ms)",prop:"senMaxQueueingTimes"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.senMaxQueueingTimes,callback:function(t){e.$set(e.formData,"senMaxQueueingTimes",e._n(t))},expression:"formData.senMaxQueueingTimes"}})],1):e._e()]:e._e()],2):e._e(),"RESILIENCE4J"===e.rowData.limitFrame?t("div",[t("el-form-item",{attrs:{label:"策略",prop:"protocol"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择策略"},model:{value:e.formData.resStrategy,callback:function(t){e.$set(e.formData,"resStrategy",t)},expression:"formData.resStrategy"}},e._l(e.dict_resilience4jStrategy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),[1,"1"].includes(e.formData.resStrategy)?[t("el-form-item",{attrs:{label:"频次阈值",prop:"resLimitPeriod"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resLimitPeriod,callback:function(t){e.$set(e.formData,"resLimitPeriod",e._n(t))},expression:"formData.resLimitPeriod"}})],1),t("el-form-item",{attrs:{label:"阈值刷新时间(ms)",prop:"resLimitRefreshPeriod"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resLimitRefreshPeriod,callback:function(t){e.$set(e.formData,"resLimitRefreshPeriod",e._n(t))},expression:"formData.resLimitRefreshPeriod"}})],1),t("el-form-item",{attrs:{label:"限流后的冷却时间(ms)",prop:"resTimeoutDuration"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resTimeoutDuration,callback:function(t){e.$set(e.formData,"resTimeoutDuration",e._n(t))},expression:"formData.resTimeoutDuration"}})],1)]:e._e(),[2,"2"].includes(e.formData.resStrategy)?[t("el-form-item",{attrs:{label:"最大并发数",prop:"resMaxConcurrentCalls"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resMaxConcurrentCalls,callback:function(t){e.$set(e.formData,"resMaxConcurrentCalls",e._n(t))},expression:"formData.resMaxConcurrentCalls"}})],1),t("el-form-item",{attrs:{prop:"resMaxWaitDuration"}},[t("template",{slot:"label"},[t("span",[e._v("饱和等待时间(ms)")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("等待线程释放时间")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resMaxWaitDuration,callback:function(t){e.$set(e.formData,"resMaxWaitDuration",e._n(t))},expression:"formData.resMaxWaitDuration"}})],2)]:e._e(),[3,"3"].includes(e.formData.resStrategy)?[t("el-form-item",{attrs:{label:"最大线程池",prop:"resMaxThreadPoolSize"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resMaxThreadPoolSize,callback:function(t){e.$set(e.formData,"resMaxThreadPoolSize",e._n(t))},expression:"formData.resMaxThreadPoolSize"}})],1),t("el-form-item",{attrs:{label:"核心线程数",prop:"resCoreThreadPoolSize"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resCoreThreadPoolSize,callback:function(t){e.$set(e.formData,"resCoreThreadPoolSize",e._n(t))},expression:"formData.resCoreThreadPoolSize"}})],1),t("el-form-item",{attrs:{label:"队列容量",prop:"resQueueCapacity"}},[t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resQueueCapacity,callback:function(t){e.$set(e.formData,"resQueueCapacity",e._n(t))},expression:"formData.resQueueCapacity"}})],1),t("el-form-item",{attrs:{prop:"resKeepAliveTime"}},[t("template",{slot:"label"},[t("span",[e._v("等待时间(ms)")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("等待线程释放时间")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{type:"number",min:"0"},model:{value:e.formData.resKeepAliveTime,callback:function(t){e.$set(e.formData,"resKeepAliveTime",e._n(t))},expression:"formData.resKeepAliveTime"}})],2)]:e._e()],2):e._e(),t("el-form-item",{attrs:{prop:"fallbackStrategy",label:"降级策略"}},[t("el-radio-group",{model:{value:e.formData.fallbackStrategy,callback:function(t){e.$set(e.formData,"fallbackStrategy",t)},expression:"formData.fallbackStrategy"}},e._l(e.dict_fallback_strategy,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{prop:"fallbackMethod"}},[t("template",{slot:"label"},[t("span",[e._v("降级方法")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 降级方法的全类名。如：com.example.service.FallbackService.fallBack ")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{model:{value:e.formData.fallbackMethod,callback:function(t){e.$set(e.formData,"fallbackMethod",t)},expression:"formData.fallbackMethod"}})],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],r=a("c7eb"),n=a("5530"),l=a("1da1"),s=(a("b64b"),a("d3b7"),a("159b"),a("ec41")),c=a("bc59"),u=a("d1cd"),f=a("555f"),p=a("5307"),m={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{dict_fallback_strategy:p["a"].options,loading:!1,dict_limitWay:u["e"],dict_QPSlimitStrategy:u["a"],dict_resilience4jStrategy:u["f"],clusterList:[],labelPosition:"right",formData:d(),rules:{senGrade:[{required:!0,message:"请选择限流方式",trigger:"change"}],senCount:[{required:!0,message:"请输入限流阈值",trigger:"blur"}],fallbackMethod:[{required:!0,message:"请输入降级方法",trigger:"blur"}],senControlBehavior:[{required:!0,message:"请选择限流策略",trigger:"change"}],senMaxQueueingTimes:[{required:!0,message:"请输入队列超时时间",trigger:"blur"}],resStrategy:[{required:!0,message:"请选择策略",trigger:"change"}],resMaxConcurrentCalls:[{required:!0,message:"请输入最大并发数",trigger:"blur"}],resMaxWaitDuration:[{required:!0,message:"请输入饱和等待时间",trigger:"blur"}],resLimitPeriod:[{required:!0,message:"请输入频次阈值",trigger:"blur"}],resLimitRefreshPeriod:[{required:!0,message:"请输入阀值刷新时间",trigger:"blur"}],resTimeoutDuration:[{required:!0,message:"请输入限流后的冷却时间",trigger:"blur"}]},detailData:null}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e,t=this;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.loading=!0,Object(f["a"])(this.rowData.id).then((function(e){Object(s["a"])(e,"data.id")?(t.detailData=e.data,t.formData=d(e.data,t.rowData.limitFrame)):t.formData=d(null,t.rowData.limitFrame)})).catch((function(e){})).finally((function(){t.loading=!1})))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(a){var i,o,l;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=8;break}if(o=Object(n["a"])(Object(n["a"])({},e.formData),{},{targetId:e.rowData.id}),e.loading=!0,null===(i=e.detailData)||void 0===i||!i.id){t.next=7;break}return o.id=null===(l=e.detailData)||void 0===l?void 0:l.id,Object(f["c"])(o).then((function(t){e.$message({type:"success",message:"配置更新成功"}),e.$emit("change",!1),e.refresh()})).catch((function(e){})).finally((function(){e.loading=!1})),t.abrupt("return");case 7:Object(f["b"])(o).then((function(t){200===t.code&&(e.$message({type:"success",message:"配置添加成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}};function d(e,t){var a={fallbackStrategy:"1",fallbackMethod:""};switch(t){case"SENTINEL":a.senGrade=0,a.senCount="",a.senControlBehavior="",a.senWarmUpPeriodSec="",a.senMaxQueueingTimes="";break;case"RESILIENCE4J":a.resStrategy="",a.resMaxConcurrentCalls="",a.resMaxWaitDuration="",a.resLimitPeriod="",a.resLimitRefreshPeriod="",a.resTimeoutDuration="",a.resMaxThreadPoolSize="",a.resCoreThreadPoolSize="",a.resQueueCapacity="",a.resKeepAliveTime="";break}return e&&Object.keys(a).forEach((function(t){Object(c["a"])(e,t)&&(a[t]=e[t])})),a}var g=m,b=(a("f6eda"),a("2877")),h=Object(b["a"])(g,i,o,!1,null,"512106da",null);t["default"]=h.exports},"388f":function(e,t,a){},"38de":function(e,t,a){"use strict";a("388f")},"39d9":function(e,t,a){},"42d2":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.total,operateSlice:3,rowKey:"id",isPage:e.tableConfig.isPage,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAddDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e()],1)},o=[],r=a("5530"),n=(a("d81d"),a("14d9"),a("d3b7"),a("a4d3"),a("e01a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"应用名称",prop:"appId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",disabled:e.isEdit},model:{value:e.form.appId,callback:function(t){e.$set(e.form,"appId",t)},expression:"form.appId"}},e._l(e.appOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.applicationName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"集群名称",prop:"clusterName"}},[t("el-input",{attrs:{size:"mini"},model:{value:e.form.clusterName,callback:function(t){e.$set(e.form,"clusterName",t)},expression:"form.clusterName"}})],1),t("el-form-item",{attrs:{label:"流控框架",prop:"limitFrame"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},model:{value:e.form.limitFrame,callback:function(t){e.$set(e.form,"limitFrame",t)},expression:"form.limitFrame"}},e._l(e.dict_flowFrame,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"应用框架",prop:"appFrame"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},model:{value:e.form.appFrame,callback:function(t){e.$set(e.form,"appFrame",t)},expression:"form.appFrame"}},e._l(e.dict_appFrame,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"限流模式",prop:"limitModel"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},model:{value:e.form.limitModel,callback:function(t){e.$set(e.form,"limitModel",t)},expression:"form.limitModel"}},e._l(e.dict_limitModel,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{size:"mini",type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),l=[],s=a("c7eb"),c=a("1da1"),u=(a("b64b"),a("159b"),a("cba0")),f=a("bc59"),p=a("ff51"),m=a("d1cd");function d(e){var t={id:"",appFrame:"",appId:"",clusterName:"",limitFrame:"",limitModel:"",description:""};return e&&Object.keys(t).forEach((function(a){Object(f["a"])(e,a)&&(t[a]=e[a])})),t}var g={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{appOptions:[],dict_flowFrame:m["c"],dict_appFrame:m["b"],dict_limitModel:m["d"],loading:!1,clusterList:[],labelPosition:"right",form:d(),rules:{appId:[{required:!0,message:"请选择应用名称",trigger:"change"}],clusterName:[{required:!0,message:"请输入集群名称",trigger:"blur"}],limitFrame:[{required:!0,message:"请选择流控框架",trigger:"change"}],appFrame:[{required:!0,message:"请选择应用框架",trigger:"change"}],limitModel:[{required:!0,message:"请选择限流模式",trigger:"change"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){var e;this.getAppOptions(),null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.form=d(this.rowData))},methods:{getAppOptions:function(){var e=this;Object(u["a"])().then((function(t){e.appOptions=Object(p["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(a){var i;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(i=Object(r["a"])({},e.form),e.loading=!0,e.isEdit?Object(u["f"])(i).then((function(t){200===t.code&&(e.$message.success("编辑成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1})):(delete i.id,Object(u["e"])(i).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},b=g,h=(a("cbbf"),a("2877")),v=Object(h["a"])(b,n,l,!1,null,"57e2d235",null),D=v.exports,w=a("ec41"),y={name:"ComponentName",components:{AddAndEdit:D},mixins:[],props:{},data:function(){this.$createElement;var e=this;return{showAddDialog:!1,rowData:null,appId:"",appOptions:[],buttonList:[{label:"新增",type:"add",click:this.addInfo}],tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"appName",label:"应用名称"},{prop:"clusterName",label:"集群名称"},{prop:"limitModel",label:"限流模式",render:function(e,t){var a=t.row;return e("span",[1===a.limitModel?"均摊模式":"权重模式"])}},{prop:"limitFrame",label:"限流框架"},{prop:"appFrame",label:"应用框架"}],operate:{width:220,list:[{label:"编辑",id:"edit"},{label:"删除",id:"delete"},{label:"流控策略",id:"strategy"}]}},searchConfig:{searchData:{clusterName:"",appId:"",limitFrame:"",appFrame:""},searchItem:[{type:"input",label:"集群名称",prop:"clusterName"},{type:"select",label:"应用名称",prop:"appId",get options(){return e.appOptions}},{type:"select",label:"限流框架",prop:"limitFrame",options:m["c"]},{type:"select",label:"应用框架",prop:"appFrame",options:m["b"]}],rules:{}}}},computed:{},watch:{},created:function(){},mounted:function(){this.getAppOptions(),this.getList()},methods:{getAppOptions:function(){var e=this,t=[];Object(u["a"])().then((function(a){Object(p["a"])(null===a||void 0===a?void 0:a.data)&&(t=a.data.map((function(e){return{label:e.applicationName,value:e.id}}))),e.appOptions=t}))},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(r["a"])({},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(u["d"])(t).then((function(t){var a=Object(w["a"])(t,"data.data");e.tableConfig.tableData=Object(p["a"])(a)?a:[],e.tableConfig.pagination.total=Object(w["a"])(t,"data.totalCount")||0})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.showAddDialog=!0,this.rowData=null},openConfig:function(e){this.showConfigDialog=!0,this.rowData=e},onSearch:function(e){e?this.tableConfig.tableData=[]:this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getIndex:function(e){var t=this,a=(e.index,e.row),i=e.operate;"delete"===i.id?this.$confirm("确定要删除【".concat(a.appName,"】吗?"),{type:"warning"}).then((function(){t.tableConfig.loading=!0,Object(u["b"])(a.id).then((function(e){t.$message.success("删除成功"),t.getList()})).catch((function(e){})).finally((function(){t.tableConfig.loading=!1}))})).catch((function(e){})):"edit"===i.id?(this.rowData=a,this.showAddDialog=!0):"strategy"===i.id&&this.$router.push({path:"/govern-flow-control-server/app-flow-strategy/flow-strategy",query:{limitModel:a.limitModel,baseId:a.id,appId:a.appId}})}}},C=y,k=(a("7893"),Object(h["a"])(C,i,o,!1,null,"1f8a1b0e",null));t["default"]=k.exports},"4aa3":function(e,t,a){},"4ead":function(e,t,a){"use strict";a("2666")},5048:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"黑白名单配置",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"名单类别",prop:"listType"}},[t("el-radio",{attrs:{label:"1"},model:{value:e.formData.listType,callback:function(t){e.$set(e.formData,"listType",t)},expression:"formData.listType"}},[e._v("黑名单")]),t("el-radio",{attrs:{label:"2"},model:{value:e.formData.listType,callback:function(t){e.$set(e.formData,"listType",t)},expression:"formData.listType"}},[e._v("白名单")])],1),t("el-form-item",{attrs:{label:"IP",prop:"ip"}},[t("el-input",{attrs:{size:"mini",rows:"6",type:"textarea",placeholder:"请输入ip,多个ip用英文逗号分隔"},model:{value:e.formData.ip,callback:function(t){e.$set(e.formData,"ip",t)},expression:"formData.ip"}})],1),t("el-form-item",{attrs:{prop:"fallbackStrategy",label:"降级策略"}},[t("el-radio-group",{model:{value:e.formData.fallbackStrategy,callback:function(t){e.$set(e.formData,"fallbackStrategy",t)},expression:"formData.fallbackStrategy"}},e._l(e.dict_fallback_strategy,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{prop:"fallbackMethod"}},[t("template",{slot:"label"},[t("span",[e._v("降级方法")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 降级方法的全类名。如：com.example.service.FallbackService.fallBack ")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{size:"mini"},model:{value:e.formData.fallbackMethod,callback:function(t){e.$set(e.formData,"fallbackMethod",t)},expression:"formData.fallbackMethod"}})],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],r=a("c7eb"),n=a("5530"),l=a("1da1"),s=(a("b64b"),a("d3b7"),a("159b"),a("ec41")),c=a("bc59"),u=a("70b8"),f=a("5307"),p={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{dict_fallback_strategy:f["a"].options,loading:!1,labelPosition:"right",formData:m(),rules:{listType:[{required:!0,message:"请选择名单类别",trigger:"change"}],fallbackMethod:[{required:!0,message:"请输入降级方法",trigger:"blur"}],ip:[{required:!0,message:"请输入请输入ip,多个ip用英文逗号分隔",trigger:"blur"}]},detailData:null}},computed:{},watch:{},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e,t=this;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.loading=!0,Object(u["a"])(this.rowData.id).then((function(e){Object(s["a"])(e,"data.id")&&(t.detailData=e.data,t.formData=m(e.data))})).catch((function(e){})).finally((function(){t.loading=!1})))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(a){var i,o,l;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:if(l=Object(n["a"])({targetId:null===(i=e.rowData)||void 0===i?void 0:i.id},e.formData),e.loading=!0,null===(o=e.detailData)||void 0===o||!o.id){t.next=8;break}return l.id=e.detailData.id,Object(u["c"])(l).then((function(t){e.$message({type:"success",message:"更新成功"}),e.$emit("change",!1),e.refresh()})).catch((function(e){})).finally((function(){e.loading=!1})),t.abrupt("return");case 8:Object(u["b"])(l).then((function(t){200===t.code&&(e.$message({type:"success",message:"设置成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}};function m(e){var t={listType:"1",fallbackStrategy:"1",fallbackMethod:"",ip:""};return e&&Object.keys(t).forEach((function(a){Object(c["a"])(e,a)&&(t[a]=e[a])})),t}var d=p,g=(a("55246"),a("2877")),b=Object(g["a"])(d,i,o,!1,null,"9d2d957c",null);t["default"]=b.exports},55246:function(e,t,a){"use strict";a("8f79")},6757:function(e,t,a){},7893:function(e,t,a){"use strict";a("14c32")},"7a13":function(e,t,a){},"846c":function(e,t,a){"use strict";a("4aa3")},8887:function(e,t,a){"use strict";a("143f")},"8f79":function(e,t,a){},"948d":function(e,t,a){},a5ef:function(e,t,a){"use strict";a("2630")},a75d:function(e,t,a){},a8eb:function(e,t,a){"use strict";a("948d")},ab6b:function(e,t,a){"use strict";a.r(t);a("a4d3"),a("e01a");var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"在线实例",prop:"instanceOnline"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},on:{change:e.instanceChange},model:{value:e.form.instanceOnline,callback:function(t){e.$set(e.form,"instanceOnline",t)},expression:"form.instanceOnline"}},[t("el-option",{attrs:{value:""}},[e._v("请选择")]),e._l(e.configOptions,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})}))],2)],1),t("el-form-item",{attrs:{label:"实例IP",prop:"instanceIp"}},[t("el-input",{model:{value:e.form.instanceIp,callback:function(t){e.$set(e.form,"instanceIp",t)},expression:"form.instanceIp"}})],1),t("el-form-item",{attrs:{label:"实例端口",prop:"instancePort"}},[t("el-input",{model:{value:e.form.instancePort,callback:function(t){e.$set(e.form,"instancePort",e._n(t))},expression:"form.instancePort"}})],1),2===e.limitModel?t("el-form-item",{attrs:{label:"权重",prop:"flowWeight"}},[t("el-input",{attrs:{type:"number"},model:{value:e.form.flowWeight,callback:function(t){e.$set(e.form,"flowWeight",t)},expression:"form.flowWeight"}})],1):e._e(),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],r=a("c7eb"),n=a("5530"),l=a("1da1"),s=(a("b64b"),a("d3b7"),a("159b"),a("b3a4")),c=a("bc59"),u=a("ec41");function f(e){var t={id:"",instanceOnline:"",instanceIp:"",instancePort:"",flowWeight:"",description:""};return e&&Object.keys(t).forEach((function(a){Object(c["a"])(e,a)&&(t[a]=e[a])})),t}var p={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{configOptions:[],loading:!1,clusterList:[],labelPosition:"right",form:f(),rules:{instanceIp:[{required:!0,message:"请输入实例IP",trigger:"blur"}],instancePort:[{required:!0,message:"请输入实例端口",trigger:"blur"},{pattern:/^\d{4,5}$/,message:"请输入4到5位数字",trigger:"blur"},,],flowWeight:[{required:!0,message:"请输入权重",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)},limitModel:function(){return this.$route.query.limitModel},baseId:function(){return this.$route.query.baseId}},watch:{},created:function(){},mounted:function(){var e;this.getClusterConfigOptions(),null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.form=f(this.rowData))},methods:{instanceChange:function(e){if(e){var t=e.split(":");this.form.instanceIp=t[0],this.form.instancePort=t[1]}else this.form.instanceIp="",this.form.instancePort=""},getClusterConfigOptions:function(){var e=this;Object(s["a"])({appId:this.$route.query.appId,baseId:this.$route.query.baseId}).then((function(t){e.configOptions=Object(u["a"])(t,"data")}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(a){var i;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(i=Object(n["a"])(Object(n["a"])({},e.form),{},{baseId:e.$route.query.baseId}),e.loading=!0,delete i.instanceOnline,e.isEdit?Object(s["d"])(i).then((function(t){200===t.code&&(e.$message.success("编辑成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1})):(delete i.id,Object(s["c"])(i).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},m=p,d=(a("a5ef"),a("2877")),g=Object(d["a"])(m,i,o,!1,null,"10fd2df0",null);t["default"]=g.exports},aedf:function(e,t,a){"use strict";a.r(t);a("caad");var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"匹配方式",prop:"matchType"}},[t("el-radio",{attrs:{label:0},model:{value:e.form.matchType,callback:function(t){e.$set(e.form,"matchType",t)},expression:"form.matchType"}},[e._v("类")]),t("el-radio",{attrs:{label:1},model:{value:e.form.matchType,callback:function(t){e.$set(e.form,"matchType",t)},expression:"form.matchType"}},[e._v("方法/数据")]),t("el-radio",{attrs:{label:2},model:{value:e.form.matchType,callback:function(t){e.$set(e.form,"matchType",t)},expression:"form.matchType"}},[e._v("自定义")])],1),t("el-form-item",{attrs:{label:"所属应用",prop:"baseId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:"",placeholder:"请选择"},model:{value:e.form.baseId,callback:function(t){e.$set(e.form,"baseId",t)},expression:"form.baseId"}},e._l(e.appOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.appName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"流控框架",prop:"limitFrame"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.limitFrame,callback:function(t){e.$set(e.form,"limitFrame",t)},expression:"form.limitFrame"}},e._l(e.dict_flowFrame,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"应用框架",prop:"appFrame"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.appFrame,callback:function(t){e.$set(e.form,"appFrame",t)},expression:"form.appFrame"}})],1),2==e.form.matchType?t("el-form-item",{attrs:{label:"处理引擎",prop:"customizeEngine"}},[t("el-input",{attrs:{placeholder:"请输入处理引擎"},model:{value:e.form.customizeEngine,callback:function(t){e.$set(e.form,"customizeEngine",t)},expression:"form.customizeEngine"}})],1):e._e(),t("el-form-item",{attrs:{label:"类名",prop:"className"}},[t("el-input",{model:{value:e.form.className,callback:function(t){e.$set(e.form,"className",t)},expression:"form.className"}})],1),1==e.form.matchType||2==e.form.matchType?t("el-form-item",{attrs:{label:"方法名",prop:"methodName"}},[t("el-input",{model:{value:e.form.methodName,callback:function(t){e.$set(e.form,"methodName",t)},expression:"form.methodName"}})],1):e._e(),[1,2].includes(e.form.matchType)?t("el-form-item",{attrs:{label:"参数类型",prop:"typeList_form"}},[t("FlowParamsType",{model:{value:e.typeList_form,callback:function(t){e.typeList_form=t},expression:"typeList_form"}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)],1)},o=[],r=a("5530"),n=a("c7eb"),l=a("1da1"),s=(a("99af"),a("d81d"),a("b64b"),a("d3b7"),a("159b"),a("cba0")),c=a("dcf6"),u=a("bc59"),f=a("ec41"),p=a("d1cd"),m=a("f14a"),d=a("aee7");function g(e,t){var a={id:"",matchType:0,baseId:"",limitFrame:"",appFrame:"",methodName:"",className:"",consumerProviderFlag:1,fuseState:0,resAppFlag:2,blackWhiteState:0};switch(t){case 2:break}return e&&Object.keys(a).forEach((function(t){Object(u["a"])(e,t)&&(a[t]=e[t])})),a}var b={components:{FlowParamsType:m["default"]},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},appType:{type:Object,default:null},refresh:Function},data:function(){return{dict_flowFrame:p["c"],typeList_form:[],typeList_hiddenExtra:null,appOptions:[],showDialog:!1,loading:!1,labelPosition:"right",form:g(),rules:{matchType:[{required:!0,message:"请选择匹配方式",trigger:"change"}],baseId:[{required:!0,message:"请选择所属应用",trigger:"change"}],limitFrame:[{required:!0,message:"请选择流控框架",trigger:"change"}],customizeEngine:[{required:!0,message:"请选择流处理引擎",trigger:"change"}],className:[{required:!0,message:"请填写类型",trigger:"blur"}],methodName:[{required:!0,message:"请填写方法名",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.getAppOptions(),this.isEdit?(this.form=g(this.rowData,this.rowData.matchType),this.form.className=this.rowData.resourceName.split("|")[0],this.form.methodName=this.rowData.resourceName.split("|")[1]||"",this.getDetail()):(this.form.baseId=this.appType.value,this.form.limitFrame=this.appType.limitFrame,this.form.appFrame=this.appType.appFrame)},methods:{getDetail:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var a,i,o,r;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.rowData)&&void 0!==a&&a.id){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Object(c["b"])(e.rowData.id);case 4:i=t.sent,o=Object(f["a"])(i,"data.typeList"),e.typeList_hiddenExtra=Object(d["b"])(o),r=Object(d["a"])(o).map((function(e){return{states:e.states,parameterType:e.parameterType}})),e.typeList_form=r;case 9:case"end":return t.stop()}}),t)})))()},getAppOptions:function(){var e=this;Object(s["c"])().then((function(t){e.appOptions=Object(f["a"])(t,"data")}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(n["a"])().mark((function t(a){var i,o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(i=Object(r["a"])({resourceName:"".concat(e.form.className).concat(""!==e.form.methodName?"|"+e.form.methodName:"")},e.form),delete i.methodName,delete i.className,o={govAppConfigPo:i,typeList:[]},[1,2].includes(e.form.matchType)&&(o.typeList=e.typeList_form.map((function(e,t){return Object(r["a"])(Object(r["a"])({},e),{},{paramNo:t+1})}))),e.loading=!0,e.isEdit?(e.typeList_hiddenExtra&&o.typeList.unshift(e.typeList_hiddenExtra),Object(c["h"])(o).then((function(t){200===t.code&&(e.$message({type:"success",message:"编辑成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))):Object(c["e"])(o).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},h=b,v=(a("846c"),a("2877")),D=Object(v["a"])(h,i,o,!1,null,"ef4e3c8e",null);t["default"]=D.exports},c936:function(e,t,a){"use strict";a("39d9")},cbbf:function(e,t,a){"use strict";a("a75d")},e6ff:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"黑白名单配置",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"名单类别",prop:"listType"}},[t("el-radio",{attrs:{label:"1"},model:{value:e.formData.listType,callback:function(t){e.$set(e.formData,"listType",t)},expression:"formData.listType"}},[e._v("黑名单")]),t("el-radio",{attrs:{label:"2"},model:{value:e.formData.listType,callback:function(t){e.$set(e.formData,"listType",t)},expression:"formData.listType"}},[e._v("白名单")])],1),t("el-form-item",{attrs:{label:"IP",prop:"ip"}},[t("el-input",{attrs:{rows:"6",type:"textarea",placeholder:"请输入ip,多个ip用英文逗号分隔"},model:{value:e.formData.ip,callback:function(t){e.$set(e.formData,"ip",t)},expression:"formData.ip"}})],1),t("el-form-item",{attrs:{prop:"fallbackStrategy",label:"降级策略"}},[t("el-radio-group",{model:{value:e.formData.fallbackStrategy,callback:function(t){e.$set(e.formData,"fallbackStrategy",t)},expression:"formData.fallbackStrategy"}},e._l(e.dict_fallback_strategy,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{prop:"fallbackMethod"}},[t("template",{slot:"label"},[t("span",[e._v("降级方法")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 降级方法的全类名。如：com.example.service.FallbackService.fallBack ")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{model:{value:e.formData.fallbackMethod,callback:function(t){e.$set(e.formData,"fallbackMethod",t)},expression:"formData.fallbackMethod"}})],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],r=a("c7eb"),n=a("5530"),l=a("1da1"),s=(a("b64b"),a("d3b7"),a("159b"),a("ec41")),c=a("bc59"),u=a("70b8"),f=a("5307"),p={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{dict_fallback_strategy:f["a"].options,loading:!1,labelPosition:"right",formData:m(),rules:{listType:[{required:!0,message:"请选择名单类别",trigger:"change"}],fallbackMethod:[{required:!0,message:"请输入降级方法",trigger:"blur"}],ip:[{required:!0,message:"请输入请输入ip,多个ip用英文逗号分隔",trigger:"blur"}]},detailData:null}},computed:{},watch:{},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e,t=this;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.loading=!0,Object(u["a"])(this.rowData.id).then((function(e){Object(s["a"])(e,"data.id")&&(t.detailData=e.data,t.formData=m(e.data))})).catch((function(e){})).finally((function(){t.loading=!1})))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(a){var i,o,l;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:if(l=Object(n["a"])({targetId:null===(i=e.rowData)||void 0===i?void 0:i.id},e.formData),e.loading=!0,null===(o=e.detailData)||void 0===o||!o.id){t.next=8;break}return l.id=e.detailData.id,Object(u["c"])(l).then((function(t){e.$message({type:"success",message:"更新成功"}),e.$emit("change",!1),e.refresh()})).catch((function(e){})).finally((function(){e.loading=!1})),t.abrupt("return");case 8:Object(u["b"])(l).then((function(t){200===t.code&&(e.$message({type:"success",message:"设置成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}};function m(e){var t={listType:"1",fallbackStrategy:"1",fallbackMethod:"",ip:""};return e&&Object.keys(t).forEach((function(a){Object(c["a"])(e,a)&&(t[a]=e[a])})),t}var d=p,g=(a("2c33"),a("2877")),b=Object(g["a"])(d,i,o,!1,null,"591bc797",null);t["default"]=b.exports},f58c:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.total,operateSlice:3,rowKey:"id",isPage:e.tableConfig.isPage,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAddDialog?t("FlowStrategyAdd",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e()],1)},o=[],r=a("5530"),n=(a("14d9"),a("d3b7"),a("ab6b")),l=a("b3a4"),s=a("ff51"),c=a("ec41"),u=a("d1cd"),f={components:{FlowStrategyAdd:n["default"]},mixins:[],props:{},data:function(){this.$createElement;var e=this;return{showAddDialog:!1,rowData:null,buttonList:[{label:"新增",type:"add",click:this.addInfo},{label:"返回",btnType:"",click:this.clickGoBack}],tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"instanceIp",label:"实例IP",align:"center"},{prop:"instancePort",label:"实例端口",align:"center"},{prop:"flowWeight",label:"权重",align:"center",get show(){return e.isWeight}},{prop:"instanceState",label:"状态",width:100,align:"left",render:function(e,t){var a=t.row,i=Object(u["i"])(a.instanceState,"instanceStateOptions"),o=Object(u["i"])(a.instanceState,"instanceStateOptions",["value","status"]);return o?e("hubaryDot",{attrs:{text:i,status:o}}):e("span")}},{prop:"description",label:"描述",align:"center"}],operate:{width:220,list:[{label:"编辑",id:"edit"},{label:"删除",id:"delete"}]}},searchConfig:{searchData:{instanceIp:""},searchItem:[{type:"input",label:"实例IP",prop:"instanceIp"}],rules:{}}}},computed:{isWeight:function(){return 2===this.$route.query.limitModel},limitModel:function(){return this.$route.query.limitModel},baseId:function(){return this.$route.query.baseId}},watch:{},created:function(){},mounted:function(){this.getList()},methods:{clickGoBack:function(){this.$router.push("/app-flow-strategy")},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(r["a"])(Object(r["a"])({},this.searchConfig.searchData),{},{baseId:this.$route.query.baseId,appId:this.$route.query.appId})};this.tableConfig.loading=!0,Object(l["e"])(t).then((function(t){Object(s["a"])(null===t||void 0===t?void 0:t.data.data)&&(e.tableConfig.tableData=t.data.data,e.tableConfig.pagination.total=Object(c["a"])(t,"data.totalCount")||0)})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.showAddDialog=!0,this.rowData=null},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getIndex:function(e){var t=this,a=(e.index,e.row),i=e.operate;"delete"===i.id?this.$confirm("确定要删除【".concat(a.instanceIp,"】吗?"),{type:"warning"}).then((function(){Object(l["b"])(a.id).then((function(e){t.$message.success("删除成功"),t.getList()})).catch((function(e){}))})).catch((function(e){})):"edit"===i.id&&(this.rowData=a,this.showAddDialog=!0)}}},p=f,m=a("2877"),d=Object(m["a"])(p,i,o,!1,null,"9f011f24",null);t["default"]=d.exports},f6eda:function(e,t,a){"use strict";a("6757")},fe3a:function(e,t,a){"use strict";a.r(t);a("caad");var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"配置-".concat(e.rowData.limitFrame),visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"SENTINEL"===e.rowData.limitFrame?"140px":"170px",model:e.formData,rules:e.rules}},["SENTINEL"===e.rowData.limitFrame?t("div",[t("el-form-item",{attrs:{label:"限流方式",prop:"senGrade"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择"},model:{value:e.formData.senGrade,callback:function(t){e.$set(e.formData,"senGrade",t)},expression:"formData.senGrade"}},e._l(e.dict_limitWay,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{prop:"senCount"}},[t("template",{slot:"label"},[t("span",[e._v("限流阈值")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(e.formData.senGrade?"集群允许最高QPS数":"集群允许最大并发线程数")+" ")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.senCount,callback:function(t){e.$set(e.formData,"senCount",e._n(t))},expression:"formData.senCount"}})],2),1==e.formData.senGrade?[t("el-form-item",{attrs:{label:"QPS限流策略",prop:"senControlBehavior"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择QPS限流策略"},model:{value:e.formData.senControlBehavior,callback:function(t){e.$set(e.formData,"senControlBehavior",t)},expression:"formData.senControlBehavior"}},e._l(e.dict_QPSlimitStrategy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),[2,4].includes(e.formData.senControlBehavior)?t("el-form-item",{attrs:{label:"预热时长(s)",prop:"senWarmUpPeriodSec"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.senWarmUpPeriodSec,callback:function(t){e.$set(e.formData,"senWarmUpPeriodSec",e._n(t))},expression:"formData.senWarmUpPeriodSec"}})],1):e._e(),[3,4].includes(e.formData.senControlBehavior)?t("el-form-item",{attrs:{label:"队列超时时间(ms)",prop:"senMaxQueueingTimes"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.senMaxQueueingTimes,callback:function(t){e.$set(e.formData,"senMaxQueueingTimes",e._n(t))},expression:"formData.senMaxQueueingTimes"}})],1):e._e()]:e._e()],2):e._e(),"RESILIENCE4J"===e.rowData.limitFrame?t("div",[t("el-form-item",{attrs:{label:"策略",prop:"protocol"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择策略"},model:{value:e.formData.resStrategy,callback:function(t){e.$set(e.formData,"resStrategy",t)},expression:"formData.resStrategy"}},e._l(e.dict_resilience4jStrategy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),[1,"1"].includes(e.formData.resStrategy)?[t("el-form-item",{attrs:{label:"频次阈值",prop:"resLimitPeriod"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resLimitPeriod,callback:function(t){e.$set(e.formData,"resLimitPeriod",e._n(t))},expression:"formData.resLimitPeriod"}})],1),t("el-form-item",{attrs:{label:"阈值刷新时间(ms)",prop:"resLimitRefreshPeriod"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resLimitRefreshPeriod,callback:function(t){e.$set(e.formData,"resLimitRefreshPeriod",e._n(t))},expression:"formData.resLimitRefreshPeriod"}})],1),t("el-form-item",{attrs:{label:"限流后的冷却时间(ms)",prop:"resTimeoutDuration"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resTimeoutDuration,callback:function(t){e.$set(e.formData,"resTimeoutDuration",e._n(t))},expression:"formData.resTimeoutDuration"}})],1)]:e._e(),[2,"2"].includes(e.formData.resStrategy)?[t("el-form-item",{attrs:{label:"最大并发数",prop:"resMaxConcurrentCalls"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resMaxConcurrentCalls,callback:function(t){e.$set(e.formData,"resMaxConcurrentCalls",e._n(t))},expression:"formData.resMaxConcurrentCalls"}})],1),t("el-form-item",{attrs:{prop:"resMaxWaitDuration"}},[t("template",{slot:"label"},[t("span",[e._v("饱和等待时间(ms)")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("等待线程释放时间")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resMaxWaitDuration,callback:function(t){e.$set(e.formData,"resMaxWaitDuration",e._n(t))},expression:"formData.resMaxWaitDuration"}})],2)]:e._e(),[3,"3"].includes(e.formData.resStrategy)?[t("el-form-item",{attrs:{label:"最大线程池",prop:"resMaxThreadPoolSize"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resMaxThreadPoolSize,callback:function(t){e.$set(e.formData,"resMaxThreadPoolSize",e._n(t))},expression:"formData.resMaxThreadPoolSize"}})],1),t("el-form-item",{attrs:{label:"核心线程数",prop:"resCoreThreadPoolSize"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resCoreThreadPoolSize,callback:function(t){e.$set(e.formData,"resCoreThreadPoolSize",e._n(t))},expression:"formData.resCoreThreadPoolSize"}})],1),t("el-form-item",{attrs:{label:"队列容量",prop:"resQueueCapacity"}},[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resQueueCapacity,callback:function(t){e.$set(e.formData,"resQueueCapacity",e._n(t))},expression:"formData.resQueueCapacity"}})],1),t("el-form-item",{attrs:{prop:"resKeepAliveTime"}},[t("template",{slot:"label"},[t("span",[e._v("等待时间(ms)")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("等待线程释放时间")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:e.formData.resKeepAliveTime,callback:function(t){e.$set(e.formData,"resKeepAliveTime",e._n(t))},expression:"formData.resKeepAliveTime"}})],2)]:e._e()],2):e._e(),t("el-form-item",{attrs:{prop:"fallbackStrategy",label:"降级策略"}},[t("el-radio-group",{model:{value:e.formData.fallbackStrategy,callback:function(t){e.$set(e.formData,"fallbackStrategy",t)},expression:"formData.fallbackStrategy"}},e._l(e.dict_fallback_strategy,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{prop:"fallbackMethod"}},[t("template",{slot:"label"},[t("span",[e._v("降级方法")]),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 降级方法的全类名。如：com.example.service.FallbackService.fallBack ")]),t("i",{staticClass:"el-icon-info table-msg"})])],1),t("el-input",{attrs:{size:"mini"},model:{value:e.formData.fallbackMethod,callback:function(t){e.$set(e.formData,"fallbackMethod",t)},expression:"formData.fallbackMethod"}})],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],r=a("c7eb"),n=a("5530"),l=a("1da1"),s=(a("b64b"),a("d3b7"),a("159b"),a("ec41")),c=a("bc59"),u=a("d1cd"),f=a("555f"),p=a("5307"),m={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{loading:!1,dict_limitWay:u["e"],dict_fallback_strategy:p["a"].options,dict_QPSlimitStrategy:u["a"],dict_resilience4jStrategy:u["f"],clusterList:[],labelPosition:"right",formData:d(),rules:{senGrade:[{required:!0,message:"请选择限流方式",trigger:"change"}],senCount:[{required:!0,message:"请输入限流阈值",trigger:"blur"}],fallbackMethod:[{required:!0,message:"请输入降级方法",trigger:"blur"}],senControlBehavior:[{required:!0,message:"请选择限流策略",trigger:"change"}],senMaxQueueingTimes:[{required:!0,message:"请输入队列超时时间",trigger:"blur"}],resStrategy:[{required:!0,message:"请选择策略",trigger:"change"}],resMaxConcurrentCalls:[{required:!0,message:"请输入最大并发数",trigger:"blur"}],resMaxWaitDuration:[{required:!0,message:"请输入饱和等待时间",trigger:"blur"}],resLimitPeriod:[{required:!0,message:"请输入频次阈值",trigger:"blur"}],resLimitRefreshPeriod:[{required:!0,message:"请输入阀值刷新时间",trigger:"blur"}],resTimeoutDuration:[{required:!0,message:"请输入限流后的冷却时间",trigger:"blur"}],fallbackStrategy:[{required:!0,message:"降级策略",trigger:"blur"}]},detailData:null}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e,t=this;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.loading=!0,Object(f["a"])(this.rowData.id).then((function(e){Object(s["a"])(e,"data.id")?(t.detailData=e.data,t.formData=d(e.data,t.rowData.limitFrame)):t.formData=d(null,t.rowData.limitFrame)})).catch((function(e){})).finally((function(){t.loading=!1})))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(l["a"])(Object(r["a"])().mark((function t(a){var i,o,l;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=8;break}if(o=Object(n["a"])(Object(n["a"])({},e.formData),{},{targetId:e.rowData.id}),e.loading=!0,null===(i=e.detailData)||void 0===i||!i.id){t.next=7;break}return o.id=null===(l=e.detailData)||void 0===l?void 0:l.id,Object(f["c"])(o).then((function(t){e.$message({type:"success",message:"配置更新成功"}),e.$emit("change",!1),e.refresh()})).catch((function(e){})).finally((function(){e.loading=!1})),t.abrupt("return");case 7:Object(f["b"])(o).then((function(t){200===t.code&&(e.$message({type:"success",message:"配置添加成功"}),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}};function d(e,t){var a={fallbackStrategy:"1",fallbackMethod:""};switch(t){case"SENTINEL":a.senGrade=0,a.senCount="",a.senControlBehavior="",a.senWarmUpPeriodSec="",a.senMaxQueueingTimes="";break;case"RESILIENCE4J":a.resStrategy="",a.resMaxConcurrentCalls="",a.resMaxWaitDuration="",a.resLimitPeriod="",a.resLimitRefreshPeriod="",a.resTimeoutDuration="",a.resMaxThreadPoolSize="",a.resCoreThreadPoolSize="",a.resQueueCapacity="",a.resKeepAliveTime="";break}return e&&Object.keys(a).forEach((function(t){Object(c["a"])(e,t)&&(a[t]=e[t])})),a}var g=m,b=(a("a8eb"),a("2877")),h=Object(b["a"])(g,i,o,!1,null,"4b7a35a5",null);t["default"]=h.exports}}]);