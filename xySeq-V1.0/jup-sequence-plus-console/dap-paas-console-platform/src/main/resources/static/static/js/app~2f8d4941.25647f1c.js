(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~2f8d4941"],{"2cb0":function(e,t,a){},3522:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("div",{key:"consume",staticClass:"page-box"},[t("el-form",{ref:"formRef",attrs:{model:e.searchData,rules:e.rules,inline:!0}},[t("el-form-item",{attrs:{label:"集群/节点",prop:"clusterId"}},[t("el-cascader",{ref:"clusterRef",staticStyle:{width:"400px"},attrs:{props:e.props,placeholder:"请选择集群和节点"},on:{change:e.changeCluster},model:{value:e.searchData.ids,callback:function(t){e.$set(e.searchData,"ids",t)},expression:"searchData.ids"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{prop:"clusterNodeId"}}),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.clickSearch}},[e._v(" 查询")]),t("el-button",{attrs:{size:"small"},on:{click:e.clickRefreshCache}},[e._v(" 刷新缓存 ")])],1)],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.cardData&&e.cardData.length>0?t("el-row",{attrs:{gutter:20}},e._l(e.cardData,(function(a,i){return t("el-col",{key:i,attrs:{span:6}},[t("div",{staticClass:"card-box",attrs:{id:"node-item-".concat(i+1)}},[0===a.status?t("div",{staticClass:"card-status-tag"},[t("el-tag",{attrs:{size:"small",effect:"dark",type:"danger"}},[e._v("异常")])],1):e._e(),1===a.status?t("div",{staticClass:"card-status-tag"},[t("el-tag",{attrs:{size:"small",effect:"dark",type:"success"}},[e._v("正常")])],1):e._e(),t("ul",[t("li",[t("span",{staticClass:"card-li-label"},[e._v("集群名称")]),t("span",[e._v(" "+e._s(a.serviceName)+" ")])]),t("li",[t("span",{staticClass:"card-li-label"},[e._v("客户端名称")]),t("span",[e._v(" "+e._s(a.clientName)+" ")])]),t("li",[t("span",{staticClass:"card-li-label"},[e._v("连接数")]),t("span",[e._v(" "+e._s(a.appNum)+" ")])]),t("li",[t("span",{staticClass:"card-li-label"},[e._v("IP")]),t("span",[e._v(" "+e._s(a.hostIp)+" ")])]),t("li",[t("span",{staticClass:"card-li-label"},[e._v("端口")]),t("span",[e._v(" "+e._s(a.port)+" ")])])])])])})),1):t("el-empty",{attrs:{"image-size":220}})],1)],1),e.showDialog?t("DialogRefreshCache",{attrs:{rowData:e.rowData},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}}):e._e()],1)},n=[],s=a("5530"),o=a("c7eb"),r=a("1da1"),l=(a("99af"),a("d81d"),a("d3b7"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"刷新缓存",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"集群",prop:"clusterId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择集群",filterable:""},on:{change:e.changeCluster},model:{value:e.formData.clusterId,callback:function(t){e.$set(e.formData,"clusterId",t)},expression:"formData.clusterId"}},e._l(e.opts_cluster,(function(e){return t("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"应用实例",prop:"instance"}},[t("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingTree,expression:"loadingTree"}],ref:"treeRef",staticClass:"instance-tree",attrs:{data:e.treeData,props:e.defaultProps,"show-checkbox":"","node-key":"id"},on:{"check-change":e.handleCheckChange}})],1),t("el-form-item",{attrs:{label:"执行参数",prop:"details"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入执行参数"},model:{value:e.formData.details,callback:function(t){e.$set(e.formData,"details",t)},expression:"formData.details"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),c=[],u=(a("b64b"),a("0168")),d=a("4b2e"),f=a("ff51"),p=a("e8b2"),m={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean},data:function(){return{formData:{clusterId:"",instance:[],details:""},opts_cluster:[],rules:{clusterId:[{required:!0,trigger:"blur",message:"请输入原密码"}],instance:[{type:"array",required:!0,trigger:"change",message:"请选择应用实例"}]},defaultProps:{children:"children",label:"label",isLeaf:"isLeaf"},treeData:[],loadingTree:!1,loading:!1}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}}},watch:{},created:function(){this.getCluster()},mounted:function(){},methods:{clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},getCluster:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var a,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["c"])();case 2:a=t.sent,i=a.data,e.opts_cluster=Object(f["a"])(i)?i:[];case 5:case"end":return t.stop()}}),t)})))()},handleCheckChange:function(e,t,a){var i=this.$refs.treeRef.getCheckedNodes(!0);this.formData.instance=i.map((function(e){return e.id}))},changeCluster:function(e){var t=this;return Object(r["a"])(Object(o["a"])().mark((function a(){var i,n,s;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=[],t.treeData=[],a.prev=2,!e){a.next=11;break}return t.loadingTree=!0,a.next=7,Object(d["b"])(e);case 7:n=a.sent,s=JSON.parse(null===n||void 0===n?void 0:n.data),Object(p["a"])(s)&&(i=Object.keys(s).map((function(e){var t=[];return Object(f["a"])(s[e])&&(t=s[e].map((function(e){return{label:"".concat(e.hostIp,":").concat(e.port),id:e.id,isLeaf:!0}}))),{label:e,id:e,isLeaf:!1,children:t}})));case 11:a.next=16;break;case 13:a.prev=13,a.t0=a["catch"](2);case 16:t.loadingTree=!1,t.treeData=i;case 18:case"end":return a.stop()}}),a,null,[[2,13]])})))()},clickConfirm:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var a,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.formRef.validate();case 3:if(a=t.sent,a){t.next=6;break}return t.abrupt("return");case 6:return i=null,e.loading=!0,t.next=10,Object(d["c"])({ids:e.formData.instance,details:e.formData.details});case 10:i=t.sent,i&&200==i.code&&(e.$notify({title:"提示",message:i.data}),e.$emit("change",!1)),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0);case 17:e.loading=!1;case 18:case"end":return t.stop()}}),t,null,[[0,14]])})))()}}},g=m,h=(a("c9c5"),a("2877")),b=Object(h["a"])(g,l,c,!1,null,"1e8bbca8",null),v=b.exports,y=a("1f97"),C={name:"sdk-topology-monitor",components:{DialogRefreshCache:v},mixins:[],filters:{F_clusterStatusOptions:function(e){return Object(y["c"])(e,"clusterStatusOptions")}},props:{},data:function(){return{showDialog:!1,rowData:null,cardData:[],loading:!1,searchData:{ids:[],get clusterId(){return Object(f["a"])(this.ids)?this.ids[0]:""},get clusterNodeId(){return Object(f["a"])(this.ids)?this.ids[1]:""}},rules:{clusterId:[{required:!0,message:"请选择集群和节点",trigger:"change"}],clusterNodeId:[{required:!0,message:"请选择集群和节点",trigger:"change"}]},clusterList:[],props:{lazy:!0,lazyLoad:this.lazyLoad}}},computed:{clusterStatusArr:function(){return y["b"].map((function(e){return e.value}))}},watch:{},created:function(){},mounted:function(){},methods:{clickSearch:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.formRef.validate();case 3:a=t.sent,a&&e.changeCluster(),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},clickRefreshCache:function(e){this.showDialog=!0,this.rowData=e},getData:function(){var e=this;this.loading=!0,this.cardData=[],Object(d["a"])(this.searchData.clusterNodeId).then((function(t){Object(f["a"])(null===t||void 0===t?void 0:t.data)&&(e.cardData=t.data)})).catch((function(e){})).finally((function(){e.loading=!1}))},getTagType:function(e){return Object(y["c"])(e,"clusterStatusOptions",["value","type"])},changeCluster:function(e){var t=this.$refs.clusterRef.getCheckedNodes(!0);t&&t.length>0&&t[0].data,this.getData()},lazyLoad:function(e,t){var a=e.level;0===a?Object(u["c"])().then((function(e){var a=Object(f["a"])(null===e||void 0===e?void 0:e.data)?e.data:[],i=a.map((function(e){return{label:e.clusterName,value:e.id,leaf:!1}}));t(i)})):1===a&&Object(u["d"])(e.value).then((function(e){var a=Object(f["a"])(null===e||void 0===e?void 0:e.data)?e.data:[],i=a.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{label:"".concat(e.hostIp,":").concat(e.port),value:e.id,leaf:!0})}));t(i)})).catch((function(e){}))}}},k=C,D=(a("3973"),Object(h["a"])(k,i,n,!1,null,"0c30586a",null));t["default"]=D.exports},3973:function(e,t,a){"use strict";a("4c35")},"3d74":function(e,t,a){},"406a":function(e,t,a){},"4c35":function(e,t,a){},"5ad5":function(e,t,a){"use strict";a.r(t);a("b0c0");var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.rules,inline:!0}},[t("el-form-item",{attrs:{prop:"groupId",label:"架构"}},[t("el-select",{on:{change:e.changeGroupId},model:{value:e.formData.groupId,callback:function(t){e.$set(e.formData,"groupId",t)},expression:"formData.groupId"}},e._l(e.archList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.clickSearch}},[e._v("刷新")])],1)],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.linksData.length>0?t("G6Dagre",{attrs:{chartData:e.chartData,height:"500px",width:"100%"},on:{"click-node":e.clickNode}}):t("el-empty")],1)],1)},n=[],s=a("5530"),o=(a("14d9"),a("d3b7"),a("07ac"),a("159b"),a("0aac")),r=a("04bb"),l=a("ff51"),c=a("ec41"),u=a("bc59"),d=a("f360"),f=a("cfcc"),p={components:{G6Dagre:d["default"]},data:function(){return{formData:{groupId:""},rules:{groupId:[{required:!0,message:"请选择架构",trigger:"change"}]},archList:[],chartData:{edges:[],nodes:[],combos:[]},linksData:[],loading:!1}},created:function(){this.getArch()},methods:{getArch:function(){var e=this;Object(r["c"])({}).then((function(t){e.archList=Object(l["a"])(Object(c["a"])(t,"data"))?t.data:[]})).catch((function(e){}))},changeGroupId:function(e){e&&this.clickSearch()},clickSearch:function(){var e=this;this.$refs.formRef.validate((function(t){t&&e.getData()}))},getData:function(){var e=this;this.loading=!0,this.linksData=[],this.chartData.combos=[],this.chartData.nodes=[],this.chartData.edges=[],Object(o["d"])(this.formData.groupId).then((function(t){if(t){var a=Object(l["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.linksData=a;var i={},n={fill:"#fff",stroke:"#C4E3B2",lineWidth:1,shadowBlur:0,radius:7},o=[],r=[];a.forEach((function(e){e.cityId&&!Object(u["a"])(i,e.cityId)&&(i[e.cityId]={id:e.cityId,label:e.cityName,style:n});var t="",a="gray",l=Object(f["f"])(e.syncMethod,"syncMethodOptions");e.status&&(t=Object(f["f"])(e.status,"dataMigrationStatus"),a=Object(f["f"])(e.status,"dataMigrationStatus",["value","color"])),o.push(Object(s["a"])(Object(s["a"])({},e),{},{id:e.clusterId,value:e.clusterName,label:e.clusterName,comboId:e.cityId,statusLabel:t,syncMethodLabel:l})),e.parentClusterId&&"-"!==e.parentClusterId&&r.push({source:e.parentClusterId,target:e.clusterId,label:l,style:{stroke:a}})})),e.chartData.nodes=o,e.chartData.edges=r,e.chartData.combos=Object.values(i)}})).catch((function(e){})).finally((function(){e.loading=!1}))},clickNode:function(e){}}},m=p,g=a("2877"),h=Object(g["a"])(m,i,n,!1,null,"bc19bc64",null);t["default"]=h.exports},"636b":function(e,t,a){"use strict";a("406a")},"6b3d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"添加主中心",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"地区",prop:"cityId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择地区"},on:{change:e.getMachineRoomOptions},model:{value:e.formData.cityId,callback:function(t){e.$set(e.formData,"cityId",t)},expression:"formData.cityId"}},e._l(e.csMixCity,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"数据中心",prop:"machineRoomId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据中心"},model:{value:e.formData.machineRoomId,callback:function(t){e.$set(e.formData,"machineRoomId",t)},expression:"formData.machineRoomId"}},e._l(e.MachineRoomOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.machineRoomName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"集群",prop:"clusterId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择集群"},on:{change:e.getClusterOptions},model:{value:e.formData.clusterId,callback:function(t){e.$set(e.formData,"clusterId",t)},expression:"formData.clusterId"}},e._l(e.clusterIdOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},n=[],s=a("5530"),o=(a("d3b7"),a("ff32")),r=a("1b62"),l=(a("ca9d"),a("fbd2")),c=a("3882"),u=a("0aac"),d=r["a"].CommonSelectCreaterMix,f={components:{},mixins:[d(["csMixCity","csMixMachineRoom"])],model:{prop:"show",event:"change"},props:{show:Boolean,refresh:{type:Function,require:!0}},data:function(){return{registryClusterOptions:o["g"],configClusterRoleOptions:o["a"],clusterList:[],MachineRoomOptions:[],clusterIdOptions:[],loading:!1,formData:{cityId:"",machineRoomId:"",clusterId:""},rules:{cityId:[{required:!0,trigger:"change",message:"请选择地区"}],machineRoomId:[{required:!0,trigger:"change",message:"请选择机房"}],clusterId:[{required:!0,trigger:"change",message:"请选择集群"}]}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},orgId:function(){return this.$route.query.orgId},groupId:function(){return this.$route.query.groupId}},watch:{},created:function(){},mounted:function(){this.getClusterIdOptions()},methods:{getMachineRoomOptions:function(){var e=this,t={orgId:this.$route.query.orgId,cityId:this.formData.cityId};Object(l["d"])(t).then((function(t){e.MachineRoomOptions=t.data}))},getClusterIdOptions:function(){var e=this,t=this.$route.query.orgId;Object(c["i"])(t).then((function(t){e.clusterIdOptions=t.data}))},getClusterOptions:function(){},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(s["a"])(Object(s["a"])({},e.formData),{},{groupId:e.$route.query.groupId});e.loading=!0,Object(u["b"])(a).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))}}))}}},p=f,m=a("2877"),g=Object(m["a"])(p,i,n,!1,null,"6e914ff7",null);t["default"]=g.exports},8238:function(e,t,a){},9236:function(e,t,a){},9778:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("div",{staticClass:"flex-inline-between"},[t("el-button",{directives:[{name:"perm-code",rawName:"v-perm-code",value:"add",expression:"'add'"}],attrs:{type:"primary"},on:{click:e.openAdd}},[e._v("新增")])],1),t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:3,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.visible?t("DialogOrgAdd",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}}):e._e()],1)},n=[],s=a("5530"),o=(a("14d9"),a("b0c0"),a("d3b7"),a("a4d3"),a("e01a"),a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name","string"===typeof t?t.trim():t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"组织",prop:"orgId"}},[t("el-select",{staticClass:"w-100",attrs:{type:"orgId",placeholder:"请选择组织",disabled:e.isEdit},model:{value:e.formData.orgId,callback:function(t){e.$set(e.formData,"orgId",t)},expression:"formData.orgId"}},e._l(e.organizationList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.organizationName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"版本",prop:"version"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择版本",disabled:e.isEdit},model:{value:e.formData.version,callback:function(t){e.$set(e.formData,"version",t)},expression:"formData.version"}},e._l(e.redisVersionOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入描述",type:"textarea"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description","string"===typeof t?t.trim():t)},expression:"formData.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),r=[],l=(a("b64b"),a("159b"),a("ff51")),c=a("e8b2"),u=(a("2208"),a("fbd2")),d=a("ff32"),f=a("04bb"),p=a("cfcc"),m={name:"dialog-org-add",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:{type:Function,required:!0,default:function(){}}},data:function(){return{formData:g(),registryClusterOptions:d["g"],redisVersionOptions:p["g"],rules:{name:[{required:!0,trigger:"blur",message:"请输入名称"}],version:[{required:!0,trigger:"change",message:"请选择版本"}],orgId:[{required:!0,trigger:"change",message:"请选择组织"}]},organizationList:[],versionOptions:[]}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){this.getOrg()},mounted:function(){var e;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.formData=g(this.rowData))},methods:{getOrg:function(){var e=this;Object(u["e"])().then((function(t){e.organizationList=Object(l["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(s["a"])({},e.formData);e.isEdit?Object(f["e"])(a).then((function(t){t&&200===t.code&&(e.$message.success("修改成功"),e.$emit("change",!1),e.refresh())})):(delete a.id,Object(f["a"])(a).then((function(t){t&&200===t.code&&(e.$message.success("新增成功"),e.refresh(),e.$emit("change",!1))})))}}))}}};function g(e){var t={id:"",name:"",version:"",orgId:"",description:""};return Object(c["a"])(e)&&Object.keys(t).forEach((function(a){e.hasOwnProperty(a)&&(t[a]=e[a])})),t}var h=m,b=a("2877"),v=Object(b["a"])(h,o,r,!1,null,"22ab1e14",null),y=v.exports,C=a("ec41"),k={name:"cache-multiple-center-settings",components:{DialogOrgAdd:y},mixins:[],props:{},data:function(){this.$createElement;return{visible:!1,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"name",label:"名称",align:"center"},{prop:"orgId",label:"组织",align:"center",render:function(e,t){var a=t.row;return e("span",[a.orgName])}},{prop:"clusterNum",label:"集群数",align:"center"},{prop:"description",label:"描述",align:"center"}],operate:{width:220,list:[{label:"中心管理",id:"manage",btnPermCode:"relation"},{label:"编辑",id:"edit",btnPermCode:"edit"},{label:"删除",id:"delete",btnPermCode:"delete"}]}},searchConfig:{searchData:{name:""},searchItem:[{type:"input",label:"名称",prop:"name"}],rules:{}},rowData:null}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{onSearch:function(){this.tableConfig.pagination.currentPage=1,this.getList()},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(s["a"])({},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(f["d"])(t).then((function(t){var a=Object(C["a"])(t,"data.data");e.tableConfig.tableData=Object(l["a"])(a)?a:[],e.tableConfig.pagination.totalCount=Object(C["a"])(t,"data.totalCount")||0})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},getIndex:function(e){var t=this,a=(e.index,e.row),i=e.operate;"delete"===i.id?this.$confirm("确定要删除【".concat(a.name,"】吗?"),{type:"warning"}).then((function(){Object(f["b"])(a.id).then((function(e){200===e.code&&(t.$message.success("删除成功"),t.getList())})).catch((function(e){}))})).catch((function(e){})):"edit"===i.id?(this.rowData=a,this.visible=!0):"manage"===i.id&&this.$router.push({path:"/multicentreStructure/cache-multi-cluster-manage",query:{groupId:a.id,orgId:a.orgId}})},openAdd:function(){this.rowData=null,this.visible=!0},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()}}},D=k,w=Object(b["a"])(D,i,n,!1,null,"48cb6102",null);t["default"]=w.exports},"9e73":function(e,t,a){"use strict";a("2cb0")},b1c6:function(e,t,a){"use strict";a.r(t);a("caad");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("header",[e.isAddMain?t("el-button",{attrs:{type:"primary"},on:{click:e.clickAddCluster}},[e._v("添加主中心")]):e._e(),t("el-button",{attrs:{type:"primary"},on:{click:e.clickRefresh}},[e._v("刷新")]),t("el-button",{on:{click:e.clickBack}},[e._v("返回")])],1),t("main",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mt-15"},[e.clusterData.length>0?t("el-row",{attrs:{gutter:10}},e._l(e.clusterData,(function(a){return t("el-col",{key:a.id,attrs:{span:8}},[t("el-card",{staticClass:"multiple-card",attrs:{shadow:"always"}},[[t("el-tag",{attrs:{size:"small",type:e.dictCache_clusterRole.getItem(a.dataType).type,effect:"dark"}},[e._v(" "+e._s(e.dictCache_clusterRole.get(a.dataType))+" ")])],t("el-descriptions",{attrs:{column:2}},[t("el-descriptions-item",{attrs:{label:"集群名称",span:2}},[e._v(" "+e._s(a.clusterName)+" ")]),t("el-descriptions-item",{attrs:{label:"机房",span:1}},[e._v(" "+e._s(a.machineRoomName)+" ")]),t("el-descriptions-item",{attrs:{label:"状态",span:1}},[e.dictCache_mainStatus.has(a.status)?t("hubary-dot",{attrs:{status:e.dictCache_mainStatus.getItem(a.status).status,title:a.status}},[e._v(" "+e._s(e.dictCache_mainStatus.get(a.status))+" ")]):e._e()],1),t("el-descriptions-item",{attrs:{label:"地区",span:2}},[e._v(e._s(a.cityName))]),t("el-descriptions-item",{attrs:{label:"总节点数",span:1}},[e._v(" "+e._s(a.totalNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"运行节点数",span:1}},[e._v(" "+e._s(a.runNodeNum)+" ")]),a.parentClusterId?[t("el-descriptions-item",{attrs:{label:"同步集群",span:1}},[e._v(" "+e._s(a.parentClusterName)+" ")]),t("el-descriptions-item",{attrs:{label:"同步方式",span:1}},[e._v(" "+e._s(e.dictCache_syncMethod.get(a.syncMethod))+" ")])]:e._e()],2),t("footer",[0==a.syncMethod?t("el-button",{on:{click:function(t){return e.clickSync(a)}}},[e._v("同步")]):e._e(),1===a.dataType?[0!=a.syncMethod?t("el-button",{directives:[{name:"show",rawName:"v-show",value:["STOP","CREATING","CREATED","PAUSE","BROKEN"].includes(a.status),expression:"\n                  ['STOP', 'CREATING', 'CREATED', 'PAUSE', 'BROKEN'].includes(\n                    item.status\n                  )\n                "}],attrs:{size:"mini"},on:{click:function(t){return e.clickBackFooter("start",a)}}},[e._v("启动")]):e._e(),t("el-button",{directives:[{name:"show",rawName:"v-show",value:["RUN","RDBRUNING","COMMANDRUNNING","FINISH"].includes(a.status),expression:"\n                  ['RUN', 'RDBRUNING', 'COMMANDRUNNING', 'FINISH'].includes(\n                    item.status\n                  )\n                "}],attrs:{size:"mini"},on:{click:function(t){return e.clickBackFooter("stop",a)}}},[e._v("停止")])]:e._e(),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.clickBackFooter("move",a)}}},[e._v("关联备中心")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.clickBackFooter("delete",a)}}},[e._v("删除")])],2)],2)],1)})),1):t("el-empty")],1),e.visible?t("ClusterAdd",{attrs:{refresh:e.getList},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}}):e._e(),e.visibleMove?t("DataMove",{attrs:{rowData:e.rowData,clusterList:e.clusterData,refresh:e.getList},model:{value:e.visibleMove,callback:function(t){e.visibleMove=t},expression:"visibleMove"}}):e._e()],1)},n=[],s=a("c7eb"),o=a("1da1"),r=(a("d3b7"),a("3882")),l=a("0aac"),c=a("ec41"),u=a("ff51"),d=a("6b3d"),f=a("b2f1"),p=a("a349"),m={components:{ClusterAdd:d["default"],DataMove:f["default"]},data:function(){return{isAddMain:!1,visible:!1,visibleMove:!1,loading:!1,clusterData:[],status:"STOP",rowData:null,clusterOptions:[],dictCache_syncMethod:p["d"],dictCache_mainStatus:p["c"],dictCache_clusterRole:p["a"]}},computed:{groupId:function(){return this.$route.query.groupId},orgId:function(){return this.$route.query.orgId}},watch:{clusterData:function(){var e=!0;if(this.clusterData.length>0){var t=this.clusterData.some((function(e){return!e.parentClusterId}));t&&(e=!1)}this.isAddMain=e}},created:function(){},mounted:function(){this.getClusterIdOptions()},methods:{clickBack:function(){this.$router.go(-1)},clickRefresh:function(){this.getList()},getClusterIdOptions:function(){var e=this;return Object(o["a"])(Object(s["a"])().mark((function t(){var a,i,n;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$route.query.orgId,t.next=3,Object(r["i"])(a).catch((function(e){}));case 3:i=t.sent,n=Object(c["a"])(i,"data"),e.clusterOptions=Object(u["a"])(n)?n:[],e.getList();case 7:case"end":return t.stop()}}),t)})))()},getList:function(){var e=this;return Object(o["a"])(Object(s["a"])().mark((function t(){var a,i;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$route.query.groupId,e.loading=!0,t.next=4,Object(l["e"])({groupId:a}).catch((function(e){}));case 4:i=t.sent,e.loading=!1,e.clusterData=Object(u["a"])(null===i||void 0===i?void 0:i.data)?i.data:[];case 7:case"end":return t.stop()}}),t)})))()},clickAddCluster:function(){this.visible=!0},clickSync:function(e){var t=this,a={id:e.id};Object(l["f"])(a).then((function(e){t.$message.success("已同步"),t.clickRefresh()})).finally((function(){t.loading=!1}))},clickBackFooter:function(e,t){var a=this;switch(e){case"move":this.rowData=t,this.visibleMove=!0;break;case"delete":this.$confirm("确定要删除【".concat(t.clusterName,"】吗"),{type:"warning"}).then((function(){Object(l["c"])(t.id).then((function(e){a.$message.success("删除成功"),a.clickRefresh()}))}));break;case"start":var i={id:t.id};this.loading=!0,Object(l["f"])(i).then((function(e){a.$message.success("启动成功"),a.clickRefresh()})).catch((function(){a.loading=!1}));break;case"stop":var n={id:t.id};this.loading=!0,Object(l["g"])(n).then((function(e){a.$message.success("停止成功"),a.clickRefresh()})).catch((function(){a.loading=!1}));break}}}},g=m,h=(a("bc45"),a("2877")),b=Object(h["a"])(g,i,n,!1,null,"f8fe1350",null);t["default"]=b.exports},b2f1:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"关联备中心",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"同步集群",prop:"parentClusterId"}},[t("span",[e._v(e._s(e.filterInfo(e.rowData.clusterId,"clusterName")))])]),t("el-form-item",{attrs:{label:"地区",prop:"cityId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择地区"},on:{change:e.getMachineRoomOptions},model:{value:e.formData.cityId,callback:function(t){e.$set(e.formData,"cityId",t)},expression:"formData.cityId"}},e._l(e.csMixCity,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"机房",prop:"machineRoomId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择机房"},model:{value:e.formData.machineRoomId,callback:function(t){e.$set(e.formData,"machineRoomId",t)},expression:"formData.machineRoomId"}},e._l(e.MachineRoomOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.machineRoomName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"集群",prop:"clusterId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择集群"},model:{value:e.formData.clusterId,callback:function(t){e.$set(e.formData,"clusterId",t)},expression:"formData.clusterId"}},e._l(e.clusterIdOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"同步方式",prop:"syncMethod"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择同步方式"},model:{value:e.formData.syncMethod,callback:function(t){e.$set(e.formData,"syncMethod",t)},expression:"formData.syncMethod"}},[t("el-option",{attrs:{label:"冷备",value:"0"}}),t("el-option",{attrs:{label:"热备",value:"1"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},n=[],s=a("5530"),o=(a("d3b7"),a("ff32")),r=a("3882"),l=a("0aac"),c=a("fbd2"),u=a("1b62"),d=(a("49bb"),u["a"].CommonSelectCreaterMix),f={components:{},mixins:[d(["csMixCity","csMixMachineRoom"])],model:{prop:"show",event:"change"},props:{show:Boolean,refresh:{type:Function,require:!0},rowData:{type:Object,default:function(){return{}}},clusterList:{type:Array,default:function(){return[]}}},data:function(){return{dataMoveTypeOptions:o["d"],MachineRoomOptions:[],clusterIdOptions:[],loading:!1,formData:{parentClusterId:"",cityId:"",machineRoomId:"",clusterId:"",syncMethod:""},rules:{cityId:[{required:!0,trigger:"change",message:"请选择地区"}],machineRoomId:[{required:!0,trigger:"change",message:"请选择机房"}],clusterId:[{required:!0,trigger:"change",message:"请选择集群"}],syncMethod:[{required:!0,trigger:"change",message:"请选择同步方式"}]}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},orgId:function(){return this.$route.query.orgId},groupId:function(){return this.$route.query.groupId}},watch:{},created:function(){},mounted:function(){this.getClusterIdOptions()},methods:{filterInfo:function(e,t){return Object(o["e"])(e,this.clusterIdOptions,["id",t])},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(s["a"])(Object(s["a"])({},e.formData),{},{parentClusterId:e.rowData.clusterId,groupId:e.groupId});e.loading=!0,Object(l["a"])(a).then((function(t){200===t.code&&(e.$message.success("关联成功"),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))}}))},getMachineRoomOptions:function(e){var t=this,a={orgId:this.$route.query.orgId,cityId:e};Object(c["d"])(a).then((function(e){t.MachineRoomOptions=e.data}))},getClusterIdOptions:function(){var e=this,t=this.$route.query.orgId;Object(r["i"])(t).then((function(t){e.clusterIdOptions=t.data}))}}},p=f,m=(a("d84e"),a("2877")),g=Object(m["a"])(p,i,n,!1,null,"67f21f07",null);t["default"]=g.exports},bc45:function(e,t,a){"use strict";a("8238")},c804:function(e,t,a){},c9c5:function(e,t,a){"use strict";a("3d74")},ccfd:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("div",{staticClass:"name-container"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:3,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}}):e._e(),e.showDetail?t("DialogDataMove",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showDetail,callback:function(t){e.showDetail=t},expression:"showDetail"}}):e._e()],1)])},n=[],s=(a("7db0"),a("caad"),a("d3b7"),a("a4d3"),a("e01a"),a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,loading:e.multiLoading,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"80px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[t("el-input",{attrs:{disabled:e.isEdit,placeholder:"请输入名称"},model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName","string"===typeof t?t.trim():t)},expression:"form.taskName"}})],1),t("el-form-item",{attrs:{label:"源集群",prop:"sourceClusterId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:e.isEdit,placeholder:"请选择",clearable:""},on:{change:e.getSourceClusterInfo},model:{value:e.form.sourceClusterId,callback:function(t){e.$set(e.form,"sourceClusterId",t)},expression:"form.sourceClusterId"}},e._l(e.csMixCacheCluster,(function(a){return t("el-option",{key:a.id,attrs:{disabled:e.form.targetClusterId==a.id,label:a.clusterName,value:a.id}})})),1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.form.sourceClusterId,expression:"form.sourceClusterId"}],staticStyle:{"font-size":"12px"}},[t("div",[t("span",[e._v("版本：")]),t("span",[e._v(e._s(e.form.sourceClusterVersion))])]),t("el-row",[t("el-col",{attrs:{span:2}},[t("span",[e._v("节点:")])]),t("el-col",{attrs:{span:22}},e._l(e.form.sourceClusterNodes.split(","),(function(a){return t("el-tag",{key:a,staticClass:"mr-10"},[e._v(e._s(a))])})),1)],1)],1)],1),t("el-form-item",{attrs:{label:"迁移类型",prop:"syncType"}},[t("div",[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.form.syncType,callback:function(t){e.$set(e.form,"syncType",t)},expression:"form.syncType"}},e._l(e.syncTypeOptions,(function(a){return t("el-radio",{key:a.value,staticClass:"mt-10",attrs:{label:a.value}},[e._v(e._s(a.label)+"("+e._s(a.description)+")")])})),1)],1)]),t("el-form-item",{attrs:{label:"目标集群",prop:"targetClusterId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:e.isEdit,placeholder:"请选择",clearable:""},on:{change:e.getTargetClusterInfo},model:{value:e.form.targetClusterId,callback:function(t){e.$set(e.form,"targetClusterId",t)},expression:"form.targetClusterId"}},e._l(e.csMixCacheCluster,(function(a){return t("el-option",{key:a.id,attrs:{disabled:e.form.sourceClusterId==a.id,label:a.clusterName,value:a.id}})})),1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.form.targetClusterId,expression:"form.targetClusterId"}],staticStyle:{"font-size":"12px"}},[t("div",[t("span",[e._v("版本：")]),t("span",[e._v(e._s(e.form.targetClusterVersion))])]),t("el-row",[t("el-col",{attrs:{span:2}},[t("span",[e._v("节点:")])]),t("el-col",{attrs:{span:22}},e._l(e.form.targetClusterNodes.split(","),(function(a){return t("el-tag",{key:a,staticClass:"mr-10"},[e._v(e._s(a))])})),1)],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),o=[],r=a("c7eb"),l=a("5530"),c=a("1da1"),u=(a("b64b"),a("159b"),a("bdee")),d=a("cfcc"),f=a("bc59"),p=a("1b62"),m=p["a"].CommonSelectCreaterMix;function g(e){var t={id:"",status:"CREATING",taskName:"",sourceClusterId:"",sourceClusterName:"",sourceClusterVersion:"",sourceClusterNodes:"",targetClusterId:"",targetClusterName:"",targetClusterVersion:"",targetClusterNodes:"",syncType:"2"};return e&&Object.keys(t).forEach((function(a){Object(f["a"])(e,a)&&(t[a]=e[a])})),t}var h={name:"AddAndEdit",components:{},mixins:[m(["csMixCacheCluster"])],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{multiLoading:!1,cacheUserStatusOptions:d["b"],passVisible:!1,isIndeterminate:!0,checkAll:!1,cacheAuthOptions:d["a"],labelPosition:"right",form:g(),rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"change"}],sourceClusterId:[{required:!0,message:"请选择源集群",trigger:"change"}],syncType:[{required:!0,message:"请选择迁移类型",trigger:"change"}],targetClusterId:[{required:!0,message:"请选择目标集群",trigger:"change"}]},syncTypeOptions:d["i"]}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){},methods:{getSourceClusterInfo:function(e){if(e){var t=this.csMixCacheCluster.find((function(t){return t.id==e}));this.form.sourceClusterVersion=t.redisVersion,this.form.sourceClusterNodes=t.nodes,this.form.sourceClusterName=t.clusterName}},getTargetClusterInfo:function(e){if(e){var t=this.csMixCacheCluster.find((function(t){return t.id==e}));this.form.targetClusterVersion=t.redisVersion,this.form.targetClusterNodes=t.nodes,this.form.targetClusterName=t.clusterName}},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(c["a"])(Object(r["a"])().mark((function t(a){var i;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(i=Object(l["a"])({},e.form),e.isEdit?(e.multiLoading=!0,Object(u["g"])(i).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.multiLoading=!1}))):(e.multiLoading=!0,delete i.id,Object(u["d"])(i).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.multiLoading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},b=h,v=(a("636b"),a("2877")),y=Object(v["a"])(b,s,o,!1,null,"45c1854c",null),C=y.exports,k=a("ec41"),D=a("ff51"),w=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"详情",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.multipleDetail.length>0?t("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.multipleDetail,(function(a,i){return t("el-collapse-item",{key:i,attrs:{title:"子任务【".concat(i+1,"】"),name:i}},[t("table",{staticClass:"custom-table"},[t("thead",[t("tr",[t("th",[e._v("中文名称")]),t("th",[e._v("值")])])]),t("tbody",e._l(e.configParams,(function(i,n){return t("tr",{directives:[{name:"show",rawName:"v-show",value:!("sourceRedisAddress"===i.key&&""===a[i.key]),expression:"\n                !(\n                  item.key === 'sourceRedisAddress' && detail[item.key] === ''\n                )\n              "}],key:n},[t("td",[e._v(" "+e._s(i.title)+" ")]),t("td",[e._v(e._s(a[i.key]))])])})),0)])])})),1):t("el-empty")],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)])},I=[],O=[{key:"taskName",title:"任务名称",keyAlias:"taskName",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"sourceClusterName",title:"源集群名称",keyAlias:"sourceClusterName",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"sourceClusterVersion",title:"源集群版本",keyAlias:"sourceClusterVersion",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"sourceRedisAddress",title:"源集群地址",keyAlias:"sourceRedisAddress",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"sourceRedisType",title:"源集群类型",keyAlias:"sourceRedisType",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"targetClusterName",title:"目标集群名称",keyAlias:"targetClusterName",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"targetClusterVersion",title:"目标集群版本",keyAlias:"targetClusterVersion",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"targetRedisAddress",title:"目标集群地址",keyAlias:"targetRedisAddress",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"targetRedisType",title:"目标集群类型",keyAlias:"targetRedisType",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"status",title:"任务状态",keyAlias:"status",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"rdbKeyCount",title:"全量key的数量",keyAlias:"rdbKeyCount",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"allKeyCount",title:"从运行到现在的key总量",keyAlias:"allKeyCount",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"commandKeyCount",title:"同步到目标的key数量",keyAlias:"commandKeyCount",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"taskMsg",title:"任务反馈信息",keyAlias:"taskMsg",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"brokenReason",title:"异常原因",keyAlias:"brokenReason",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"createTime",title:"创建时间",keyAlias:"createTime",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""},{key:"updateTime",title:"更新时间",keyAlias:"updateTime",options:"",type:"",elementType:"",readonly:"",description:"",dataType:"",value:"",default:"",example:""}],x={name:"PageBrokerConfig",model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return null}},refresh:Function},data:function(){return{configParams:O,activeNames:[],multipleDetail:[],loading:!1}},watch:{},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;return Object(c["a"])(Object(r["a"])().mark((function t(){var a,i;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.rowData)&&void 0!==a&&a.id){t.next=2;break}return t.abrupt("return");case 2:return e.loading=!0,t.next=5,Object(u["b"])(e.rowData.id).catch((function(e){}));case 5:i=t.sent,e.multipleDetail=Object(D["a"])(null===i||void 0===i?void 0:i.data)?i.data:[],e.activeNames=e.multipleDetail.length>0?[0]:[],e.loading=!1;case 9:case"end":return t.stop()}}),t)})))()},clickCancel:function(){this.$emit("change",!1)}}},_=x,N=(a("9e73"),Object(v["a"])(_,w,I,!1,null,"4e6ca3e0",null)),j=N.exports,R={name:"data-move",filters:{},components:{AddAndEdit:C,DialogDataMove:j},data:function(){this.$createElement;return{clusterList:[],showDialog:!1,showPasswordDialog:!1,buttonList:[{label:"创建任务",type:"add",click:this.addInfo}],tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"taskName",label:"任务名",align:"center"},{prop:"sourceClusterName",label:"源集群名称",align:"center"},{prop:"sourceClusterVersion",label:"源集群版本",align:"center"},{prop:"syncType",label:"迁移同步类型 ",align:"center",format:function(e){return Object(d["f"])(e,"syncTypeOptions")}},{prop:"targetClusterName",label:"目标集群名",align:"center"},{prop:"targetClusterVersion",label:"目标集群版本",align:"center"},{prop:"status",label:"状态",align:"center",render:function(e,t){var a=t.row,i=d["e"].find((function(e){return e.value===a.status}));return e("el-tooltip",{attrs:{effect:"dark",content:i.label,placement:"top-start"}},[e("span",[i.value])])}},{label:"创建时间",prop:"createDate"}],operate:{width:220,list:[{label:"启动",id:"start",isShow:function(e){return!["RUN","RDBRUNING","COMMANDRUNNING","BROKEN"].includes(e.status)}},{label:"暂停",id:"pause",isShow:function(e){return["RUN","RDBRUNING","COMMANDRUNNING","FINISH"].includes(e.status)}},{label:"详情",id:"detail"},{label:"删除",id:"delete"}]}},searchConfig:{searchData:{taskName:""},searchItem:[{type:"input",label:"任务名称",prop:"taskName"}],rules:{}},showDetail:!1,rowData:null}},mounted:function(){this.getList()},methods:{getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:this.searchConfig.searchData};this.tableConfig.loading=!0,Object(u["c"])(t).then((function(t){var a,i=Object(k["a"])(t,"data.data");e.tableConfig.tableData=Object(D["a"])(i)?i:[],e.tableConfig.pagination.totalCount=null!==(a=Object(k["a"])(t,"data.totalCount"))&&void 0!==a?a:0})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.rowData=null,this.showDialog=!0},onSearch:function(){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getIndex:function(e){var t=this,a=e.row,i=e.operate;"delete"===i.id?this.$confirm("确定要删除【".concat(a.taskName,"】吗?"),{type:"warning"}).then((function(){Object(u["a"])(a.id).then((function(e){t.$message.success(e.msg),t.getList()})).catch((function(e){}))})).catch((function(e){})):"start"===i.id?this.$confirm("确定要启动【".concat(a.taskName,"】吗?"),{type:"warning"}).then((function(){Object(u["e"])({id:a.id,status:a.status}).then((function(e){t.$message.success(e.data),t.getList()}))})):"pause"===i.id?this.$confirm("确定要暂停【".concat(a.taskName,"】吗?"),{type:"warning"}).then((function(){Object(u["f"])({id:a.id,status:a.status}).then((function(e){t.$message.success(e.data),t.getList()}))})):"detail"===i.id&&(this.rowData=a,this.showDetail=!0)}}},$=R,S=Object(v["a"])($,i,n,!1,null,"d11be590",null);t["default"]=S.exports},d84e:function(e,t,a){"use strict";a("c804")},dd12:function(e,t,a){"use strict";a("9236")},f360:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{style:{height:e.height,width:e.width},attrs:{id:"mountNode"}})},n=[],s=(a("99af"),a("a15b"),a("7c3e")),o={name:"g6-dagre",components:{},mixins:[],props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},chartData:{type:Object,default:function(){return{nodes:[],edges:[]}}}},data:function(){return{graph:null}},computed:{},watch:{},created:function(){},mounted:function(){this.initDagre(),window.addEventListener("resize",this.resize)},destroyed:function(){window.removeEventListener("resize",this.resize),this.graph=null},methods:{initDagre:function(){var e=this,t=this.chartData;s["a"].registerNode("card-node",{draw:function(e,t){var a=2,i="#5B8FF9",n="green",s=e.size[0],o=e.size[1],r=t.addShape("rect",{attrs:{x:-s/2+20,y:-o/2,width:s,height:o,stroke:i,radius:a,fill:"#fff"},name:"main-box",draggable:!0}),l=0===e.dataType;return t.addShape("rect",{attrs:{x:-s/2+20,y:-o/2,width:s,height:30,fill:l?n:i,radius:[a,a,0,0]},name:"title-box",draggable:!0}),t.addShape("text",{attrs:{textBaseline:"top",x:-s/2+20+2,y:-o/2+10,lineHeight:30,text:"[".concat(l?"主":"备","] ").concat(e.clusterName),fill:"#fff"},name:"title"}),t.addShape("text",{attrs:{textBaseline:"top",x:-s/2+20,y:-o/2+40,lineHeight:20,text:" 状态：".concat(e.statusLabel),fill:"rgba(0,0,0, 1)"},name:"statusLabel"}),t.addShape("text",{attrs:{textBaseline:"top",x:-s/2+20,y:-o/2+60,lineHeight:20,text:" 机房：".concat(e.machineRoomName),fill:"rgba(0,0,0, 1)"},name:"machineRoomName"}),t.addShape("text",{attrs:{textBaseline:"top",x:-s/2+20,y:-o/2+80,lineHeight:20,text:" 总节点数：".concat(e.totalNodes||""),fill:"rgba(0,0,0, 1)"},name:"totalNodes"}),r}});var a=new s["a"].Graph({container:"mountNode",fitView:!0,pixelRatio:2,groupByTypes:!1,layout:{type:"dagre",ranksep:25,nodesep:25,controlPoints:!0,align:"UL",sortByCombo:!0},defaultNode:{type:"card-node",size:[200,120],style:{stroke:"#C4E3B2",radius:7}},defaultCombo:{type:"rect",labelCfg:{position:"top",padding:[20,10],style:{fill:"#666",fontSize:14}}},defaultEdge:{type:"cubic-vertical",style:{endArrow:!0,lineWidth:2,stroke:"#C2C8D5"}},comboStateStyles:{selected:{shadowBlur:1,lineWidth:1}},nodeStateStyles:{selected:{shadowColor:"#1d70f5",shadowBlur:10,lineWidth:2,cursor:"pointer"}},modes:{default:["drag-canvas","zoom-canvas","click-select",{type:"tooltip",formatText:function(e){var t=[];return t.join("\n")},offset:30}]}});a.data(t),a.render(),a.fitView(),this.graph=a,a.on("node:click",(function(t){t.target;var a=t.item,i=a.getModel();e.$emit("click-node",i)}))},resize:function(){var e=this.$el,t=e.offsetHeight,a=e.offsetWidth;this.graph.changeSize(a,t)}}},r=o,l=(a("dd12"),a("2877")),c=Object(l["a"])(r,i,n,!1,null,"4a138f18",null);t["default"]=c.exports}}]);