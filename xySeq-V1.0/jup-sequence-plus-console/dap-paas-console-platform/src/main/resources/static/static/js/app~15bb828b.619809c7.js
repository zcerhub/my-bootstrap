(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~15bb828b"],{"0915":function(e,t,a){"use strict";a.r(t);a("99af"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("HubaryExpandSearch",{attrs:{isAnimation:!0,oneItemHeight:50,expandDefault:!1},on:{search:function(t){return e.onSearch(!1)},reset:function(t){return e.onSearch(!0)}}},[t("el-form",{ref:"formRef",attrs:{model:e.searchConfig.searchData,rules:e.searchConfig.rules,inline:!0}},[t("el-form-item",{staticClass:"fix-form-item",attrs:{label:"应用",prop:"appId","label-width":"50px"}},[t("el-select",{attrs:{loading:e.loadingApp,filterable:"","default-first-option":""},on:{change:e.changeAppId},model:{value:e.searchConfig.searchData.appId,callback:function(t){e.$set(e.searchConfig.searchData,"appId",t)},expression:"searchConfig.searchData.appId"}},e._l(e.appOptions,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.label,"(").concat(a.applicationName,")"),value:a.value}},[t("ul",{},[t("li",[e._v(e._s(a.label))]),t("li",{staticStyle:{color:"#666","font-weight":"500"}},[e._v(" "+e._s(a.applicationName)+" ")])])])})),1)],1),t("el-form-item",{staticClass:"fix-form-item",attrs:{label:"服务集群名称",prop:"coorId","label-width":"130px"},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("服务集群名称")]),t("el-tooltip",{attrs:{disabled:!e.coorItem,effect:"dark",placement:"bottom"},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticStyle:{padding:"0 3px 2px","text-align":"center"}},[e._v(" 数据源信息 ")]),e.coorItem?t("table",{attrs:{border:1,cellspacing:0,cellpadding:3}},[t("tr",[t("td",{attrs:{width:"100"}},[e._v("数据库驱动")]),t("td",{attrs:{width:"200"}},[e._v(e._s(e.coorItem.dbDriver))])]),t("tr",[t("td",{attrs:{width:"100"}},[e._v("数据库URL")]),t("td",{attrs:{width:"200"}},[e._v(e._s(e.coorItem.dbUrl))])]),t("tr",[t("td",{attrs:{width:"100"}},[e._v("数据库用户名")]),t("td",{attrs:{width:"200"}},[e._v(e._s(e.coorItem.dbUser))])])]):e._e()]},proxy:!0}])},[t("span",[t("i",{staticClass:"el-icon-info"})])])]},proxy:!0}])},[t("el-select",{attrs:{loading:e.loadingCluster,filterable:""},on:{change:e.changeCoorId},model:{value:e.searchConfig.searchData.coorId,callback:function(t){e.$set(e.searchConfig.searchData,"coorId",t)},expression:"searchConfig.searchData.coorId"}},e._l(e.coorOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"fix-form-item",attrs:{label:"环境",prop:"envId","label-width":"50px"}},[t("el-select",{attrs:{filterable:""},on:{change:e.changeEnvId},model:{value:e.searchConfig.searchData.envId,callback:function(t){e.$set(e.searchConfig.searchData,"envId",t)},expression:"searchConfig.searchData.envId"}},e._l(e.envOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"fix-form-item",attrs:{label:"单元",prop:"unitCode","label-width":"50px"}},[t("el-select",{attrs:{filterable:"",clearable:""},on:{change:e.changeUnitCode},model:{value:e.searchConfig.searchData.unitCode,callback:function(t){e.$set(e.searchConfig.searchData,"unitCode",t)},expression:"searchConfig.searchData.unitCode"}},e._l(e.unitOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),e.versionOptions.length>0?t("div",[t("button-list",{staticClass:"mb-10",attrs:{data:e.buttonList}}),t("el-form",[t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"配置",prop:"releaseId"}},[t("el-select",{staticStyle:{width:"50%"},attrs:{placeholder:"",filterable:""},on:{change:e.changeVersionId},model:{value:e.searchConfig.searchData.releaseId,callback:function(t){e.$set(e.searchConfig.searchData,"releaseId",t)},expression:"searchConfig.searchData.releaseId"}},e._l(e.versionOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"主版本",name:"main-version"}}),t("el-tab-pane",{attrs:{label:"灰度版本",name:"gray-version"}}),t("el-tab-pane",{attrs:{label:"历史版本",name:"history-version"}})],1),t(e.activeName,{tag:"component",on:{"delete-danger":e.changeDeleteDanger}})],1):t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"min-height":"300px"}},[t("el-empty",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],attrs:{description:"暂无数据"}},[e.searchConfig.searchData.appId&&e.searchConfig.searchData.envId?[t("el-button",{attrs:{type:"primary"},on:{click:e.openConfig}},[e._v(" 添加配置 ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickBatchUpload}},[e._v("批量上传")])]:e._e()],2)],1),e.dialogVisible?t("ManiConfigAdd",{attrs:{rowData:e.rowData,refresh:e.getVersion},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}}):e._e(),e.copyVisible?t("config-copy",{model:{value:e.copyVisible,callback:function(t){e.copyVisible=t},expression:"copyVisible"}}):e._e(),e.versionVisible?t("VersionDownload",{attrs:{rowData:e.versionData,refresh:e.onSearch},model:{value:e.versionVisible,callback:function(t){e.versionVisible=t},expression:"versionVisible"}}):e._e(),e.dialogClientVisible?t("ClientConfigExample",{attrs:{rowData:e.rowData},model:{value:e.dialogClientVisible,callback:function(t){e.dialogClientVisible=t},expression:"dialogClientVisible"}}):e._e(),e.uploadVisible?t("AllUpload",{attrs:{refresh:e.getVersion},model:{value:e.uploadVisible,callback:function(t){e.uploadVisible=t},expression:"uploadVisible"}}):e._e(),e.downloadVisible?t("AllDownload",{attrs:{refresh:e.getVersion},model:{value:e.downloadVisible,callback:function(t){e.downloadVisible=t},expression:"downloadVisible"}}):e._e(),e.rollbackVisible?t("AllRollback",{attrs:{refresh:e.getVersion},model:{value:e.rollbackVisible,callback:function(t){e.rollbackVisible=t},expression:"rollbackVisible"}}):e._e()],1)},o=[],i=a("c7eb"),r=a("5530"),c=a("1da1"),l=(a("7db0"),a("d81d"),a("d3b7"),a("ff51")),s=a("ec41"),f=a("a0dd"),d=a("4376"),u=a("ec2d"),p=a("c4ca"),m=a("9258"),h=a("0c9b"),g=a("6c42"),b=a("aaf1"),v=a("a24d"),y=a("2742"),x=a("d07b"),k=a("c43b"),D=a("934b"),C=a("3739"),w={name:"config-manage",components:{ConfigCopy:h["default"],ManiConfigAdd:f["default"],HistoryVersion:v["default"],MainVersion:b["default"],GrayVersion:y["default"],VersionDownload:m["default"],AllUpload:d["default"],AllDownload:u["default"],AllRollback:p["default"],ClientConfigExample:g["default"]},mixins:[],props:{},provide:function(){return{search:this.searchConfig.searchData,releaseId:this.releaseId}},data:function(){var e=this;return{loadingApp:!1,loadingCluster:!1,dialogClientVisible:!1,versionVisible:!1,downloadVisible:!1,uploadVisible:!1,rollbackVisible:!1,versionData:null,envOptions:[],appOptions:[],coorOptions:[],unitOptions:[],searchConfig:{searchData:{appId:"",appName:"",envId:"",envName:"",releaseId:"",configName:"",unitCode:"",coorName:"",coorId:"",accessKey:void 0},rules:{appId:[{required:!0,trigger:"change",message:"请选择应用"}],envId:[{required:!0,trigger:"change",message:"请选择环境"}],coorId:[{required:!0,trigger:"change",message:"请选择服务集群名称"}]}},buttonList:[{label:"添加配置",click:this.openConfig,btnPermCode:"add"},{label:"打包下载",click:function(){e.openVersionDownload("download")},btnPermCode:"downLoad"},{label:"主版本批量发布",click:function(){return e.openVersionDownload("publish")},btnPermCode:"downSend"},{label:"主版本批量下线",click:function(){return e.openVersionDownload("offline")},btnPermCode:"destroy"},{label:"客户端集成配置示例",click:function(){e.dialogClientVisible=!0,e.rowData=e.searchConfig.searchData}},{label:"批量下载",click:function(){e.downloadVisible=!0}},{label:"批量上传",click:this.clickBatchUpload},{label:"批量回滚",click:function(){e.rollbackVisible=!0}},{label:"批量删除",click:function(){e.openVersionDownload("delete")},btnPermCode:"delete"}],versionOptions:[],copyVisible:!1,dialogVisible:!1,activeName:"main-version",loading:!1}},computed:{coorItem:function(){var e=this.searchConfig.searchData.coorId;if(e){var t=this.coorOptions.find((function(t){return t.id===e}));if(t)return t}return null}},watch:{},created:function(){this.getOptions(),this.getUnit()},mounted:function(){},methods:{changeAppId:function(e){var t,a;this.versionOptions=[],this.searchConfig.searchData.releaseId="",this.searchConfig.searchData.configName="",this.searchConfig.searchData.coorId="";var n=this.appOptions.find((function(t){return t.value===e}));this.searchConfig.searchData.appName=null!==(t=null===n||void 0===n?void 0:n.label)&&void 0!==t?t:"",this.searchConfig.searchData.accessKey=null!==(a=null===n||void 0===n?void 0:n.accessKey)&&void 0!==a?a:"",this.getCoorOptions(),this.searchConfig.searchData.envId&&this.getVersion()},changeCoorId:function(e){var t;this.versionOptions=[],this.searchConfig.searchData.envId="",this.searchConfig.searchData.envName="",this.searchConfig.searchData.releaseId="",this.searchConfig.searchData.configName="";var a=this.coorOptions.find((function(t){return t.value===e}));this.searchConfig.searchData.coorName=null!==(t=null===a||void 0===a?void 0:a.label)&&void 0!==t?t:"",this.getEnvOption()},changeEnvId:function(e){var t;this.versionOptions=[],this.searchConfig.searchData.releaseId="",this.searchConfig.searchData.configName="";var a=this.envOptions.find((function(t){return t.value===e}));this.searchConfig.searchData.envName=null!==(t=null===a||void 0===a?void 0:a.label)&&void 0!==t?t:"",this.getVersion()},changeUnitCode:function(e){this.versionOptions=[],this.searchConfig.searchData.releaseId="",this.searchConfig.searchData.configName="",this.getVersion()},getUnit:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(D["c"])({}).catch((function(e){}));case 2:a=t.sent,n=Object(l["a"])(a.data)?a.data:[],e.unitOptions=n.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{label:e.unitCode,value:e.unitCode,id:e.id})}));case 5:case"end":return t.stop()}}),t)})))()},onSearch:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.searchConfig.searchData.releaseId="",t.searchConfig.searchData.configName="",t.versionOptions=[],e?t.$refs.formRef.resetFields():t.$refs.formRef.validate((function(e){e&&t.getVersion()}));case 5:case"end":return a.stop()}}),a)})))()},clickBatchUpload:function(){this.uploadVisible=!0},openVersionDownload:function(e){var t=Object(r["a"])({type:e},this.searchConfig.searchData);this.versionData=t,this.versionVisible=!0},openConfig:function(){this.dialogVisible=!0,this.rowData=null},editConfig:function(e){this.dialogVisible=!0,this.rowData=e},getVersion:function(){var e=this,t=this.searchConfig.searchData;this.loading=!0,Object(x["m"])(t).then((function(t){var a=Object(s["a"])(t,"data");if(e.versionOptions=Object(l["a"])(a)?a:[],e.versionOptions.length>0){var n=e.versionOptions[0].id;e.searchConfig.searchData.releaseId=n,e.changeVersionId(n)}})).catch((function(e){})).finally((function(){e.loading=!1}))},getEnvOption:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.searchConfig.searchData.coorId,a){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,Object(k["h"])(a).catch((function(e){}));case 5:n=t.sent,e.envOptions=Object(l["a"])(null===n||void 0===n?void 0:n.data)?n.data:[],e.envOptions.length>0&&(e.searchConfig.searchData.envId=n.data[0].value,e.searchConfig.searchData.envName=n.data[0].label,e.getVersion());case 8:case"end":return t.stop()}}),t)})))()},getCoorOptions:function(){var e=this,t={appId:this.searchConfig.searchData.appId};this.loadingCluster=!0,Object(C["h"])(t).then((function(t){var a=Object(l["a"])(null===t||void 0===t?void 0:t.data)?t.data:[],n=a.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{label:e.name,value:e.id})}));e.coorOptions=n,n.length>0&&(e.searchConfig.searchData.coorId=n[0].value,e.searchConfig.searchData.coorName=n[0].label),e.getEnvOption()})).finally((function(){e.loadingCluster=!1}))},getOptions:function(){var e=this;this.loadingApp=!0;Object(k["e"])().then((function(t){e.appOptions=Object(l["a"])(null===t||void 0===t?void 0:t.data)?t.data:[],e.appOptions.length>0&&(e.searchConfig.searchData.appId=t.data[0].value,e.searchConfig.searchData.appName=t.data[0].label,e.searchConfig.searchData.accessKey=Object(s["a"])(t,"data[0].accessKey")),e.getCoorOptions()})).catch((function(e){})).finally((function(){e.loadingApp=!1}))},changeVersionId:function(e){var t,a=this.versionOptions.find((function(t){return t.id===e}));this.searchConfig.searchData.configName=null!==(t=null===a||void 0===a?void 0:a.name)&&void 0!==t?t:""},changeDeleteDanger:function(e){this.onSearch()}}},O=w,j=(a("f26a"),a("2877")),_=Object(j["a"])(O,n,o,!1,null,"2ab70f8e",null);t["default"]=_.exports},"0c9b":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"复制配置",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"目标环境"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.appname,callback:function(t){e.$set(e.form,"appname",t)},expression:"form.appname"}},[t("el-option",{attrs:{label:"DemoApp1",value:"DemoApp1"}}),t("el-option",{attrs:{label:"DemoApp2",value:"DemoApp2"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=(a("b0c0"),a("b64b"),a("d3b7"),a("159b"),a("ff32"));function r(e){var t={name:"",desc:"",format:"",whitelist:""};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var c={name:"DialogUpdateIcon",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{entercode:"",configFormatOptions:i["b"],form:r(),rules:{file:[{required:!0,trigger:"blur",message:"请选择图标文件"}]}}},computed:{},watch:{},created:function(){},mounted:function(){var e;null!==(e=this.rowData)&&void 0!==e&&e.name&&(this.form=r(this.rowData))},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e,t=this;Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)?this.$refs.formRef.validate((function(e){if(e){var a=t.rowData.id;t.formSubmitData.set("id",a)}})):this.$emit("change",!1)}}},l=c,s=a("2877"),f=Object(s["a"])(l,n,o,!1,null,"6cd72d8b",null);t["default"]=f.exports},"16d0":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"".concat(e.isEdit?"编辑":"添加","配置项"),visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"Key",prop:"key"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.key,callback:function(t){e.$set(e.formData,"key",t)},expression:"formData.key"}})],1),t("el-form-item",{attrs:{label:"Value",prop:"value"}},[t("el-input",{attrs:{placeholder:"请输入",type:"textarea"},model:{value:e.formData.value,callback:function(t){e.$set(e.formData,"value",t)},expression:"formData.value"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!this.isEdit,expression:"!this.isEdit"}],attrs:{label:"加密",prop:"isEncrypt"}},[t("el-switch",{attrs:{"active-color":"#13ce66","active-text":"是","inactive-text":"否","active-value":"1","inactive-value":"0"},model:{value:e.formData.isEncrypt,callback:function(t){e.$set(e.formData,"isEncrypt",t)},expression:"formData.isEncrypt"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("5530"),r=(a("b64b"),a("d3b7"),a("ac1f"),a("38cf"),a("841c"),a("159b"),a("d07b")),c={name:"main-table-config-item",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},inject:["search"],data:function(){return{formData:l(),rules:{key:[{required:!0,trigger:"blur",message:"请输入Key"}],value:[{required:!0,trigger:"blur",message:"请输入Value"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.key)}},watch:{},created:function(){},mounted:function(){this.isEdit&&(this.formData=l(this.rowData))},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(i["a"])(Object(i["a"])({},e.formData),{},{unitCode:e.search.unitCode});a.id=e.search.releaseId,e.isEdit?Object(r["p"])(a).then((function(t){200===t.code&&(e.$message.success("修改成功"),e.refresh(),e.$emit("change",!1))})).catch((function(e){})):(delete a.oldKey,Object(r["i"])(a).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.refresh(),e.$emit("change",!1))})).catch((function(e){})))}}))}}};function l(e){var t={key:"",value:"",oldKey:"",isEncrypt:"0"};return e&&e.key&&Object.keys(t).forEach((function(a){"oldKey"===a?t.oldKey=e.key:"value"===a?t.value="1"===e.isEncrypt?"*".repeat(10):e.value:t[a]=e[a]})),t}var s=c,f=a("2877"),d=Object(f["a"])(s,n,o,!1,null,"6b70481e",null);t["default"]=d.exports},"1f79":function(e,t,a){"use strict";a("c553")},2742:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"page-box"},[t("button-list",{staticClass:"button-list",attrs:{data:e.buttonList},scopedSlots:e._u([{key:"slot-publish",fn:function(){return[e.statusTag?t("el-tag",{staticClass:"mr-10",attrs:{size:"medium",type:e.statusTag.type}},[e._v(e._s(e.statusTag.label))]):e._e()]},proxy:!0},{key:"slot-ips",fn:function(){return[t("span",{staticClass:"mr-5",staticStyle:{"font-size":"12px"}},[e._v("机器:")]),t("el-select",{staticClass:"mr-10",staticStyle:{width:"200px"},attrs:{multiple:""},on:{change:e.changeIps},model:{value:e.txtform.ipsArr,callback:function(t){e.$set(e.txtform,"ipsArr",t)},expression:"txtform.ipsArr"}},e._l(e.ipsArrList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),"text"===e.activeName?t("div",[t("el-form",{ref:"formRef",attrs:{model:e.txtform,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"配置格式",prop:"configFormat"}},[t("el-radio-group",{on:{change:e.changeConfigFormat},model:{value:e.txtform.configFormat,callback:function(t){e.$set(e.txtform,"configFormat",t)},expression:"txtform.configFormat"}},e._l(e.configFormatOptions,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"配置内容",prop:"content"}},[t("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{comment:"这一行不能删除, 是为了兼容检测txtform.content的, change后触发校验"},model:{value:e.txtform.content,callback:function(t){e.$set(e.txtform,"content",t)},expression:"txtform.content"}}),t("ConfigContent",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingContent,expression:"loadingContent"}],ref:"contentRef",attrs:{options:e.options,fileName:e.fileName,showEdit:!0},on:{change:e.changeConfigContent},model:{value:e.txtform.content,callback:function(t){e.$set(e.txtform,"content",t)},expression:"txtform.content"}})],1),t("el-form-item",{attrs:{label:"加载方式",prop:"configLoadType"}},e._l(e.dict_configLoadType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value},model:{value:e.txtform.configLoadType,callback:function(t){e.$set(e.txtform,"configLoadType",t)},expression:"txtform.configLoadType"}},[e._v(e._s(a.label))])})),1),t("el-form-item",{attrs:{label:"落盘路径",prop:"configLoadPath"}},[t("el-input",{attrs:{placeholder:"请输入落盘路径"},model:{value:e.txtform.configLoadPath,callback:function(t){e.$set(e.txtform,"configLoadPath",t)},expression:"txtform.configLoadPath"}}),t("span",{staticClass:"form-item-extra"},[e._v("绝对路径请以/开头，工程相对路径不可使用/开头")])],1),"4"!==e.txtform.configFormat?t("div",[t("el-form-item",{attrs:{label:"加密方式",prop:"encryptType"}},[e._l(e.dict_encryptType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value},model:{value:e.txtform.encryptType,callback:function(t){e.$set(e.txtform,"encryptType",t)},expression:"txtform.encryptType"}},[e._v(e._s(a.label))])})),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"0"!==e.txtform.encryptType,expression:"txtform.encryptType !== '0'"}],attrs:{type:"primary"},on:{click:e.clickDataEncryption}},[e._v("数据加密")])],2),t("el-form-item",{attrs:{label:"加密字段",prop:"encryptKeys"}},[t("el-input",{attrs:{placeholder:"字段之间请用逗号分割"},model:{value:e.txtform.encryptKeys,callback:function(t){e.$set(e.txtform,"encryptKeys",t)},expression:"txtform.encryptKeys"}})],1)],1):e._e(),t("el-form-item",[t("el-button",{directives:[{name:"perm-code",rawName:"v-perm-code",value:"edit",expression:"'edit'"}],attrs:{type:"primary"},on:{click:function(t){return e.clickSave(!1)}}},[e._v("保存")])],1)],1)],1):e._e(),e.dialogVisible?t("TableConfigItem",{attrs:{rowData:e.rowData,grayId:e.grayId,refresh:e.getDetail},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}}):e._e(),e.showDataEncryption?t("DialogDataEncryption",{attrs:{txtform:e.txtform},model:{value:e.showDataEncryption,callback:function(t){e.showDataEncryption=t},expression:"showDataEncryption"}}):e._e()],1)},o=[],i=a("c7eb"),r=a("1da1"),c=(a("99af"),a("4de4"),a("7db0"),a("caad"),a("a15b"),a("b64b"),a("d3b7"),a("ac1f"),a("3ca3"),a("38cf"),a("841c"),a("ddb0"),a("d66d")),l=a("ff32"),s=a("9a90"),f=a("70a3"),d=a("8121"),u=a("ff51"),p=a("ec41"),m=a("070e"),h=a("212b"),g={name:"gray-version",components:{ConfigContent:s["default"],TableConfigItem:c["default"],DialogDataEncryption:function(){return a.e("chunk-36aa4c5e").then(a.bind(null,"d908"))}},mixins:[],props:{},inject:["search"],data:function(){this.$createElement;var e=this;return{dict_configLoadType:h["a"].options,dict_encryptType:h["c"].options,loading:!1,ipsArrList:[],buttonList:[{slot:"slot-publish"},{slot:"slot-ips"},{label:"发布",click:this.clickPublish,btnPermCode:"publish"},{label:"下线",click:this.clickOffline,btnPermCode:"stop"},{label:"合并",click:this.clickMerge},{label:"删除",btnType:"danger",click:this.clickGrayDelete,btnPermCode:"delete",get hidden(){return"1"===e.versionStatus}}],txtform:{ips:"",get ipsArr(){return Object(d["a"])(this.ips)?this.ips.split(",").filter((function(e){return""!==e})):[]},set ipsArr(e){this.ips=Object(u["a"])(e)?e.join(","):""},configFormat:"1",content:"",configLoadType:"1",encryptType:"0",encryptKeys:"",configLoadPath:""},options:{title:"内容",content:""},rules:{ips:[{required:!0,message:"请选择机器",trigger:"change"}],configFormat:[{required:!0,message:"请选择配置格式",trigger:"change"}],content:[{required:!0,message:"请输入配置内容",trigger:"change"}],configLoadType:[{required:!0,message:"请选择加载方式",trigger:"change"}],encryptType:[{required:!0,message:"请选择加密方式",trigger:"change"}],encryptKeys:[{required:!1,message:"请输入加密字段",trigger:"blur"}]},configFormatOptions:l["b"],activeName:"text",rowData:{},dialogVisible:!1,loadingTable:!1,tableModel:{tableData:[],rowData:[{prop:"key",label:"key"},{prop:"value",label:"value",render:function(e,t){var a=t.row;return"1"===a.isEncrypt?e("span",["*".repeat(10)]):e("span",[a.value])}},{prop:"isEncrypt",label:"是否加密",format:function(e){return Object(l["e"])(e,"isEncryptOptions")}}],operateData:[{label:"编辑",type:"editConfig",funName:"editConfig",btnPermCode:"edit_1"},{label:"删除",type:"delete-table",funName:"clickDeleteRow",btnPermCode:"delete_1"}],pagination:{pageNo:1,pageSize:10,total:2,show:!0}},formModel:{formData:{name:"",version:"",desc:""},formLabelWidth:"80px",formFilds:[{label:"产品名称",prop:"name",type:"input",disabled:!1},{label:"版本",prop:"version",type:"input",disabled:!1},{label:"描述",prop:"desc",type:"textarea",disabled:!1}],btnData:[{type:"submit",style:"primary",label:"确定",handle:function(){}},{type:"cancle",label:"取消",style:"",handle:function(){}}]},searchModel:{btnGroup:[],formModel:{cluster:""},searchFild:[]},grayId:"",versionStatus:"",detailData:null,oldFormate:"",oldConfig:"",oldConfigLoadType:"",oldConfigLoadPath:"",oldEncryptType:"",oldEncryptKeys:"",loadingContent:!1,showDataEncryption:!1}},computed:{statusTag:function(){var e=this;return l["h"].find((function(t){return t.value===e.versionStatus}))},fileName:function(){var e=this.search.configName,t=void 0===e?"xxx":e,a=Object(l["e"])(this.txtform.configFormat,"configFormatOptions"),n="txt";return a&&Object(d["a"])(a)&&(n=a.toLowerCase()),"".concat(t,".").concat(n)}},watch:{versionStatus:function(e){"0"===e&&(this.txtform.ipsArr="")},"search.releaseId":{handler:function(e){this.getDetail(e)},immediate:!0},"search.configName":{handler:function(e,t){this.getMachineList()},deep:!0,immediate:!0}},created:function(){},mounted:function(){},methods:{clickDataEncryption:function(){this.showDataEncryption=!0},getMachineList:function(){var e=this,t={appName:this.search.appName,appId:this.search.appId,envId:this.search.envId,envName:this.search.envName,configName:this.search.configName,unitCode:this.search.unitCode};Object(f["b"])(t).then((function(t){200===t.code&&(e.ipsArrList=t.data)}))},clickAdd:function(){this.rowData=null,this.dialogVisible=!0},editConfig:function(e){this.rowData=e,this.dialogVisible=!0},changeConfigContent:function(e){this.txtform.content=e},changeConfigFormat:function(e){e===this.oldFormate?(this.txtform.content=this.oldConfig,this.options.content=this.oldConfig):(this.txtform.content="",this.options.content="")},getDetail:function(e){var t=this,a=e||this.search.releaseId||"";a&&(this.loading=!0,Object(f["g"])(a).then((function(e){var a,n,o;t.detailData=null!==(a=e.data)&&void 0!==a?a:null;var i=Object(p["a"])(e,"data.configTable");try{var r=JSON.parse(i);t.tableModel.tableData=Object(u["a"])(r)?r:[]}catch(h){t.tableModel.tableData=[]}var c=Object(p["a"])(e,"data.configFormat"),l=Object(p["a"])(e,"data.content"),s=Object(p["a"])(e,"data.configLoadType"),f=Object(p["a"])(e,"data.encryptType"),d=Object(p["a"])(e,"data.encryptKeys");t.txtform.configLoadType=null!==s&&void 0!==s?s:"0",t.txtform.encryptType=null!==f&&void 0!==f?f:"0",t.txtform.encryptKeys=null!==d&&void 0!==d?d:"",t.txtform.configFormat=null!==c&&void 0!==c?c:"",t.txtform.content=null!==l&&void 0!==l?l:"",t.txtform.ips=null!==(n=Object(p["a"])(e,"data.ips"))&&void 0!==n?n:"";var m=null!==(o=Object(p["a"])(e,"data.configLoadPath"))&&void 0!==o?o:"";t.txtform.configLoadPath=m,t.options.content=null!==l&&void 0!==l?l:"",t.versionStatus=Object(p["a"])(e,"data.status"),t.grayId=Object(p["a"])(e,"data.id"),t.oldConfig=null!==l&&void 0!==l?l:"",t.oldFormate=null!==c&&void 0!==c?c:"",t.oldConfigLoadType=null!==s&&void 0!==s?s:"",t.oldConfigLoadPath=null!==m&&void 0!==m?m:"",t.oldEncryptType=null!==f&&void 0!==f?f:"",t.oldEncryptKeys=null!==d&&void 0!==d?d:"",t.$nextTick((function(){var e;null===(e=t.$refs.contentRef)||void 0===e||e.refresh()}))})).catch((function(e){})).finally((function(){t.loading=!1})))},clickSave:function(e){var t=this;return Object(r["a"])(Object(i["a"])().mark((function a(){var n,o,r,c,l,s;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.detailData){a.next=3;break}return a.abrupt("return");case 3:return n=t.$refs.formRef,a.next=6,n.validate().catch((function(e){}));case 6:if(o=a.sent,o){a.next=10;break}return a.abrupt("return");case 10:return r=["id","createDate","createUserId","appId","envId","name","description","configFormat","content","isDelete","configTable","unitCode"],c=Object(m["a"])(t.detailData,r),Object.assign(c,t.txtform),delete c.ipsArr,t.loading=!0,a.prev=15,a.next=18,t.$refs.formRef.validate();case 18:if(l=a.sent,l){a.next=21;break}return a.abrupt("return");case 21:return a.next=23,Object(f["i"])(c);case 23:if(s=a.sent,200!==s.code){a.next=33;break}if(!e){a.next=31;break}return t.$message.success("保存成功"),a.next=29,t.publishApi();case 29:a.next=33;break;case 31:t.$message.success("保存成功"),t.getDetail(t.search.releaseId);case 33:a.next=38;break;case 35:a.prev=35,a.t0=a["catch"](15);case 38:t.loading=!1;case 39:case"end":return a.stop()}}),a,null,[[15,35]])})))()},clickOffline:function(){var e=this;this.$confirm("确定要下线吗?",{type:"warning"}).then((function(){var t;e.loading=!0;var a={id:e.grayId,unitCode:null===(t=e.detailData)||void 0===t?void 0:t.unitCode};Object(f["e"])(a).then((function(t){200===t.code&&(e.getDetail(e.search.releaseId),e.$message.success("下线成功"))})).catch((function(e){})).finally((function(){e.loading=!1}))}))},clickPublish:function(){var e,t=this;0===this.txtform.ipsArr.length?this.$message.warning("发布灰度未关联机器,不能发布成功"):this.oldConfig===this.txtform.content&&this.oldConfigLoadType===this.txtform.configLoadType&&this.oldConfigLoadPath===this.txtform.configLoadPath&&["1","3"].includes(null===(e=this.statusTag)||void 0===e?void 0:e.value)?this.$message.warning("配置内容未修改，不能发布，请修改后再发布！"):this.$confirm("确定要发布吗?",{type:"warning"}).then((function(){t.publishApi()}))},publishApi:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a,n,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=["id","createDate","createUserId","appId","envId","name","description","configFormat","content","isDelete","configTable","unitCode"],n=Object(m["a"])(e.detailData,a),Object.assign(n,e.txtform,{id:e.grayId,ips:e.txtform.ips,releaseId:e.search.releaseId}),e.txtform.ips){t.next=6;break}return e.$message.warning("发布灰度未关联机器,不能发布成功"),t.abrupt("return");case 6:return e.loading=!0,t.prev=7,t.next=10,Object(f["f"])(n);case 10:o=t.sent,200===o.code&&(e.getDetail(e.search.releaseId),e.$message.success("发布成功")),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](7);case 17:e.loading=!1;case 18:case"end":return t.stop()}}),t,null,[[7,14]])})))()},clickMerge:function(){var e=this;this.$confirm("确定要合并吗?",{type:"warning"}).then((function(){var t;e.loading=!0;var a={id:e.grayId,unitCode:null===(t=e.detailData)||void 0===t?void 0:t.unitCode};Object(f["d"])(a).then((function(t){200===t.code&&(e.getDetail(e.search.releaseId),e.$message.success("合并成功"))})).catch((function(e){})).finally((function(){e.loading=!1}))}))},clickDeleteRow:function(e){var t=this;this.$confirm("确定要删除吗?",{type:"warning"}).then((function(){var a={id:t.grayId,key:e.key};Object(f["h"])(a).then((function(e){200===e.code&&(t.getDetail(t.search.releaseId),t.$message.success("删除成功"))})).catch((function(e){}))})).catch((function(e){}))},clickGrayDelete:function(){var e=this;this.$confirm("确定要删除吗?",{type:"warning"}).then((function(){Object(f["a"])(e.grayId).then((function(t){200===t.code&&(e.getDetail(e.search.releaseId),e.$message.success("删除成功"),e.$emit("delete-danger","main-version"))})).catch((function(e){}))}))},changeIps:function(e){}}},b=g,v=(a("7949"),a("2877")),y=Object(v["a"])(b,n,o,!1,null,"1adc23c8",null);t["default"]=y.exports},"2b25":function(e,t,a){"use strict";a("77c0")},"2de8":function(e,t,a){},3187:function(e,t,a){"use strict";a("849e")},"35e3":function(e,t,a){"use strict";a("b5f4")},"3b09":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"历史版本详情",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{model:e.txtform,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"配置格式"}},[t("el-radio-group",{model:{value:e.txtform.configFormat,callback:function(t){e.$set(e.txtform,"configFormat",t)},expression:"txtform.configFormat"}},[e._l(e.configFormatOptions,(function(a){return[e.txtform.configFormat===a.value?t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))]):e._e()]}))],2)],1),t("el-form-item",{attrs:{label:"配置内容"}},[t("ConfigContent",{ref:"contentRef",attrs:{options:e.options,fileName:e.fileName,showEdit:!0},model:{value:e.txtform.content,callback:function(t){e.$set(e.txtform,"content",t)},expression:"txtform.content"}})],1),t("el-form-item",{attrs:{label:"加载方式",prop:"configLoadType"}},[t("el-radio-group",{model:{value:e.txtform.configLoadType,callback:function(t){e.$set(e.txtform,"configLoadType",t)},expression:"txtform.configLoadType"}},[e._l(e.dict_configLoadType,(function(a){return[e.txtform.configLoadType===a.value?t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))]):e._e()]}))],2)],1),t("el-form-item",{attrs:{label:"落盘路径",prop:"configLoadPath"}},[t("el-input",{attrs:{placeholder:"请输入落盘路径"},model:{value:e.txtform.configLoadPath,callback:function(t){e.$set(e.txtform,"configLoadPath",t)},expression:"txtform.configLoadPath"}}),t("span",{staticClass:"form-item-extra"},[e._v("绝对路径请以/开头，工程相对路径不可使用/开头")])],1),t("el-form-item",{attrs:{label:"加密方式",prop:"encryptType"}},[t("el-radio-group",{model:{value:e.txtform.encryptType,callback:function(t){e.$set(e.txtform,"encryptType",t)},expression:"txtform.encryptType"}},[e._l(e.dict_encryptType,(function(a){return[e.txtform.encryptType===a.value?t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))]):e._e()]}))],2)],1),t("el-form-item",{attrs:{label:"加密字段",prop:"encryptKeys"}},[t("el-input",{attrs:{placeholder:"字段之间请用逗号分割"},model:{value:e.txtform.encryptKeys,callback:function(t){e.$set(e.txtform,"encryptKeys",t)},expression:"txtform.encryptKeys"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=(a("99af"),a("b0c0"),a("b64b"),a("d3b7"),a("9a90")),r=a("ff32"),c=a("455d"),l=a("8121"),s=a("ec41"),f=a("ff51"),d=a("212b"),u={name:"history-version-detail",components:{ConfigContent:i["default"]},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null}},data:function(){return{dict_configLoadType:d["a"].options,dict_encryptType:d["c"].options,txtform:{configFormat:"",content:"",configLoadType:"1",encryptType:"0",encryptKeys:""},options:{title:"内容",content:"",readOnly:!0},configFormatOptions:r["b"],activeName:"1",tableModel:{tableData:[],rowData:[{prop:"key",label:"key"},{prop:"value",label:"value"},{prop:"isEncrypt",label:"是否加密",format:function(e){return Object(r["e"])(e,"isEncryptOptions")}}],operateData:[],pagination:{pageNo:1,pageSize:10,total:0,show:!0}},loading:!1}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},fileName:function(){var e=this.rowData,t=e.name,a=void 0===t?"xxx":t,n=e.configFormat,o=Object(r["e"])(n,"configFormatOptions"),i="txt";return o&&Object(l["a"])(o)&&(i=o.toLowerCase()),"".concat(a,".").concat(i)}},watch:{},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e=this;this.loading=!0,Object(c["c"])(this.rowData.id).then((function(t){var a,n,o=Object(s["a"])(t,"data.configTable");try{var i=JSON.parse(o);e.tableModel.tableData=Object(f["a"])(i)?i:[]}catch(u){e.tableModel.tableData=[]}e.txtform.configFormat=null!==(a=Object(s["a"])(t,"data.configFormat"))&&void 0!==a?a:"",e.options.content=null!==(n=Object(s["a"])(t,"data.content"))&&void 0!==n?n:"";var r=Object(s["a"])(t,"data.configLoadType");e.txtform.configLoadType=null!==r&&void 0!==r?r:"0";var c=Object(s["a"])(t,"data.encryptType");e.txtform.encryptType=null!==c&&void 0!==c?c:"0";var l=Object(s["a"])(t,"data.encryptKeys");e.txtform.encryptKeys=null!==l&&void 0!==l?l:"";var d=Object(s["a"])(t,"data.configLoadPath");e.txtform.configLoadPath=null!==d&&void 0!==d?d:""})).catch((function(e){})).finally((function(){e.$nextTick((function(){var t;null===(t=e.$refs.contentRef)||void 0===t||t.refresh()})),e.loading=!1}))},clickCancel:function(){this.$emit("change",!1)}}},p=u,m=(a("3187"),a("2877")),h=Object(m["a"])(p,n,o,!1,null,"1bc09211",null);t["default"]=h.exports},4376:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"批量上传",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"环境",prop:"envId"}},[t("el-select",{staticClass:"w-100",model:{value:e.formData.envId,callback:function(t){e.$set(e.formData,"envId",t)},expression:"formData.envId"}},e._l(e.envOptions,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label,filterable:""}})})),1)],1),t("el-form-item",{attrs:{label:"选择文件",prop:""}},[t("upload-button",{ref:"unpackUpload",attrs:{action:"v1/config/release/uploadBatch/".concat(e.formData.envId),fileList:e.fileList,listType:"",accept:".xlsx,.xls,.txt",data:e.formData,name:"file",autoUpload:!0,showFileList:!0,buttonText:"选择文件",beforeUpload:e.beforeUpload,multiple:"true"},on:{success:e.uploadSuccess},model:{value:e.fileData,callback:function(t){e.fileData=t},expression:"fileData"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.clickCancel}},[e._v("关闭")])],1)],1)},o=[],i=a("c7eb"),r=a("1da1"),c=a("c43b"),l=a("ff51"),s={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{envOptions:[],loading:!1,fileData:"",fileList:[],formData:{envId:""},rules:{envId:[{required:!0,trigger:"change",message:"请选择环境"}]}}},computed:{},watch:{},created:function(){this.getEnvOptions()},mounted:function(){},methods:{getEnvOptions:function(){var e=this;Object(c["f"])().then((function(t){e.envOptions=Object(l["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){}))},beforeUpload:function(){var e=this,t=!0;return this.loading=!0,this.$refs.formRef.validate(function(){var a=Object(r["a"])(Object(i["a"])().mark((function a(n){return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n||(e.$message("请选择所属环境"),t=!1,e.loading=!1);case 1:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()),t},uploadSuccess:function(e){var t=this;return Object(r["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e.response,e.file,e.fileList,t.loading=!1;try{200===n.code?(t.$message.success(n.msg),t.$emit("change",!1),t.refresh()):t.$message({type:"warning",message:n.msg,duration:3e3})}catch(o){}case 4:case"end":return a.stop()}}),a)})))()},clickCancel:function(){this.$emit("change",!1)}}},f=s,d=a("2877"),u=Object(d["a"])(f,n,o,!1,null,"4613d5f4",null);t["default"]=u.exports},"6c42":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"客户端集成配置示例",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading},on:{close:e.clickCancel}},[e.dataMsg?t("pre",[e._v(e._s(e.dataMsg))]):t("el-empty"),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.dataMsg,expression:"dataMsg"}],attrs:{type:"primary"},on:{click:e.clickUpload}},[e._v("下载")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("c7eb"),r=a("1da1"),c=(a("d3b7"),a("d07b")),l=a("ec41"),s={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{dataMsg:"",loading:!1}},computed:{},watch:{},created:function(){},mounted:function(){this.getVersion()},methods:{getVersion:function(){var e=this;this.loading=!0;var t=this.rowData,a=t.appName,n=t.envId,o=t.unitCode,i=t.configName,r=t.releaseId,s=t.coorId,f=t.accessKey;Object(c["e"])({configName:i,unitCode:o,appCode:a,releaseId:r,envId:n,clusterId:s,accessKey:f}).then((function(t){var a=Object(l["a"])(t,"data","");e.dataMsg=a})).catch((function(e){})).finally((function(){e.loading=!1}))},clickUpload:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!0;try{saveAs(new Blob([e.dataMsg],{type:"text/plain;charset=utf-8"}),"dap-server.properties"),e.loading=!1}catch(a){}case 2:case"end":return t.stop()}}),t)})))()},clickCancel:function(){this.$emit("change",!1)}}},f=s,d=(a("a713"),a("2877")),u=Object(d["a"])(f,n,o,!1,null,"4eb4a055",null);t["default"]=u.exports},"77c0":function(e,t,a){},7949:function(e,t,a){"use strict";a("deeb")},"79f1":function(e,t,a){},"849e":function(e,t,a){},9258:function(e,t,a){"use strict";a.r(t);a("b0c0");var n=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"han-dialog-limit",attrs:{title:e.title,visible:e.show,size:"small",top:"10vh",width:e.autoWidthByLength,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formRef",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[e.versionOptions.length>0?t("el-form-item",{staticStyle:{"margin-bottom":"10px"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.changeCheckAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选版本")])],1):e._e(),t("el-form-item",{staticClass:"form-item-checkList",attrs:{label:"版本",prop:"checkList"}},[e.versionOptions.length>0?[t("el-checkbox-group",{on:{change:e.changeCheckList},model:{value:e.form.checkList,callback:function(t){e.$set(e.form,"checkList",t)},expression:"form.checkList"}},e._l(e.versionOptions,(function(a){return t("el-checkbox",{key:a.id,staticClass:"radio-item",attrs:{label:a.id,title:a.name}},[e._v(e._s(a.name))])})),1)]:t("span",[e._v("暂无数据")])],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{disabled:0==e.form.checkList.length||e.loading,type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=(a("d81d"),a("b64b"),a("d3b7"),a("159b"),a("ff32")),r=a("d07b"),c=a("ed08"),l=a("ec41"),s={download:"打包下载",publish:"发布全部",offline:"发布下线",delete:"批量删除"};function f(e){var t={checkList:[]};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var d={name:"DialogUpdateIcon",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{title:"",loading:!1,versionOptions:[],configFormatOptions:i["b"],form:f(),rules:{checkList:[{required:!0,trigger:"blur",message:"请选择版本"}]},isIndeterminate:!1,checkAll:!1}},computed:{versionAllIds:function(){return this.versionOptions.map((function(e){return e.id}))},autoWidthByLength:function(){var e=this.versionOptions.length;return e>10?"800px":"500px"}},watch:{},created:function(){},mounted:function(){this.title=s[this.rowData.type],this.getVersion()},methods:{changeCheckAll:function(e){this.form.checkList=e?this.versionAllIds:[],this.isIndeterminate=!1},changeCheckList:function(e){var t=e.length;this.checkAll=t===this.versionAllIds.length,this.isIndeterminate=t>0&&t<this.versionAllIds.length},getVersion:function(){var e=this,t=this.rowData;this.loading=!0,Object(r["m"])(t).then((function(t){var a=Object(l["a"])(t,"data");e.versionOptions=a})).catch((function(e){})).finally((function(){e.loading=!1}))},clickCancel:function(){this.$emit("change",!1)},allPublish:function(){var e=this;this.loading=!0,Object(r["c"])({ids:this.form.checkList}).then((function(t){200===t.code&&(e.$emit("change",!1),e.$message.success("发布全部成功"),e.refresh())})).finally((function(){e.loading=!1}))},allOffline:function(){var e=this;this.loading=!0,Object(r["b"])({ids:this.form.checkList}).then((function(t){200===t.code&&(e.$emit("change",!1),e.$message.success("全部下线成功"),e.refresh())})).finally((function(){e.loading=!1}))},dowload:function(){var e=this,t="打包下载-".concat(Object(c["d"])(new Date,"{y}{m}{d}-{h}{i}"));this.loading=!0,Object(r["a"])({ids:this.form.checkList}).then((function(a){saveAs(new Blob([a],{type:"application/zip"}),"".concat(t)),e.$emit("change",!1)})).finally((function(){e.loading=!1}))},allDelete:function(){var e=this;this.loading=!0,Object(r["d"])(this.form.checkList).then((function(t){200===t.code&&(e.$emit("change",!1),e.$message.success("批量删除成功"),e.refresh())})).finally((function(){e.loading=!1}))},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t)switch(e.rowData.type){case"download":e.dowload();break;case"publish":e.allPublish();break;case"offline":e.allOffline();break;case"delete":e.allDelete();break;default:}}))}}},u=d,p=(a("1f79"),a("2877")),m=Object(p["a"])(u,n,o,!1,null,"e1d4b5ac",null);t["default"]=m.exports},"950c":function(e,t,a){"use strict";a("79f1")},"951e":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.title,visible:e.visible,size:"small",width:"80%","append-to-body":!0,top:"10vh","close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{"line-height":"36px","margin-left":"261px"}},[e._v(" 历史版本("+e._s(e.rowData.version)+") ")])]),t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{"line-height":"36px","margin-left":"75px"}},[e._v(" 环境 "),t("el-select",{attrs:{"value-key":"value"},on:{change:e.changeHistoryVersions},model:{value:e.envId,callback:function(t){e.envId=t},expression:"envId"}},e._l(e.envOptions,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label,filterable:""}})})),1),e._v(" 对比版本 "),t("el-select",{attrs:{"value-key":"id"},on:{change:e.changeVersion},model:{value:e.diffVersion,callback:function(t){e.diffVersion=t},expression:"diffVersion"}},e._l(e.releaseList,(function(e){return t("el-option",{key:e.id,attrs:{value:e,label:e.version,filterable:""}})})),1)],1)])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.ready?t("codemirror",{ref:"codeFresh",attrs:{merge:!0,options:e.cmOption},on:{input:e.changeFn,ready:e.onCmReady,scroll:e.onCmScroll}}):t("el-empty")],1)],1)},o=[],i=a("c7eb"),r=a("1da1"),c=(a("99af"),a("7db0"),a("b0c0"),a("d3b7"),a("ffda"),a("b866"),a("c885"),a("bb47"),a("f4ba"),a("8f94")),l=a("455d"),s=a("c43b"),f=a("641c"),d=a.n(f),u=a("ff51"),p=a("ec41");window.diff_match_patch=d.a,window.DIFF_DELETE=-1,window.DIFF_INSERT=1,window.DIFF_EQUAL=0;var m={name:"history-version-diff",components:{codemirror:c["codemirror"]},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null}},data:function(){return{loading:!1,ready:!1,cmOption:{autoRefresh:!0,value:"",origLeft:null,readOnly:!0,orig:"",connect:"center",theme:"idea",styleActiveLine:!0,mode:"text/x-mysql",lineNumInnerWidth:29,lineNumbers:!0,collapseIdentical:!1,highlightDifferences:!0,revertButtons:!1},envId:null,diffVersion:null,envOptions:[],releaseList:[]}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},title:function(){var e=this.rowData.name,t="版本对比";return"".concat(t,"(").concat(e,")")}},watch:{},created:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getOptions(),e.getHistoryVersionsFn();case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{onCmReady:function(e){},changeVersion:function(){this.getDiffCode()},changeHistoryVersions:function(){this.getHistoryVersionsFnV2()},getOptions:function(){var e=this;Object(s["f"])().then((function(t){e.envOptions=Object(u["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];var a=e.envOptions.find((function(t){return t.value===e.rowData.envId}));e.envId=a.label})).catch((function(e){}))},getHistoryVersionsFnV2:function(){var e=this,t={id:this.rowData.id,envId:this.envId,name:this.rowData.name,appId:this.rowData.appId};Object(l["a"])(t).then((function(t){e.cmOption.value=t.data.history;var a=Object(p["a"])(t,"data.release");e.releaseList=Object(u["a"])(a)?a:[];var n=null;a.length>0&&(n=a[0]),e.diffVersion=n,e.getDiffCode()})).catch((function(e){})).finally((function(){}))},getHistoryVersionsFn:function(){var e=this,t={id:this.rowData.id,envId:this.rowData.envId,name:this.rowData.name,appId:this.rowData.appId};Object(l["a"])(t).then((function(t){e.cmOption.value=t.data.history;var a=Object(p["a"])(t,"data.release");e.releaseList=Object(u["a"])(a)?a:[];var n=null;a.length>0&&(n=a[0]),e.diffVersion=n,e.getDiffCode()})).catch((function(e){})).finally((function(){}))},getDiffCode:function(){var e=this;if(this.ready=!1,!this.diffVersion)return this.cmOption.orig="",this.cmOption.value="",void(this.diffVersion="");this.loading=!0,Object(l["f"])(this.diffVersion).then((function(t){var a;e.$set(e.cmOption,"orig",null!==(a=t.data)&&void 0!==a?a:""),e.ready=!0})).catch((function(e){})).finally((function(){e.loading=!1}))},cancel:function(){this.$emit("update:show",!1)},onCmScroll:function(){},changeFn:function(e){},clickCancel:function(){this.$emit("change",!1)}}},h=m,g=(a("9914"),a("2877")),b=Object(g["a"])(h,n,o,!1,null,"687de290",null);t["default"]=b.exports},"965b":function(e,t,a){},9914:function(e,t,a){"use strict";a("c94a")},"9a90":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"editor-mirror"},[e.showEdit?t("el-button",{staticClass:"extra-button",attrs:{type:"text",icon:"el-icon-download"},on:{click:e.localDownload}}):e._e(),t("div",{staticClass:"editor-title"},[e._v(e._s(e.options.title))]),t("codemirror",{key:Math.random(),ref:"codeRef",staticClass:"mirror-box",staticStyle:{border:"1px solid #e8eaf0"},attrs:{options:e.editorOption},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},o=[],i=a("21a6"),r=a("8f94"),c=(a("f6b6"),a("9b74"),a("a7be"),a("01cb"),a("d7d5"),a("8c2e"),a("7393"),{components:{codemirror:r["codemirror"]},props:{options:{type:Object,default:function(){return{title:"脚本内容",fileType:"xml",height:"500",content:"qweqweqwe"}}},show:{type:Boolean,default:!0},showEdit:{type:Boolean,default:!1},fileName:{type:String,default:"xxx.txt"}},data:function(){return{cmOptions:{tabSize:4,styleActiveLine:!0,lineNumbers:!0,line:!0,foldGutter:!0,styleSelectedText:!0,mode:"YAML",theme:"blackboard",matchBrackets:!0,readOnly:!1,showCursorWhenSelecting:!0,lineWrapping:"wrap",extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1}}}},computed:{content:{get:function(){return this.options.content},set:function(e){this.$emit("change",e)}},editorOption:function(){return Object.assign({},this.cmOptions,this.options)}},watch:{"options.content":{handler:function(e){this.refresh()},immediate:!0}},methods:{localDownload:function(){Object(i["saveAs"])(new Blob([this.content],{type:"text/plain;charset=utf-8"}),this.fileName)},refresh:function(){var e;null===(e=this.$refs.codeRef)||void 0===e||e.refresh()}}}),l=c,s=(a("35e3"),a("2877")),f=Object(s["a"])(l,n,o,!1,null,null,null);t["default"]=f.exports},a0dd:function(e,t,a){"use strict";a.r(t);a("a4d3"),a("e01a"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"添加配置",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"配置名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{placeholder:"请输入",type:"textarea"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),t("el-form-item",{attrs:{label:"配置格式",prop:"configFormat"}},[t("el-radio-group",{on:{change:e.changeConfigFormat},model:{value:e.formData.configFormat,callback:function(t){e.$set(e.formData,"configFormat",t)},expression:"formData.configFormat"}},e._l(e.configFormatOptions,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"配置内容",prop:"content"}},[t("ConfigContent",{ref:"contentRef",attrs:{options:e.options,showEdit:!0},on:{change:e.changeConfigContent},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}})],1),t("el-form-item",{attrs:{label:"加载方式",prop:"configLoadType"}},e._l(e.dict_configLoadType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value},model:{value:e.formData.configLoadType,callback:function(t){e.$set(e.formData,"configLoadType",t)},expression:"formData.configLoadType"}},[e._v(e._s(a.label))])})),1),t("el-form-item",{attrs:{label:"落盘路径",prop:"configLoadPath"}},[t("el-input",{attrs:{placeholder:"请输入落盘路径"},model:{value:e.formData.configLoadPath,callback:function(t){e.$set(e.formData,"configLoadPath",t)},expression:"formData.configLoadPath"}}),t("span",{staticClass:"form-item-extra"},[e._v("绝对路径请以/开头，工程相对路径不可使用/开头")])],1),"4"!==e.formData.configFormat?t("div",[t("el-form-item",{attrs:{label:"加密方式",prop:"encryptType"}},e._l(e.dict_encryptType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value},model:{value:e.formData.encryptType,callback:function(t){e.$set(e.formData,"encryptType",t)},expression:"formData.encryptType"}},[e._v(e._s(a.label))])})),1),t("el-form-item",{attrs:{label:"加密字段",prop:"encryptKeys"}},[t("el-input",{attrs:{placeholder:"字段之间请用逗号分割"},model:{value:e.formData.encryptKeys,callback:function(t){e.$set(e.formData,"encryptKeys",t)},expression:"formData.encryptKeys"}})],1)],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("ade3"),r=(a("b64b"),a("d3b7"),a("ac1f"),a("841c"),a("159b"),a("9a90")),c=a("ff32"),l=a("d07b"),s=a("212b"),f={components:{ConfigContent:r["default"]},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},inject:["search"],data:function(){return{configFormatOptions:c["b"],dict_configLoadType:s["a"].options,dict_encryptType:s["c"].options,options:{content:"",title:"内容"},formData:d(),rules:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({name:[{required:!0,trigger:"blur",message:"请输入名称"}],configFormat:[{required:!0,trigger:"blur",message:"请选择配置格式"}],content:[{required:!0,trigger:"blur",message:"请输入内容"}]},"configFormat",[{required:!0,message:"请选择配置格式",trigger:"change"}]),"content",[{required:!0,message:"请输入配置内容",trigger:"change"}]),"configLoadType",[{required:!0,message:"请选择加载方式",trigger:"change"}]),"encryptType",[{required:!0,message:"请选择加密方式",trigger:"change"}]),"encryptKeys",[{required:!1,message:"请输入加密字段",trigger:"blur"}])}},computed:{},watch:{},created:function(){},mounted:function(){Object.assign(this.formData,this.search)},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){t&&Object(l["h"])(e.formData).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){}))}))},changeConfigContent:function(e){this.formData.content=e},changeConfigFormat:function(){}}};function d(e){var t={name:"",description:"",content:"",configFormat:"1",appId:"",envId:"",configLoadType:"1",encryptType:"0",encryptKeys:"",configLoadPath:""};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var u=f,p=a("2877"),m=Object(p["a"])(u,n,o,!1,null,"0ba2cc92",null);t["default"]=m.exports},a24d:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:4,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.visible?t("HistoryVersionDiff",{attrs:{rowData:e.rowData},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}}):e._e(),e.visibleDetail?t("HistoryVersionDetail",{attrs:{rowData:e.rowData},model:{value:e.visibleDetail,callback:function(t){e.visibleDetail=t},expression:"visibleDetail"}}):e._e()],1)},o=[],i=a("5530"),r=(a("d3b7"),a("ac1f"),a("5319"),a("841c"),a("3b09")),c=a("951e"),l=a("455d"),s=a("ff32"),f=a("ec41"),d=a("ff51"),u=a("070e"),p=a("ed08"),m={name:"history-version",components:{HistoryVersionDiff:c["default"],HistoryVersionDetail:r["default"]},mixins:[],props:{},inject:["search"],data:function(){this.$createElement;return{visible:!1,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"name",label:"配置名称",align:"center"},{prop:"configFormat",label:"配置格式",align:"center",render:function(e,t){var a=t.row;return e("span",[Object(s["e"])(a.configFormat,"configFormatOptions")])}},{prop:"updateDate",label:"修改时间",align:"center",format:function(e){return Object(p["d"])(e)}},{prop:"version",label:"版本号",align:"center"}],operate:{width:250,list:[{label:"详情",id:"detail"},{label:"版本对比",id:"version_diff"},{label:"回滚",id:"rollback"},{label:"删除",id:"delete"}]}},rowData:null,visibleDetail:!1}},computed:{},watch:{"search.releaseId":{handler:function(){this.getList()},immediate:!0}},created:function(){},mounted:function(){},methods:{getList:function(){var e=this,t={pageSize:this.tableConfig.pagination.pageSize,pageNo:this.tableConfig.pagination.pageNo,requestObject:Object(i["a"])({},this.search)};this.tableConfig.loading=!0,Object(l["d"])(t).then((function(t){var a=Object(f["a"])(t,"data.data");Object(d["a"])(a)&&(e.tableConfig.tableData=a),e.tableConfig.pagination.totalCount=Object(f["a"])(t,"data.totalCount")||0})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},getIndex:function(e){var t=this,a=(e.index,e.row),n=e.operate;"detail"===n.id?(this.rowData=a,this.visibleDetail=!0):"version_diff"===n.id?(this.rowData=a,this.visible=!0):"rollback"===n.id?this.$confirm("确认要回滚到此历史版本吗?",{type:"warning"}).then((function(){t.tableConfig.loading=!0,Object(l["e"])(Object(u["a"])(a,["releaseId","content","configFormat","version","configLoadType","encryptType","encryptKeys","configLoadPath","unitCode"])).then((function(e){200===e.code&&(t.$message.success("回滚成功"),t.getList())})).catch((function(e){})).finally((function(){t.tableConfig.loading=!1}))})).catch((function(e){})):"delete"===n.id&&this.$confirm("确认要删除此历史版本吗?",{type:"warning"}).then((function(){Object(l["b"])(a.id).then((function(e){200===e.code&&(t.$message.success("删除成功"),t.getList())})).catch((function(e){}))})).catch((function(e){}))},clickSearchButton:function(e){e&&(this.requestObject.wrapName="",this.tableConfig.pagination.pageNo=1),this.getList()},openAdd:function(){this.rowData=null,this.visible=!0},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},clickBack:function(){this.$router.replace("/configManagement/tab-index")}}},h=m,g=a("2877"),b=Object(g["a"])(h,n,o,!1,null,"5462bfec",null);t["default"]=b.exports},a713:function(e,t,a){"use strict";a("965b")},aaf1:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"page-box"},[t("button-list",{staticClass:"button-list",attrs:{data:e.buttonList},scopedSlots:e._u([e.statusTag?{key:"slot-publish",fn:function(){return[t("el-tag",{staticClass:"mr-10",attrs:{size:"medium",type:e.statusTag.type}},[e._v(e._s(e.statusTag.label))])]},proxy:!0}:null],null,!0)}),"text"===e.activeName?t("div",[t("el-form",{ref:"formRef",attrs:{model:e.txtform,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"配置格式",prop:"configFormat"}},[t("el-radio-group",{on:{change:e.changeConfigFormat},model:{value:e.txtform.configFormat,callback:function(t){e.$set(e.txtform,"configFormat",t)},expression:"txtform.configFormat"}},e._l(e.configFormatOptions,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"配置内容",prop:"content"}},[t("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{comment:"这一行不能删除, 是为了兼容检测txtform.content的, change后触发校验"},model:{value:e.txtform.content,callback:function(t){e.$set(e.txtform,"content",t)},expression:"txtform.content"}}),t("ConfigContent",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingContent,expression:"loadingContent"}],ref:"contentRef",attrs:{options:e.options,fileName:e.fileName,showEdit:!0},on:{change:e.changeConfigContent},model:{value:e.txtform.content,callback:function(t){e.$set(e.txtform,"content",t)},expression:"txtform.content"}})],1),t("el-form-item",{attrs:{label:"加载方式",prop:"configLoadType"}},e._l(e.dict_configLoadType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value},model:{value:e.txtform.configLoadType,callback:function(t){e.$set(e.txtform,"configLoadType",t)},expression:"txtform.configLoadType"}},[e._v(e._s(a.label))])})),1),t("el-form-item",{attrs:{label:"落盘路径",prop:"configLoadPath"}},[t("el-input",{attrs:{placeholder:"请输入落盘路径"},model:{value:e.txtform.configLoadPath,callback:function(t){e.$set(e.txtform,"configLoadPath",t)},expression:"txtform.configLoadPath"}}),t("span",{staticClass:"form-item-extra"},[e._v("绝对路径请以/开头，工程相对路径不可使用/开头")])],1),"4"!==e.txtform.configFormat?t("div",[t("el-form-item",{attrs:{label:"加密方式",prop:"encryptType"}},[e._l(e.dict_encryptType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value},model:{value:e.txtform.encryptType,callback:function(t){e.$set(e.txtform,"encryptType",t)},expression:"txtform.encryptType"}},[e._v(e._s(a.label))])})),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"0"!==e.txtform.encryptType,expression:"txtform.encryptType !== '0'"}],attrs:{type:"primary"},on:{click:e.clickDataEncryption}},[e._v("数据加密")])],2),t("el-form-item",{attrs:{label:"加密字段",prop:"encryptKeys"}},[t("el-input",{attrs:{placeholder:"字段之间请用逗号分割"},model:{value:e.txtform.encryptKeys,callback:function(t){e.$set(e.txtform,"encryptKeys",t)},expression:"txtform.encryptKeys"}})],1)],1):e._e(),t("el-form-item",[t("el-button",{directives:[{name:"perm-code",rawName:"v-perm-code",value:"edit",expression:"'edit'"}],attrs:{type:"primary"},on:{click:function(t){return e.clickSave(!1)}}},[e._v("保存")])],1)],1)],1):e._e(),e.dialogVisible?t("TableConfigItem",{attrs:{rowData:e.rowData,refresh:e.getDetail},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}}):e._e(),e.showDataEncryption?t("DialogDataEncryption",{attrs:{txtform:e.txtform},model:{value:e.showDataEncryption,callback:function(t){e.showDataEncryption=t},expression:"showDataEncryption"}}):e._e()],1)},o=[],i=a("c7eb"),r=a("1da1"),c=(a("99af"),a("7db0"),a("caad"),a("b64b"),a("d3b7"),a("ac1f"),a("3ca3"),a("38cf"),a("841c"),a("ddb0"),a("16d0")),l=a("ff32"),s=a("9a90"),f=a("d07b"),d=a("8121"),u=a("ec41"),p=a("ff51"),m=a("070e"),h=a("212b"),g={name:"main-version",components:{ConfigContent:s["default"],TableConfigItem:c["default"],DialogDataEncryption:function(){return a.e("chunk-36aa4c5e").then(a.bind(null,"d908"))}},mixins:[],props:{},inject:["search"],data:function(){this.$createElement;var e=this;return{dict_configLoadType:h["a"].options,dict_encryptType:h["c"].options,buttonList:[{slot:"slot-publish"},{label:"发布",click:this.clickPublish,btnPermCode:"publish"},{label:"下线",click:this.clickOffline,btnPermCode:"stop"},{label:"删除",btnType:"danger",click:this.clickDelete,btnPermCode:"delete",get hidden(){return"1"===e.versionStatus}}],txtform:{configFormat:"1",content:"",configLoadType:"1",encryptType:"0",encryptKeys:"",configLoadPath:""},options:{title:"内容",content:""},rules:{configFormat:[{required:!0,message:"请选择配置格式",trigger:"change"}],content:[{required:!0,message:"请输入配置内容",trigger:"change"}],configLoadType:[{required:!0,message:"请选择加载方式",trigger:"change"}],encryptType:[{required:!0,message:"请选择加密方式",trigger:"change"}],encryptKeys:[{required:!1,message:"请输入加密字段",trigger:"blur"}]},configFormatOptions:l["b"],activeName:"text",rowData:{},dialogVisible:!1,loadingTable:!1,tableModel:{tableData:[],rowData:[{prop:"key",label:"key"},{prop:"value",label:"value",render:function(e,t){var a=t.row;return"1"===a.isEncrypt?e("span",["*".repeat(10)]):e("span",[a.value])}},{prop:"isEncrypt",label:"是否加密",format:function(e){return Object(l["e"])(e,"isEncryptOptions")}}],operateData:[{label:"编辑",type:"editConfig",funName:"editConfig",btnPermCode:"edit_1"},{label:"删除",type:"delete-row",funName:"clickDeleteRow",btnPermCode:"delete_1"}],pagination:{pageNo:1,pageSize:10,total:2,show:!0}},formModel:{formData:{name:"",version:"",desc:""},formLabelWidth:"80px",formFilds:[{label:"产品名称",prop:"name",type:"input",disabled:!1},{label:"版本",prop:"version",type:"input",disabled:!1},{label:"描述",prop:"desc",type:"textarea",disabled:!1}],btnData:[{type:"submit",style:"primary",label:"确定",handle:function(){}},{type:"cancle",label:"取消",style:"",handle:function(){}}],rules:{}},searchModel:{btnGroup:[],formModel:{cluster:""},searchFild:[]},detailData:null,loading:!1,versionStatus:"",oldFormate:"",newFormate:"",oldConfig:"",oldConfigLoadType:"",oldConfigLoadPath:"",oldEncryptType:"",oldEncryptKeys:"",loadingContent:!1,showDataEncryption:!1}},computed:{statusTag:function(){var e=this;return l["h"].find((function(t){return t.value===e.versionStatus}))},fileName:function(){var e=this.search.configName,t=void 0===e?"xxx":e,a=Object(l["e"])(this.txtform.configFormat,"configFormatOptions"),n="txt";return a&&Object(d["a"])(a)&&(n=a.toLowerCase()),"".concat(t,".").concat(n)}},watch:{"search.releaseId":{handler:function(e){this.getDetail(e)},immediate:!0}},created:function(){},mounted:function(){},methods:{clickDataEncryption:function(){this.showDataEncryption=!0},clickAdd:function(){this.rowData=null,this.dialogVisible=!0},editConfig:function(e){this.rowData=e,this.dialogVisible=!0},changeConfigContent:function(e){this.txtform.content=e},changeConfigFormat:function(e){e===this.oldFormate?(this.txtform.content=this.oldConfig,this.options.content=this.oldConfig):(this.txtform.content="",this.options.content="")},getDetail:function(e){var t=this,a=e||this.search.releaseId||"";a&&(this.loading=!0,Object(f["l"])(a).then((function(e){var a;t.detailData=null!==(a=e.data)&&void 0!==a?a:null;var n=Object(u["a"])(e,"data.configTable");try{var o=JSON.parse(n);t.tableModel.tableData=Object(p["a"])(o)?o:[]}catch(d){t.tableModel.tableData=[]}var i=Object(u["a"])(e,"data.configFormat"),r=Object(u["a"])(e,"data.content");t.txtform.configFormat=null!==i&&void 0!==i?i:"",t.txtform.content=null!==r&&void 0!==r?r:"",t.options.content=null!==r&&void 0!==r?r:"";var c=Object(u["a"])(e,"data.configLoadType"),l=Object(u["a"])(e,"data.encryptType"),s=Object(u["a"])(e,"data.encryptKeys");t.txtform.configLoadType=null!==c&&void 0!==c?c:"0",t.txtform.encryptType=null!==l&&void 0!==l?l:"0",t.txtform.encryptKeys=null!==s&&void 0!==s?s:"";var f=Object(u["a"])(e,"data.configLoadPath");t.txtform.configLoadPath=null!==f&&void 0!==f?f:"",t.versionStatus=Object(u["a"])(e,"data.status"),t.oldConfig=null!==r&&void 0!==r?r:"",t.oldFormate=null!==i&&void 0!==i?i:"",t.oldConfigLoadType=null!==c&&void 0!==c?c:"",t.oldConfigLoadPath=null!==f&&void 0!==f?f:"",t.oldEncryptType=null!==l&&void 0!==l?l:"",t.oldEncryptKeys=null!==s&&void 0!==s?s:"",t.$nextTick((function(){var e;null===(e=t.$refs.contentRef)||void 0===e||e.refresh()}))})).catch((function(e){})).finally((function(){t.loading=!1})))},clickOffline:function(){var e=this;this.$confirm("确定要下线吗?",{type:"warning"}).then((function(){var t;e.loading=!0;var a={id:e.search.releaseId,unitCode:null===(t=e.detailData)||void 0===t?void 0:t.unitCode};Object(f["j"])(a).then((function(t){200===t.code&&(e.getDetail(e.search.releaseId),e.$message.success("下线成功"))})).catch((function(e){})).finally((function(){e.loading=!1}))}))},clickPublish:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.oldConfig!==e.txtform.content||e.oldConfigLoadType!==e.txtform.configLoadType||e.oldConfigLoadPath!==e.txtform.configLoadPath||!["1","3"].includes(null===(a=e.statusTag)||void 0===a?void 0:a.value)){t.next=3;break}return t.abrupt("return",e.$message.warning("配置内容未修改，不能发布，请修改后再发布！"));case 3:return t.next=5,e.$confirm("确定发布此主版本吗?",{type:"warning"});case 5:if(n=t.sent,"confirm"===n){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,e.publishApi();case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},publishApi:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a,n,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.detailData){t.next=2;break}return t.abrupt("return");case 2:return a=["id","createDate","createUserId","appId","envId","name","description","configFormat","content","isDelete","configTable","unitCode"],n=Object(m["a"])(e.detailData,a),Object.assign(n,e.txtform),e.loading=!0,t.prev=6,t.next=9,Object(f["k"])(n);case 9:o=t.sent,200===o.code&&(e.getDetail(e.search.releaseId),e.$message.success("发布成功")),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6);case 16:e.loading=!1;case 17:case"end":return t.stop()}}),t,null,[[6,13]])})))()},clickDeleteRow:function(e){var t=this;this.$confirm("确定要删除吗?",{type:"warning"}).then((function(){var a={id:t.search.releaseId,key:e.key};Object(f["n"])(a).then((function(e){200===e.code&&(t.$message.success("删除成功"),t.getDetail(t.search.releaseId))})).catch((function(e){}))})).catch((function(e){}))},clickDelete:function(){var e=this;this.$confirm("主版本所关联的灰度或历史数据也将会被删除,确认删除此主版本吗?",{type:"warning"}).then((function(){e.loading=!0,Object(f["g"])(e.search.releaseId).then((function(t){200===t.code&&(e.$message.success("删除成功"),e.$emit("delete-danger","main-version"))})).catch((function(e){})).finally((function(){e.loading=!1}))})).catch((function(e){}))},clickSave:function(e){var t=this;return Object(r["a"])(Object(i["a"])().mark((function a(){var n,o,r,c,l;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.detailData){a.next=2;break}return a.abrupt("return");case 2:return n=t.$refs.formRef,a.next=5,n.validate().catch((function(e){}));case 5:if(o=a.sent,o){a.next=9;break}return a.abrupt("return");case 9:return r=["id","createDate","createUserId","appId","envId","name","description","configFormat","content","isDelete","configTable","unitCode"],c=Object(m["a"])(t.detailData,r),Object.assign(c,t.txtform),t.loading=!0,a.next=15,Object(f["o"])(c).catch((function(e){}));case 15:if(l=a.sent,200!==(null===l||void 0===l?void 0:l.code)){a.next=24;break}if(t.$message.success("保存成功"),!e){a.next=23;break}return a.next=21,t.publishApi();case 21:a.next=24;break;case 23:t.getDetail(t.search.releaseId);case 24:t.loading=!1;case 25:case"end":return a.stop()}}),a)})))()}}},b=g,v=(a("2b25"),a("2877")),y=Object(v["a"])(b,n,o,!1,null,"852b6038",null);t["default"]=y.exports},b5f4:function(e,t,a){e.exports={theme:"#1d70f5",menuText:"#333",menuActiveText:"#1d70f5",subMenuActiveText:"#1d70f5",menuBg:"#fff",topHeaderHeight:"60px",menuHover:"#f2f3f5",subMenuBg:"#fff",subMenuHover:"#f2f3f5",sideBarWidth:"210px",primaryColor:"#1d70f5"}},c4ca:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"批量回滚",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"环境",prop:"envId"}},[t("el-select",{staticClass:"w-100",model:{value:e.formData.envId,callback:function(t){e.$set(e.formData,"envId",t)},expression:"formData.envId"}},e._l(e.envOptions,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label,filterable:""}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=(a("b64b"),a("d3b7"),a("159b"),a("c43b")),r=a("f27a"),c=a("ff51"),l={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{envOptions:[],formData:s(),loading:!1,rules:{envId:[{required:!0,trigger:"change",message:"请选择环境"}]}}},computed:{},watch:{},created:function(){this.getEnvOptions()},mounted:function(){},methods:{getEnvOptions:function(){var e=this;Object(i["f"])().then((function(t){e.envOptions=Object(c["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){}))},clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a={envId:e.formData.envId};e.loading=!0,Object(r["b"])(a).then((function(t){200===t.code?(e.$message.success(t.msg),e.$emit("change",!1),e.refresh()):e.$message.warning(t.msg)})).catch((function(e){})),e.loading=!1}}))}}};function s(e){var t={envId:""};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var f=l,d=a("2877"),u=Object(d["a"])(f,n,o,!1,null,"1bb8acaa",null);t["default"]=u.exports},c553:function(e,t,a){},c94a:function(e,t,a){},d625:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"".concat(e.isEdit?"编辑":"添加","配置项"),visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"Key",prop:"key"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.key,callback:function(t){e.$set(e.formData,"key",t)},expression:"formData.key"}})],1),t("el-form-item",{attrs:{label:"Value",prop:"value"}},[t("el-input",{attrs:{placeholder:"请输入",type:"textarea"},model:{value:e.formData.value,callback:function(t){e.$set(e.formData,"value",t)},expression:"formData.value"}})],1),t("el-form-item",{attrs:{label:"加密",prop:"isEncrypt"}},[t("el-switch",{attrs:{"active-color":"#13ce66","active-text":"是","inactive-text":"否","active-value":"1","inactive-value":"0"},model:{value:e.formData.isEncrypt,callback:function(t){e.$set(e.formData,"isEncrypt",t)},expression:"formData.isEncrypt"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("5530"),r=(a("b64b"),a("d3b7"),a("ac1f"),a("38cf"),a("841c"),a("159b"),a("d07b")),c={name:"detail-table-config-item",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},inject:["search"],data:function(){return{formData:l(),rules:{key:[{required:!0,trigger:"blur",message:"请输入Key"}],value:[{required:!0,trigger:"blur",message:"请输入Value"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.key)}},watch:{},created:function(){},mounted:function(){this.isEdit&&(this.formData=l(this.rowData))},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(i["a"])(Object(i["a"])({},e.formData),{},{unitCode:e.search.unitCode});a.id=e.search.releaseId,e.isEdit?Object(r["p"])(a).then((function(t){200===t.code&&(e.$message.success("修改成功"),e.refresh(),e.$emit("change",!1))})).catch((function(e){})):(delete a.oldKey,Object(r["i"])(a).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.refresh(),e.$emit("change",!1))})).catch((function(e){})))}}))}}};function l(e){var t={key:"",value:"",oldKey:"",isEncrypt:"0"};return e&&e.key&&Object.keys(t).forEach((function(a){"oldKey"===a?t.oldKey=e.key:"value"===a?t.value="1"===e.isEncrypt?"*".repeat(10):e.value:t[a]=e[a]})),t}var s=c,f=a("2877"),d=Object(f["a"])(s,n,o,!1,null,"1eaf93a6",null);t["default"]=d.exports},d66d:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"".concat(e.isEdit?"编辑":"添加","配置项"),visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"Key",prop:"key"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formData.key,callback:function(t){e.$set(e.formData,"key",t)},expression:"formData.key"}})],1),t("el-form-item",{attrs:{label:"Value",prop:"value"}},[t("el-input",{attrs:{placeholder:"请输入",type:"textarea"},model:{value:e.formData.value,callback:function(t){e.$set(e.formData,"value",t)},expression:"formData.value"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!this.isEdit,expression:"!this.isEdit"}],attrs:{label:"加密",prop:"isEncrypt"}},[t("el-switch",{attrs:{"active-color":"#13ce66","active-text":"是","inactive-text":"否","active-value":"1","inactive-value":"0"},model:{value:e.formData.isEncrypt,callback:function(t){e.$set(e.formData,"isEncrypt",t)},expression:"formData.isEncrypt"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("5530"),r=(a("b64b"),a("d3b7"),a("ac1f"),a("38cf"),a("841c"),a("159b"),a("70a3")),c={name:"gray-table-config-item",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function,grayId:String},inject:["search"],data:function(){return{formData:l(),rules:{key:[{required:!0,trigger:"blur",message:"请输入Key"}],value:[{required:!0,trigger:"blur",message:"请输入Value"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.key)}},watch:{},created:function(){},mounted:function(){this.isEdit&&(this.formData=l(this.rowData))},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(i["a"])(Object(i["a"])({},e.formData),{},{unitCode:e.search.uniCode});a.id=e.grayId,e.isEdit?Object(r["j"])(a).then((function(t){200===t.code&&(e.$message.success("修改成功"),e.refresh(),e.$emit("change",!1))})).catch((function(e){})):(delete a.oldKey,Object(r["c"])(a).then((function(t){200===t.code&&(e.$message.success("新增成功"),e.refresh(),e.$emit("change",!1))})).catch((function(e){})))}}))}}};function l(e){var t={key:"",value:"",oldKey:"",isEncrypt:"0"};return e&&e.key&&Object.keys(t).forEach((function(a){"oldKey"===a?t.oldKey=e.key:"value"===a?t.value="1"===e.isEncrypt?"*".repeat(10):e.value:t[a]=e[a]})),t}var s=c,f=a("2877"),d=Object(f["a"])(s,n,o,!1,null,"385cd2b2",null);t["default"]=d.exports},deeb:function(e,t,a){},ec2d:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"han-dialog-limit",attrs:{title:"批量下载",visible:e.show,size:"small",top:"10vh",width:e.autoWidthByLength,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formRef",attrs:{model:e.formData,"label-width":"80px",rules:e.rules}},[t("el-form-item",{attrs:{label:"环境",prop:"envId"}},[t("el-select",{staticClass:"w-100",model:{value:e.formData.envId,callback:function(t){e.$set(e.formData,"envId",t)},expression:"formData.envId"}},e._l(e.envOptions,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label,filterable:""}})})),1)],1),t("el-form-item",{attrs:{label:"文件类型",prop:"type"}},[t("el-radio",{attrs:{label:"excel"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}}),t("el-radio",{attrs:{label:"json"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}})],1),e.appOptions.length>0?t("el-form-item",{staticStyle:{"margin-bottom":"10px"}},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.changeCheckAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选应用")])],1):e._e(),t("el-form-item",{staticClass:"form-item-appId",attrs:{label:"应用",prop:"appId"}},[e.appOptions.length>0?[t("el-checkbox-group",{on:{change:e.changeCheckList},model:{value:e.formData.appId,callback:function(t){e.$set(e.formData,"appId",t)},expression:"formData.appId"}},e._l(e.appOptions,(function(a){return t("el-checkbox",{key:a.value,staticClass:"radio-item",attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)]:t("span",[e._v("暂无数据")])],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",disabled:0===e.formData.appId.length||e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=(a("d81d"),a("b64b"),a("d3b7"),a("159b"),a("c43b")),r=a("f27a"),c=a("ff51"),l=a("21a6"),s={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{envOptions:[],appOptions:[],formData:f(),loading:!1,rules:{type:[{required:!0,trigger:"change",message:"请选择文件类型"}],appId:[{required:!0,trigger:"change",message:"请选择应用"}],envId:[{required:!0,trigger:"change",message:"请选择环境"}]},isIndeterminate:!1,checkAll:!1,loadingApp:!1}},computed:{versionAllIds:function(){return this.appOptions.map((function(e){return e.value}))},autoWidthByLength:function(){var e=this.appOptions.length;return e>10?"600px":"500px"}},watch:{"formData.envId":function(e){this.getAppOptions()}},created:function(){this.getEnvOptions(),this.getAppOptions()},mounted:function(){},methods:{changeCheckAll:function(e){this.formData.appId=e?this.versionAllIds:[],this.isIndeterminate=!1},changeCheckList:function(e){var t=e.length;this.checkAll=t===this.versionAllIds.length,this.isIndeterminate=t>0&&t<this.versionAllIds.length},getEnvOptions:function(){var e=this;Object(i["f"])().then((function(t){e.envOptions=Object(c["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){}))},getAppOptions:function(){var e=this;this.loading=!0,Object(i["e"])({envId:this.formData.envId}).then((function(t){e.appOptions=Object(c["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){})).finally((function(){e.loading=!1}))},clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=e.formData,n=a.type,o=a.envId,i=a.appId,c={envId:o,appIds:i,type:n};e.loading=!0,Object(r["a"])(c).then((function(t){var a=t.type,n=t.data,o=t.filename,i=t.message;"success"==a&&Object(l["saveAs"])(new Blob([n]),o),e.$message({type:a,message:i}),e.refresh(),e.$emit("change",!1)})).catch((function(e){})).finally((function(){e.loading=!1}))}}))}}};function f(e){var t={appId:[],envId:"",type:"excel"};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var d=s,u=(a("950c"),a("2877")),p=Object(u["a"])(d,n,o,!1,null,"5e2a4e4c",null);t["default"]=p.exports},f26a:function(e,t,a){"use strict";a("2de8")}}]);