(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~e0959b73"],{"130a":function(t,e,a){},"5eb5":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"g-page"},[e("search-form",{attrs:{searchConfig:t.searchConfig},on:{onSearch:t.onSearch}}),e("button-list",{attrs:{data:t.buttonList}}),e("tableView",{attrs:{loading:t.tableConfig.loading,operateObj:t.tableConfig.operate,columns:t.tableConfig.columns,tableData:t.tableConfig.tableData,isPage:t.tableConfig.isPage,total:t.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:2,currentPage:t.tableConfig.pagination.pageNo,pageSize:t.tableConfig.pagination.pageSize},on:{"update:currentPage":function(e){return t.$set(t.tableConfig.pagination,"pageNo",e)},"update:current-page":function(e){return t.$set(t.tableConfig.pagination,"pageNo",e)},"update:pageSize":function(e){return t.$set(t.tableConfig.pagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.tableConfig.pagination,"pageSize",e)},changePage:t.changePage,operate:t.getIndex}}),t.visible?e("DialogAddEdit",{attrs:{rowData:t.rowData,dataCenter:t.dataCenter_options,refresh:t.getList},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}}):t._e(),t.showActions?e("DialogActions",{attrs:{rowData:t.rowData,refresh:t.getList},model:{value:t.showActions,callback:function(e){t.showActions=e},expression:"showActions"}}):t._e()],1)},n=[],o=a("c7eb"),r=a("1da1"),s=a("5530"),c=(a("99af"),a("a15b"),a("d81d"),a("d3b7"),a("498a"),function(){var t=this,e=t._self._c;return e("el-dialog-limit",{attrs:{title:t.isEdit?"编辑":"新增",visible:t.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:t.clickCancel}},[e("el-form",{ref:"formRef",attrs:{model:t.formData,"label-width":"120px",rules:t.rules}},[e("el-form-item",{attrs:{label:"单元名称",prop:"unitName"}},[e("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入单元名称"},model:{value:t.formData.unitName,callback:function(e){t.$set(t.formData,"unitName","string"===typeof e?e.trim():e)},expression:"formData.unitName"}})],1),e("el-form-item",{attrs:{label:"单元类型",prop:"unitType"}},[e("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择单元类型",clearable:"",filterable:""},model:{value:t.formData.unitType,callback:function(e){t.$set(t.formData,"unitType",e)},expression:"formData.unitType"}},t._l(t.dict_unitType.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"单元编码",prop:"unitCode"}},[e("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入单元编码",disabled:t.isEdit},model:{value:t.formData.unitCode,callback:function(e){t.$set(t.formData,"unitCode","string"===typeof e?e.trim():e)},expression:"formData.unitCode"}})],1),e("el-form-item",{attrs:{label:"备份号",prop:"bakNo"}},[e("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入备份号",disabled:t.isEdit},model:{value:t.formData.bakNo,callback:function(e){t.$set(t.formData,"bakNo","string"===typeof e?e.trim():e)},expression:"formData.bakNo"}})],1),e("el-form-item",{attrs:{label:"数据中心",prop:"machineRoomId"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据中心名称"},model:{value:t.formData.machineRoomId,callback:function(e){t.$set(t.formData,"machineRoomId",e)},expression:"formData.machineRoomId"}},t._l(t.dataCenter,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"备注",prop:"unitDesc"}},[e("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入备注",type:"textarea"},model:{value:t.formData.unitDesc,callback:function(e){t.$set(t.formData,"unitDesc","string"===typeof e?e.trim():e)},expression:"formData.unitDesc"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.clickConfirm}},[t._v("确定")]),e("el-button",{on:{click:t.clickCancel}},[t._v("取消")])],1)],1)}),l=[],u=(a("b64b"),a("159b"),a("934b")),d=a("e8b2"),f=a("4879"),p={name:"add-edit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:{type:Function,required:!0,default:function(){}},dataCenter:{type:Array,default:function(){return[]}}},data:function(){return{resourceList:[],resourceProps:{key:"resourceId",label:"resourceName",disabled:"disabled"},dict_unitType:f["g"],formData:m(),rules:{machineRoomId:[{required:!0,trigger:"blur",message:"请选择数据中心"}],unitType:[{required:!0,trigger:"change",message:"请选择单元类型"}],unitCode:[{required:!0,trigger:"blur",message:"请输入单元编码"}],bakNo:[{required:!0,trigger:"blur",message:"请输入备份号"}],unitName:[{required:!0,trigger:"blur",message:"请输入单元名称"}]},loading:!1}},computed:{visible:{get:function(){return this.show},set:function(t){this.$emit("change",!1)}},isEdit:function(){var t;return Boolean(null===(t=this.rowData)||void 0===t?void 0:t.unitName)}},watch:{},created:function(){},mounted:function(){var t;null!==(t=this.rowData)&&void 0!==t&&t.id&&(this.formData=m(this.rowData))},methods:{clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},baseUnitAdd:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function a(){var i;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(u["i"])(t).catch((function(t){e.loading=!1}));case 2:if(i=a.sent,!i){a.next=6;break}return delete t.id,a.abrupt("return",Object(u["f"])(t).then((function(t){t&&200===t.code&&(e.$message.success("新增成功"),e.refresh(),e.visible=!1)})).finally((function(){e.loading=!1})));case 6:case"end":return a.stop()}}),a)})))()},clickConfirm:function(){var t=this;this.$refs.formRef.validate((function(e){if(e){var a=Object(s["a"])({},t.formData);if(t.loading=!0,t.isEdit)return Object(u["j"])(a).then((function(e){e&&200===e.code&&(t.$message({message:"修改成功",type:"success"}),t.visible=!1,t.refresh())})).finally((function(){t.loading=!1}));t.baseUnitAdd(a)}}))}}};function m(t){var e={id:"",machineRoomId:"",unitType:"",unitCode:"",unitDesc:"",bakNo:"",unitName:""};return Object(d["a"])(t)&&Object.keys(e).forEach((function(a){t.hasOwnProperty(a)&&(e[a]=t[a])})),e}var b=p,h=(a("90ac"),a("2877")),g=Object(h["a"])(b,c,l,!1,null,"7590dd7a",null),v=g.exports,C=a("142c"),D=a("ff51"),w=a("ec41"),k=function(){var t=this,e=t._self._c;return e("el-dialog-limit",{attrs:{title:t.title,visible:t.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:t.clickCancel}},[e("el-form",{ref:"formRef",attrs:{model:t.formData,"label-width":"120px",rules:t.rules}},[e("el-form-item",{attrs:{label:"机器",prop:"idList"}},[e("el-transfer",{attrs:{data:t.resourceList,props:t.resourceProps,titles:["数据中心机器","本单元机器"]},model:{value:t.formData.idList,callback:function(e){t.$set(t.formData,"idList",e)},expression:"formData.idList"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.clickConfirm}},[t._v("确定")]),e("el-button",{on:{click:t.clickCancel}},[t._v("取消")])],1)],1)},y=[],j={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:{type:Function,required:!0,default:function(){}}},data:function(){return{resourceList:[],resourceProps:{key:"id",label:"label",disabled:"disabled"},formData:{idList:[]},rules:{idList:[{required:!0,trigger:"change",message:"请选择机器"}]},loading:!1}},computed:{visible:{get:function(){return this.show},set:function(t){this.$emit("change",!1)}},title:function(){var t;return null!==(t=this.rowData)&&void 0!==t&&t.unitName?"关联机器 (".concat(this.rowData.unitName,")"):"关联机器"}},watch:{},created:function(){},mounted:function(){var t=this;this.rowData.id?(this.formData.unitId=this.rowData.id,Object(u["h"])({id:this.rowData.id,machineRoomId:this.rowData.machineRoomId}).then((function(e){var a=Object(w["a"])(e,"data.mrMachines"),i=Object(w["a"])(e,"data.unitMachines"),n=[];Object(D["a"])(a)&&(n=a,Object(D["a"])(i)&&(n=a.concat(i))),n.forEach((function(t){t.label="".concat(t.hostIp,"(").concat(t.hostSshAccount,")")})),t.resourceList=n,t.formData.idList=i.map((function(t){return t.id}))})).catch((function(t){}))):this.visible=!1},methods:{clickCancel:function(){this.$refs.formRef.resetFields(),this.visible=!1},clickConfirm:function(){var t=this;this.$refs.formRef.validate((function(e){e&&(t.loading=!0,Object(u["g"])(t.formData).then((function(e){e&&200===e.code&&(t.$message.success("操作成功"),t.visible=!1,t.refresh())})).finally((function(){t.loading=!1})))}))}}},O=j,N=Object(h["a"])(O,k,y,!1,null,"121f19b4",null),x=N.exports,$={name:"manage-account",components:{DialogAddEdit:v,DialogActions:x},mixins:[],props:{},data:function(){this.$createElement;var t=this;return{dataCenter_options:[],buttonList:[{label:"新增",type:"add",click:this.openAdd}],searchConfig:{searchData:{machineRoomId:""},searchItem:[{type:"select",label:"数据中心",prop:"machineRoomId",labelWidth:"100px",get options(){return t.dataCenter_options}}],rules:{machineRoomId:[{required:!0,message:"请选择数据中心名称",trigger:"change"}]}},visible:!1,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{label:"单元名称",prop:"unitName"},{label:"单元编码",prop:"unitCode"},{label:"备份号",prop:"bakNo"},{label:"单元类型",prop:"unitType",format:function(t){return f["g"].get(t)}},{label:"数据中心",prop:"dcName",render:function(t,e){var a=e.row;return t("span",["".concat(a.machineRoomCode,"(").concat(a.machineRoomName,")")])}},{label:"机器信息",prop:"machineList",render:function(t,e){var a=e.row,i="";return Object(D["a"])(a.machineList)&&(i=a.machineList.map((function(t){return"".concat(t.hostIp,"(").concat(t.hostSshAccount,")")})).join(",")),t("span",[i])}},{label:"备注",prop:"unitDesc"}],operate:{width:160,list:[{label:"编辑",id:"edit"},{label:"删除",id:"delete"},{label:"关联机器",id:"actions"}]}},rowData:null,showActions:!1}},computed:{},watch:{},created:function(){this.getDataCenterOptions()},mounted:function(){},methods:{getList:function(){var t=this,e=Object(s["a"])(Object(s["a"])({},this.tableConfig.pagination),{},{requestObject:this.searchConfig.searchData});delete e.totalCount,this.tableConfig.loading=!0,Object(u["e"])(e).then((function(e){var a=Object(w["a"])(e,"data.data");t.tableConfig.tableData=Object(D["a"])(a)?a:[],t.tableConfig.pagination.totalCount=Object(w["a"])(e,"data.totalCount")||0})).catch((function(t){})).finally((function(){t.tableConfig.loading=!1}))},getDataCenterOptions:function(){var t=this;Object(C["f"])().then((function(e){var a=Object(w["a"])(e,"data");t.dataCenter_options=a.map((function(t){return{label:"".concat(t.machineRoomCode,"(").concat(t.machineRoomName,")"),value:t.id}}))}))},getIndex:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function a(){var i,n,r;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.index,i=t.row,n=t.operate,e.rowData=i,a.t0=n.id,a.next="edit"===a.t0?6:"actions"===a.t0?8:"delete"===a.t0?10:15;break;case 6:return e.visible=!0,a.abrupt("break",16);case 8:return e.showActions=!0,a.abrupt("break",16);case 10:return a.next=12,e.$confirm("确定要删除【".concat(i.unitName,"】吗?"),{type:"warning"});case 12:return r=a.sent,"confirm"===r&&Object(u["a"])(i.id).then((function(t){200===t.code&&(e.$message.success("删除成功"),e.getList())})).catch((function(t){})),a.abrupt("break",16);case 15:case 16:case"end":return a.stop()}}),a)})))()},onSearch:function(t){this.tableConfig.pagination.pageNo=1,this.getList()},openAdd:function(){this.rowData=null,this.visible=!0},changePage:function(t,e){t&&(this.tableConfig.pagination.pageNo=t),e&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=e),this.getList()}}},L=$,R=Object(h["a"])(L,i,n,!1,null,"07ac0f4d",null);e["default"]=R.exports},"90ac":function(t,e,a){"use strict";a("130a")}}]);