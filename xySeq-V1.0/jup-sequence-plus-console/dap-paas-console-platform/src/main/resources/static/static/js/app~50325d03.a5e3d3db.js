(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~50325d03"],{"041c":function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return p}));var r=a("d4ec"),s=a("bee2"),o=(a("a15b"),a("d81d"),a("5c8a")),c=a("bc48"),i=a("ec41"),n=a("cf45");function l(e){return{id:e.id,clusterName:e.clusterName,version:e.version,clusterMode:e.clusterMode,nameserverDeployInfo:{image:"",configTemplateId:"",jvmParam:"-Xms1g -Xmx1g -Xmn256m",size:2,listenPort:8888,storageClassName:"",storage:1,hostNetwork:!1,limitsCpu:500,limitsMemory:2048,requestCpu:250,requestMemory:2048,imagePullPolicy:"IfNotPresent",imagePullSecrets:"",serviceType:"ClusterIP",nodePort:"",nodeSelector:[]},brokerDeployInfo:{image:"",configTemplateId:"",jvmParam:"-Xms4g -Xmx4g -Xmn1g",size:2,replicaPerGroup:1,listenPort:2222,dlegerPort:40911,storageClassName:"",storage:1,hostNetwork:!1,limitsCpu:500,limitsMemory:5120,requestCpu:250,requestMemory:5120,imagePullPolicy:"IfNotPresent",imagePullSecrets:"",serviceType:"ClusterIP",nodePorts:"",nodeSelector:[]}}}var p=function(){function e(t){Object(r["a"])(this,e),this.data=Object(o["a"])(t)}return Object(s["a"])(e,[{key:"result",value:function(){var e=this.data.id,t={clusterId:e,nameserverDeployInfo:this._processNameserver(),brokerDeployInfo:this._processBroker()};return t}},{key:"_processNameserver",value:function(){var e=this.data,t=e.clusterName,a=e.nameserverDeployInfo,r=a.image,s=a.configTemplateId,o=a.jvmParam,i=a.size,l=a.listenPort,p=a.storageClassName,u=a.storage,m=a.hostNetwork,g=a.limitsCpu,d=a.limitsMemory,b=a.requestCpu,f=a.requestMemory,j=a.imagePullPolicy,h=a.imagePullSecrets,v=a.serviceType,P=a.nodePort,O=a.nodeSelector,y={apiVersion:"rocketmq.gientech.io/v1alpha1",kind:"NameServer",metadata:{name:t+"-nameserver",annotations:{configName:s.label,imageId:r.id}},spec:{config:s.value,jvmParam:o,size:i,image:r.value,listenPort:l,imagePullPolicy:j,serviceType:v,resources:{requests:{memory:f+"Mi",cpu:b+"m"},limits:{memory:d+"Mi",cpu:g+"m"}},volumeClaimTemplate:{spec:{storageClassName:p,accessModes:["ReadWriteOnce"],resources:{requests:{storage:u+"Gi"}}}}}};return m&&Object(c["a"])(y,"spec.hostNetwork",m),P&&Object(c["a"])(y,"spec.nodePort",P),h&&Object(c["a"])(y,"spec.imagePullSecrets",h),O.length&&Object(c["a"])(y,"spec.nodeSelector",new n["a"](O)),y}},{key:"_processBroker",value:function(){var e=this.data,t=e.clusterName,a=e.brokerDeployInfo,r=(e.version,e.clusterMode),s=a.image,o=a.configTemplateId,i=a.jvmParam,l=a.size,p=a.listenPort,u=a.dlegerPort,m=a.storageClassName,g=a.storage,d=a.hostNetwork,b=a.limitsCpu,f=a.limitsMemory,j=a.requestCpu,h=a.requestMemory,v=a.replicaPerGroup,P=a.imagePullPolicy,O=a.imagePullSecrets,y=a.serviceType,C=a.nodePorts,k=a.nodeSelector,w={apiVersion:"rocketmq.gientech.io/v1alpha1",kind:"Broker",metadata:{name:t+"-broker",annotations:{configName:o.label,imageId:s.id}},spec:{nameServers:"",config:o.value,jvmParam:i,size:l,image:s.value,listenPort:p,replicaPerGroup:v,clusterMode:r,imagePullPolicy:P,serviceType:y,resources:{requests:{memory:h+"Mi",cpu:j+"m"},limits:{memory:f+"Mi",cpu:b+"m"}},volumeClaimTemplate:{spec:{storageClassName:m,accessModes:["ReadWriteOnce"],resources:{requests:{storage:g+"Gi"}}}}}};return"dleger"===r&&Object(c["a"])(w,"spec.dlegerPort",u),d&&Object(c["a"])(w,"spec.hostNetwork",d),C&&Object(c["a"])(w,"spec.nodePorts",C?C.split(",").map((function(e){return parseInt(e)})):""),O&&Object(c["a"])(w,"spec.imagePullSecrets",O),k.length&&Object(c["a"])(w,"spec.nodeSelector",new n["a"](k)),w}},{key:"editBrokerResult",value:function(e){var t=this.data,a=t.brokerDeployInfo,r=t.clusterMode,s=a.image,o=a.configTemplateId,i=a.jvmParam,l=a.size,p=a.listenPort,u=a.dlegerPort,m=a.storageClassName,g=a.storage,d=a.hostNetwork,b=a.limitsCpu,f=a.limitsMemory,j=a.requestCpu,h=a.requestMemory,v=a.replicaPerGroup,P=a.imagePullPolicy,O=a.imagePullSecrets,y=a.serviceType,C=a.nodePorts,k=a.nodeSelector;return Object(c["a"])(e,"spec.image",s.value),Object(c["a"])(e,"metadata.annotations.imageId",s.id),Object(c["a"])(e,"spec.config",o.value),Object(c["a"])(e,"metadata.annotations.configName",o.label),Object(c["a"])(e,"spec.jvmParam",i),Object(c["a"])(e,"spec.size",l),Object(c["a"])(e,"spec.replicaPerGroup",v),Object(c["a"])(e,"spec.listenPort",p),Object(c["a"])(e,"spec.resources.requests.memory",h+"Mi"),Object(c["a"])(e,"spec.resources.requests.cpu",j+"m"),Object(c["a"])(e,"spec.resources.limits.memory",f+"Mi"),Object(c["a"])(e,"spec.resources.limits.cpu",b+"m"),Object(c["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage",g+"Gi"),Object(c["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName",m),Object(c["a"])(e,"spec.imagePullPolicy",P),Object(c["a"])(e,"spec.serviceType",y),"dleger"===r?Object(c["a"])(e,"spec.dlegerPort",u):delete e.spec.dlegerPort,d?Object(c["a"])(e,"spec.hostNetwork",d):delete e.spec.hostNetwork,C?Object(c["a"])(e,"spec.nodePorts",C.split(",").map((function(e){return parseInt(e)}))):delete e.spec.nodePorts,O?Object(c["a"])(e,"spec.imagePullSecrets",O):delete e.spec.imagePullSecrets,k.length?Object(c["a"])(e,"spec.nodeSelector",new n["a"](k)):delete e.spec.nodeSelector,e}},{key:"editNameserverResult",value:function(e){var t=this.data.nameserverDeployInfo,a=t.image,r=t.configTemplateId,s=t.jvmParam,o=t.size,i=t.listenPort,l=t.storageClassName,p=t.storage,u=t.hostNetwork,m=t.limitsCpu,g=t.limitsMemory,d=t.requestCpu,b=t.requestMemory,f=t.imagePullPolicy,j=t.imagePullSecrets,h=t.serviceType,v=t.nodePort,P=t.nodeSelector;return Object(c["a"])(e,"spec.image",a.value),Object(c["a"])(e,"metadata.annotations.imageId",a.id),Object(c["a"])(e,"spec.config",r.value),Object(c["a"])(e,"metadata.annotations.configName",r.label),Object(c["a"])(e,"spec.jvmParam",s),Object(c["a"])(e,"spec.size",o),Object(c["a"])(e,"spec.listenPort",i),Object(c["a"])(e,"spec.resources.requests.memory",b+"Mi"),Object(c["a"])(e,"spec.resources.requests.cpu",d+"m"),Object(c["a"])(e,"spec.resources.limits.memory",g+"Mi"),Object(c["a"])(e,"spec.resources.limits.cpu",m+"m"),Object(c["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage",p+"Gi"),Object(c["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName",l),Object(c["a"])(e,"spec.imagePullPolicy",f),Object(c["a"])(e,"spec.serviceType",h),u?Object(c["a"])(e,"spec.hostNetwork",u):delete e.spec.hostNetwork,v?Object(c["a"])(e,"spec.nodePort",v):delete e.spec.nodePort,j?Object(c["a"])(e,"spec.imagePullSecrets",j):delete e.spec.imagePullSecrets,P.length?Object(c["a"])(e,"spec.nodeSelector",new n["a"](P)):delete e.spec.nodeSelector,e}},{key:"init",value:function(e){var t=l(e);return t.brokerDeployInfo=this._matchBroker(),t.nameserverDeployInfo=this._matchNameserver(t),t}},{key:"_matchNameserver",value:function(e){var t=this.data;e.clusterName=Object(i["a"])(t,"metadata.name");var a=Object(i["a"])(t,"spec.image"),r=Object(i["a"])(t,"metadata.annotations.imageId"),s=Object(i["a"])(t,"spec.config"),o=Object(i["a"])(t,"metadata.annotations.configName"),c=Object(i["a"])(t,"spec.jvmParam","-Xms1g -Xmx1g -Xmn256m"),l=Object(i["a"])(t,"spec.size"),p=Object(i["a"])(t,"spec.listenPort"),u=Object(i["a"])(t,"spec.hostNetwork",!1),m=Object(i["a"])(t,"spec.volumeClaimTemplate.spec.resources.requests.storage"),g=Object(i["a"])(t,"spec.volumeClaimTemplate.spec.storageClassName"),d=Object(i["a"])(t,"spec.resources.limits.cpu"),b=Object(i["a"])(t,"spec.resources.limits.memory"),f=Object(i["a"])(t,"spec.resources.requests.cpu"),j=Object(i["a"])(t,"spec.resources.requests.memory"),h=Object(i["a"])(t,"spec.imagePullPolicy"),v=Object(i["a"])(t,"spec.imagePullSecrets"),P=Object(i["a"])(t,"spec.serviceType"),O=Object(i["a"])(t,"spec.nodePort"),y=Object(i["a"])(t,"spec.nodeSelector",{});return{image:{id:r,value:a},configTemplateId:{value:s,label:o},jvmParam:c,size:l,listenPort:p,hostNetwork:u,storage:m.split("Gi")[0],storageClassName:g,limitsCpu:d.split("m")[0],limitsMemory:b.split("Mi")[0],requestCpu:f.split("m")[0],requestMemory:j.split("Mi")[0],imagePullPolicy:h,imagePullSecrets:v,serviceType:P,nodePort:O,nodeSelector:new n["a"](y)}}},{key:"_matchBroker",value:function(){var e=this.data,t=Object(i["a"])(e,"spec.image"),a=Object(i["a"])(e,"metadata.annotations.imageId"),r=Object(i["a"])(e,"spec.config"),s=Object(i["a"])(e,"metadata.annotations.configName"),o=Object(i["a"])(e,"spec.jvmParam","-Xms4g -Xmx4g -Xmn1g"),c=Object(i["a"])(e,"spec.size"),l=Object(i["a"])(e,"spec.listenPort"),p=Object(i["a"])(e,"spec.dlegerPort",40911),u=Object(i["a"])(e,"spec.hostNetwork",!1),m=Object(i["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage"),g=Object(i["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName"),d=Object(i["a"])(e,"spec.resources.limits.cpu"),b=Object(i["a"])(e,"spec.resources.limits.memory"),f=Object(i["a"])(e,"spec.resources.requests.cpu"),j=Object(i["a"])(e,"spec.resources.requests.memory"),h=Object(i["a"])(e,"spec.replicaPerGroup"),v=Object(i["a"])(e,"spec.imagePullPolicy"),P=Object(i["a"])(e,"spec.imagePullSecrets"),O=Object(i["a"])(e,"spec.serviceType"),y=Object(i["a"])(e,"spec.nodePorts"),C=Object(i["a"])(e,"spec.nodeSelector",{});return{image:{id:a,value:t},configTemplateId:{value:r,label:s},jvmParam:o,size:c,replicaPerGroup:h,listenPort:l,hostNetwork:u,dlegerPort:p,storage:m.split("Gi")[0],storageClassName:g,limitsCpu:d.split("m")[0],limitsMemory:b.split("Mi")[0],requestCpu:f.split("m")[0],requestMemory:j.split("Mi")[0],imagePullPolicy:v,imagePullSecrets:P,serviceType:O,nodePorts:y?y.join(","):y,nodeSelector:new n["a"](C)}}}])}()},"35c4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{loading:e.instancesLoading,title:"集群存在以下节点数据,确认全部删除?",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("tableView",{ref:"tableView",attrs:{isPage:e.tableConfig.isPage,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,rowKey:"id"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},s=[],o=(a("a15b"),a("d81d"),a("d3b7"),a("3775")),c={name:"AddAndEdit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{instancesLoading:!1,tableConfig:{loading:!1,isPage:!1,tableData:[],columns:[{prop:"instanceName",label:"节点名称",align:"center"},{prop:"port",label:"端口",align:"center"}]}}},watch:{},created:function(){},mounted:function(){this.tableConfig.tableData=this.rowData.instancesData},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this,t={clusterId:this.rowData.clusterId,id:this.rowData.instancesData.map((function(e){return e.id})).join(",")};this.instancesLoading=!0,Object(o["e"])(t).then((function(t){e.$message.success(t.data),e.$emit("change",!1),e.refresh()})).finally((function(){e.instancesLoading=!1}))}}},i=c,n=a("2877"),l=Object(n["a"])(i,r,s,!1,null,"51312267",null);t["default"]=l.exports},"3c75":function(e,t,a){},"62ad":function(e,t,a){"use strict";a("3c75")},"63d1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("el-page-header",{staticStyle:{"margin-bottom":"20px"},attrs:{content:"部署记录"},on:{back:e.goBack}}),t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:2,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage}})],1)},s=[],o=a("c7eb"),c=a("5530"),i=a("1da1"),n=a("23a6"),l=a("ec41"),p=a("ff51"),u={name:"deploy-record",components:{},mixins:[],props:{},data:function(){return{buttonList:[],searchConfig:{searchData:{cluster:"",machineIp:""},searchItem:[{prop:"cluster",label:"集群",type:"input"},{prop:"machineIp",label:"机器",type:"input"}],rules:{}},tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"cluster",label:"集群"},{prop:"machineIp",label:"机器ip"},{prop:"machinePort",label:"机器端口"},{prop:"deployStatus",label:"部署状态"},{prop:"deployPath",label:"部署路径"},{prop:"content",label:"内容"},{prop:"detail",label:"详情"},{prop:"createDate",label:"部署时间"}],operate:{width:160,list:[]}},rowData:null}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},getList:function(){var e=this;return Object(i["a"])(Object(o["a"])().mark((function t(){var a,r,s;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableConfig.loading=!0,t.prev=1,a=Object(c["a"])(Object(c["a"])({},e.tableConfig.pagination),{},{requestObject:Object(c["a"])({componentType:"11"},e.searchConfig.searchData)}),t.next=5,Object(n["f"])(a);case 5:r=t.sent,s=Object(l["a"])(r,"data.data"),e.tableConfig.tableData=Object(p["a"])(s)?s:[],e.tableConfig.pagination.totalCount=Object(l["a"])(r,"data.totalCount")||0,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1);case 14:e.tableConfig.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()}}},m=u,g=a("2877"),d=Object(g["a"])(m,r,s,!1,null,"31c631c5",null);t["default"]=d.exports},b8fc:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"扩缩容"+e.rowData.clusterType+"集群",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"broker"===e.rowData.clusterType?"master实例数":"实例数",prop:"size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.size,callback:function(t){e.$set(e.formData,"size",e._n(t))},expression:"formData.size"}})],1),"broker"===e.rowData.clusterType?t("el-form-item",{attrs:{label:"slave实例数",prop:"replicaPerGroup"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入slave实例数"},model:{value:e.formData.replicaPerGroup,callback:function(t){e.$set(e.formData,"replicaPerGroup",e._n(t))},expression:"formData.replicaPerGroup"}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},s=[],o=a("c7eb"),c=a("1da1"),i=(a("d3b7"),a("98c7")),n=a("ec41"),l=a("61f7"),p={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{loading:!1,labelPosition:"right",formData:{size:2,replicaPerGroup:2},rules:{size:[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:l["d"],trigger:"blur"}],replicaPerGroup:[{required:!0,message:"请输入slave实例数",trigger:"blur"},{validator:l["d"],trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){"nameserver"===this.rowData.clusterType?this.getNameserverById():this.getBrokerById()},methods:{getNameserverById:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(i["g"])(e.rowData.id).then((function(t){var a=null===t||void 0===t?void 0:t.data;e.formData.size=Object(n["a"])(a,"spec.size")}));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1);case 9:e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},getBrokerById:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(i["e"])(e.rowData.id).then((function(t){var a=null===t||void 0===t?void 0:t.data;e.formData.size=Object(n["a"])(a,"spec.size"),e.formData.replicaPerGroup=Object(n["a"])(a,"spec.replicaPerGroup")}));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1);case 9:e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(c["a"])(Object(o["a"])().mark((function t(a){var r,s;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(e.loading=!0,"nameserver"===e.rowData.clusterType?(r={clusterId:e.rowData.id,context:{spec:{size:e.formData.size}}},Object(i["c"])(r).then((function(t){200===t.code&&(e.$message({type:"success",message:"修改成功"}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))):(s={clusterId:e.rowData.id,context:{spec:{size:e.formData.size,replicaPerGroup:e.formData.replicaPerGroup}}},Object(i["b"])(s).then((function(t){200===t.code&&(e.$message({type:"success",message:"修改成功"}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},u=p,m=(a("62ad"),a("2877")),g=Object(m["a"])(u,r,s,!1,null,"21cdacc6",null);t["default"]=g.exports}}]);