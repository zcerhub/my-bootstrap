(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~d7095425"],{"398e":function(e,t,a){"use strict";a("4612")},4612:function(e,t,a){},"4b1b":function(e,t,a){"use strict";a.r(t);a("99af"),a("b0c0"),a("498a");var r=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.deployLoading,expression:"deployLoading"}],staticClass:"deployment-plan"},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"90px",model:e.form,rules:e.rules}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.form.nameSrvList.length>0,expression:"form.nameSrvList.length > 0"}]},[t("header-line",[e._v("NameSrv(端口为0自动分配)")]),e._l(e.form.nameSrvList,(function(a,r){return t("el-card",{key:r,staticStyle:{"margin-bottom":"20px"}},[t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:20}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"机器:",prop:"nameSrvList.".concat(r,".machine"),rules:e.rules.machine}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择机器","value-key":"id"},on:{change:function(t){return e.changeMachine(t,a)}},model:{value:a.machine,callback:function(t){e.$set(a,"machine",t)},expression:"item.machine"}},e._l(e.rocketMachineOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.address,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口:",prop:"nameSrvList.".concat(r,".port"),rules:e.rules.port}},[t("el-input",{attrs:{placeholder:"请输入端口"},model:{value:a.port,callback:function(t){e.$set(a,"port","string"===typeof t?t.trim():t)},expression:"item.port"}})],1)],1)],1),t("el-form-item",{attrs:{label:"部署路径:",prop:"nameSrvList.".concat(r,".deployPath"),rules:e.rules.deployPath}},[t("el-input",{attrs:{placeholder:"请输入部署路径"},model:{value:a.deployPath,callback:function(t){e.$set(a,"deployPath","string"===typeof t?t.trim():t)},expression:"item.deployPath"}})],1),t("el-form-item",{attrs:{label:"配置模板",prop:"configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板"},model:{value:a.configTemplateId,callback:function(t){e.$set(a,"configTemplateId",t)},expression:"item.configTemplateId"}},e._l(e.opts_serverTemplate,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"运行内存",prop:"nameSrvList.".concat(r,".jvmParam"),rules:e.rules.jvmParam}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:a.jvmParam,callback:function(t){e.$set(a,"jvmParam",t)},expression:"item.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delNameSrvNode(a,r)}}},[e._v("删除")])],1)],1)],1)}))],2),t("div",{directives:[{name:"show",rawName:"v-show",value:e.form.brokerList.length>0,expression:"form.brokerList.length > 0"}]},[t("header-line",[e._v("broker(端口为0自动分配)")]),e._l(e.form.brokerList,(function(a,r){return t("el-card",{key:r,staticStyle:{"margin-bottom":"20px"}},[t("div",[t("header-line",{attrs:{type:"success"}},[e._v("主节点")]),t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:20}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"机器:",prop:"brokerList.".concat(r,".machine"),rules:e.rules.machine}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择机器","value-key":"id"},on:{change:function(t){return e.changeMachine(t,a)}},model:{value:a.machine,callback:function(t){e.$set(a,"machine",t)},expression:"item.machine"}},e._l(e.rocketMachineOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.address,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口:",prop:"brokerList.".concat(r,".port"),rules:e.rules.port}},[t("el-input",{attrs:{placeholder:"请输入端口"},model:{value:a.port,callback:function(t){e.$set(a,"port","string"===typeof t?t.trim():t)},expression:"item.port"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"name:",prop:"instanceName"}},[t("el-input",{attrs:{placeholder:"请输入name"},model:{value:a.instanceName,callback:function(t){e.$set(a,"instanceName","string"===typeof t?t.trim():t)},expression:"item.instanceName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"部署路径:",prop:"brokerList.".concat(r,".deployPath"),rules:e.rules.deployPath}},[t("el-input",{attrs:{placeholder:"请输入部署路径"},model:{value:a.deployPath,callback:function(t){e.$set(a,"deployPath","string"===typeof t?t.trim():t)},expression:"item.deployPath"}})],1)],1)],1),t("el-form-item",{attrs:{label:"运行内存",prop:"brokerList.".concat(r,".jvmParam"),rules:e.rules.jvmParam}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:a.jvmParam,callback:function(t){e.$set(a,"jvmParam",t)},expression:"item.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addDeployNode(a)}}},[e._v("新增")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delBrokerNode(r)}}},[e._v("删除")])],1)],1)],1),e._l(a.childList,(function(o,l){return t("div",{key:l,staticStyle:{"margin-left":"20px"}},[t("header-line",{attrs:{type:"warning"}},[e._v("从节点")]),t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:20}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"机器:",prop:"brokerList.".concat(r,".childList.").concat(l,".machine"),rules:e.rules.machine}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择机器","value-key":"id"},on:{change:function(t){return e.changeMachine(t,o)}},model:{value:o.machine,callback:function(t){e.$set(o,"machine",t)},expression:"child.machine"}},e._l(e.rocketMachineOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.address,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口:",prop:"brokerList.".concat(r,".childList.").concat(l,".port"),rules:e.rules.port}},[t("el-input",{attrs:{placeholder:"请输入端口"},model:{value:o.port,callback:function(t){e.$set(o,"port","string"===typeof t?t.trim():t)},expression:"child.port"}})],1)],1)],1),t("el-form-item",{attrs:{label:"部署路径:",prop:"brokerList.".concat(r,".childList.").concat(l,".deployPath"),rules:e.rules.deployPath}},[t("el-input",{attrs:{placeholder:"请输入部署路径"},model:{value:o.deployPath,callback:function(t){e.$set(o,"deployPath","string"===typeof t?t.trim():t)},expression:"child.deployPath"}})],1),t("el-form-item",{attrs:{label:"运行内存",prop:"brokerList.".concat(r,".childList.").concat(l,".jvmParam"),rules:e.rules.jvmParam}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:o.jvmParam,callback:function(t){e.$set(o,"jvmParam",t)},expression:"child.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delDeployNode(a,l)}}},[e._v("删除")])],1)],1)],1)})),t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:20}},[t("el-form-item",{attrs:{label:"配置模板",prop:"configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板"},model:{value:a.configTemplateId,callback:function(t){e.$set(a,"configTemplateId",t)},expression:"item.configTemplateId"}},e._l(e.opts_brokerTemplate,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1)],2)}))],2)])],1)},o=[],l=a("3835"),n=a("b85c"),s=a("2909"),i=(a("4de4"),a("caad"),a("a15b"),a("d81d"),a("14d9"),a("a434"),a("4fad"),a("0541"),a("b64b"),a("d3b7"),a("159b"),a("3775")),c=a("082f"),m=a("ff51"),p=a("ec41"),u=a("5c8a"),f=a("49bb"),d=a("61f7"),b={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{opts_startupTemplate:f["i"],opts_serverTemplate:[],opts_brokerTemplate:[],deployLoading:!1,rocketMachineOptions:[],labelPosition:"right",form:{nameSrvList:[],brokerList:[]},rules:{jvmParam:[{required:!0,validator:d["h"],trigger:"change"}],machine:[{required:!0,message:"请选择机器",trigger:"change"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}],deployPath:[{required:!0,message:"请输入部署路径",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){this.getServerConfigTemplate(),this.getBrokerConfigTemplate()},mounted:function(){this.isEdit&&(this.getDeployplanById(),this.getAllMachine())},methods:{getServerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_SERVER",componentType:"ROCKETMQ"};Object(c["c"])(t).then((function(t){e.opts_serverTemplate=Object(m["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},getBrokerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_BROKER",componentType:"ROCKETMQ"};Object(c["c"])(t).then((function(t){e.opts_brokerTemplate=Object(m["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},changeMachine:function(e,t){var a=Object(p["a"])(e,"path","");this.$set(t,"deployPath",a)},getDeployplanById:function(){var e=this;this.deployLoading=!0,Object(i["k"])(this.rowData.id).then((function(t){var a=Object(p["a"])(t,"data");e.form.nameSrvList=a.filter((function(e){return"RocketMQ_NameSrv"===e.instanceType})),e.form.brokerList=a.filter((function(e){return"RocketMQ_Dleger"===e.instanceType||"RocketMQ_Broker"===e.instanceType}))})).finally((function(){e.deployLoading=!1}))},getAllMachine:function(){var e=this;Object(i["i"])(this.rowData.id).then((function(t){e.rocketMachineOptions=Object(p["a"])(t,"data")}))},delNameSrvNode:function(e,t){this.form.nameSrvList.splice(t,1)},delDeployNode:function(e,t){e.childList.splice(t,1)},addDeployNode:function(e){var t={machine:"",port:"",deployment:"",configTemplateId:"",instanceName:e.instanceName,instanceType:e.instanceType,clusterId:e.clusterId,role:"slave",childList:null};e.childList||this.$set(e,"childList",[]),e.childList.push(t)},delBrokerNode:function(e){this.form.brokerList.length<=1?this.$message.error("至少保留一个主节点"):this.form.brokerList.splice(e,1)},checkAllIpPort:function(){var e=g(this.form);return y(e)}}};function g(e){var t=Object(u["a"])(e),a=[].concat(Object(s["a"])(t.brokerList),Object(s["a"])(t.nameSrvList)),r=[];function o(e){var t,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var l=t.value;[0,"0"].includes(l.port)||r.push({address:l.machine.address,port:l.port}),Array.isArray(l.childList)&&o(l.childList)}}catch(s){a.e(s)}finally{a.f()}}return o(a),r}function y(e){var t,a=e.length,r=e.map((function(e){return"".concat(e.address,":").concat(e.port)})),o={},s=Object(n["a"])(r);try{for(s.s();!(t=s.n()).done;){var i=t.value;Object.hasOwn(o,i)?o[i]+=1:o[i]=1}}catch(m){s.e(m)}finally{s.f()}var c=[];return Object.entries(o).forEach((function(e){var t=Object(l["a"])(e,2),a=t[0],r=t[1];r>1&&c.push("".concat(a,"重复 ").concat(r,"次"))})),{message:c.join("; "),isPass:Object.keys(o).length===a}}var h=b,v=(a("6db3"),a("2877")),D=Object(v["a"])(h,r,o,!1,null,"1315f210",null);t["default"]=D.exports},"5cc4":function(e,t,a){},"6db3":function(e,t,a){"use strict";a("821e")},"78be":function(e,t,a){"use strict";a("c85e")},"821e":function(e,t,a){},"931e":function(e,t,a){"use strict";a.r(t);a("b0c0");var r=function(){var e=this,t=e._self._c;return t("div",[t("el-drawer",{attrs:{title:"一键部署(容器)",visible:e.show,size:"900px","append-to-body":!0,"close-on-click-modal":!1,loading:e.deployLoading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form ml-10 mr-20",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},[t("div",[t("header-line",[e._v("NameSrv")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"nameserverDeployInfo.image"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.nameserverDeployInfo.image,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"image",t)},expression:"formData.nameserverDeployInfo.image"}},e._l(e.opts_imageNs,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模板",prop:"nameserverDeployInfo.configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板","value-key":"label"},model:{value:e.formData.nameserverDeployInfo.configTemplateId,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"configTemplateId",t)},expression:"formData.nameserverDeployInfo.configTemplateId"}},e._l(e.opts_serverTemplate,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行内存",prop:"nameserverDeployInfo.jvmParam"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:e.formData.nameserverDeployInfo.jvmParam,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"jvmParam",t)},expression:"formData.nameserverDeployInfo.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实例数",prop:"nameserverDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.nameserverDeployInfo.size,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"size",e._n(t))},expression:"formData.nameserverDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口",prop:"nameserverDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入端口"},model:{value:e.formData.nameserverDeployInfo.listenPort,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"listenPort",e._n(t))},expression:"formData.nameserverDeployInfo.listenPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"nameserverDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.nameserverDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"storageClassName",t)},expression:"formData.nameserverDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"nameserverDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入存储卷大小"},model:{value:e.formData.nameserverDeployInfo.storage,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"storage",e._n(t))},expression:"formData.nameserverDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.nameserverDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"imagePullPolicy",t)},expression:"formData.nameserverDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.nameserverDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"imagePullSecrets",t)},expression:"formData.nameserverDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.nameserverDeployInfo.serviceType,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"serviceType",t)},expression:"formData.nameserverDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.nameserverDeployInfo.serviceType?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"nodePort",prop:"nameserverDeployInfo.nodePort"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入nodePort"},model:{value:e.formData.nameserverDeployInfo.nodePort,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"nodePort",e._n(t))},expression:"formData.nameserverDeployInfo.nodePort"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.nameserverDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"hostNetwork",t)},expression:"formData.nameserverDeployInfo.hostNetwork"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"支持虚机会为Pod使用主机网络，请确保主机端口可用",type:"warning","show-icon":"",closable:!1}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.nameserverDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:r.key,callback:function(t){e.$set(r,"key",t)},expression:"row.key"}})]}}])}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"row.value"}})]}}])}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("ns")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(a){var r=a.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.nameserverDeployInfo.nodeSelector,r)}}},[e._v("删除")])]}}])})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"nameserverDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.nameserverDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"limitsCpu",e._n(t))},expression:"formData.nameserverDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"nameserverDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minNsMemory,placeholder:"请输入memory"},model:{value:e.formData.nameserverDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"limitsMemory",e._n(t))},expression:"\n                      formData.nameserverDeployInfo.limitsMemory\n                    "}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"nameserverDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.nameserverDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"requestCpu",e._n(t))},expression:"formData.nameserverDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"nameserverDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minNsMemory,placeholder:"请输入memory"},model:{value:e.formData.nameserverDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"requestMemory",e._n(t))},expression:"\n                      formData.nameserverDeployInfo.requestMemory\n                    "}})],1)],1)],1)],1)],1)],1),t("div",[t("header-line",[e._v("broker")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"brokerDeployInfo.image"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.brokerDeployInfo.image,callback:function(t){e.$set(e.formData.brokerDeployInfo,"image",t)},expression:"formData.brokerDeployInfo.image"}},e._l(e.opts_imageBk,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模板",prop:"brokerDeployInfo.configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板","value-key":"label"},model:{value:e.formData.brokerDeployInfo.configTemplateId,callback:function(t){e.$set(e.formData.brokerDeployInfo,"configTemplateId",t)},expression:"formData.brokerDeployInfo.configTemplateId"}},e._l(e.opts_brokerTemplate,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行内存",prop:"brokerDeployInfo.jvmParam"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:e.formData.brokerDeployInfo.jvmParam,callback:function(t){e.$set(e.formData.brokerDeployInfo,"jvmParam",t)},expression:"formData.brokerDeployInfo.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"master实例数",prop:"brokerDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入master实例数"},model:{value:e.formData.brokerDeployInfo.size,callback:function(t){e.$set(e.formData.brokerDeployInfo,"size",e._n(t))},expression:"formData.brokerDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"slave实例数",prop:"brokerDeployInfo.replicaPerGroup"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入slave实例数"},model:{value:e.formData.brokerDeployInfo.replicaPerGroup,callback:function(t){e.$set(e.formData.brokerDeployInfo,"replicaPerGroup",e._n(t))},expression:"formData.brokerDeployInfo.replicaPerGroup"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口",prop:"brokerDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入端口"},model:{value:e.formData.brokerDeployInfo.listenPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"listenPort",e._n(t))},expression:"formData.brokerDeployInfo.listenPort"}})],1)],1),"dleger"===e.rowData.clusterMode?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"dlegerPort",prop:"brokerDeployInfo.dlegerPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入dlegerPort"},model:{value:e.formData.brokerDeployInfo.dlegerPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"dlegerPort",e._n(t))},expression:"formData.brokerDeployInfo.dlegerPort"}})],1)],1):e._e(),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"brokerDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.brokerDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storageClassName",t)},expression:"formData.brokerDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"brokerDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入存储卷大小"},model:{value:e.formData.brokerDeployInfo.storage,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storage",e._n(t))},expression:"formData.brokerDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.brokerDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullPolicy",t)},expression:"formData.brokerDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.brokerDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullSecrets",t)},expression:"formData.brokerDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.brokerDeployInfo.serviceType,callback:function(t){e.$set(e.formData.brokerDeployInfo,"serviceType",t)},expression:"formData.brokerDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.brokerDeployInfo.serviceType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"外部服务端口",prop:"brokerDeployInfo.nodePorts"}},[t("el-input",{staticStyle:{width:"37%"},attrs:{placeholder:"请输入外部服务端口,多个端口用逗号隔开"},model:{value:e.formData.brokerDeployInfo.nodePorts,callback:function(t){e.$set(e.formData.brokerDeployInfo,"nodePorts",t)},expression:"formData.brokerDeployInfo.nodePorts"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"请确保为每个实例都设置了外部服务端口",type:"warning","show-icon":"",closable:!1}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.brokerDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.brokerDeployInfo,"hostNetwork",t)},expression:"formData.brokerDeployInfo.hostNetwork"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.brokerDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:r.key,callback:function(t){e.$set(r,"key",t)},expression:"row.key"}})]}}])}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"row.value"}})]}}])}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("bk")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(a){var r=a.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.brokerDeployInfo.nodeSelector,r)}}},[e._v("删除")])]}}])})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsCpu",e._n(t))},expression:"formData.brokerDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsMemory",e._n(t))},expression:"formData.brokerDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestCpu",e._n(t))},expression:"formData.brokerDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestMemory",e._n(t))},expression:"formData.brokerDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1)]),t("span",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1),e.deployVisible?t("el-drawer",{attrs:{title:"部署信息",visible:e.deployVisible,size:"70%","append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.deployVisible=t},close:e.clickDeployCancel}},[t("my-xterm",{ref:"xterm",attrs:{terminal:e.terminal,socketUrl:e.socketUrl}})],1):e._e()],1)},o=[],l=a("c7eb"),n=a("1da1"),s=(a("99af"),a("a15b"),a("d81d"),a("14d9"),a("a434"),a("b64b"),a("d3b7"),a("ac1f"),a("00b4"),a("159b"),a("a4ed")),i=a("98c7"),c=a("082f"),m=a("041c"),p=a("49bb"),u=a("ec41"),f=a("ff51"),d=a("61f7"),b=a("957c"),g={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=function(e,t,a){return Object(d["g"])(e,t,a)};return{socketUrl:"",terminal:{pid:1,name:"terminal"},minNsMemory:2048,minBkMemory:5120,deployVisible:!1,dict_imagePullPolicy:p["d"],opts_startupTemplate:p["i"],opts_imageNs:[],opts_imageBk:[],opts_imagePullSecrets:[],dict_serviceType:p["f"],opts_storageClass:[],opts_serverTemplate:[],opts_brokerTemplate:[],deployLoading:!1,nameSrvList:[],brokerList:[],labelPosition:"right",formData:Object(m["b"])(this.rowData),rules:{"nameserverDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"brokerDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"nameserverDeployInfo.configTemplateId":[{required:!0,message:"请选择配置模板",trigger:"change"}],"brokerDeployInfo.configTemplateId":[{required:!0,message:"请选择配置模板",trigger:"change"}],"nameserverDeployInfo.jvmParam":[{required:!0,validator:d["h"],trigger:"change"}],"brokerDeployInfo.jvmParam":[{required:!0,validator:d["h"],trigger:"change"}],"nameserverDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.size":[{required:!0,message:"请输入master实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.replicaPerGroup":[{required:!0,message:"请输入slave实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.dlegerPort":[{required:!0,message:"请输入dlegerPort",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"brokerDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"nameserverDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.nodePort":[{validator:d["f"],trigger:"blur"}],"brokerDeployInfo.nodePorts":[{validator:e,trigger:"blur"}],"nameserverDeployInfo.limitsCpu":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.limitsCpu":[{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.limitsMemory":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.limitsMemory":[{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.requestCpu":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.requestCpu":[{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.requestMemory":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.requestMemory":[{validator:d["d"],trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{"formData.nameserverDeployInfo.jvmParam":function(e){if(e){var t=/^(?=.*-Xms)(?=.*-Xmx)(?=.*-Xmn).*$/,a=t.test(e);if(a){var r=e.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],o=1024*r+1024;this.minNsMemory=o,this.formData.nameserverDeployInfo.limitsMemory=o,this.formData.nameserverDeployInfo.requestMemory=o}}},"formData.brokerDeployInfo.jvmParam":function(e){if(e){var t=/^(?=.*-Xms)(?=.*-Xmx)(?=.*-Xmn).*$/,a=t.test(e);if(a){var r=e.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],o=1024*r+1024;this.minBkMemory=o,this.formData.brokerDeployInfo.limitsMemory=o,this.formData.brokerDeployInfo.requestMemory=o}}}},created:function(){this.getServerConfigTemplate(),this.getBrokerConfigTemplate(),this.getK8sStorageClass(),this.getContainerManage(),this.getContainerImageNs(),this.getContainerImageBk()},mounted:function(){},methods:{clickAction:function(e){switch(e){case"ns":this.formData.nameserverDeployInfo.nodeSelector.push({key:"",value:""});break;case"bk":this.formData.brokerDeployInfo.nodeSelector.push({key:"",value:""})}},clickDelete:function(e,t){e.splice(t,1)},socketStart:function(e){this.socketUrl="/echo?logId=".concat(e.id),this.deployVisible=!0},clickDeployCancel:function(){this.deployVisible=!1,this.$emit("change",!1),this.refresh()},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n["a"])(Object(l["a"])().mark((function t(a){var r,o,n,s,c,p,u,f,d,b,g,y,h,v,D,k,I,w,C;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=41;break}if(r=e.formData.nameserverDeployInfo,o=r.jvmParam,n=r.listenPort,s=r.limitsCpu,c=r.limitsMemory,p=r.requestCpu,u=r.requestMemory,f=e.formData.brokerDeployInfo,d=f.jvmParam,b=f.listenPort,g=f.limitsCpu,y=f.limitsMemory,h=f.requestCpu,v=f.requestMemory,n!==b){t.next=6;break}return e.$message.error("NameSrv端口与broker端口不能相同"),t.abrupt("return",!1);case 6:if(!(s<p)){t.next=9;break}return e.$message.error("NameSrv request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 9:if(!(g<h)){t.next=12;break}return e.$message.error("broker request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 12:if(!(c<u)){t.next=15;break}return e.$message.error("NameSrv request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 15:if(!(y<v)){t.next=18;break}return e.$message.error("broker request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 18:if(!o){t.next=27;break}if(D=o.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],k=1024*D,!(k>=c)){t.next=24;break}return e.$message.error("NameSrv limits-memory须小于运行内存"),t.abrupt("return",!1);case 24:if(!(k>=u)){t.next=27;break}return e.$message.error("NameSrv request-memory须小于运行内存"),t.abrupt("return",!1);case 27:if(!d){t.next=36;break}if(I=d.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],w=1024*I,!(w>=y)){t.next=33;break}return e.$message.error("broker limits-memory须小于运行内存"),t.abrupt("return",!1);case 33:if(!(w>=v)){t.next=36;break}return e.$message.error("broker request-memory须小于运行内存"),t.abrupt("return",!1);case 36:e.loading=!0,C=new m["a"](e.formData).result(),Object(i["d"])(C).then((function(t){200===t.code&&e.$message({type:"success",message:t.msg})})).finally((function(){e.loading=!1})),e.socketStart(e.rowData);case 41:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getContainerImageNs:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var a,r;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["c"])("ROCKETMQ_NAMESERVER").catch((function(e){}));case 2:a=t.sent,r=Object(u["a"])(a,"data",[]),e.opts_imageNs=r.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 7:case"end":return t.stop()}}),t)})))()},getContainerImageBk:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var a,r;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["c"])("ROCKETMQ_BROKER").catch((function(e){}));case 2:a=t.sent,r=Object(u["a"])(a,"data",[]),e.opts_imageBk=r.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerManage:function(){var e=this;Object(s["a"])({agentId:this.rowData.agentId,namespace:this.rowData.namespace}).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_imagePullSecrets=a.map((function(e){return{name:Object(u["a"])(e,"metadata.name")}}))}))},getK8sStorageClass:function(){var e=this;Object(s["e"])({agentId:this.rowData.agentId}).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_storageClass=a.map((function(e){return{label:Object(u["a"])(e,"metadata.name"),value:Object(u["a"])(e,"metadata.name")}}))}))},getServerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_SERVER",componentType:"ROCKETMQ"};Object(c["d"])(t).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_serverTemplate=a.map((function(e){var t=e.content?JSON.parse(e.content):"",a=[];return t&&t.forEach((function(e){var t=e.configKey;a.push("".concat(t,"=").concat(e.configValue))})),{label:e.name,value:a.join("\n")}}))}))},getBrokerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_BROKER",componentType:"ROCKETMQ"};Object(c["d"])(t).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_brokerTemplate=a.map((function(e){var t=e.content?JSON.parse(e.content):"",a=[];return t&&t.forEach((function(e){var t=e.configKey;a.push("".concat(t,"=").concat(e.configValue))})),{label:e.name,value:a.join("\n")}}))}))}}},y=g,h=(a("78be"),a("2877")),v=Object(h["a"])(y,r,o,!1,null,"6a344999",null);t["default"]=v.exports},bf6d:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.totalCount,rowKey:"id",currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,deployMode:"1",refresh:e.getList},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}}):e._e(),e.showInstancesDialog?t("InstancesTable",{attrs:{rowData:e.instancesData,refresh:e.getList},model:{value:e.showInstancesDialog,callback:function(t){e.showInstancesDialog=t},expression:"showInstancesDialog"}}):e._e(),e.showContainerDialog?t("DeployPlanContainer",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showContainerDialog,callback:function(t){e.showContainerDialog=t},expression:"showContainerDialog"}}):e._e(),e.showEditClusterDialog?t("EditNamesvrAndBroker",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showEditClusterDialog,callback:function(t){e.showEditClusterDialog=t},expression:"showEditClusterDialog"}}):e._e(),e.showFlexClusterDialog?t("FlexNamesvrAndBroker",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showFlexClusterDialog,callback:function(t){e.showFlexClusterDialog=t},expression:"showFlexClusterDialog"}}):e._e()],1)},o=[],l=a("5530"),n=(a("14d9"),a("d3b7"),a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"150px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"clusterName"}},[t("el-input",{attrs:{placeholder:"请输入名称",maxlength:"30","show-word-limit":"",disabled:e.isEdit},model:{value:e.form.clusterName,callback:function(t){e.$set(e.form,"clusterName","string"===typeof t?t.trim():t)},expression:"form.clusterName"}})],1),t("el-form-item",{attrs:{label:"部署模式",prop:"deployMode"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择部署模式",clearable:"",filterable:"",disabled:""},model:{value:e.form.deployMode,callback:function(t){e.$set(e.form,"deployMode",t)},expression:"form.deployMode"}},e._l(e.dict_deployMode.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"容器代理服务名称",prop:"agentId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择容器代理服务名称",clearable:"",filterable:"",disabled:e.isEdit,"filter-method":e.filterClusterMethod},on:{change:e.getOptionsK8s_namespaces},model:{value:e.form.agentId,callback:function(t){e.$set(e.form,"agentId",t)},expression:"form.agentId"}},e._l(e.clusterK8s_options,(function(e){return t("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"命名空间",prop:"namespace"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择命名空间",clearable:"",filterable:"",disabled:e.isEdit,"filter-method":e.filterNamespaceMethod},model:{value:e.form.namespace,callback:function(t){e.$set(e.form,"namespace",t)},expression:"form.namespace"}},e._l(e.namespaceK8s_options,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.label}})})),1)],1),t("el-form-item",{attrs:{label:"版本",prop:"version"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择版本",disabled:e.isEdit},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}},e._l(e.rocketVersionOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"集群模式",prop:"clusterMode"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择集群模式",disabled:e.isEdit},model:{value:e.form.clusterMode,callback:function(t){e.$set(e.form,"clusterMode",t)},expression:"form.clusterMode"}},e._l(e.clusterModeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"死信保存天数",prop:"deadRetentionDays"}},[t("el-input",{attrs:{placeholder:"请输入死信保存天数",type:"number",min:0,"show-word-limit":""},model:{value:e.form.deadRetentionDays,callback:function(t){e.$set(e.form,"deadRetentionDays",e._n(t))},expression:"form.deadRetentionDays"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),s=[],i=a("c7eb"),c=a("1da1"),m=(a("4de4"),a("7db0"),a("d81d"),a("4e82"),a("b64b"),a("159b"),a("3775")),p=a("a4ed"),u=a("61f7"),f=a("49bb"),d=a("4879"),b=(a("0159"),a("bc59")),g=a("ec41"),y=a("ff51"),h=a("5c8a");function v(e){var t={id:"",clusterMode:"",clusterName:"",version:"",deadRetentionDays:30,deployMode:"1",agentId:"",containerAgentName:"",namespace:""};return e&&Object.keys(t).forEach((function(a){Object(b["a"])(e,a)&&(t[a]=e[a])})),t}var D={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},deployMode:String,refresh:Function},data:function(){return{clusterK8s_options:[],clusterK8s_optionsCopy:[],namespaceK8s_options:[],namespaceK8s_optionsCopy:[],loading:!1,dict_deployMode:d["d"],rocketVersionOptions:f["k"],clusterModeOptions:[{value:"master-slave",label:"master-slave"},{value:"dleger",label:"dledger"}],labelPosition:"right",form:v(),rules:{clusterMode:[{required:!0,message:"请选择集群模式",trigger:"change"}],clusterName:[{required:!0,message:"请输入名称",trigger:"blur"},{validator:u["b"],trigger:"blur"}],version:[{required:!0,message:"请选择版本",trigger:"change"}],agentId:[{required:!0,message:"请选择容器代理服务名称",trigger:"change"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],deadRetentionDays:[{required:!0,message:"请输入死信保存天数",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)},containerAgentName:function(){var e=this,t=this.clusterK8s_options.find((function(t){return t.id===e.form.agentId}));return null===t||void 0===t?void 0:t.clusterName}},watch:{"form.agentId":function(e){e||(this.clusterK8s_options=this.clusterK8s_optionsCopy)},"form.namespace":function(e){e||(this.namespaceK8s_options=this.namespaceK8s_optionsCopy)}},created:function(){},mounted:function(){this.form.deployMode=this.deployMode,this.isEdit&&(this.form=v(this.rowData),this.getOptionsK8s_namespaces()),this.getOptionsK8s_cluster()},methods:{filterClusterMethod:function(e){this.form.agentId=e,this.clusterK8s_options=e?this.clusterK8s_optionsCopy.filter((function(t){if(~t.clusterName.indexOf(e)||~t.clusterName.toUpperCase().indexOf(e.toUpperCase()))return!0})).sort((function(t,a){var r=t.clusterName.indexOf(e),o=a.clusterName.indexOf(e);return r-o})):this.clusterK8s_optionsCopy},filterNamespaceMethod:function(e){this.form.namespace=e,this.namespaceK8s_options=e?this.namespaceK8s_optionsCopy.filter((function(t){if(~t.label.indexOf(e)||~t.label.toUpperCase().indexOf(e.toUpperCase()))return!0})).sort((function(t,a){var r=t.label.indexOf(e),o=a.label.indexOf(e);return r-o})):this.namespaceK8s_optionsCopy},getOptionsK8s_cluster:function(){var e=this;Object(p["g"])({agentType:this.form.deployMode}).then((function(t){var a=Object(g["a"])(t,"data"),r=Object(y["a"])(a)?a:[];e.clusterK8s_options=r,e.clusterK8s_optionsCopy=r}))},getOptionsK8s_namespaces:function(){var e=this;Object(p["d"])({agentId:this.form.agentId}).then((function(t){var a=Object(g["a"])(t,"data.items"),r=a.map((function(e){var t=Object(g["a"])(e,"metadata.name");return{label:t}}));e.namespaceK8s_options=r,e.namespaceK8s_optionsCopy=r}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(c["a"])(Object(i["a"])().mark((function t(a){var r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(r=Object(h["a"])(e.form),r.containerAgentName=e.containerAgentName,e.loading=!0,e.isEdit?Object(m["q"])(r).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})):(delete r.id,Object(m["g"])(r).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},k=D,I=(a("e424"),a("2877")),w=Object(I["a"])(k,n,s,!1,null,"3f5e7074",null),C=w.exports,_=a("931e"),x=a("c575"),P=a("b8fc"),S=a("35c4"),M=a("98c7"),O={filters:{},components:{AddAndEdit:C,InstancesTable:S["default"],DeployPlanContainer:_["default"],EditNamesvrAndBroker:x["default"],FlexNamesvrAndBroker:P["default"]},computed:{},data:function(){this.$createElement;return{showInstancesDialog:!1,showFlexClusterDialog:!1,showEditClusterDialog:!1,showContainerDialog:!1,dict_deployMode:d["d"],instancesData:{},deployVisible:!1,buttonList:[{label:"新增",type:"add",click:this.addInfo,btnPermCode:"add"}],showACLDialog:!1,showDialog:!1,rowData:null,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},columns:[{prop:"clusterName",label:"名称",align:"center"},{prop:"containerAgentName",label:"容器代理服务名称",align:"center"},{prop:"namespace",label:"命名空间",align:"center"},{prop:"version",label:"版本",align:"center"},{prop:"clusterState",label:"部署状态",align:"center",format:function(e){return Object(f["g"])(e,"dict_containerStatus")}},{prop:"clusterMode",label:"集群模式",render:function(e,t){var a=t.row;return e("span",["dleger"==a.clusterMode?"dledger模式":"主从模式"])}}],operate:{width:270,align:"left",columnAlign:"left",list:[{label:"节点管理",id:"manage",btnPermCode:"config"},{label:"一键部署",id:"fast_deploy",btnPermCode:"import",isShow:function(e){return"0"===e.clusterState}},{label:"nameserver配置修改",id:"editNamesvr",isShow:function(e){return"1"===e.clusterState}},{label:"broker配置修改",id:"editBroker",isShow:function(e){return"1"===e.clusterState}},{label:"nameserver扩缩容",id:"flexNamesvr",isShow:function(e){return"1"===e.clusterState}},{label:"broker扩缩容",id:"flexBroker",isShow:function(e){return"1"===e.clusterState}},{label:"编辑",id:"edit",btnPermCode:"edit"},{label:"删除",id:"delete",btnPermCode:"config"}]}},searchConfig:{searchData:{clusterName:""},searchItem:[{type:"input",label:"名称",prop:"clusterName"}],rules:{}}}},created:function(){},mounted:function(){this.getList()},watch:{},methods:{getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(l["a"])({deployMode:"1"},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(m["p"])(t).then((function(t){var a,r=Object(g["a"])(t,"data.data");e.tableConfig.tableData=Object(y["a"])(r)?r:[],e.tableConfig.pagination.totalCount=null!==(a=Object(g["a"])(t,"data.totalCount"))&&void 0!==a?a:0})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.showDialog=!0,this.rowData=null},onSearch:function(){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},deleteCluster:function(e){var t=this;Object(M["a"])(e).then((function(a){if(Object(y["a"])(null===a||void 0===a?void 0:a.data)&&a.data.length>0){var r=Object(g["a"])(a,"data");t.showInstancesDialog=!0,t.instancesData={clusterId:e,instancesData:r}}else t.$message.success("删除成功"),t.getList()})).catch((function(e){}))},getIndex:function(e){var t=this,a=(e.index,e.row),r=e.operate;"delete"===r.id?this.$confirm("确定要删除【".concat(a.clusterName,"】吗?"),{type:"warning"}).then((function(){t.deleteCluster(a.id)})).catch((function(e){})):"edit"===r.id?(this.rowData=a,this.showDialog=!0):"manage"===r.id?this.toPage(a):"manage2"===r.id?this.toPage2(a):"fast_deploy"===r.id?this.fast_deploy(a):"editNamesvr"===r.id?(this.showEditClusterDialog=!0,this.rowData=Object(l["a"])(Object(l["a"])({},a),{},{clusterType:"nameserver"})):"editBroker"===r.id?(this.showEditClusterDialog=!0,this.rowData=Object(l["a"])(Object(l["a"])({},a),{},{clusterType:"broker"})):"flexNamesvr"===r.id?(this.showFlexClusterDialog=!0,this.rowData=Object(l["a"])(Object(l["a"])({},a),{},{clusterType:"nameserver"})):"flexBroker"===r.id&&(this.showFlexClusterDialog=!0,this.rowData=Object(l["a"])(Object(l["a"])({},a),{},{clusterType:"broker"}))},fast_deploy:function(e){this.rowData=e,this.showContainerDialog=!0},toTopic:function(){this.$router.push({path:"/clusterManagement/cluster/topicManagement"})},toPage2:function(e){this.$router.push({path:"/rocketmq/clusterManagement/rocketmq-node-manage2",query:{rows:e}})},toPage:function(e){this.$router.push({path:"/rocketmq/clusterManagement/rocketmq-node-manage-container",query:{id:e.id,agentId:e.agentId,clusterName:e.clusterName,clusterMode:e.clusterMode,namespace:e.namespace}})}}},j=O,$=Object(I["a"])(j,r,o,!1,null,"4768148c",null);t["default"]=$.exports},bfac:function(e,t,a){"use strict";a("f04c")},c575:function(e,t,a){"use strict";a.r(t);a("b0c0");var r=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"编辑"+e.rowData.clusterType+"集群",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},["nameserver"===e.rowData.clusterType?t("div",[t("header-line",[e._v("NameSrv")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"nameserverDeployInfo.image"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.nameserverDeployInfo.image,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"image",t)},expression:"formData.nameserverDeployInfo.image"}},e._l(e.opts_imageNs,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模板",prop:"nameserverDeployInfo.configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板","value-key":"label"},model:{value:e.formData.nameserverDeployInfo.configTemplateId,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"configTemplateId",t)},expression:"formData.nameserverDeployInfo.configTemplateId"}},e._l(e.opts_serverTemplate,(function(e){return t("el-option",{key:e.label,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行内存",prop:"nameserverDeployInfo.jvmParam"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:e.formData.nameserverDeployInfo.jvmParam,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"jvmParam",t)},expression:"formData.nameserverDeployInfo.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实例数",prop:"nameserverDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.nameserverDeployInfo.size,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"size",e._n(t))},expression:"formData.nameserverDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口",prop:"nameserverDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入端口"},model:{value:e.formData.nameserverDeployInfo.listenPort,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"listenPort",e._n(t))},expression:"formData.nameserverDeployInfo.listenPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"nameserverDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:"",placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.nameserverDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"storageClassName",t)},expression:"formData.nameserverDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"nameserverDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入存储大小"},model:{value:e.formData.nameserverDeployInfo.storage,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"storage",e._n(t))},expression:"formData.nameserverDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.nameserverDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"imagePullPolicy",t)},expression:"formData.nameserverDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.nameserverDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"imagePullSecrets",t)},expression:"formData.nameserverDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.nameserverDeployInfo.serviceType,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"serviceType",t)},expression:"formData.nameserverDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.nameserverDeployInfo.serviceType?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"nodePort",prop:"nameserverDeployInfo.nodePort"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入nodePort"},model:{value:e.formData.nameserverDeployInfo.nodePort,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"nodePort",e._n(t))},expression:"formData.nameserverDeployInfo.nodePort"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.nameserverDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"hostNetwork",t)},expression:"formData.nameserverDeployInfo.hostNetwork"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.nameserverDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:r.key,callback:function(t){e.$set(r,"key",t)},expression:"row.key"}})]}}],null,!1,3247490804)}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"row.value"}})]}}],null,!1,366466804)}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("ns")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(a){var r=a.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.nameserverDeployInfo.nodeSelector,r)}}},[e._v("删除")])]}}],null,!1,3524678912)})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"nameserverDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.nameserverDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"limitsCpu",e._n(t))},expression:"formData.nameserverDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"nameserverDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minNsMemory,placeholder:"请输入memory"},model:{value:e.formData.nameserverDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"limitsMemory",e._n(t))},expression:"formData.nameserverDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"nameserverDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.nameserverDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"requestCpu",e._n(t))},expression:"formData.nameserverDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"nameserverDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minNsMemory,placeholder:"请输入memory"},model:{value:e.formData.nameserverDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"requestMemory",e._n(t))},expression:"formData.nameserverDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1):t("div",[t("header-line",[e._v("broker")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"brokerDeployInfo.image"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.brokerDeployInfo.image,callback:function(t){e.$set(e.formData.brokerDeployInfo,"image",t)},expression:"formData.brokerDeployInfo.image"}},e._l(e.opts_imageBk,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模板",prop:"brokerDeployInfo.configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板","value-key":"label"},model:{value:e.formData.brokerDeployInfo.configTemplateId,callback:function(t){e.$set(e.formData.brokerDeployInfo,"configTemplateId",t)},expression:"formData.brokerDeployInfo.configTemplateId"}},e._l(e.opts_brokerTemplate,(function(e){return t("el-option",{key:e.label,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行内存",prop:"brokerDeployInfo.jvmParam"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:e.formData.brokerDeployInfo.jvmParam,callback:function(t){e.$set(e.formData.brokerDeployInfo,"jvmParam",t)},expression:"formData.brokerDeployInfo.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"master实例数",prop:"brokerDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入master实例数"},model:{value:e.formData.brokerDeployInfo.size,callback:function(t){e.$set(e.formData.brokerDeployInfo,"size",e._n(t))},expression:"formData.brokerDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"slave实例数",prop:"brokerDeployInfo.replicaPerGroup"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入slave实例数"},model:{value:e.formData.brokerDeployInfo.replicaPerGroup,callback:function(t){e.$set(e.formData.brokerDeployInfo,"replicaPerGroup",e._n(t))},expression:"formData.brokerDeployInfo.replicaPerGroup"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口",prop:"brokerDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入端口"},model:{value:e.formData.brokerDeployInfo.listenPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"listenPort",e._n(t))},expression:"formData.brokerDeployInfo.listenPort"}})],1)],1),"dleger"===e.rowData.clusterMode?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"dlegerPort",prop:"brokerDeployInfo.dlegerPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入dlegerPort"},model:{value:e.formData.brokerDeployInfo.dlegerPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"dlegerPort",e._n(t))},expression:"formData.brokerDeployInfo.dlegerPort"}})],1)],1):e._e(),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"brokerDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:"",placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.brokerDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storageClassName",t)},expression:"formData.brokerDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"brokerDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入存储大小"},model:{value:e.formData.brokerDeployInfo.storage,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storage",e._n(t))},expression:"formData.brokerDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.brokerDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullPolicy",t)},expression:"formData.brokerDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.brokerDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullSecrets",t)},expression:"formData.brokerDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.brokerDeployInfo.serviceType,callback:function(t){e.$set(e.formData.brokerDeployInfo,"serviceType",t)},expression:"formData.brokerDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.brokerDeployInfo.serviceType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"外部服务端口",prop:"brokerDeployInfo.nodePorts"}},[t("el-input",{staticStyle:{width:"37%"},attrs:{placeholder:"请输入外部服务端口,多个端口用逗号隔开"},model:{value:e.formData.brokerDeployInfo.nodePorts,callback:function(t){e.$set(e.formData.brokerDeployInfo,"nodePorts",t)},expression:"formData.brokerDeployInfo.nodePorts"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"请确保为每个实例都设置了外部服务端口",type:"warning","show-icon":"",closable:!1}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.brokerDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.brokerDeployInfo,"hostNetwork",t)},expression:"formData.brokerDeployInfo.hostNetwork"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.brokerDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:r.key,callback:function(t){e.$set(r,"key",t)},expression:"row.key"}})]}}])}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"row.value"}})]}}])}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("bk")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(a){var r=a.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.brokerDeployInfo.nodeSelector,r)}}},[e._v("删除")])]}}])})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsCpu",e._n(t))},expression:"formData.brokerDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsMemory",e._n(t))},expression:"formData.brokerDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestCpu",e._n(t))},expression:"formData.brokerDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestMemory",e._n(t))},expression:"formData.brokerDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],l=a("c7eb"),n=a("1da1"),s=(a("99af"),a("7db0"),a("a15b"),a("d81d"),a("14d9"),a("a434"),a("b64b"),a("d3b7"),a("ac1f"),a("00b4"),a("159b"),a("a4ed")),i=a("082f"),c=a("041c"),m=a("49bb"),p=a("98c7"),u=a("ec41"),f=a("ff51"),d=a("61f7"),b=a("957c"),g={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=function(e,t,a){return Object(d["g"])(e,t,a)};return{minNsMemory:2048,minBkMemory:5120,dict_imagePullPolicy:m["d"],opts_imageNs:[],opts_imageBk:[],opts_imagePullSecrets:[],dict_serviceType:m["f"],opts_startupTemplate:m["i"],resultNameSvrJson:null,resultBrokerJson:null,opts_storageClass:[],opts_serverTemplate:[],opts_brokerTemplate:[],loading:!1,labelPosition:"right",formData:Object(c["b"])(this.rowData),rules:{"nameserverDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"brokerDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"nameserverDeployInfo.configTemplateId":[{required:!0,message:"请选择配置模板",trigger:"change"}],"brokerDeployInfo.configTemplateId":[{required:!0,message:"请选择配置模板",trigger:"change"}],"nameserverDeployInfo.jvmParam":[{required:!0,validator:d["h"],trigger:"change"}],"brokerDeployInfo.jvmParam":[{required:!0,validator:d["h"],trigger:"change"}],"nameserverDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.size":[{required:!0,message:"请输入master实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.replicaPerGroup":[{required:!0,message:"请输入slave实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.dlegerPort":[{required:!0,message:"请输入dlegerPort",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"brokerDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"nameserverDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.nodePort":[{validator:d["f"],trigger:"blur"}],"brokerDeployInfo.nodePorts":[{validator:e,trigger:"blur"}],"nameserverDeployInfo.limitsCpu":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.limitsCpu":[{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.limitsMemory":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.limitsMemory":[{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.requestCpu":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.requestCpu":[{validator:d["d"],trigger:"blur"}],"nameserverDeployInfo.requestMemory":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.requestMemory":[{validator:d["d"],trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{"formData.nameserverDeployInfo.jvmParam":function(e){if(e){var t=/^(?=.*-Xms)(?=.*-Xmx)(?=.*-Xmn).*$/,a=t.test(e);if(a){var r=e.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],o=1024*r+1024;this.minNsMemory=o,this.formData.nameserverDeployInfo.limitsMemory=o,this.formData.nameserverDeployInfo.requestMemory=o}}},"formData.brokerDeployInfo.jvmParam":function(e){if(e){var t=/^(?=.*-Xms)(?=.*-Xmx)(?=.*-Xmn).*$/,a=t.test(e);if(a){var r=e.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],o=1024*r+1024;this.minBkMemory=o,this.formData.brokerDeployInfo.limitsMemory=o,this.formData.brokerDeployInfo.requestMemory=o}}}},created:function(){this.getServerConfigTemplate(),this.getBrokerConfigTemplate(),this.getK8sStorageClass(),this.getContainerManage()},mounted:function(){"nameserver"===this.rowData.clusterType?(this.getNameserverById(),this.getContainerImageNs()):(this.getBrokerById(),this.getContainerImageBk())},methods:{clickAction:function(e){switch(e){case"ns":this.formData.nameserverDeployInfo.nodeSelector.push({key:"",value:""});break;case"bk":this.formData.brokerDeployInfo.nodeSelector.push({key:"",value:""})}},clickDelete:function(e,t){e.splice(t,1)},getContainerImageNs:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var a,r;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["c"])("ROCKETMQ_NAMESERVER").catch((function(e){}));case 2:a=t.sent,r=Object(u["a"])(a,"data",[]),e.opts_imageNs=r.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerImageBk:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var a,r;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["c"])("ROCKETMQ_BROKER").catch((function(e){}));case 2:a=t.sent,r=Object(u["a"])(a,"data",[]),e.opts_imageBk=r.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerManage:function(){var e=this;Object(s["a"])({agentId:this.rowData.agentId,namespace:this.rowData.namespace}).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_imagePullSecrets=a.map((function(e){return{name:Object(u["a"])(e,"metadata.name")}}))}))},getNameserverById:function(){var e=this;this.loading=!0,Object(p["g"])(this.rowData.id).then((function(t){var a=null===t||void 0===t?void 0:t.data;e.resultNameSvrJson=a;var r=new c["a"](a).init(e.rowData,a);e.formData.nameserverDeployInfo=r.nameserverDeployInfo;var o=e.opts_serverTemplate.find((function(e){var t;return e.label===(null===(t=r.nameserverDeployInfo.configTemplateId)||void 0===t?void 0:t.label)}));e.formData.nameserverDeployInfo.configTemplateId=o||""})),this.loading=!1},getBrokerById:function(){var e=this;this.loading=!0,Object(p["e"])(this.rowData.id).then((function(t){var a=null===t||void 0===t?void 0:t.data;e.resultBrokerJson=a;var r=new c["a"](a).init(e.rowData,a);e.formData.brokerDeployInfo=r.brokerDeployInfo;var o=e.opts_brokerTemplate.find((function(e){var t;return e.label===(null===(t=r.brokerDeployInfo.configTemplateId)||void 0===t?void 0:t.label)}));e.formData.brokerDeployInfo.configTemplateId=o||""})),this.loading=!1},getK8sStorageClass:function(){var e=this;Object(s["e"])({agentId:this.rowData.agentId}).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_storageClass=a.map((function(e){return{label:Object(u["a"])(e,"metadata.name"),value:Object(u["a"])(e,"metadata.name")}}))}))},getServerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_SERVER",componentType:"ROCKETMQ"};Object(i["d"])(t).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_serverTemplate=a.map((function(e){var t=e.content?JSON.parse(e.content):"",a=[];return t&&t.forEach((function(e){var t=e.configKey;a.push("".concat(t,"=").concat(e.configValue))})),{label:e.name,value:a.join("\n")}}))}))},getBrokerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_BROKER",componentType:"ROCKETMQ"};Object(i["d"])(t).then((function(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_brokerTemplate=a.map((function(e){var t=e.content?JSON.parse(e.content):"",a=[];return t&&t.forEach((function(e){var t=e.configKey;a.push("".concat(t,"=").concat(e.configValue))})),{label:e.name,value:a.join("\n")}}))}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n["a"])(Object(l["a"])().mark((function t(a){var r,o,n,s,i,m,u,f,d,b,g,y,h,v,D,k,I,w;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=43;break}if("nameserver"!==e.rowData.clusterType){t.next=24;break}if(r=e.formData.nameserverDeployInfo,o=r.jvmParam,n=r.limitsCpu,s=r.limitsMemory,i=r.requestCpu,m=r.requestMemory,!(n<i)){t.next=6;break}return e.$message.error("NameSrv request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 6:if(!(s<m)){t.next=9;break}return e.$message.error("NameSrv request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 9:if(!o){t.next=18;break}if(u=o.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],f=1024*u,!(f>=s)){t.next=15;break}return e.$message.error("NameSrv limits-memory须小于运行内存"),t.abrupt("return",!1);case 15:if(!(f>=m)){t.next=18;break}return e.$message.error("NameSrv request-memory须小于运行内存"),t.abrupt("return",!1);case 18:d=new c["a"](e.formData).editNameserverResult(e.resultNameSvrJson),e.loading=!0,Object(p["k"])({clusterId:e.rowData.id,context:d}).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})),t.next=43;break;case 24:if(b=e.formData.brokerDeployInfo,g=b.jvmParam,y=b.limitsCpu,h=b.limitsMemory,v=b.requestCpu,D=b.requestMemory,!(y<v)){t.next=28;break}return e.$message.error("broker request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 28:if(!(h<D)){t.next=31;break}return e.$message.error("broker request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 31:if(!g){t.next=40;break}if(k=g.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],I=1024*k,!(I>=h)){t.next=37;break}return e.$message.error("broker limits-memory须小于运行内存"),t.abrupt("return",!1);case 37:if(!(I>=D)){t.next=40;break}return e.$message.error("broker request-memory须小于运行内存"),t.abrupt("return",!1);case 40:w=new c["a"](e.formData).editBrokerResult(e.resultBrokerJson),e.loading=!0,Object(p["i"])({clusterId:e.rowData.id,context:w}).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}));case 43:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},y=g,h=(a("bfac"),a("2877")),v=Object(h["a"])(y,r,o,!1,null,"85b5e7a0",null);t["default"]=v.exports},c85e:function(e,t,a){},d8df:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,total:e.tableConfig.pagination.totalCount,rowKey:"id",currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,deployMode:"2",refresh:e.getList},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}}):e._e(),e.showACLDialog?t("ACLManagement",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showACLDialog,callback:function(t){e.showACLDialog=t},expression:"showACLDialog"}}):e._e(),e.showInstancesDialog?t("InstancesTable",{attrs:{rowData:e.instancesData,refresh:e.getList},model:{value:e.showInstancesDialog,callback:function(t){e.showInstancesDialog=t},expression:"showInstancesDialog"}}):e._e(),e.showEmployDialog?t("EmployPortDialog",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showEmployDialog,callback:function(t){e.showEmployDialog=t},expression:"showEmployDialog"}}):e._e(),e.showDeploymentDialog?t("el-drawer",{attrs:{title:"部署计划",visible:e.showDeploymentDialog,size:"70%"},on:{"update:visible":function(t){e.showDeploymentDialog=t},close:e.clickDeployCancel}},[t("DeploymentPlan",{ref:"deploymentRef",staticClass:"pl-10 pr-20",staticStyle:{"margin-bottom":"100px"},attrs:{rowData:e.rowData,refresh:e.getList}}),t("span",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickDeployCancel}},[e._v("取消")])],1)],1):e._e(),e.deployVisible?t("el-drawer",{attrs:{title:"部署信息",size:"70%",visible:e.deployVisible},on:{"update:visible":function(t){e.deployVisible=t},close:e.clickCancel}},[t("my-xterm",{ref:"xterm",attrs:{terminal:e.terminal,socketUrl:e.socketUrl}})],1):e._e()],1)},o=[],l=a("5530"),n=(a("99af"),a("d81d"),a("14d9"),a("d3b7"),a("2ca0"),a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"150px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"clusterName"}},[t("el-input",{attrs:{placeholder:"请输入名称",maxlength:"30","show-word-limit":""},model:{value:e.form.clusterName,callback:function(t){e.$set(e.form,"clusterName","string"===typeof t?t.trim():t)},expression:"form.clusterName"}})],1),t("el-form-item",{attrs:{label:"部署模式",prop:"deployMode"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择部署模式",clearable:"",filterable:"",disabled:""},model:{value:e.form.deployMode,callback:function(t){e.$set(e.form,"deployMode",t)},expression:"form.deployMode"}},e._l(e.dict_deployMode.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"版本",prop:"version"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择版本",disabled:e.isEdit},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}},e._l(e.rocketVersionOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"集群模式",prop:"clusterMode"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:e.isEdit,placeholder:"请选择集群模式"},model:{value:e.form.clusterMode,callback:function(t){e.$set(e.form,"clusterMode",t)},expression:"form.clusterMode"}},e._l(e.clusterModeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"省、市",prop:"cityId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:e.isEdit,placeholder:"请选择省、市"},on:{change:e.changeCity},model:{value:e.form.cityId,callback:function(t){e.$set(e.form,"cityId",t)},expression:"form.cityId"}},e._l(e.csMixCity,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"数据中心",prop:"machineRoomId"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:e.isEdit,placeholder:"请选择数据中心"},on:{change:e.changemachineGroup},model:{value:e.form.machineRoomId,callback:function(t){e.$set(e.form,"machineRoomId",t)},expression:"form.machineRoomId"}},e._l(e.csMixMachineRoom,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"机器信息",prop:"machineGroup"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择机器信息",multiple:"",filterable:""},model:{value:e.form.machineInfo,callback:function(t){e.$set(e.form,"machineInfo",t)},expression:"form.machineInfo"}},e._l(e.clusterMechineOptions,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.hostIp,"(").concat(a.hostSshAccount,")"),value:a.id}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.hostIp))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1)],1),t("el-form-item",{attrs:{label:"死信保存天数",prop:"deadRetentionDays"}},[t("el-input",{attrs:{placeholder:"请输入死信保存天数",type:"number",min:0,"show-word-limit":""},model:{value:e.form.deadRetentionDays,callback:function(t){e.$set(e.form,"deadRetentionDays",e._n(t))},expression:"form.deadRetentionDays"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"clusterRemark"}},[t("el-input",{attrs:{placeholder:"请输入内容",type:"textarea",maxlength:"200","show-word-limit":""},model:{value:e.form.clusterRemark,callback:function(t){e.$set(e.form,"clusterRemark",t)},expression:"form.clusterRemark"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),s=[],i=a("c7eb"),c=a("1da1"),m=(a("a15b"),a("b64b"),a("159b"),a("aa89")),p=a("3775"),u=a("61f7"),f=a("49bb"),d=a("4879"),b=a("1b62"),g=a("ff51"),y=a("8121"),h=a("bc59"),v=a("5c8a"),D=b["a"].CommonSelectCreaterMix;function k(e){var t={id:"",cityId:"",clusterMode:"",clusterName:"",clusterRemark:"",deadRetentionDays:30,get machineGroup(){return Object(g["a"])(this.machineInfo)&&this.machineInfo.length>0?this.machineInfo.join(";"):""},set machineGroup(e){var t=this;if(e&&Object(y["a"])(e)){var a=e.split(";");a.forEach((function(e){""!==(null!==e&&void 0!==e?e:"")&&t.machineInfo.push(e)}))}},machineRoomId:"",machineRoomName:"",version:"",machineInfo:[],description:"",deployMode:"1"};return e&&Object.keys(t).forEach((function(a){Object(h["a"])(e,a)&&(t[a]=e[a])})),t}var I={name:"AddAndEdit",components:{},mixins:[D(["csMixCity","csMixMachineRoom"])],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},deployMode:String,refresh:Function},data:function(){return{loading:!1,dict_deployMode:d["d"],clusterNodeTypeOptions:f["b"],clusterTypeOptions:f["c"],rocketVersionOptions:f["k"],clusterMechineOptions:[],clusterModeOptions:[{value:"master-slave",label:"master-slave"},{value:"dleger",label:"dledger"}],labelPosition:"right",form:k(),rules:{cityId:[{required:!0,message:"请选择地区",trigger:"change"}],clusterMode:[{required:!0,message:"请选择集群模式",trigger:"change"}],clusterName:[{required:!0,message:"请输入名称",trigger:"blur"},{validator:u["e"],trigger:"blur"}],machineGroup:[{required:!0,message:"请选择机器",trigger:"change"}],machineRoomId:[{required:!0,message:"请输入数据中心",trigger:"change"}],version:[{required:!0,message:"请选择版本",trigger:"change"}],deadRetentionDays:[{required:!0,message:"请输入死信保存天数",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.form.deployMode=this.deployMode,this.isEdit&&(this.form=k(this.rowData),this.csRepeatMachineRoom({cityId:this.form.cityId}),this.getClusterMechineGroup())},methods:{changemachineGroup:function(){this.clusterMechineOptions=[],this.form.machineInfo=[],this.getClusterMechineGroup()},getClusterMechineGroup:function(){var e=this,t=this.form.machineRoomId;Object(m["a"])(t).then((function(t){200===t.code&&(e.clusterMechineOptions=t.data)}))},changeCity:function(e){this.form.machineRoomId="",this.csMachineRoom=[],this.csRepeatMachineRoom({cityId:e})},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(c["a"])(Object(i["a"])().mark((function t(a){var r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(r=Object(v["a"])(e.form),delete r.machineInfo,e.loading=!0,e.isEdit?Object(p["q"])(r).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})):(delete r.id,Object(p["g"])(r).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},w=I,C=(a("398e"),a("2877")),_=Object(C["a"])(w,n,s,!1,null,"42b621ce",null),x=_.exports,P=a("4764"),S=a("4b1b"),M=a("35c4"),O=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{loading:e.instancesLoading,title:"节点信息",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,isPage:e.tableConfig.isPage,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,rowKey:"id"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},j=[],$=a("ec41"),N={name:"AddAndEdit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{instancesLoading:!1,tableConfig:{loading:!1,isPage:!1,tableData:[],columns:[{prop:"hostIp",label:"服务器ip",align:"center"},{prop:"serverType",label:"服务类型",align:"center"},{prop:"ports",label:"占用端口号",align:"center",width:400}]}}},watch:{},created:function(){},mounted:function(){this.getMqPortDetail()},methods:{getMqPortDetail:function(){var e=this;this.tableConfig.loading=!0,Object(p["f"])(this.rowData.id).then((function(t){var a=Object($["a"])(t,"data");e.tableConfig.tableData=a})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},clickCancel:function(){this.$emit("change",!1)}}},T=N,q=Object(C["a"])(T,O,j,!1,null,"5c21cfbb",null),R=q.exports,L={filters:{},components:{AddAndEdit:x,ACLManagement:P["default"],DeploymentPlan:S["default"],InstancesTable:M["default"],EmployPortDialog:R},computed:{},data:function(){this.$createElement;return{dict_deployMode:d["d"],instancesData:{},showEmployDialog:!1,showInstancesDialog:!1,showDeploymentDialog:!1,sendParams:null,socketUrl:"",terminal:{pid:1,name:"terminal"},deployVisible:!1,buttonList:[{label:"新增",type:"add",click:this.addInfo,btnPermCode:"add"}],showACLDialog:!1,showDialog:!1,rowData:null,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},columns:[{prop:"clusterName",label:"名称",align:"center"},{prop:"version",label:"版本",align:"center"},{prop:"totalNodes",label:"总节点",align:"center"},{prop:"runTotalNodes",label:"总运行节点",align:"center"},{prop:"namesrvNumber",label:"NameSrv节点数",align:"center",render:function(e,t){var a=t.row;if(a.nodesAddress){var r=a.nodesAddress.split(",");return e("el-tooltip",{attrs:{placement:"right"}},[e("ul",{slot:"content"},[r.map((function(t){return e("li",{class:"mb-10"},[t])}))]),e("span",[a.namesrvNumber])])}}},{prop:"cityName",label:"省、市",align:"center"},{prop:"machineRoomName",label:"数据中心",align:"center"},{prop:"clusterMode",label:"集群模式",render:function(e,t){var a=t.row;return e("span",["dleger"==a.clusterMode?"dledger模式":"主从模式"])}}],operate:{width:220,align:"left",columnAlign:"left",list:[{label:"节点管理",id:"manage",btnPermCode:"config"},{label:"一键部署",id:"fast_deploy",btnPermCode:"import"},{label:"一键停止",id:"fast_stop",btnPermCode:"stop"},{label:"一键启动",id:"fast_start",btnPermCode:"start"},{label:"ACL管理",id:"ACL_manage",btnPermCode:""},{label:"占用端口",id:"employ"},{label:"编辑",id:"edit",btnPermCode:"edit"},{label:"删除",id:"delete",btnPermCode:"config"}]}},searchConfig:{searchData:{clusterName:""},searchItem:[{type:"input",label:"名称",prop:"clusterName"}],rules:{}}}},created:function(){this.getList()},watch:{},methods:{clickConfirm:function(){var e=this;this.$refs.deploymentRef.$refs.formRef.validate((function(t){if(t){var a=e.$refs.deploymentRef.checkAllIpPort();if(!a.isPass)return e.$message.warning(a.message);var r=e.$refs.deploymentRef.form.nameSrvList,o=e.$refs.deploymentRef.form.brokerList,l=r.concat(o);Object(p["j"])(l).then((function(t){200===t.code&&e.$message({type:"success",message:t.msg})})),e.showDeploymentDialog=!1,e.socketStart(e.rowData)}}))},clickDeployCancel:function(){this.showDeploymentDialog=!1},clickCancel:function(){this.deployVisible=!1,this.getList()},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(l["a"])({deployMode:"2"},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(p["p"])(t).then((function(t){var a,r=Object($["a"])(t,"data.data");e.tableConfig.tableData=Object(g["a"])(r)?r:[],e.tableConfig.pagination.totalCount=null!==(a=Object($["a"])(t,"data.totalCount"))&&void 0!==a?a:0})).finally((function(){e.tableConfig.loading=!1}))},addInfo:function(){this.showDialog=!0,this.rowData=null},onSearch:function(){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},deleteCluster:function(e){var t=this;Object(p["d"])(e).then((function(a){if(Object(g["a"])(null===a||void 0===a?void 0:a.data)&&a.data.length>0){var r=Object($["a"])(a,"data");t.showInstancesDialog=!0,t.instancesData={clusterId:e,instancesData:r}}else t.$message.success("删除成功"),t.getList()})).catch((function(e){}))},getIndex:function(e){var t=this,a=(e.index,e.row),r=e.operate;"delete"===r.id?this.$confirm("确定要删除【".concat(a.clusterName,"】吗?"),{type:"warning"}).then((function(){t.deleteCluster(a.id)})).catch((function(e){})):"edit"===r.id?(this.rowData=a,this.showDialog=!0):"manage"===r.id?this.toPage(a):"manage2"===r.id?this.toPage2(a):r.id.startsWith("fast_")?this[r.id](a):"ACL_manage"===r.id?(this.rowData=a,this.showACLDialog=!0):"employ"===r.id&&(this.rowData=a,this.showEmployDialog=!0)},fast_stop:function(e){var t=this;this.$confirm("确定要一键停止【".concat(e.clusterName,"】吗?"),{type:"warning"}).then((function(){t.socketStart(e),Object(p["m"])(e.id).then((function(e){t.$message.success("一键停止成功"),t.getList()})).catch((function(e){}))})).catch((function(e){}))},fast_start:function(e){var t=this;this.$confirm("确定要一键启动【".concat(e.clusterName,"】吗?"),{type:"warning"}).then((function(){t.socketStart(e),Object(p["l"])(e.id).then((function(e){t.$message.success("一键启动成功"),t.getList()})).catch((function(e){}))})).catch((function(e){}))},fast_deploy:function(e){this.rowData=e,this.showDeploymentDialog=!0},socketStart:function(e){this.socketUrl="/echo?logId=".concat(e.id),this.deployVisible=!0},toTopic:function(){this.$router.push({path:"/clusterManagement/cluster/topicManagement"})},toPage2:function(e){this.$router.push({path:"/rocketmq/clusterManagement/rocketmq-node-manage2",query:{rows:e}})},toPage:function(e){this.$router.push({path:"/rocketmq/clusterManagement/rocketmq-node-manage",query:{id:e.id,clusterName:e.clusterName,machineRoomName:e.machineRoomName,clusterMode:e.clusterMode}})}}},E=L,A=Object(C["a"])(E,r,o,!1,null,"4cee5978",null);t["default"]=A.exports},e424:function(e,t,a){"use strict";a("5cc4")},f04c:function(e,t,a){}}]);