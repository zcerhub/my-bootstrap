(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~e9e1fe45"],{"06c3":function(e,t,a){"use strict";a("1b0c")},"0e1e":function(e,t,a){"use strict";a("6348")},"1b0c":function(e,t,a){},2961:function(e,t,a){"use strict";a.r(t);a("b0c0");var o=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{title:"一键部署(容器)",visible:e.show,size:"900px","append-to-body":!0,"close-on-click-modal":!1,loading:e.deployLoading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form ml-10 mr-20",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"集群名称",prop:"name"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入集群名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"redis-cluster镜像",prop:"image"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入redis-cluster镜像"},model:{value:e.formData.image,callback:function(t){e.$set(e.formData,"image",t)},expression:"formData.image"}})],1),t("el-form-item",{attrs:{label:"监控镜像",prop:"monitormage"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入监控镜像"},model:{value:e.formData.monitormage,callback:function(t){e.$set(e.formData,"monitormage",t)},expression:"formData.monitormage"}})],1),t("el-form-item",{attrs:{label:"predixy镜像",prop:"proxyimage"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入predixy镜像"},model:{value:e.formData.proxyimage,callback:function(t){e.$set(e.formData,"proxyimage",t)},expression:"formData.proxyimage"}})],1),t("el-form-item",{attrs:{label:"实例数",prop:"size"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.size,callback:function(t){e.$set(e.formData,"size",t)},expression:"formData.size"}})],1),t("el-form-item",{attrs:{label:"storageClass",prop:"storageclass"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入storageClass"},model:{value:e.formData.storageclass,callback:function(t){e.$set(e.formData,"storageclass",t)},expression:"formData.storageclass"}})],1),t("el-form-item",{attrs:{label:"存储大小",prop:"storagesize"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入存储大小"},model:{value:e.formData.storagesize,callback:function(t){e.$set(e.formData,"storagesize",t)},expression:"formData.storagesize"}})],1),t("div",[t("header-line",[e._v("resource")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu",prop:"cpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.nameserverDeployInfo.cpu,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"cpu",e._n(t))},expression:"formData.nameserverDeployInfo.cpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory",prop:"memory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入memory"},model:{value:e.formData.nameserverDeployInfo.memory,callback:function(t){e.$set(e.formData.nameserverDeployInfo,"memory",e._n(t))},expression:"formData.nameserverDeployInfo.memory"}})],1)],1)],1)],1)])],1)],1),t("span",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=a("c7eb"),i=a("1da1"),s=(a("4de4"),a("d81d"),a("14d9"),a("a434"),a("d3b7"),a("a4ed")),l=a("98c7"),c=a("082f"),u=a("d4ec"),d=a("bee2"),p=(a("99af"),a("5c8a")),m=a("bc48"),f=a("ec41");function g(e){return{id:e.id,clusterName:e.clusterName,image:"",version:e.version,clusterMode:e.clusterMode,nameserverDeployInfo:{name:"",image:"",monitorimage:"",proxyimage:"",size:3,storageclass:"",storagesize:2,storageClassName:"",cpu:.2,memory:200},brokerDeployInfo:{configTemplateId:"",size:2,replicaPerGroup:1,listenPort:2222,storageClassName:"",storage:1,hostNetwork:!0,limitsCpu:500,limitsMemory:1024,requestCpu:250,requestMemory:512}}}var h=function(){function e(t){Object(u["a"])(this,e),this.data=Object(p["a"])(t)}return Object(d["a"])(e,[{key:"result",value:function(){var e=this.data,t=e.id,a=(e.clusterName,{clusterId:t,nameserverDeployInfo:this._processNameserver(),brokerDeployInfo:this._processBroker()});return a}},{key:"_processNameserver",value:function(){var e=this.data,t=(e.clusterName,e.nameserverDeployInfo),a=e.version,o=t.name,r=t.image,n=t.monitorimage,i=t.proxyimage,s=t.size,l=t.storageclass,c=t.storagesize,u=t.cpu,d=t.memory,p={apiVersion:"cache.tongdun.net/v1alpha1",kind:"RedisCluster",metadata:{name:o+"-nameserver"},spec:{app:o+"-nameserver",capacity:capacity,dc:dc,env:env,image:"".concat(r,"/redis/redis-cluster:").concat(a),monitorimage:"".concat(n,"/redis/redis-exporter:").concat(a),netmode:netmode,proxyimage:"".concat(i,"/redis/predixy:").concat(a),proxysecret:proxysecret,realname:realname,secret:secret,size:s,storageclass:l,storagesize:c,cpu:u,memory:d,vip:vip}};return p}},{key:"_processBroker",value:function(){var e=this.data,t=e.clusterName,a=e.brokerDeployInfo,o=e.image,r=e.version,n=e.clusterMode,i=a.configTemplateId,s=a.size,l=a.listenPort,c=a.storageClassName,u=a.storage,d=a.hostNetwork,p=a.limitsCpu,m=a.limitsMemory,f=a.requestCpu,g=a.requestMemory,h=a.replicaPerGroup,b={apiVersion:"rocketmq.gientech.io/v1alpha1",kind:"Broker",metadata:{name:t+"-broker"},spec:{nameServers:"",config:i,hostNetwork:d,size:s,image:"".concat(o,"/rocketmq/rocketmq-broker:").concat(r),listenPort:l,replicaPerGroup:h,clusterMode:n,imagePullPolicy:"",resources:{requests:{memory:g+"Mi",cpu:f+"m"},limits:{memory:m+"Mi",cpu:p+"m"}},volumeClaimTemplate:{spec:{storageClassName:c,accessModes:["ReadWriteOnce"],resources:{requests:{storage:u+"Gi"}}}}}};return b}},{key:"editBrokerResult",value:function(e){var t=this.data.brokerDeployInfo,a=t.configTemplateId,o=t.size,r=t.listenPort,n=t.storageClassName,i=t.storage,s=t.hostNetwork,l=t.limitsCpu,c=t.limitsMemory,u=t.requestCpu,d=t.requestMemory,p=t.replicaPerGroup;return Object(m["a"])(e,"spec.config",a),Object(m["a"])(e,"spec.hostNetwork",s),Object(m["a"])(e,"spec.size",o),Object(m["a"])(e,"spec.replicaPerGroup",p),Object(m["a"])(e,"spec.listenPort",r),Object(m["a"])(e,"spec.resources.requests.memory",d+"Mi"),Object(m["a"])(e,"spec.resources.requests.cpu",u+"m"),Object(m["a"])(e,"spec.resources.limits.memory",c+"Mi"),Object(m["a"])(e,"spec.resources.limits.cpu",l+"m"),Object(m["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage",i+"Gi"),Object(m["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName",n),e}},{key:"editNameserverResult",value:function(e){var t=this.data.nameserverDeployInfo,a=t.configTemplateId,o=t.size,r=t.listenPort,n=t.storageClassName,i=t.storage,s=t.hostNetwork,l=t.limitsCpu,c=t.limitsMemory,u=t.requestCpu,d=t.requestMemory;return Object(m["a"])(e,"spec.config",a),Object(m["a"])(e,"spec.hostNetwork",s),Object(m["a"])(e,"spec.size",o),Object(m["a"])(e,"spec.listenPort",r),Object(m["a"])(e,"spec.resources.requests.memory",d+"Mi"),Object(m["a"])(e,"spec.resources.requests.cpu",u+"m"),Object(m["a"])(e,"spec.resources.limits.memory",c+"Mi"),Object(m["a"])(e,"spec.resources.limits.cpu",l+"m"),Object(m["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage",i+"Gi"),Object(m["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName",n),e}},{key:"init",value:function(e){var t=g(e);return t.brokerDeployInfo=this._matchBroker(),t.nameserverDeployInfo=this._matchNameserver(t),t}},{key:"_matchNameserver",value:function(e){var t=this.data;e.name=Object(f["a"])(t,"metadata.name");var a=Object(f["a"])(t,"spec.size"),o=Object(f["a"])(t,"spec.image"),r=Object(f["a"])(t,"spec.monitorimage"),n=Object(f["a"])(t,"spec.proxyimage"),i=Object(f["a"])(t,"spec.storageclass"),s=Object(f["a"])(t,"spec.storagesize"),l=Object(f["a"])(t,"spec.cpu"),c=Object(f["a"])(t,"spec.memory");return{name:name,image:o,monitorimage:r,proxyimage:n,size:a,storageclass:i,storagesize:s,cpu:l,memory:c}}},{key:"_matchBroker",value:function(){var e=this.data,t=Object(f["a"])(e,"spec.config"),a=Object(f["a"])(e,"spec.size"),o=Object(f["a"])(e,"spec.listenPort"),r=Object(f["a"])(e,"spec.hostNetwork",!1),n=Object(f["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage"),i=Object(f["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName"),s=Object(f["a"])(e,"spec.resources.limits.cpu"),l=Object(f["a"])(e,"spec.resources.limits.memory"),c=Object(f["a"])(e,"spec.resources.requests.cpu"),u=Object(f["a"])(e,"spec.resources.requests.memory"),d=Object(f["a"])(e,"spec.replicaPerGroup");return{configTemplateId:t,size:a,replicaPerGroup:d,listenPort:o,hostNetwork:r,storage:n.split("Gi")[0],storageClassName:i,limitsCpu:s.split("m")[0],limitsMemory:l.split("Mi")[0],requestCpu:c.split("m")[0],requestMemory:u.split("Mi")[0]}}}])}(),b=a("ff51"),v={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{opts_storageClass:[],opts_serverTemplate:[],opts_brokerTemplate:[],deployLoading:!1,nameSrvList:[],brokerList:[],labelPosition:"right",formData:g(this.rowData),rules:{"nameserverDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"}],"brokerDeployInfo.size":[{required:!0,message:"请输入master实例数",trigger:"blur"}],"brokerDeployInfo.replicaPerGroup":[{required:!0,message:"请输入slave实例数",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){this.getServerConfigTemplate(),this.getBrokerConfigTemplate(),this.getK8sStorageClass()},mounted:function(){this.isEdit},methods:{clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(i["a"])(Object(n["a"])().mark((function t(a){var o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&(e.loading=!0,o=new h(e.formData).result(),Object(l["d"])(o).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getK8sStorageClass:function(){var e=this;this.opts_storageClass=[],Object(s["e"])({agentId:this.rowData.agentId}).then((function(t){var a=Object(b["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_storageClass=a.map((function(e){return{label:Object(f["a"])(e,"metadata.name"),value:Object(f["a"])(e,"metadata.name")}}))}))},getServerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_SERVER",componentType:"MQ"};this.opts_serverTemplate=[],Object(c["c"])(t).then((function(t){e.opts_serverTemplate=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},getBrokerConfigTemplate:function(){var e=this,t={moduleType:"ROCKRTMQ_NAME_BROKER",componentType:"MQ"};this.opts_brokerTemplate=[],Object(c["c"])(t).then((function(t){e.opts_brokerTemplate=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},changeMachine:function(e,t){var a=Object(f["a"])(e,"path","");this.$set(t,"deployPath",a)},getDeployplanById:function(){var e=this;this.deployLoading=!0,Object(l["d"])({clusterId:this.rowData.id}).then((function(t){var a=Object(f["a"])(t,"data");e.nameSrvList=a.filter((function(e){return"RocketMQ_NameSrv"===e.instanceType})),e.brokerList=a.filter((function(e){return"RocketMQ_Dleger"===e.instanceType||"RocketMQ_Broker"===e.instanceType}))})).finally((function(){e.deployLoading=!1}))},delNameSrvNode:function(e,t){this.nameSrvList.splice(t,1)},delDeployNode:function(e,t){e.childList.splice(t,1)},addDeployNode:function(e){var t={machine:"",listenPort:"",deployment:"",configTemplateId:"",instanceName:e.instanceName,instanceType:e.instanceType,clusterId:e.clusterId,role:"slave",childList:null};e.childList||this.$set(e,"childList",[]),e.childList.push(t)},delBrokerNode:function(e){this.brokerList.length<=1?this.$message.error("至少保留一个主节点"):this.brokerList.splice(e,1)}}},y=v,w=(a("06c3"),a("2877")),C=Object(w["a"])(y,o,r,!1,null,"494b61a1",null);t["default"]=C.exports},"2bb1":function(e,t,a){"use strict";a("59a4")},"2d16":function(e,t,a){},3123:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("el-page-header",{staticStyle:{"margin-bottom":"20px"},attrs:{content:"部署记录"},on:{back:e.goBack}}),t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:2,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage}})],1)},r=[],n=a("c7eb"),i=a("5530"),s=a("1da1"),l=a("23a6"),c=a("ec41"),u=a("ff51"),d={name:"deploy-record",components:{},mixins:[],props:{},data:function(){return{buttonList:[],searchConfig:{searchData:{cluster:"",machineIp:""},searchItem:[{prop:"cluster",label:"集群",type:"input"},{prop:"machineIp",label:"机器",type:"input"}],rules:{}},tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"cluster",label:"集群"},{prop:"machineIp",label:"机器ip"},{prop:"machinePort",label:"机器端口"},{prop:"deployStatus",label:"部署状态"},{prop:"deployPath",label:"部署路径"},{prop:"content",label:"内容"},{prop:"detail",label:"详情"},{prop:"createDate",label:"部署时间"}],operate:{width:160,list:[]}},rowData:null}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},getList:function(){var e=this;return Object(s["a"])(Object(n["a"])().mark((function t(){var a,o,r;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableConfig.loading=!0,t.prev=1,a={pageNo:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize,requestObject:Object(i["a"])({componentType:"0"},e.searchConfig.searchData)},t.next=5,Object(l["f"])(a);case 5:o=t.sent,r=Object(c["a"])(o,"data.data"),e.tableConfig.tableData=Object(u["a"])(r)?r:[],e.tableConfig.pagination.totalCount=Object(c["a"])(o,"data.totalCount")||0,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1);case 14:e.tableConfig.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()}}},p=d,m=a("2877"),f=Object(m["a"])(p,o,r,!1,null,"036841bb",null);t["default"]=f.exports},"340c":function(e,t,a){"use strict";a("b9b6")},"380a":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"清空缓存",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-alert",{attrs:{title:"数据清空操作无法撤销,且数据被清空将无法恢复,请谨慎操作",type:"warning","show-icon":"",closable:!1}}),t("el-descriptions",{staticClass:"mt-20",attrs:{column:1,border:"",labelStyle:{width:"100px"}}},[t("el-descriptions-item",{attrs:{label:"集群名称"}},[e._v(e._s(e.rowData.clusterName))]),t("el-descriptions-item",{attrs:{label:"模式"}},[e._v(e._s(e._f("F_cache_clusterTypeOptions")(e.rowData.clusterType)))]),t("el-descriptions-item",{attrs:{label:"集群运行状态"}},[e._v(e._s(e._f("F_cache_clusterRunStatusOptions")(e.rowData.clusterRunStatus)))]),t("el-descriptions-item",{attrs:{label:"总节点数"}},[e._v(e._s(e.rowData.totalNodes))])],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定清空")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=(a("d3b7"),a("3882")),i={name:"dialog-cache-empty",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}}},watch:{},created:function(){},mounted:function(){},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$confirm("确认进行缓存清空吗?",{type:"warning"}).then((function(){e.loading=!0,Object(n["f"])({id:e.rowData.id}).then((function(t){t&&200===t.code&&(e.$message({message:"缓存清空成功",type:"success"}),e.$emit("change",!1))})).finally((function(){e.loading=!1}))}))}}},s=i,l=a("2877"),c=Object(l["a"])(s,o,r,!1,null,"18b86c30",null);t["a"]=c.exports},"3ab8":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"扩缩容",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formRef",staticClass:"cluster-form",attrs:{model:e.formData,rules:e.rules,"label-position":"right","label-width":"120px"}},[t("el-form-item",{attrs:{label:"主节点个数",prop:"size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,precision:0,placeholder:"请输入"},model:{value:e.formData.size,callback:function(t){e.$set(e.formData,"size",e._n(t))},expression:"formData.size"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=a("c7eb"),i=a("1da1"),s=(a("d3b7"),a("ec41")),l=a("f3d0"),c={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{loading:!1,formData:{size:2},rules:{size:[{required:!0,message:"请输入",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)},clusterId:function(){var e;return this.isEdit?null===(e=this.rowData)||void 0===e?void 0:e.id:this.$route.query.id}},watch:{},created:function(){this.getDetail()},mounted:function(){},methods:{getDetail:function(){var e=this;return Object(i["a"])(Object(n["a"])().mark((function t(){var a,o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(l["c"])({clusterId:e.clusterId}).catch((function(e){}));case 3:if(a=t.sent,e.loading=!1,a){t.next=7;break}return t.abrupt("return");case 7:o=null===a||void 0===a?void 0:a.data,e.formData.size=Object(s["a"])(o,"spec.size");case 9:case"end":return t.stop()}}),t)})))()},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;return Object(i["a"])(Object(n["a"])().mark((function t(){var a,o,r;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.formRef,t.next=3,a.validate().catch((function(e){}));case 3:if(o=t.sent,o){t.next=6;break}return t.abrupt("return");case 6:e.loading=!0,r={clusterId:e.clusterId,spec:{size:e.formData.size}},Object(l["d"])(r).then((function(t){e.$message.success("扩容成功"),e.$emit("change",!1),e.refresh()})).finally((function(){e.loading=!1}));case 9:case"end":return t.stop()}}),t)})))()}}},u=c,d=(a("340c"),a("2877")),p=Object(d["a"])(u,o,r,!1,null,"a3c24ae8",null);t["default"]=p.exports},"49ce":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-deploy"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("el-button",{attrs:{type:"primary"},on:{click:e.clickAdd}},[e._v("新增")]),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,operateSlice:2,total:e.tableConfig.pagination.totalCount,rowKey:"id",currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showDialog?t("AddAndEdit",{attrs:{show:e.showDialog,rowData:e.rowData,refresh:e.getList},on:{"update:show":function(t){e.showDialog=t}}}):e._e(),e.showInstancesDialog?t("InstancesTable",{attrs:{rowData:e.instancesData,refresh:e.getList},model:{value:e.showInstancesDialog,callback:function(t){e.showInstancesDialog=t},expression:"showInstancesDialog"}}):e._e(),t("ContainerOneKey",{attrs:{show:e.showContainerDialog,rowData:e.rowData,refresh:e.getList},on:{"update:show":function(t){e.showContainerDialog=t}}}),e.showCapacity?t("ChangeCapacity",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showCapacity,callback:function(t){e.showCapacity=t},expression:"showCapacity"}}):e._e(),e.showModifyPassword?t("ModifyPassword",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showModifyPassword,callback:function(t){e.showModifyPassword=t},expression:"showModifyPassword"}}):e._e(),e.showCacheEmpty?t("DialogCacheEmpty",{attrs:{rowData:e.rowData},model:{value:e.showCacheEmpty,callback:function(t){e.showCacheEmpty=t},expression:"showCacheEmpty"}}):e._e()],1)},r=[],n=a("5530"),i=(a("d81d"),a("14d9"),a("d3b7"),a("3ca3"),a("ddb0"),a("498a"),function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("el-dialog-limit",{attrs:{title:a.isEdit?"编辑":"新增",visible:a.props.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:a.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:a.loadingConfirm,expression:"loadingConfirm"}],ref:"formRef",staticClass:"cluster-form",attrs:{"label-width":"150px",model:a.formData,rules:a.rules,"label-position":"right"}},[t("el-form-item",{attrs:{label:"名称",prop:"clusterName"}},[t("el-input",{attrs:{disabled:a.isEdit,placeholder:"请输入名称",maxlength:"30","show-word-limit":""},model:{value:a.formData.clusterName,callback:function(t){e.$set(a.formData,"clusterName","string"===typeof t?t.trim():t)},expression:"formData.clusterName"}})],1),t("el-form-item",{attrs:{label:"容器代理服务名称",prop:"containerAgentId"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.containerAllLoading,placeholder:a.containerAllLoading?"查询中...":"请选择",disabled:a.isEdit,clearable:"",filterable:"","filter-method":a.filterContainerMethod},on:{change:a.changeAgentId,clear:a.filterContainerMethod},model:{value:a.formData.containerAgentId,callback:function(t){e.$set(a.formData,"containerAgentId",t)},expression:"formData.containerAgentId"}},e._l(a.containerOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"命名空间",prop:"namespace"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.k8sNamespaceLoading,placeholder:a.k8sNamespaceLoading?"查询中...":"请选择",disabled:a.isEdit,"filter-method":a.filterNsMethod,clearable:"",filterable:""},on:{clear:a.filterNsMethod},model:{value:a.formData.namespace,callback:function(t){e.$set(a.formData,"namespace",t)},expression:"formData.namespace"}},e._l(a.namespaceOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.label}})})),1)],1),t("el-form-item",{attrs:{label:"集群类型",prop:"clusterType"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:a.isEdit,placeholder:"请选择"},model:{value:a.formData.clusterType,callback:function(t){e.$set(a.formData,"clusterType",t)},expression:"formData.clusterType"}},[t("el-option",{attrs:{label:"集群模式",value:0}})],1)],1),t("el-form-item",{attrs:{label:"组织",prop:"orgId"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.orgLoading,placeholder:a.orgLoading?"查询中...":"请选择",clearable:"",filterable:""},on:{change:a.changeOrg},model:{value:a.formData.orgId,callback:function(t){e.$set(a.formData,"orgId",t)},expression:"formData.orgId"}},e._l(a.orgOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.organizationName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"省、市",prop:"cityId"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.cityLoading,placeholder:a.cityLoading?"查询中...":"请选择",clearable:"",filterable:""},on:{change:a.changeCity},model:{value:a.formData.cityId,callback:function(t){e.$set(a.formData,"cityId",t)},expression:"formData.cityId"}},e._l(a.cityOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.cityName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"数据中心",prop:"machineRoomId"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.centerLoading,placeholder:a.centerLoading?"查询中...":"请选择",clearable:"",filterable:""},model:{value:a.formData.machineRoomId,callback:function(t){e.$set(a.formData,"machineRoomId",t)},expression:"formData.machineRoomId"}},e._l(a.centerOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.machineRoomName,value:e.id}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:a.loadingConfirm},on:{click:a.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:a.clickCancel}},[e._v("取消")])],1)],1)}),s=[],l=a("c7eb"),c=a("1da1"),u=a("3835"),d=(a("4de4"),a("7db0"),a("4e82"),a("4ec9"),a("b64b"),a("6062"),a("0eb6"),a("b7ef"),a("8bd4"),a("ad1f"),a("4879")),p=a("ec41"),m=a("5c96"),f=a("fc9b"),g=a("2b0e"),h=a("3882"),b=(a("61f7"),a("65ae")),v={__name:"AddAndEdit",props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},emits:["update:show"],setup:function(e,t){var a=t.emit,o=e,r=Object(g["ref"])(!1),i=new b["c"],s=i.orgFetch,v=i.orgOptions,y=i.orgLoading,w=new b["a"],C=w.centerFetch,D=w.centerLoading,k=w.centerOptions,O=new b["b"],I=O.cityFetch,x=O.cityLoading,j=O.cityOptions,_=new f["a"],M=_.containerAllLoading,N=_.containerAllOptions,S=_.containerAllFetch,P=new f["d"],$=P.k8sNamespaceLoading,z=P.k8sNamespaceOptions,R=P.k8sNamespaceFetch,L=function(e){e?R({agentId:e}):N.value=[]},T=Object(g["ref"])(N),q=Object(g["ref"])(T.value),E=Object(g["ref"])(z),A=Object(g["ref"])(E.value),F=Object(g["computed"])((function(){var e;return Boolean(null===(e=o.rowData)||void 0===e?void 0:e.id)})),B=Object(g["reactive"])({id:void 0,containerAgentId:void 0,clusterName:void 0,k8sClusterName:void 0,clusterType:0,namespace:void 0,deployMode:d["a"],orgId:"",cityId:"",machineRoomId:""});Object(g["onMounted"])((function(){if(S({agentType:"3"}),s(),I(),F.value){var e=o.rowData,t=e.id,a=e.clusterName,r=e.containerAgentId,n=e.deployMode,i=e.clusterType,l=e.k8sClusterName;B.id=t,B.clusterName=a,B.containerAgentId=r,B.deployMode=n,B.clusterType=i,B.k8sClusterName=l,B.namespace=Object(p["a"])(o.rowData,"namespace"),B.orgId=Object(p["a"])(o.rowData,"orgId"),B.cityId=Object(p["a"])(o.rowData,"cityId"),B.machineRoomId=Object(p["a"])(o.rowData,"machineRoomId"),L(r)}})),Object(g["watch"])([function(){return B.cityId},function(){return B.orgId},function(){return N},function(){return z}],(function(e){var t=Object(u["a"])(e,4),a=t[0],o=t[1],r=t[2],n=t[3];a&&o?C({cityId:a,orgId:o}):k.value=[],q.value=r.value,A.value=n.value}),{immediate:!0});var V=function(){B.machineRoomId=""},K=function(){B.machineRoomId=""},G=function(e){0==q.value.length&&(q.value=structuredClone(T.value));var t=q.value;B.containerAgentId=e,T.value=e?t.filter((function(t){if(~t.clusterName.indexOf(e)||~t.clusterName.toUpperCase().indexOf(e.toUpperCase()))return!0})).sort((function(t,a){var o=t.clusterName.indexOf(e),r=a.clusterName.indexOf(e);return o-r})):q.value},W=function(e){0==A.value.length&&(A.value=structuredClone(E.value));var t=A.value;B.namespace=e,E.value=e?t.filter((function(t){if(~t.label.indexOf(e)||~t.label.toUpperCase().indexOf(e.toUpperCase()))return!0})).sort((function(t,a){var o=t.label.indexOf(e),r=a.label.indexOf(e);return o-r})):A.value},Q={clusterName:[{required:!0,message:"请输入名称",trigger:"blur"},{pattern:/^[a-z][a-z0-9-]*$/,trigger:"change",message:"只能包含小写字母、数字、中划线-，且不能以数字开头"}],containerAgentId:[{required:!0,message:"请选择容器代理服务名称",trigger:"change"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],clusterType:[{required:!0,message:"请选择集群模式",trigger:"change"}],cityId:[{required:!0,message:"请选择省、市",trigger:"change"}],orgId:[{required:!0,message:"请选择组织",trigger:"change"}],machineRoomId:[{required:!0,message:"请选择数据中心",trigger:"change"}]},U=function(){a("update:show",!1)},H=Object(g["ref"])(),J=Object(g["computed"])((function(){var e=N.value.find((function(e){return B.containerAgentId===e.id}));if(e)return e.clusterName})),X=function(){var e=Object(c["a"])(Object(l["a"])().mark((function e(){var t,a,r,i,s;return Object(l["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,null===(t=H.value)||void 0===t?void 0:t.validate().catch((function(e){}));case 2:if(a=e.sent,a){e.next=5;break}return e.abrupt("return");case 5:if(r=Object(n["a"])(Object(n["a"])({},B),{},{k8sClusterName:J.value}),!F.value){e.next=12;break}return e.next=9,Object(h["v"])(r);case 9:return i=e.sent,i&&(m["Message"].success("编辑成功"),o.refresh(),U()),e.abrupt("return");case 12:return e.next=14,Object(h["c"])(r);case 14:s=e.sent,s&&(m["Message"].success("新增成功"),o.refresh(),U());case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{__sfc:!0,props:o,loadingConfirm:r,emit:a,orgFetch:s,orgOptions:v,orgLoading:y,centerFetch:C,centerLoading:D,centerOptions:k,cityFetch:I,cityLoading:x,cityOptions:j,containerAllLoading:M,containerAllOptions:N,containerAllFetch:S,k8sNamespaceLoading:$,k8sNamespaceOptions:z,k8sNamespaceFetch:R,changeAgentId:L,containerOptions:T,filterContainer:q,namespaceOptions:E,filterNamespace:A,isEdit:F,formData:B,changeOrg:V,changeCity:K,filterContainerMethod:G,filterNsMethod:W,rules:Q,clickCancel:U,formRef:H,K8sClusterName:J,clickConfirm:X}}},y=v,w=(a("aa64"),a("2877")),C=Object(w["a"])(y,i,s,!1,null,"c5c252a4",null),D=C.exports,k=a("3ab8"),O=a("5093"),I=a("ff51"),x=a("f3d0"),j=a("a349"),_=a("9959"),M=a("380a"),N="1",S="2",P="1",$={filters:{},components:{AddAndEdit:D,InstancesTable:O["default"],ChangeCapacity:k["default"],ContainerOneKey:_["default"],ModifyPassword:function(){return Promise.resolve().then(a.bind(null,"62ff"))},DialogCacheEmpty:M["a"]},computed:{},data:function(){var e=this;this.$createElement;return{showCacheEmpty:!1,showInstancesDialog:!1,showCapacity:!1,showContainerDialog:!1,instancesData:{},showDialog:!1,showModifyPassword:!1,rowData:null,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},columns:[{prop:"clusterName",label:"名称"},{prop:"namespace",label:"命名空间"},{prop:"redisVersion",label:"版本"},{label:"容器集群名称",prop:"containerClusterName"},{prop:"containerAgentName",label:"容器代理服务名称"},{prop:"clusterType",label:"集群类型",format:function(e){return"0"==e?"集群模式":e}},{prop:"nodes",label:"节点信息",render:function(t,a){var o=a.row;if(2===o.clusterRunStatus||!o.nodes)return t("span");var r=o.nodes.split(",");return t("el-tooltip",{attrs:{placement:"right"}},[t("ul",{slot:"content"},[r.map((function(e){return t("li",{class:"mb-10"},[e])}))]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickCopy(o.nodes)}}},["复制"])])}},{prop:"clusterRunStatus",label:"集群状态",render:function(e,t){var a=t.row,o=j["b"].getItem(a.clusterRunStatus);return o?e("hubaryDot",{attrs:{text:o.label,status:o.status}}):e("span",[a.clusterRunStatus])}}],operate:{width:250,list:[{label:"一键部署",id:"fast_deploy",btnPermCode:"import",isShow:function(e){return e.clusterRunStatus!=P}},{label:"节点管理",id:"manage",isShow:function(e){return e.clusterRunStatus!=S}},{label:"编辑",id:"edit",btnPermCode:"edit"},{label:"部署配置",id:"deploy_config",btnPermCode:"import",isShow:function(e){return e.clusterRunStatus==P}},{label:"扩缩容",id:"change_capacity",isShow:function(e){return e.clusterRunStatus==P}},{label:"修改密码",id:"modify_paasword"},{label:"清空缓存",id:"empty_cache",isShow:function(e){return 1!==e.clusterType}},{label:"删除",id:"delete",btnPermCode:"config"}]}},searchConfig:{searchData:{clusterName:void 0},searchItem:[{type:"input",label:"名称",prop:"clusterName"}],rules:{}}}},created:function(){this.getList()},watch:{},methods:{getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(n["a"])({deployMode:N},this.searchConfig.searchData)};this.tableConfig.loading=!0,Object(h["o"])(t).then((function(t){var a=Object(p["a"])(t,"data.data");e.tableConfig.tableData=Object(I["a"])(a)?a:[],e.tableConfig.pagination.totalCount=Object(p["a"])(t,"data.totalCount",0)})).finally((function(){e.tableConfig.loading=!1}))},clickAdd:function(){this.showDialog=!0,this.rowData=null},onSearch:function(){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},deleteCluster:function(e){var t=this;Object(x["b"])({clusterId:e}).then((function(a){if(Object(I["a"])(null===a||void 0===a?void 0:a.data)&&a.data.length>0){var o=Object(p["a"])(a,"data");t.showInstancesDialog=!0,t.instancesData={clusterId:e,instancesData:o}}else t.$message.success("删除成功"),t.getList()})).catch((function(e){}))},getIndex:function(e){var t=this,a=(e.index,e.row),o=e.operate;switch(o.id){case"delete":this.$confirm("确定要删除【".concat(a.clusterName,"】吗?"),{type:"warning"}).then((function(){t.deleteCluster(a.id)})).catch((function(e){}));break;case"edit":this.rowData=a,this.showDialog=!0;break;case"manage":this.toPage(a);break;case"fast_deploy":case"deploy_config":this.fast_deploy(a);break;case"change_capacity":this.rowData=a,this.showCapacity=!0;break;case"modify_paasword":this.rowData=a,this.showModifyPassword=!0;break;case"empty_cache":this.rowData=a,this.showCacheEmpty=!0;break;default:}},fast_deploy:function(e){this.rowData=e,this.showContainerDialog=!0},toPage:function(e){if(0==e.clusterType){var t="/cacheCluster/cache-node-monitor/mode-cluster";this.$router.push({path:t,query:{id:e.id,clusterType:e.clusterType,deployMode:"1"}})}},clickCopy:function(e){var t=this;this.$copyText(e).then((function(){t.$message.success("复制成功")})).catch((function(e){t.$message.error("复制失败")}))}}},z=$,R=(a("5a61"),Object(w["a"])(z,o,r,!1,null,"4a6791c4",null));t["default"]=R.exports},5093:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{loading:e.instancesLoading,title:"集群存在以下节点数据,确认全部删除?",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("tableView",{ref:"tableView",attrs:{isPage:e.tableConfig.isPage,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,rowKey:"id"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=(a("a15b"),a("d81d"),a("d3b7"),a("3775")),i={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{instancesLoading:!1,tableConfig:{loading:!1,isPage:!1,tableData:[],columns:[{prop:"instanceName",label:"节点名称",align:"center"},{prop:"port",label:"端口",align:"center"}]}}},watch:{},created:function(){},mounted:function(){this.tableConfig.tableData=this.rowData.instancesData},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this,t={clusterId:this.rowData.clusterId,id:this.rowData.instancesData.map((function(e){return e.id})).join(",")};this.instancesLoading=!0,Object(n["e"])(t).then((function(t){e.$message.success(t.data),e.$emit("change",!1),e.refresh()})).finally((function(){e.instancesLoading=!1}))}}},s=i,l=a("2877"),c=Object(l["a"])(s,o,r,!1,null,"5c72472c",null);t["default"]=c.exports},5357:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("comp-table",{ref:"compTable",attrs:{isMultiple:!1,"table-model":e.tableModel,"form-model":e.formModel,loading:e.loading,loadingForm:e.loadingForm,"search-model":e.searchModel},on:{submitHandle:e.clickAdd,editHandle:e.clickEdit,clickRowImport:e.clickRowImport,deleteCluster:e.deleteCluster,toPage:e.toPage,openInit:e.openInit,clickPassword:e.clickPassword,changePage:e.changePage,clickStartOrStop:e.clickStartOrStop,clickEmptyCache:e.clickEmptyCache,openWindow:e.openWindow,"click-edit-row":e.clickEditRow,btnTypeChange:e.btnTypeChange}}),t("ClusterImport",{attrs:{rowData:e.currentRow,csMixMachine:e.csMixMachine,refresh:e.getList},model:{value:e.showImport,callback:function(t){e.showImport=t},expression:"showImport"}}),e.showModifyPassword?t("ModifyPassword",{attrs:{rowData:e.currentRow,refresh:e.getList},model:{value:e.showModifyPassword,callback:function(t){e.showModifyPassword=t},expression:"showModifyPassword"}}):e._e(),e.initShow?t("DialogInit",{attrs:{rowData:e.currentRow,refresh:e.getList},model:{value:e.initShow,callback:function(t){e.initShow=t},expression:"initShow"}}):e._e(),e.openShow?t("OpenDialog",{attrs:{rowData:e.currentRow,refresh:e.getList},model:{value:e.openShow,callback:function(t){e.openShow=t},expression:"openShow"}}):e._e(),e.showCacheEmpty?t("DialogCacheEmpty",{attrs:{rowData:e.currentRow},model:{value:e.showCacheEmpty,callback:function(t){e.showCacheEmpty=t},expression:"showCacheEmpty"}}):e._e()],1)},r=[],n=a("735f"),i=(a("d9e2"),a("7db0"),a("d81d"),a("14d9"),a("d3b7"),a("ac1f"),a("00b4"),a("498a"),a("8b8f")),s=a("62ff"),l=(a("99af"),a("caad"),a("b0c0"),a("2532"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{visible:e.visible,size:"medium","append-to-body":!0,loading:e.loading,"close-on-click-modal":!1,loadingOptions:e.loadingOptions},on:{close:e.clickCancel}},[t("span",{attrs:{slot:"title"},slot:"title"},[e._v("初始化节点("+e._s(e._f("F_cache_clusterTypeOptions")(e.typeModel))+")")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2!==e.typeModel,expression:"typeModel !== 2"}],staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary"},on:{click:e.addtreenode}},[e._v("添加"+e._s(e.typeName))]),e.treeData?t("el-tree",{attrs:{data:e.treeData,props:e.treeProps,"default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(a){var o=a.node,r=a.data;return t("span",{staticClass:"custom-tree-node"},[t("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(o.label))]),t("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择机器",size:"mini",filterable:""},on:{change:function(t){return e.changeIp(t,r)}},model:{value:r.machineId,callback:function(t){e.$set(r,"machineId",t)},expression:"data.machineId"}},e._l(e.csMixMachine,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.label,"(").concat(a.hostSshAccount,")"),value:a.id}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.label))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1),t("span",{staticClass:"ml-5 mr-5"},[e._v(":")]),t("el-input-number",{staticStyle:{width:"110px"},attrs:{size:"mini","controls-position":"right",min:0,max:65535,placeholder:"端口"},model:{value:r.port,callback:function(t){e.$set(r,"port",t)},expression:"data.port"}}),t("el-input",{staticClass:"ml-10",staticStyle:{width:"200px"},attrs:{placeholder:"请输入路径",size:"mini"},model:{value:r.deployPath,callback:function(t){e.$set(r,"deployPath","string"===typeof t?t.trim():t)},expression:"data.deployPath"}}),0===e.typeModel?[t("span",{staticStyle:{"margin-left":"20px"}},[t("el-button",{attrs:{disabled:1===e.treeData.length&&"主"===o.label,type:"text",size:"mini"},on:{click:function(){return e.remove(o,r)}}},[e._v(" 删除 ")]),"主"===o.label?t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.append(r)}}},[e._v(" 添加从 ")]):e._e()],1)]:e._e(),1===e.typeModel?[t("span",{staticStyle:{"margin-left":"20px"}},[t("el-button",{attrs:{disabled:1===e.treeData.length,type:"text",size:"mini"},on:{click:function(){return e.remove(o,r)}}},[e._v(" 删除 ")])],1)]:e._e(),2===e.typeModel?[t("span",{staticStyle:{"margin-left":"20px"}},[t("el-button",{attrs:{disabled:1===e.treeData.length&&"主"===o.label,type:"text",size:"mini"},on:{click:function(){return e.remove(o,r)}}},[e._v(" 删除 ")]),"主"===o.label?t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.append(r)}}},[e._v(" 添加从 ")]):e._e()],1)]:e._e()],2)}}],null,!1,548106999)}):e._e(),1!==e.typeModel?t("el-form",[t("el-row",[t("el-form-item",{attrs:{label:"配置模板"}},[t("el-select",{staticClass:"nameStyle",attrs:{placeholder:"请选择配置模板"},model:{value:e.configTemplateId,callback:function(t){e.configTemplateId=t},expression:"configTemplateId"}},e._l(e.opts_modules,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1):e._e(),1===e.typeModel?t("div",{staticClass:"pl-20 pr-20 pb-20 shaobing-cluster"},[t("div",{staticClass:"pt-10 pb-10"},[e._v("集群:")]),t("el-checkbox-group",{model:{value:e.monitorList,callback:function(t){e.monitorList=t},expression:"monitorList"}},[t("el-form",{ref:"shaobingRef",attrs:{model:e.formData,inline:!0}},[t("el-row",e._l(e.clusterList,(function(a,o){return t("el-col",{key:a.clusterId,staticClass:"mt-10",attrs:{span:24}},[t("el-checkbox",{attrs:{label:a}},[t("span",{staticClass:"mr-20",staticStyle:{"line-height":"28px"}},[e._v(e._s(a.name))])]),e.monitorListIds.includes(a.clusterId)?t("el-form-item",{staticClass:"ml-20",attrs:{label:"主节点别名",prop:"clusterList.".concat(o,".masterName"),rules:[{required:!0,message:"请输入主节点别名",trigger:"blur"},{pattern:/^[0-9a-zA-z]+$/,message:"只能输入数字,字母组合",trigger:"blur"}]}},[t("el-input",{staticClass:"ml-10",attrs:{placeholder:"请输入名称",size:"mini"},model:{value:a.masterName,callback:function(t){e.$set(a,"masterName","string"===typeof t?t.trim():t)},expression:"item.masterName"}})],1):e._e()],1)})),1)],1)],1)],1):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),c=[],u=a("c7eb"),d=a("1da1"),p=(a("c740"),a("a434"),a("3882")),m=a("082f"),f=a("ff51"),g=a("5c8a"),h=a("1b62"),b=h["a"].CommonSelectCreaterMix,v={components:{},mixins:[b("csMixMachine")],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{configTemplateId:"",opts_modules:[],loading:!1,treeData:null,treeProps:{children:"childList"},monitorList:[],clusterList:[],loadingOptions:{text:""}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},typeModel:function(){var e;return null===(e=this.rowData)||void 0===e?void 0:e.clusterType},typeName:function(){var e,t;return 1===(null===(e=this.rowData)||void 0===e?void 0:e.clusterType)?"哨兵":0===(null===(t=this.rowData)||void 0===t?void 0:t.clusterType)?"主":void 0},clusterId:function(){var e;return null===(e=this.rowData)||void 0===e?void 0:e.id},monitorListIds:function(){return this.monitorList.map((function(e){return e.clusterId}))},formData:function(){return{clusterList:this.clusterList}}},watch:{},created:function(){this.getOpts_name()},mounted:function(){this.treeData=y(this.typeModel),this.getCluster()},methods:{getOpts_name:function(){var e=this;return Object(d["a"])(Object(u["a"])().mark((function t(){var a,o;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={moduleType:"REDIS",componentType:"CACHE"},e.opts_modules=[],t.next=4,Object(m["c"])(a);case 4:o=t.sent,e.opts_modules=Object(f["a"])(null===o||void 0===o?void 0:o.data)?o.data:[];case 6:case"end":return t.stop()}}),t)})))()},getCluster:function(){var e=this;1===this.typeModel&&Object(p["j"])(this.clusterId).then((function(t){var a=Object(f["a"])(t.data)?t.data:[];e.clusterList=a.map((function(e){return{clusterId:e.id,name:e.clusterName,masterName:e.clusterName}}))})).catch((function(e){}))},clickCancel:function(){this.$emit("change",!1)},paramsCreate:function(){var e=Object(g["a"])(this.treeData),t=null;return 0===this.typeModel||2===this.typeModel?t={clusterId:this.clusterId,configTemplateId:this.configTemplateId,redisNodeList:e}:1===this.typeModel&&(t={clusterId:this.clusterId,redisNodeList:e,monitorList:this.monitorList}),t},clickConfirm:function(){var e=this;return Object(d["a"])(Object(u["a"])().mark((function t(){var a,o;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!==e.typeModel){t.next=6;break}return t.next=3,e.$refs.shaobingRef.validate();case 3:if(a=t.sent,a){t.next=6;break}return t.abrupt("return");case 6:if(o=e.paramsCreate(),o){t.next=9;break}return t.abrupt("return");case 9:e.loading=!0,e.loadingOptions.text="正在进行环境检测,请稍后",Object(p["b"])(o).then((function(t){200===t.code&&(e.loadingOptions.text="环境检测通过,正在进行初始化",e.loading=!0,Object(p["q"])(o).then((function(t){200===t.code&&(e.$message.success("初始化完毕"),e.$emit("change",!1),e.refresh())})).catch((function(t){e.loadingOptions.text=t,e.loading=!1})).finally((function(){e.loading=!1})))})).catch((function(t){e.loading=!1,e.loadingOptions.text=t}));case 12:case"end":return t.stop()}}),t)})))()},append:function(e){var t={label:"从",machineId:"",nodeType:1,deployPath:"",port:"20003",childList:[]};e.childList||this.$set(e,"childList",[]),e.childList.push(t)},remove:function(e,t){var a=e.parent,o=a.data.childList||a.data,r=o.findIndex((function(t){return t.$treeNodeId===e.id}));o.splice(r,1)},addtreenode:function(){if(1===this.typeModel){var e={label:"哨",machineId:"",port:"23001",nodeType:2,deployPath:""};this.treeData.push(e)}if(0===this.typeModel){var t={label:"主",nodeType:0,machineId:"",port:"20001",deployPath:"",childList:[{label:"从",machineId:"",nodeType:1,deployPath:"",port:"20002"}]};this.treeData.push(t)}},changeIp:function(e,t){var a=this.csMixMachine.find((function(t){return t.id===e}));a&&a.deploymentPath?this.$set(t,"deployPath",a.deploymentPath+"/redis-cluster"):this.$set(t,"deployPath","")}}};function y(e){var t=[{label:"主",nodeType:0,machineId:"",port:"20001",deployPath:"",childList:[{label:"从",machineId:"",nodeType:1,deployPath:"",port:"20002"}]}];return 1===e?[{label:"哨",machineId:"",port:"20001",nodeType:2,deployPath:""}]:t}var w=v,C=(a("8ac8"),a("2877")),D=Object(C["a"])(w,l,c,!1,null,"be5e9982",null),k=D.exports,O=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"哨兵监控",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"集群名称"}},[t("span",[e._v(e._s(e.rowData&&e.rowData.clusterName))])]),t("el-form-item",{attrs:{label:"主节点别名",prop:"masterName"}},[t("span",[e._v(e._s(e.rowData.masterName))])]),t("el-form-item",{attrs:{label:"哨兵集群名称",prop:"clusterName"}},[t("span",[e._v(e._s(e.formData.clusterName))])]),t("el-form-item",{attrs:{label:"哨兵节点",prop:"clusterName"}},e._l(e.formData.nodes,(function(a,o){return t("el-tag",{key:o,staticClass:"mr-10",attrs:{type:""}},[e._v(e._s(a))])})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("解除监控")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},I=[],x=a("ec41"),j=a("8121"),_={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:Function},data:function(){return{formData:{clusterName:"",masterName:"",nodes:[]},rules:{}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}}},watch:{},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e=this;Object(p["g"])(this.rowData.sentinelClusterId).then((function(t){e.formData.clusterName=Object(x["a"])(t,"data.clusterName");var a=Object(x["a"])(t,"data.nodes");Object(j["a"])(a)&&a?e.formData.nodes=a.split(","):e.formData.nodes=[]})).catch((function(e){}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){t&&Object(p["u"])(e.rowData.id).then((function(t){t&&200===t.code&&(e.$message.success("已解除集群"),e.$emit("change",!1),e.refresh())}))}))}}},M=_,N=Object(C["a"])(M,O,I,!1,null,"12774e71",null),S=N.exports,P=a("cfcc"),$=a("380a"),z=a("a349"),R=h["a"].CommonSelectCreaterMix,L="2",T={name:"cluster-manage",mixins:[R(["csMixCity","csMixMachineRoom","csMixOrg","csMixMachine"])],components:{ClusterImport:i["default"],DialogInit:k,ModifyPassword:s["default"],DialogCacheEmpty:$["a"],OpenDialog:S},data:function(){var e=this,t=(this.$createElement,this);return{showCacheEmpty:!1,initShow:!1,showModifyPassword:!1,openShow:!1,loading:!1,loadingForm:!1,searchConfig:{searchData:{clusterName:""},searchItem:[{type:"input",label:"集群名称",prop:"clusterName"}],rules:{}},tableModel:{tableData:[],rowData:[{prop:"clusterName",label:"集群名称"},{prop:"redisVersion",label:"版本"},{prop:"clusterType",label:"模式",align:"left",render:function(t,a){var o=a.row,r=Object(P["f"])(o.clusterType,"clusterTypeOptions");return o.sentinelClusterId?t("span",[t("span",[r]),t("el-button",{attrs:{type:"text",icon:"el-icon-view"},class:"ml-10",on:{click:function(){return e.openWindow(o)}}})]):t("span",[r])}},{prop:"totalNodes",label:"总节点数",width:100},{prop:"runNodeNum",label:"运行节点数",width:100},{prop:"nodes",label:"节点信息",render:function(t,a){var o=a.row;if(2===o.clusterRunStatus||!o.nodes)return t("span");var r=o.nodes.split(",");return t("el-tooltip",{attrs:{placement:"right"}},[t("ul",{slot:"content"},[r.map((function(e){return t("li",{class:"mb-10"},[e])}))]),t("el-button",{attrs:{type:"text"},on:{click:function(){return e.clickCopy(o.nodes)}}},["复制"])])}},{prop:"clusterRunStatus",label:"集群运行状态",width:100,align:"left",render:function(e,t){var a=t.row,o=z["b"].getItem(a.clusterRunStatus);return o?e("hubaryDot",{attrs:{text:o.label,status:o.status}}):e("span",[a.clusterRunStatus])}}],operateWidth:"240px",operateData:[{label:"初始化节点",type:"init",funName:"openInit",btnPermCode:"restart",isShow:function(e){return!(e.totalNodes>0)}},{label:"节点管理",type:"manage",funName:"toPage",btnPermCode:"relation",isShow:function(e){return!(e.totalNodes<=0)}},{label:"编辑",type:"edit",btnPermCode:"edit"},{label:"导入集群",type:"export",btnPermCode:"import",funName:"clickRowImport",isShow:function(e){return!(e.totalNodes>0)}},{label:"设置密码",type:"password",funName:"clickPassword",btnPermCode:"config",isShow:function(e){return 1!==e.clusterType}},{label:"清空缓存",type:"empty_cache",funName:"clickEmptyCache",btnPermCode:"destroy",isShow:function(e){return 1!==e.clusterType}},{label:"一键启动",type:"start",funName:"clickStartOrStop",btnPermCode:"start",isShow:function(e){return 0===e.clusterRunStatus}},{label:"一键停止",type:"stop",funName:"clickStartOrStop",btnPermCode:"stop",isShow:function(e){return 1===e.clusterRunStatus}},{label:"删除集群",type:"deleteCluster",funName:"deleteCluster",btnPermCode:"delete"}],pagination:{pageNo:1,pageSize:10,total:0}},formModel:{formLabelWidth:"130px",formData:{id:"",clusterName:"",redisVersion:"",clusterType:"",orgId:"",orgName:"",cityId:"",cityName:"",machineRoomId:"",machineRoomName:"",deployMode:"2"},formFilds:[{label:"名称",prop:"clusterName",type:"input",disabled:!1},{label:"版本",prop:"redisVersion",type:"select",get disabled(){return Boolean(t.formModel.formData.id)},options:P["g"]},Object(n["a"])("get",{label:"模式",prop:"clusterType",type:"select",disabled:!1,options:P["d"]},"disabled",(function(){return Boolean(t.formModel.formData.id)})),{label:"组织",prop:"orgId",type:"select",disabled:!1,get options(){return t.csMixOrg},change:function(a){var o,r=t.csMixOrg.find((function(e){return e.value===a}));t.formModel.formData.orgName=null!==(o=null===r||void 0===r?void 0:r.label)&&void 0!==o?o:"";var n=e.formModel.formData.cityId;e.csMixMachineRoom=[],e.formModel.formData.machineRoomId="",e.formModel.formData.machineRoomName="",a&&n&&e.csRepeatMachineRoom({orgId:a,cityId:n})}},{label:"省、市",prop:"cityId",type:"select",disabled:!1,get options(){return t.csMixCity},change:function(a){var o,r=t.csMixCity.find((function(e){return e.value===a}));e.formModel.formData.cityName=null!==(o=null===r||void 0===r?void 0:r.label)&&void 0!==o?o:"";var n=e.formModel.formData.orgId;e.csMixMachineRoom=[],e.formModel.formData.machineRoomId="",e.formModel.formData.machineRoomName="",a&&n&&e.csRepeatMachineRoom({orgId:n,cityId:a})}},{label:"数据中心",prop:"machineRoomId",type:"select",disabled:!1,get options(){return t.csMixMachineRoom},change:function(a){var o,r=e.csMixMachineRoom.find((function(e){return e.value===a}));t.formModel.formData.machineRoomName=null!==(o=null===r||void 0===r?void 0:r.label)&&void 0!==o?o:""}}],rules:{clusterName:[{required:!0,message:"请输入名称",trigger:"blur"},{trigger:"blur",validator:function(e,t,a){if(!t)return a();var o=/^[a-z][a-z0-9\-]*[a-z0-9]$/;if(!o.test(t))return a(new Error("格式错误，只能包含小写字母、数字以及-，且不能以-结尾"));a()}}],redisVersion:[{required:!0,message:"请选择版本",trigger:"change"}],clusterType:[{required:!0,message:"请选择模式",trigger:"change"}],orgId:[{required:!0,message:"请选择组织",trigger:"change"}],cityId:[{required:!0,message:"请选择省、市",trigger:"change"}],machineRoomId:[{required:!0,message:"请选择机房",trigger:"change"}]},btnData:[{type:"submit",style:"primary",label:"确定"},{type:"cancle",label:"取消"}]},searchModel:{btnGroup:[{type:"add",style:"primary",label:"新增",btnPermCode:"add"}],formModel:{cluster:""},searchFild:[]},showImport:!1,currentRow:null,deleteFile:"1"}},created:function(){this.getList()},methods:{onSearch:function(){this.getList()},openWindow:function(e){this.currentRow=e,this.openShow=!0},getList:function(){var e=this,t=this.searchConfig.searchData.clusterName,a={pageNo:this.tableModel.pagination.pageNo,pageSize:this.tableModel.pagination.pageSize,requestObject:{clusterName:Object(j["a"])(t)?t.trim():"",deployMode:"2"}};this.loading=!0,Object(p["o"])(a).then((function(t){var a=Object(x["a"])(t,"data.data",[]);e.tableModel.tableData=Object(f["a"])(a)?a:[],e.tableModel.pagination.total=Object(x["a"])(t,"data.totalCount")||0})).catch((function(e){})).finally((function(){e.loading=!1}))},changePage:function(e,t){e&&(this.tableModel.pagination.pageNo=e),t&&(this.tableModel.pagination.pageNo=1,this.tableModel.pagination.pageSize=t),this.getList()},openInit:function(e){this.currentRow=e,this.initShow=!0},btnTypeChange:function(e){"add"===e&&(this.csMixMachineRoom=[])},clickAdd:function(e){var t=this;this.loadingForm=!0,e.deployMode="2",Object(p["c"])(e).then((function(e){t.$message.success("新增成功"),t.$refs.compTable.hideDialog(),t.getList()})).catch((function(e){})).finally((function(){t.loadingForm=!1}))},clickEditRow:function(e){this.csRepeatMachineRoom({cityId:e.cityId,orgId:e.orgId})},clickEdit:function(e){var t=this;this.loadingForm=!0,e.deployMode="2",Object(p["v"])(e).then((function(e){t.$message.success("编辑成功"),t.$refs.compTable.hideDialog(),t.getList()})).catch((function(e){})).finally((function(){t.loadingForm=!1}))},deleteCluster:function(e){var t=this,a=this.$createElement;this.deleteFile="1";var o=document.getElementById("deleteFileId");o&&(o.checked=!0);var r=a("div",[a("div",{class:"mb-15"},["确定要删除【".concat(e.clusterName,"】集群吗")]),a("span",["是否删除本地文件:"]),a("input",{domProps:{checked:!0},attrs:{type:"checkbox","true-value":"1","false-value":"0",id:"deleteFileId"},class:"ml-10",on:{input:function(e){t.deleteFile=e.target.checked?"1":"0"}}})]);this.$msgbox({title:"提示",message:r,showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(a,o,r){if("confirm"===a){o.confirmButtonLoading=!0,o.confirmButtonText="执行中...";var n={id:e.id,deleteFile:t.deleteFile};Object(p["l"])(n).then((function(){t.$message.success("删除成功"),t.getList()})).finally((function(){o.confirmButtonLoading=!1,r()}))}else r()}}).then((function(e){})).catch((function(e){}))},clickRowImport:function(e){this.currentRow=e,this.showImport=!0},clickPassword:function(e){this.currentRow=e,this.showModifyPassword=!0},clickEmptyCache:function(e){this.currentRow=e,this.showCacheEmpty=!0},clickStartOrStop:function(e){var t=this,a=1===e.clusterRunStatus,o=this.$createElement;this.$msgbox({title:"提示",message:o("p",null,[o("span",null,"确定要".concat(a?"停止":"启动","吗?")),o("i",{style:"color: teal"})]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(o,r,n){if("confirm"===o){var i={method:a?"stop":"start",clusterId:e.id};r.confirmButtonLoading=!0,r.confirmButtonText="执行中...",Object(p["s"])(i).then((function(e){200===e.code&&(t.$message.success("".concat(a?"停止":"启动","成功")),t.getList())})).catch((function(e){})).finally((function(){n(),r.confirmButtonLoading=!1}))}else n()}})},toPage:function(e){var t="";2==e.clusterType?t="/cacheCluster/cache-node-monitor/mode-main-slave":1==e.clusterType?t="/cacheCluster/cache-node-monitor/mode-sentinel":0===e.clusterType&&(t="/cacheCluster/cache-node-monitor/mode-cluster"),this.$router.push({path:t,query:{id:e.id,clusterType:e.clusterType,deployMode:L}})},clickCopy:function(e){var t=this;this.$copyText(e).then((function(){t.$message.success("复制成功")})).catch((function(e){t.$message.error("复制失败")}))}}},q=T,E=Object(C["a"])(q,o,r,!1,null,"21c18488",null);t["default"]=E.exports},"59a4":function(e,t,a){},"5a61":function(e,t,a){"use strict";a("2d16")},"62ff":function(e,t,a){"use strict";a.r(t);a("498a");var o=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"修改密码",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1,loading:e.loading},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"集群名称"}},[t("span",[e._v(e._s(e.formData.clusterName))])]),t("el-form-item",{attrs:{label:"原密码",prop:"password"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.formData.password,expression:"formData.password"}]},[t("span",{staticClass:"mr-20"},[e._v(e._s(e.showOldPassword?e.formData.password:"*******"))]),t("el-button",{attrs:{type:"text",icon:"el-icon-view"},on:{click:function(t){e.showOldPassword=!e.showOldPassword}}})],1)]),t("el-form-item",{attrs:{label:"新密码",prop:"new_passd"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入新密码",autocomplete:"off","show-password":!0},model:{value:e.formData.new_passd,callback:function(t){e.$set(e.formData,"new_passd","string"===typeof t?t.trim():t)},expression:"formData.new_passd"}})],1),t("el-form-item",{attrs:{label:"再次确认密码",prop:"newAgain"}},[t("el-input",{attrs:{placeholder:"请再次输入新密码","show-password":!0,autocomplete:"off",type:"password"},model:{value:e.formData.newAgain,callback:function(t){e.$set(e.formData,"newAgain","string"===typeof t?t.trim():t)},expression:"formData.newAgain"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=(a("d9e2"),a("b64b"),a("d3b7"),a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("00b4"),a("25f0"),a("159b"),a("3882")),i=a("8121"),s={name:"ModifyPassword",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=this,t=function(t,a,o){if(""!==a&&Object(i["a"])(a)){var r=new RegExp("[\\u4E00-\\u9FFF]+","g"),n=r.test(a);return n?o(new Error("密码不能包含中文")):a.length<6?o(new Error("密码至少6个字符")):void(e.formData.newAgain===e.formData.new_passd?o():o(new Error("两次输入的密码不一致")))}o(new Error("请再次输入新密码"))},a=function(e,t,a){if(""!==t&&Object(i["a"])(t)){var o=new RegExp("[\\u4E00-\\u9FFF]+","g"),r=o.test(t);return r?a(new Error("密码不能包含中文")):t.length<6?a(new Error("密码至少6个字符")):void a()}a(new Error("请再次输入新密码"))};return{loading:!1,formData:l(),showOldPassword:!1,rules:{password:[{required:!1,trigger:"blur",message:"请输入原密码"}],new_passd:[{required:!0,trigger:"blur",message:"请输入新密码"},{validator:a,trigger:"blur"}],newAgain:[{required:!0,trigger:"blur",message:"请再次输入新密码"},{validator:t,trigger:"blur"}]}}},computed:{},watch:{},created:function(){},mounted:function(){var e;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.formData=l(this.rowData))},methods:{clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){t&&(e.loading=!0,Object(n["w"])({clusterId:e.rowData.id,password:e.formData.new_passd}).then((function(t){t&&200===t.code&&(e.$message.success("密码修改成功"),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})))}))}}};function l(e){var t={id:"",clusterName:"",password:"",newAgain:"",new_passd:""};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var c=s,u=(a("2bb1"),a("2877")),d=Object(u["a"])(c,o,r,!1,null,"73f940d3",null);t["default"]=d.exports},6346:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"virtual-container"},[t("el-tabs",{on:{"tab-click":e.changeMode},model:{value:e.deployMode,callback:function(t){e.deployMode=t},expression:"deployMode"}},[t("el-tab-pane",{attrs:{label:"虚机部署",name:"2"}}),t("el-tab-pane",{attrs:{label:"容器部署",name:"1"}})],1),"2"===e.deployMode?t("ClusterNormal"):"1"===e.deployMode?t("ClusterContainer"):e._e()],1)},r=[],n=(a("14d9"),a("49ce")),i=a("5357"),s={name:"CacheClusterManage",filters:{},components:{ClusterContainer:n["default"],ClusterNormal:i["default"]},computed:{deployMode:{get:function(){return this.$route.query.deployMode},set:function(e){this.$router.push({query:{deployMode:e}})}}},watch:{},data:function(){return{}},created:function(){},beforeMount:function(){this.$route.query.deployMode||(this.deployMode="2")},mounted:function(){},methods:{changeMode:function(e){}}},l=s,c=(a("0e1e"),a("2877")),u=Object(c["a"])(l,o,r,!1,null,"57dcb9a8",null);t["default"]=u.exports},6348:function(e,t,a){},7889:function(e,t,a){},"8ac8":function(e,t,a){"use strict";a("bf2f")},"8b8f":function(e,t,a){"use strict";a.r(t);a("99af");var o=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"导入集群",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.rules,inline:!0}},[t("el-form-item",{attrs:{prop:"host",label:e.search_label}},[t("el-select",{attrs:{placeholder:"请选择IP",size:"mini","value-key":"id",filterable:"",clearable:""},model:{value:e.formData.host,callback:function(t){e.$set(e.formData,"host",t)},expression:"formData.host"}},e._l(e.csMixMachine,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.label,"(").concat(a.hostSshAccount,")"),value:a}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.label))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1)],1),t("el-form-item",{attrs:{prop:"port",label:"端口"}},[t("el-input",{attrs:{placeholder:"端口",size:"mini"},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",t)},expression:"formData.port"}})],1),t("el-form-item",{attrs:{prop:"password",label:"密码"}},[t("el-input",{attrs:{placeholder:"密码","show-password":!0,autocomplete:"off",size:"mini"},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clickCheck}},[e._v("检测")])],1)],1),t("el-alert",{attrs:{title:"导入集群时，请确保每个节点处于运行状态",type:"warning","show-icon":""}}),t("el-form",{ref:"tableRef",attrs:{model:e.tableConfig}},[t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:!1,rowKey:"id"}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=(a("7db0"),a("d81d"),a("d3b7"),a("159b"),a("3882")),i=a("ec41"),s=a("ff51"),l=a("cfcc"),c={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},csMixMachine:{type:Array,default:function(){return[]}},refresh:Function},data:function(){var e=this;this.$createElement;return{formData:{host:"",port:"20001",hostIp:"",password:""},rules:{host:[{required:!0,trigger:"blur",message:"请选择IP"}],port:[{required:!0,trigger:"blur",message:"请输入端口"}],password:[{trigger:"blur",message:"请输入密码"}]},tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"STT",label:"IP:端口",align:"center",width:150,render:function(e,t){var a=t.row;return e("span",[a.hostIp,":",a.port])}},{prop:"nodeType",label:"节点类型",align:"center",format:function(e){return Object(l["f"])(String(e),"nodeTypeOptions")}},{prop:"runStatus",label:"运行状态",align:"center",format:function(e){return Object(l["f"])(e,"clusterRunStatusOptions")}},{prop:"deployPath",label:"部署路径",align:"center"},{prop:"configPath",label:"配置路径",align:"center"},{prop:"TODO",label:"绑定机器",align:"center",width:180,render:function(t,a){var o=a.row,r=a.index;return t("el-form-item",{attrs:{prop:"tableData.".concat(r,".machineId"),rules:{required:!0,message:"机器不能为空",trigger:"change"}}},[t("el-select",{attrs:{value:o.machineId},on:{change:function(t){return e.setSelect(t,o)}}},[e.csMixMachine.map((function(e){return t("el-option",{attrs:{value:e.value,label:e.label+"("+e.hostSshAccount+")"}})}))])])}}]}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},search_label:function(){var e,t,a={0:"主",1:"哨兵",2:"主"};return a[null!==(e=null===(t=this.rowData)||void 0===t?void 0:t.clusterType)&&void 0!==e?e:0]}},watch:{formData:{handler:function(e){this.tableConfig.tableData=[]},immediate:!0,deep:!0}},created:function(){},mounted:function(){},methods:{setSelect:function(e,t){this.$set(t,"machineId",e)},clickCheck:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a={clusterId:e.rowData.id,port:e.formData.port,hostIp:e.formData.host.hostIp,password:e.formData.password};e.tableConfig.loading=!0,Object(n["e"])(a).then((function(t){var a=Object(i["a"])(t,"data");a.forEach((function(t){var a=e.csMixMachine.find((function(e){return e.hostIp==t.hostIp}));t.machineId=a?a.id:""})),e.tableConfig.tableData=Object(s["a"])(a)?a:[]})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))}}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.tableRef.validate((function(t){if(t){var a={clusterId:e.rowData.id,password:e.formData.password,redisNodeDTOList:e.tableConfig.tableData};Object(n["d"])(a).then((function(t){t&&200===t.code&&(e.$message.success("集群导入成功"),e.$emit("change",!1),e.refresh())}))}}))}}},u=c,d=(a("aa9c"),a("2877")),p=Object(d["a"])(u,o,r,!1,null,"2f4ddfb8",null);t["default"]=p.exports},9959:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("el-drawer",{attrs:{visible:a.visible,size:"900px","append-to-body":!0,"destroy-on-close":!0,wrapperClosable:!1},on:{"update:visible":function(e){a.visible=e},close:a.clickCancel}},[t("el-page-header",{attrs:{slot:"title",content:a.title},on:{back:a.clickCancel},slot:"title"}),t("div",{staticClass:"container"},[t("el-scrollbar",{staticStyle:{height:"calc(100vh - 96px)"}},[t("el-form",{ref:"formRef",staticClass:"p-20",attrs:{model:a.formData,"label-width":"120px",rules:a.rules}},[t("header-line",[e._v("镜像配置")]),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像",prop:"imageId"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.imageLoading,disabled:!a.isOneKey,placeholder:"请选择",clearable:"",filterable:""},on:{change:a.changeImage},model:{value:a.formData.imageId,callback:function(t){e.$set(a.formData,"imageId",t)},expression:"formData.imageId"}},e._l(a.imageOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.imageName,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"imageAddress"}},[t("el-input",{attrs:{disabled:!0,clearable:""},model:{value:a.formData.imageAddress,callback:function(t){e.$set(a.formData,"imageAddress",t)},expression:"formData.imageAddress"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像版本",prop:"imageVersion"}},[t("el-input",{attrs:{disabled:!0,clearable:""},model:{value:a.formData.imageVersion,callback:function(t){e.$set(a.formData,"imageVersion",t)},expression:"formData.imageVersion"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥",prop:"imagePullSecret"}},[t("el-input",{attrs:{disabled:!0,clearable:""},model:{value:a.formData.imagePullSecret,callback:function(t){e.$set(a.formData,"imagePullSecret",t)},expression:"formData.imagePullSecret"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略",prop:"imagePullPolicy"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",clearable:"",disabled:!a.isOneKey},model:{value:a.formData.imagePullPolicy,callback:function(t){e.$set(a.formData,"imagePullPolicy",t)},expression:"formData.imagePullPolicy"}},e._l(a.dictContainer_imagePullPolicy.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("header-line",[e._v("集群配置")]),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"主节点个数",prop:"size"}},[t("el-input-number",{staticClass:"w-100",attrs:{placeholder:"请输入",clearable:"",disabled:!a.isOneKey,min:1,precision:0},model:{value:a.formData.size,callback:function(t){e.$set(a.formData,"size",t)},expression:"formData.size"}})],1)],1),t("el-col",{attrs:{span:12}}),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口",prop:"port"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",disabled:!0,precision:0,step:1,min:0,max:65535,placeholder:"请输入"},model:{value:a.formData.port,callback:function(t){e.$set(a.formData,"port",t)},expression:"formData.port"}})],1)],1)],1),t("header-line",[e._v("Pod配置")]),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"CPU(核)",prop:"cpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",placeholder:"请输入",min:0},model:{value:a.formData.cpu,callback:function(t){e.$set(a.formData,"cpu",t)},expression:"formData.cpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"内存(Mi)",prop:"memory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",placeholder:"请输入",min:1},model:{value:a.formData.memory,callback:function(t){e.$set(a.formData,"memory",t)},expression:"formData.memory"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"storagesize"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",placeholder:"请输入",min:1},model:{value:a.formData.storagesize,callback:function(t){e.$set(a.formData,"storagesize",t)},expression:"formData.storagesize"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"storageclass"}},[t("el-select",{staticClass:"w-100",attrs:{loading:a.k8sStorageClassLoading,disabled:!a.isOneKey,placeholder:"请选择",clearable:"",filterable:""},model:{value:a.formData.storageclass,callback:function(t){e.$set(a.formData,"storageclass",t)},expression:"formData.storageclass"}},e._l(a.k8sStorageClassOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"网络模式",prop:"netmode"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:!a.isOneKey,placeholder:"请选择",clearable:"",filterable:""},model:{value:a.formData.netmode,callback:function(t){e.$set(a.formData,"netmode",t)},expression:"formData.netmode"}},[t("el-option",{attrs:{label:"NodePort",value:"NodePort"}}),t("el-option",{attrs:{label:"ClusterIP",value:"ClusterIP"}})],1)],1)],1),"NodePort"===a.formData.netmode?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"VIP",prop:"vip"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:a.formData.vip,callback:function(t){e.$set(a.formData,"vip",t)},expression:"formData.vip"}})],1)],1):e._e()],1)],1)],1)],1),t("footer",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary"},on:{click:a.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:a.clickCancel}},[e._v("取消")])],1)],1)},r=[],n=a("c7eb"),i=a("1da1"),s=(a("7db0"),a("a15b"),a("b64b"),a("d3b7"),a("159b"),a("2b0e")),l=a("4879"),c=a("f3d0"),u=a("5c96"),d=a("fc9b"),p=a("ec41"),m=a("bc59"),f={__name:"ContainerOneKey",props:{show:Boolean,rowData:{type:Object,default:null},refresh:{type:Function,required:!0}},emits:["update:show"],setup:function(e,t){var a=t.emit,o=e,r=new d["b"],f=r.imageOptions,g=r.imageFetch,h=r.imageLoading,b=new d["c"],v=b.k8sStorageClassFetch,y=b.k8sStorageClassLoading,w=b.k8sStorageClassOptions,C=Object(s["computed"])({set:function(e){Object(s["nextTick"])((function(){a("update:show",e)}))},get:function(){return o.show}}),D=R(),k=Object(s["reactive"])(D);Object(s["watch"])((function(){return o.show}),(function(e){e&&(g("REDIS").then((function(){O.value||P()})),v({agentId:o.rowData.containerAgentId}),O.value&&Object.assign(k,R()))}));var O=Object(s["computed"])((function(){var e=Object(p["a"])(o,"rowData.clusterRunStatus");return 2==e})),I=Object(s["computed"])((function(){var e=Object(p["a"])(o,"rowData.clusterName");return O.value?"一键部署(容器)  ".concat(e):"部署配置(容器)  ".concat(e)})),x={imageId:[{required:!0,message:"请选择",trigger:"change"}],netmode:[{required:!0,message:"请选择",trigger:"change"}],cpu:[{required:!0,message:"请输入",trigger:"blur"}],memory:[{required:!0,message:"请输入",trigger:"blur"}],size:[{required:!0,message:"请输入",trigger:"blur"}],storagesize:[{required:!0,message:"请输入",trigger:"blur"}],storageclass:[{required:!0,message:"请输入",trigger:"blur"}],port:[{required:!0,message:"请输入",trigger:"change"}],imagePullPolicy:[{required:!0,message:"请输入",trigger:"blur"}],vip:[{required:!0,message:"请输入",trigger:"blur"},{pattern:/^([0-9]{1,3}\.){3}[0-9]{1,3}$/,message:"请输入正确的IP地址",trigger:"blur"}]},j=Object(s["ref"])();function _(){k.imageVersion=void 0,k.imagePullSecret=void 0,k.imageAddress=void 0}function M(e){N()}function N(){var e=console,t=e.log,a=f.value.find((function(e){return e.id===k.imageId}));t("触发imageId",a,k.imageId),k.imageId&&a?(k.imageVersion=a.imageVersion,k.imagePullSecret=a.imagePullSecret,k.imageAddress=a.imageAddress):_()}Object(s["onMounted"])((function(){}));var S=Object(s["ref"])(null);function P(){Object(c["c"])({clusterId:o.rowData.id}).then((function(e){S.value=Object(p["a"])(e,"data"),Object.assign(k,R(S.value)),N()}))}var $=function(){var e=Object(i["a"])(Object(n["a"])().mark((function e(){var t,a,r,i;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j.value.validate().catch((function(e){}));case 2:if(t=e.sent,t){e.next=5;break}return e.abrupt("return");case 5:if(a=L(),!O.value){e.next=17;break}return e.next=10,Object(c["a"])(a).catch((function(e){}));case 10:if(r=e.sent,r){e.next=13;break}return e.abrupt("return");case 13:return u["Message"].success("操作成功"),z(),o.refresh(),e.abrupt("return");case 17:return Object.assign(a.metadata,Object(p["a"])(S.value,"metadata")),e.next=20,Object(c["e"])(a).catch((function(e){}));case 20:if(i=e.sent,i){e.next=23;break}return e.abrupt("return");case 23:return u["Message"].success("配置成功"),z(),o.refresh(),e.abrupt("return");case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){a("update:show",!1)};function R(e){var t=Object(p["a"])(e,"imageId"),a=Object(p["a"])(e,"spec"),o={imageId:void 0,imagePullPolicy:"IfNotPresent",imagePullSecret:"",imageVersion:void 0,size:void 0,secret:void 0,imageAddress:void 0,port:6379,netmode:"NodePort",storageclass:void 0,storagesize:5,cpu:.2,memory:200,vip:void 0};return e&&a?(o.imageId=t,Object.keys(o).forEach((function(e){Object(m["a"])(a,e)&&(o[e]=a[e])})),o):o}function L(){var e=Object(p["a"])(o,"rowData.clusterName"),t=Object(p["a"])(o,"rowData.namespace"),a=Object(p["a"])(o,"rowData.id"),r=[k.imageAddress,k.imageVersion].join(":");return{apiVersion:"cache.tongdun.net/v1alpha1",clusterId:a,imageId:k.imageId,kind:"RedisCluster",metadata:{name:e,namespace:t},spec:{app:e,capacity:570,cpu:k.cpu,dc:void 0,env:void 0,image:r,memory:k.memory,monitorimage:"gientech/redis-exporter:1.0",netmode:k.netmode,realname:e,secret:"abc",size:k.size,storageclass:k.storageclass,storagesize:k.storagesize,vip:"NodePort"===k.netmode?k.vip:void 0,resourceVersion:""}}}return{__sfc:!0,props:o,emit:a,imageOptions:f,imageFetch:g,imageLoading:h,k8sStorageClassFetch:v,k8sStorageClassLoading:y,k8sStorageClassOptions:w,visible:C,formRaw:D,formData:k,isOneKey:O,title:I,rules:x,formRef:j,clearImageExtra:_,changeImage:M,setInfo3ByImageId:N,detailRef:S,queryDetailById:P,clickConfirm:$,clickCancel:z,defaultFormData:R,sendBackend:L,dictContainer_imagePullPolicy:l["c"]}}},g=f,h=(a("f02d"),a("2877")),b=Object(h["a"])(g,o,r,!1,null,"828a59f6",null);t["default"]=b.exports},aa64:function(e,t,a){"use strict";a("dbc9")},aa9c:function(e,t,a){"use strict";a("efd6")},b9b6:function(e,t,a){},bf2f:function(e,t,a){},d846:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("el-page-header",{staticStyle:{"margin-bottom":"20px"},attrs:{content:"部署记录"},on:{back:e.goBack}}),t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("comp-table",{ref:"compTable",attrs:{isDialog:!1,isMultiple:!1,loading:e.loading,"table-model":e.tableModel,operateSlice:3,"search-model":e.searchModel},on:{changePage:e.changePage}})],1)},r=[],n=a("5530"),i=(a("d3b7"),a("23a6")),s=a("ec41"),l=a("ff51"),c={name:"deploy-record",components:{},data:function(){return{rowData:{},loading:!1,tableModel:{tableData:[],rowData:[{prop:"cluster",label:"集群"},{prop:"machineIp",label:"机器ip"},{prop:"machinePort",label:"机器端口"},{prop:"deployStatus",label:"部署状态"},{prop:"deployPath",label:"部署路径"},{prop:"content",label:"内容"},{prop:"detail",label:"详情"},{prop:"createDate",label:"部署时间"}],operateWidth:"220px",operateData:[],pagination:{pageNo:1,pageSize:10,total:0}},searchModel:{btnGroup:[]},configOptions:[],appOptions:[],envOptions:[],unitOptions:[],searchConfig:{searchData:{cluster:"",machineIp:""},searchItem:[{prop:"cluster",label:"集群",type:"input"},{prop:"machineIp",label:"机器",type:"input"}],rules:{appId:[{required:!1,message:"请选择应用",trigger:"change"}],envId:[{required:!0,trigger:"change",message:"请选择环境"}],configId:[{required:!1,message:"请选择配置",trigger:"change"}]}}}},created:function(){},mounted:function(){this.getList()},methods:{goBack:function(){this.$router.go(-1)},onSearch:function(e){e?(this.tableModel.tableData=[],this.tableModel.pagination.total=0):(this.tableModel.pagination.pageNo=1,this.getList())},getList:function(){var e=this,t={pageNo:this.tableModel.pagination.pageNo,pageSize:this.tableModel.pagination.pageSize,requestObject:Object(n["a"])({componentType:"0"},this.searchConfig.searchData)};this.loading=!0,Object(i["f"])(t).then((function(t){var a,o=Object(s["a"])(t,"data.data");e.tableModel.tableData=Object(l["a"])(o)?o:[],e.tableModel.pagination.total=(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.totalCount)||0})).catch((function(e){})).finally((function(){e.loading=!1}))},changePage:function(e,t){e&&(this.tableModel.pagination.pageNo=e),t&&(this.tableModel.pagination.pageNo=1,this.tableModel.pagination.pageSize=t),this.getList()}}},u=c,d=a("2877"),p=Object(d["a"])(u,o,r,!1,null,"e5cf2440",null);t["default"]=p.exports},dbc9:function(e,t,a){},efd6:function(e,t,a){},f02d:function(e,t,a){"use strict";a("7889")}}]);