(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~ff867824"],{6426:function(e,t,a){},"673d":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{style:{height:e.height,width:e.width},attrs:{id:"mountNode"}})},i=[],r=(a("cb29"),a("7c3e")),o={name:"g6-dagre",components:{},mixins:[],props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},chartData:{type:Object,default:function(){return{nodes:[],edges:[]}}}},data:function(){return{graph:null}},computed:{},watch:{},created:function(){},mounted:function(){this.initDagre(),window.addEventListener("resize",this.resize)},destroyed:function(){window.removeEventListener("resize",this.resize),this.graph=null},methods:{initDagre:function(){var e=this,t=this.chartData;r["a"].registerNode("sql",{drawShape:function(e,t){var a=t.addShape("rect",{attrs:{x:-75,y:-25,width:150,height:50,radius:10,textAlign:"center",textBaseline:"middle",stroke:"#5B8FF9",lineWidth:1,fill:e.style.fill},name:"rect-shape"});return e.title&&t.addShape("text",{attrs:{text:e.title,x:0,y:0,fill:"#00287E",fontSize:14,lineHeight:50,textAlign:"center",textBaseline:"middle",fontWeight:"bold",cursor:"pointer"},name:"text-shape"}),a}},"single-node");var a=1===t.nodes.length,n=new r["a"].Graph({container:"mountNode",fitView:!0,pixelRatio:2,maxZoom:a?3:10,layout:{type:"grid",begin:[20,20],nodeSize:[150,50],preventOverlap:!0},animate:!0,defaultNode:{type:"sql",size:[150,50],style:{stroke:"#C4E3B2",radius:7},labelCfg:{style:{fill:"#000",fontSize:14,lineHeight:50}}},comboStateStyles:{selected:{shadowBlur:1,lineWidth:1}},nodeStateStyles:{selected:{shadowColor:"#1d70f5",shadowBlur:10,lineWidth:2,cursor:"pointer"}},modes:{default:["drag-canvas","zoom-canvas",{type:"click-select",multiple:!1}]}});n.data(t),n.render(),n.fitView(),this.graph=n,n.on("nodeselectchange",(function(t){var a=null;t.select&&(a=t.target.getModel(),e.$emit("click-node",a))}))},resize:function(){var e=this.$el,t=e.offsetHeight,a=e.offsetWidth;this.graph.changeSize(a,t)}}},s=o,c=a("2877"),l=Object(c["a"])(s,n,i,!1,null,"6f8e2208",null);t["default"]=l.exports},"6b32":function(e,t,a){},"7aa4":function(e,t,a){"use strict";a("6426")},"80de":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:2,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.visible?t("DialogAddEdit",{attrs:{optsArch:e.opts_arch,rowData:e.rowData,refresh:e.getList},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}}):e._e()],1)},i=[],r=a("c7eb"),o=a("1da1"),s=(a("d81d"),a("14d9"),a("b0c0"),a("d3b7"),a("a4d3"),a("e01a"),a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"服务名",prop:"name"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入服务名"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name","string"===typeof t?t.trim():t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"单元化架构",prop:"unitStructureId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择单元化架构",filterable:""},on:{change:e.changeUnitStructureId},model:{value:e.formData.unitStructureId,callback:function(t){e.$set(e.formData,"unitStructureId",t)},expression:"formData.unitStructureId"}},e._l(e.optsArch,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"消息集群",prop:"clusterId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择消息集群",filterable:""},model:{value:e.formData.clusterId,callback:function(t){e.$set(e.formData,"clusterId",t)},expression:"formData.clusterId"}},e._l(e.opts_cluster,(function(e){return t("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入描述",type:"textarea"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description","string"===typeof t?t.trim():t)},expression:"formData.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),c=[],l=a("5530"),u=(a("b64b"),a("159b"),a("ff51")),d=a("e8b2"),f=a("2887"),p=a("78ec"),h={name:"add-edit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:function(){return{}}},refresh:{type:Function,required:!0,default:function(){}},optsArch:{type:Array,default:function(){return[]}}},data:function(){return{formData:m(),rules:{name:[{required:!0,trigger:"blur",message:"请输入用户名"},{pattern:/\w/g,trigger:"blur",message:"请输入 a-z A-Z 或 _"}],clusterId:[{required:!0,trigger:"change",message:"请选择集群"}],unitStructureId:[{required:!0,trigger:"change",message:"请选择架构"}]},opts_cluster:[]}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){var e;null!==(e=this.rowData)&&void 0!==e&&e.id&&(this.formData=m(this.rowData),this.getCluster(this.formData.unitStructureId))},methods:{getCluster:function(e){var t=this;Object(p["b"])({unitStructureId:e}).then((function(e){t.opts_cluster=Object(u["a"])(null===e||void 0===e?void 0:e.data)?e.data:[]})).catch((function(e){}))},changeUnitStructureId:function(e){this.formData.clusterId="",this.getCluster(e)},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(l["a"])({},e.formData);if(e.isEdit)return Object(f["g"])(a).then((function(t){t&&200===t.code&&(e.$message.success("编辑成功"),e.$emit("change",!1),e.refresh())}));delete a.id,Object(f["c"])(a).then((function(t){t&&200===t.code&&(e.$message.success("新增成功"),e.refresh(),e.$emit("change",!1))}))}}))}}};function m(e){var t={id:"",name:"",clusterId:"",unitStructureId:"",description:""};return Object(d["a"])(e)&&Object.keys(t).forEach((function(a){e.hasOwnProperty(a)&&(t[a]=e[a])})),t}var g=h,b=a("2877"),v=Object(b["a"])(g,s,c,!1,null,"78aebace",null),y=v.exports,w=a("ec41"),k=a("753f"),x={name:"unitization-sync-service",components:{DialogAddEdit:y},mixins:[],props:{},data:function(){var e=this;return{opts_arch:[],buttonList:[{label:"新增",type:"add",click:this.openAdd}],searchConfig:{searchData:{name:"",unitStructureId:""},searchItem:[{type:"input",label:"服务名",prop:"name"},{type:"select",label:"单元化架构",prop:"unitStructureId",clearable:!0,get options(){return e.opts_arch}}],rules:{}},visible:!1,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{label:"服务名",prop:"name"},{label:"单元化架构",prop:"unitStructureName"},{label:"消息集群",prop:"clusterName"},{label:"节点数量",prop:"nodeNum"},{label:"描述",prop:"description"}],operate:{width:220,list:[{label:"编辑",id:"edit"},{label:"节点管理",id:"manage"},{label:"一键部署",id:"deploy"},{label:"一键启动",id:"start"},{label:"一键停止",id:"stop"},{label:"删除",id:"delete"}]}},rowData:null}},computed:{},watch:{},created:function(){this.getArch(),this.getList()},mounted:function(){},methods:{getArch:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){var a,n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],t.prev=1,t.next=4,Object(k["c"])({code:"",name:""});case 4:n=t.sent,Object(u["a"])(null===n||void 0===n?void 0:n.data)&&(a=n.data.map((function(e){return{label:e.name,value:e.id}}))),e.opts_arch=a,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),e.opts_arch=a;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:this.searchConfig.searchData};this.tableConfig.loading=!0,Object(f["d"])(t).then((function(t){var a=Object(w["a"])(t,"data.data");e.tableConfig.tableData=Object(u["a"])(a)?a:[],e.tableConfig.pagination.totalCount=Object(w["a"])(t,"data.totalCount")||0})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},getIndex:function(e){var t=this;return Object(o["a"])(Object(r["a"])().mark((function a(){var n,i,o,s,c,l,u;return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.index,n=e.row,i=e.operate,o=null,a.t0=i.id,a.next="delete"===a.t0?6:"edit"===a.t0?22:"deploy"===a.t0?25:"start"===a.t0?44:"stop"===a.t0?62:"manage"===a.t0?80:82;break;case 6:return a.prev=6,a.next=9,t.$confirm("确定要删除【".concat(n.name,"】吗?"),{type:"warning"});case 9:if(o=a.sent,"confirm"===o){a.next=12;break}return a.abrupt("return");case 12:return a.next=14,Object(f["a"])(n.id);case 14:s=a.sent,200===(null===s||void 0===s?void 0:s.code)&&(t.$message.success("删除成功"),t.getList()),a.next=21;break;case 18:a.prev=18,a.t1=a["catch"](6);case 21:return a.abrupt("break",83);case 22:return t.rowData=n,t.visible=!0,a.abrupt("break",83);case 25:return a.prev=25,a.next=28,t.$confirm("确定要一键部署【".concat(n.name,"】吗?"),{type:"warning"});case 28:if(o=a.sent,"confirm"===o){a.next=32;break}return a.abrupt("return");case 32:return t.tableConfig.loading=!0,a.next=35,Object(f["b"])(n.id);case 35:c=a.sent,200===(null===c||void 0===c?void 0:c.code)&&(t.$message.success("一键部署成功"),t.getList()),a.next=42;break;case 39:a.prev=39,a.t2=a["catch"](25);case 42:return t.tableConfig.loading=!1,a.abrupt("break",83);case 44:return a.prev=44,a.next=47,t.$confirm("确定要一键启动【".concat(n.name,"】吗?"),{type:"warning"});case 47:if(o=a.sent,"confirm"===o){a.next=50;break}return a.abrupt("return");case 50:return t.tableConfig.loading=!0,a.next=53,Object(f["e"])(n.id);case 53:l=a.sent,200===(null===l||void 0===l?void 0:l.code)&&(t.$message.success("一键启动成功"),t.getList()),a.next=60;break;case 57:a.prev=57,a.t3=a["catch"](44);case 60:return t.tableConfig.loading=!1,a.abrupt("break",83);case 62:return a.prev=62,a.next=65,t.$confirm("确定要一键停止【".concat(n.name,"】吗?"),{type:"warning"});case 65:if(o=a.sent,"confirm"===o){a.next=68;break}return a.abrupt("return");case 68:return t.tableConfig.loading=!0,a.next=71,Object(f["f"])(n.id);case 71:u=a.sent,200===(null===u||void 0===u?void 0:u.code)&&(t.$message.success("一键停止成功"),t.getList()),a.next=78;break;case 75:a.prev=75,a.t4=a["catch"](62);case 78:return t.tableConfig.loading=!1,a.abrupt("break",83);case 80:return t.$router.push({path:"/rocketmq/unitization/node-manage",query:{id:n.id,name:n.name,unitStructureId:n.unitStructureId,unitStructureName:n.unitStructureName,clusterId:n.clusterId,clusterName:n.clusterName}}),a.abrupt("break",83);case 82:case 83:case"end":return a.stop()}}),a,null,[[6,18],[25,39],[44,57],[62,75]])})))()},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},openAdd:function(){this.rowData=null,this.visible=!0},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()}}},D=x,_=Object(b["a"])(D,n,i,!1,null,"a3633b10",null);t["default"]=_.exports},"824c":function(e,t,a){},bb12:function(e,t,a){"use strict";a.r(t);var n,i,r=a("c7eb"),o=a("1da1"),s=(a("14d9"),{name:"PageNoauth",methods:{getBack:function(){this.$router.push("/home-page")},logout:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("user/logout");case 2:e.$router.push("/login");case 3:case"end":return t.stop()}}),t)})))()}},render:function(e){var t="/static/picture/no-data.svg";return e("div",{class:"wscn-http404"},[e("main",{class:"wscn-http404-container"},[e("div",{class:"pic-404"},[e("img",{class:"pic-404__parent",attrs:{src:t,alt:"404"}})]),e("div",{class:"bullshit"},[e("div",{class:"bullshit__oops"},["抱歉!"]),e("div",{class:"bullshit__headline"},["没有查询到您的菜单数据,请联系管理员"]),e("div",{class:"bullshit__info"},["Please check that the URL you entered is correct, or click the button below to return to the homepage."]),e("a",{attrs:{href:"javascript:;"},class:"bullshit__return-home",on:{click:this.getBack}},["返回主页"]),e("a",{attrs:{href:"javascript:;"},class:"bullshit__return-home ml-20",on:{click:this.logout}},["退出登录"])])])])}}),c=s,l=(a("7aa4"),a("2877")),u=Object(l["a"])(c,n,i,!1,null,"d160ee80",null);t["default"]=u.exports},bf80:function(e,t,a){"use strict";a.r(t);a("99af"),a("498a");var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"添加节点",visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[1===e.nodeType?t("el-form-item",{attrs:{label:"父节点"}},[e._v(" "+e._s("".concat(e.rowData.ip,":").concat(e.rowData.port))+" ")]):e._e(),t("el-form-item",{attrs:{label:"数据中心",prop:"idcId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择数据中心"},on:{change:e.changeIdcId},model:{value:e.formData.idcId,callback:function(t){e.$set(e.formData,"idcId",t)},expression:"formData.idcId"}},e._l(e.opts_idc,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"部署机器",prop:"machineId"}},[t("el-select",{staticClass:"w-100",attrs:{size:"mini",placeholder:"请选择部署机器"},on:{change:e.changeIp},model:{value:e.formData.machineId,callback:function(t){e.$set(e.formData,"machineId",t)},expression:"formData.machineId"}},e._l(e.machineList,(function(a){return t("el-option",{key:a.id,staticClass:"el-option-box",attrs:{label:"".concat(a.hostIp,"(").concat(a.hostSshAccount,")"),value:a.id}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.hostIp))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1)],1),t("el-form-item",{attrs:{label:"服务端口",prop:"port"}},[t("el-input-number",{staticClass:"w-100",attrs:{size:"mini","controls-position":"right",min:1e3,max:65535,placeholder:"服务端口"},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",t)},expression:"formData.port"}})],1),t("el-form-item",{attrs:{label:"部署路径"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入部署路径",size:"mini"},model:{value:e.formData.deployPath,callback:function(t){e.$set(e.formData,"deployPath","string"===typeof t?t.trim():t)},expression:"formData.deployPath"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},i=[],r=a("5530"),o=(a("7db0"),a("d81d"),a("a9e3"),a("d3b7"),a("ff51")),s=a("aa89"),c=a("9059"),l=a("142c"),u={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,refresh:Function,rowData:{type:Object,default:function(){return{}}},serverId:{type:String,default:void 0},nodeType:{type:Number,default:void 0}},data:function(){return{formData:{idcId:"",machineId:"",port:1e3,deployPath:""},machineList:[],rules:{idcId:[{required:!0,trigger:"change",message:"请选择数据中心"}],machineId:[{required:!0,trigger:"blur",message:"请选择节点"}],port:[{required:!0,trigger:"blur",message:"请输入端口"}]},options:[],loading:!1,opts_idc:[]}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}}},watch:{},created:function(){},mounted:function(){this.getIdcIds()},methods:{getIdcIds:function(){var e=this;this.opts_idc=[],Object(l["f"])().then((function(t){var a=Object(o["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_idc=a.map((function(e){return{label:"".concat(e.machineRoomCode,"(").concat(e.machineRoomName,")"),value:e.id}}))}))},changeIdcId:function(e){this.getIps(e)},getIps:function(e){var t=this;Object(s["a"])(e).then((function(e){t.machineList=Object(o["a"])(null===e||void 0===e?void 0:e.data)?e.data:[]})).catch((function(e){}))},changeIp:function(e){var t=this.machineList.find((function(t){return t.id===e})),a="";t&&t.deploymentPath&&(a=t.deploymentPath),this.formData.deployPath=a},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(r["a"])({serverId:e.serverId},e.formData);e.loading=!0,Object(c["c"])(a).then((function(t){t&&200===t.code&&(e.$message.success("添加成功"),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))}}))}}},d=u,f=(a("c021"),a("2877")),p=Object(f["a"])(d,n,i,!1,null,"239e389e",null);t["default"]=p.exports},c021:function(e,t,a){"use strict";a("6b32")},e37f:function(e,t,a){"use strict";a.r(t);a("99af"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mode-page"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-content",attrs:{"element-loading-text":"加载中,请稍候......"}},[t("div",{staticClass:"main-left"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickAddNode}},[e._v("添加节点")]),t("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),!e.loading&&e.linksData.length>0?t("G6Dagre",{attrs:{chartData:e.chartData,height:"500px",width:"100%"},on:{"click-node":e.clickNode}}):t("el-empty",{attrs:{description:"暂无数据"}})],1),t("div",{staticClass:"main-right"},[t("el-descriptions",{staticClass:"margin-top",staticStyle:{"padding-bottom":"10px","border-bottom":"1px solid #c6c6c6"},attrs:{title:e.baseInfo.name,column:1,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.refresh}},[e._v("刷新")])],1),t("el-descriptions-item",{attrs:{label:"单元化架构"}},[e._v(" "+e._s(e.baseInfo.unitStructureName)+" ")]),t("el-descriptions-item",{attrs:{label:"消息集群"}},[e._v(" "+e._s(e.baseInfo.clusterName)+" ")])],2),e.currentNode?[t("el-descriptions",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingNode,expression:"loadingNode"}],staticClass:"mt-10",staticStyle:{"padding-top":"15px"},attrs:{title:"".concat(e.currentNode.value,":").concat(e.currentNode.port),column:1,size:"small"}},[t("el-descriptions-item",{attrs:{label:"数据中心"}},[e._v(" "+e._s(e.currentNode.idcName)+" ")]),t("el-descriptions-item",{attrs:{label:"服务状态",labelStyle:{lineHeight:"28px"},contentStyle:{lineHeight:"28px"}}},[e._v(" "+e._s(e._f("F_nodeStatus")(e.currentNode.state))+" "),"1"===e.currentNode.state?t("el-button",{staticClass:"ml-10",attrs:{size:"mini",round:"",plain:"",type:"danger"},on:{click:function(t){return e.clickStop()}}},[e._v(" 停止 ")]):e._e(),"2"===e.currentNode.state?t("el-button",{staticClass:"ml-10",attrs:{type:"primary",size:"mini",round:"",plain:""},on:{click:function(t){return e.clickStart()}}},[e._v(" 启动 ")]):e._e()],1),t("el-descriptions-item",{attrs:{label:"部署端口"}},[e._v(" "+e._s(e.currentNode.port)+" ")]),t("el-descriptions-item",{attrs:{label:"部署路径"}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.currentNode.deployPath,expression:"currentNode.deployPath"}],attrs:{size:"mini"}},[e._v(e._s(e.currentNode.deployPath))])],1)],1),t("el-divider"),t("button-list",{attrs:{data:e.buttonList}})]:e._e()],2)]),e.showAdd?t("DialogAddNode",{attrs:{serverId:e.serverId,rowData:e.currentNode,refresh:e.refresh},model:{value:e.showAdd,callback:function(t){e.showAdd=t},expression:"showAdd"}}):e._e()],1)},i=[],r=a("5530"),o=a("c7eb"),s=a("1da1"),c=a("ade3"),l=(a("cb29"),a("14d9"),a("d3b7"),a("159b"),a("673d")),u=a("bf80"),d=a("ff51"),f=a("9059"),p=a("982b"),h={filters:{F_nodeStatus:function(e){return p["c"].get(e)}},components:{G6Dagre:l["default"],DialogAddNode:u["default"]},data:function(){var e=this;return Object(c["a"])({baseInfo:{},loading:!1,loadingNode:!1,loadingDeploy:!1,buttonList:[{label:"部署节点",click:this.clickDeployNode,get loading(){return e.loadingDeploy}},{label:"移除节点",click:this.clickNodeDelete}],chartData:{edges:[],nodes:[]},showAdd:!1,currentNode:null,linksData:[]},"loading",!1)},computed:{serverId:function(){return this.$route.query.id},query:function(){return this.$route.query}},created:function(){this.getDetail(),this.baseInfo.name=this.query.name,this.baseInfo.unitStructureName=this.query.unitStructureName,this.baseInfo.clusterName=this.query.clusterName},methods:{clickStart:function(){var e=this;this.loadingNode=!0,Object(f["e"])(this.currentNode.id).then((function(t){200===t.code&&(e.refresh(),e.$message.success("已启动"))})).finally((function(){e.loadingNode=!1}))},clickStop:function(){var e=this;this.loadingNode=!0,Object(f["f"])(this.currentNode.id).then((function(t){200===t.code&&(e.refresh(),e.$message.success("已停止"))})).finally((function(){e.loadingNode=!1}))},clickDeployNode:function(){var e=this;return Object(s["a"])(Object(o["a"])().mark((function t(){var a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingDeploy=!0,t.prev=1,t.next=4,Object(f["b"])(e.currentNode.id);case 4:a=t.sent,200===(null===a||void 0===a?void 0:a.code)&&(e.$message.success("部署成功"),e.refresh()),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1);case 11:e.loadingDeploy=!1;case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},getDetail:function(){var e=this;this.loading=!0,this.currentNode=null;var t={serverId:this.serverId};Object(f["d"])(t).then((function(t){if(t){var a=Object(d["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.linksData=a;var n=[],i=[];a.forEach((function(e){var t,a=void 0;"1"===e.isMaster?a="main":"0"===e.isMaster&&(a="cong");var i=null===(t=p["c"].getItem(e.state))||void 0===t?void 0:t.fill;n.push(Object(r["a"])(Object(r["a"])({},e),{},{value:e.ip,comboId:a,title:"".concat(e.ip,":").concat(e.port),style:{fill:i}}))})),e.chartData.nodes=n,e.chartData.edges=i}})).catch((function(e){})).finally((function(){e.loading=!1}))},clickAddNode:function(){this.showAdd=!0},clickNodeDelete:function(){var e=this;return Object(s["a"])(Object(o["a"])().mark((function t(){var a,n,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a="".concat(e.currentNode.ip,":").concat(e.currentNode.port),1!=e.currentNode.state){t.next=4;break}return e.$confirm("节点正在运行, 不可移除",a,{type:"warning",confirmButtonText:"关闭",showCancelButton:!1}).catch((function(e){})),t.abrupt("return");case 4:return t.prev=4,t.next=7,e.$confirm("确定要移除".concat(a,"吗?"),{type:"warning"});case 7:if(n=t.sent,"confirm"===n){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,Object(f["a"])(e.currentNode.id);case 12:i=t.sent,200==(null===i||void 0===i?void 0:i.code)&&(e.refresh(),e.$message.success("移除成功")),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](4);case 19:case"end":return t.stop()}}),t,null,[[4,16]])})))()},clickNode:function(e){this.currentNode=e},refresh:function(){this.getDetail()}}},m=h,g=(a("fc47"),a("2877")),b=Object(g["a"])(m,n,i,!1,null,"113974b8",null);t["default"]=b.exports},fc47:function(e,t,a){"use strict";a("824c")}}]);