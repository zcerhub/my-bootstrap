(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~61d7e293"],{"05fd":function(e,t,a){"use strict";a.r(t);a("99af"),a("d3b7"),a("5377"),a("ddb0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mode-page"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-content",attrs:{"element-loading-text":"加载中,请稍候......"}},[t("div",{staticClass:"main-left"},[t("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),e.linksData.length>0?t("G6Dagre",{attrs:{chartData:e.chartData,height:"500px",width:"100%"},on:{"click-node":e.clickNode}}):t("el-empty",{attrs:{description:"暂无数据"}})],1),t("div",{staticClass:"main-right"},[t("el-descriptions",{staticClass:"margin-top",attrs:{title:e.baseInfo.clusterName,column:2,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.refresh}},[e._v("刷新")])],1),t("el-descriptions-item",{attrs:{label:"模式"}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.baseInfo.clusterType,expression:"baseInfo.clusterType"}],attrs:{size:"mini"}},[e._v(e._s(e._f("F_cache_clusterTypeOptions")(e.baseInfo.clusterType)))])],1),t("el-descriptions-item",{attrs:{label:"节点总数"}},[e._v(" "+e._s(e.baseInfo.totalNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"主节点数"}},[e._v(" "+e._s(e.baseInfo.masterNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"运行节点"}},[e._v(" "+e._s(e.baseInfo.runNodeNum)+" ")])],2),e.currentNode?[t("el-descriptions",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingNode,expression:"loadingNode"}],staticClass:"mt-10",staticStyle:{"padding-top":"15px","border-top":"1px solid #c6c6c6"},attrs:{title:"".concat(e.currentNode.value,":").concat(e.currentNode.port),column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"角色"}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.currentQueryNode.flags,expression:"currentQueryNode.flags"}],attrs:{size:"mini"}},[e._v(e._s(e.currentQueryNode.flags))])],1),t("el-descriptions-item",{attrs:{label:"PID"}},[e._v(" "+e._s(e.currentQueryNode.pid)+" ")]),t("el-descriptions-item",{attrs:{label:"内存"}},[e._v(" "+e._s(e.currentQueryNode.usedMemory)+"M ")]),t("el-descriptions-item",{attrs:{label:"执行命令总数"}},[e._v(" "+e._s(e.currentQueryNode.totalCommandsProcessed)+" ")]),t("el-descriptions-item",{attrs:{label:"Key总数"}},[e._v(" "+e._s(e.currentQueryNode.keys)+" ")]),t("el-descriptions-item",{attrs:{label:"客户端数"}},[e._v(" "+e._s(e.currentQueryNode.clients)+" ")]),t("el-descriptions-item",{attrs:{label:"过期Key"}},[e._v(" "+e._s(e.currentQueryNode.expires)+" ")]),t("el-descriptions-item",{attrs:{label:"运行状态",span:2,labelStyle:{lineHeight:"28px"},contentStyle:{lineHeight:"28px"}}},[e._v(" "+e._s(1===e.currentQueryNode.runStatus?"运行中":"停止")+" "),1===e.currentQueryNode.runStatus?t("el-button",{staticClass:"ml-10",attrs:{size:"mini",round:"",plain:"",type:"danger",loading:e.loadingBtn},on:{click:function(t){return e.clickStartAndStop(e.currentNode,!1)}}},[e._v(" 停止 ")]):0===e.currentQueryNode.runStatus?t("el-button",{staticClass:"ml-10",attrs:{type:"primary",size:"mini",round:"",plain:"",loading:e.loadingBtn},on:{click:function(t){return e.clickStartAndStop(e.currentNode,!0)}}},[e._v(" 启动 ")]):e._e()],1)],1),t("el-divider"),t("button-list",{attrs:{data:e.buttonList}})]:e._e()],2)]),e.addmasternode?t("DialogAddNode",{attrs:{clusterId:e.clusterId,nodeType:e.nodeType_add,rowData:e.currentNode,refresh:e.refresh},model:{value:e.addmasternode,callback:function(t){e.addmasternode=t},expression:"addmasternode"}}):e._e(),e.startLogShow?t("DrawerPrismjsLog",{attrs:{show:e.startLogShow,rowData:e.currentNode},on:{"update:show":function(t){e.startLogShow=t}}}):e._e()],1)},o=[],i=a("5530"),r=a("ade3"),s=(a("7db0"),a("14d9"),a("1bf2"),a("3ca3"),a("159b"),a("2c34")),l=a("3882"),c=a("0ec7"),d=a("812d"),u=a("e8b2"),p=a("ff51"),m=a("bc59"),f=a("99ca"),h=a("2b0e"),y={components:{G6Dagre:s["default"],DialogAddNode:d["a"],DrawerPrismjsLog:Object(h["defineAsyncComponent"])((function(){return Promise.all([a.e("chunk-7ef164fc"),a.e("CacheStartLogs~f71cff67")]).then(a.bind(null,"21aa"))}))},data:function(){var e=this;return Object(r["a"])(Object(r["a"])(Object(r["a"])({startLogShow:!1,baseInfo:{},loading:!1,loadingNode:!1,buttonList:[{label:"+从节点",click:this.clickSlave,get hidden(){var t;return 0!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)}},{label:"移除节点",click:function(t){e.clickNodeDelete(t)},get hidden(){var t;return 1!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)},loading:!1},{label:"配置项",click:this.clickConfigParams,get hidden(){var t;return 1!==(null===(t=e.currentQueryNode)||void 0===t?void 0:t.runStatus)}},{label:"启动日志",click:this.clickStartLog}],chartData:{edges:[],nodes:[],combos:[]},addmasternode:!1,currentNode:null,currentQueryNode:v(),linksData:[]},"loading",!1),"loadingBtn",!1),"nodeType_add",0)},computed:{clusterId:function(){return this.$route.query.id},clusterType:function(){return this.$route.query.clusterType}},created:function(){this.getDetail(),this.getBaseInfo()},methods:{clickStartLog:function(){this.startLogShow=!0},getBaseInfo:function(){var e=this;this.baseInfo={},Object(l["h"])(this.clusterId).then((function(t){e.baseInfo=Object(u["a"])(null===t||void 0===t?void 0:t.data)?t.data:{}})).catch((function(e){}))},getDetail:function(){var e=this;this.loading=!0,this.currentNode=null,this.linksData=[],this.currentQueryNode=v(),this.chartData.combos=[],this.chartData.nodes=[],this.chartData.edges=[],Object(l["m"])(this.$route.query.id).then((function(t){if(t){var a=Object(p["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.linksData=a;var n=[],o=[];a.forEach((function(e){var t=void 0;2===e.nodeType?t="A":0===e.nodeType&&(t="B"),n.push(Object(i["a"])(Object(i["a"])({},e),{},{id:e.runId,value:e.hostIp,comboId:t,category:e.nodeType})),e.masterRunId&&"-"!==e.masterRunId&&o.push({source:e.masterRunId,target:e.runId})})),e.chartData.nodes=n,e.chartData.edges=o,n.some((function(e){return"B"===e.comboId}))&&e.chartData.combos.push(f["b"])}})).catch((function(e){})).finally((function(){e.loading=!1}))},clickAddNode:function(){this.nodeType_add=0,this.addmasternode=!0},clickSlave:function(){this.nodeType_add=1,this.addmasternode=!0},clickConfigParams:function(){var e="";e=2==this.currentNode.nodeType?"/cacheCluster/cache-config-params-sentinel":"/cacheCluster/cache-config-params",this.$router.push({path:e,query:{clusterId:this.clusterId,clusterNodeId:this.currentNode.clusterNodeId,nodeType:this.currentNode.nodeType}})},clickNodeDelete:function(e){var t=this;this.$confirm("确定要移除".concat(this.currentNode.hostIp,":").concat(this.currentNode.port,"吗?"),{type:"warning"}).then((function(a){t.removeNodeDeleteFile(e)})).catch((function(e){}))},removeNodeDeleteFile:function(e){var t=this;this.$confirm("移除节点的同时是否删除本地文件?",{type:"warning",cancelButtonText:"否",confirmButtonText:"是",showClose:!1,beforeClose:function(e,a,n){var o={id:t.currentNode.clusterNodeId,deleteFile:"0"};"confirm"===e?(o.deleteFile="1",a.confirmButtonLoading=!0,a.confirmButtonText="执行中..."):(a.cancelButtonLoading=!0,a.cancelButtonText="执行中..."),Object(c["c"])(o).then((function(e){200===e.code&&(t.$message.success("移除成功"),t.refresh())})).catch((function(e){})).finally((function(){n(),a.cancelButtonLoading=!1,a.confirmButtonLoading=!1}))}})},clickNode:function(e){var t=this;this.currentNode=e,this.loadingNode=!0,this.loadingBtn=!1;var a=this.buttonList.find((function(e){return"移除节点"===e.label}));a&&this.$set(a,"loading",!1),Object(c["e"])(e.clusterNodeId).then((function(e){t.currentQueryNode=v(null===e||void 0===e?void 0:e.data)})).catch((function(e){})).finally((function(){t.loadingNode=!1}))},refresh:function(){this.getBaseInfo(),this.getDetail()},clickStartAndStop:function(e,t){var a=this,n=t?"启动":"停止";this.$confirm("确定要".concat(n,"【").concat(e.label,"】吗?")).then((function(){a.loadingBtn=!0;var o={method:t?"start":"stop",clusterNodeId:e.clusterNodeId,clusterId:a.clusterId};Object(c["f"])(o).then((function(e){200===e.code&&(a.$message.success(n+"成功"),a.refresh())})).catch((function(e){})).finally((function(){a.loadingBtn=!1}))}))}}};function v(e){var t={pid:"",usedMemory:"",usedCpuSys:"",keys:"",clients:"",expires:"",flags:""};return e&&Reflect.ownKeys(t).forEach((function(a){Object(m["a"])(e,a)&&(t[a]=e[a])})),Object.assign(t,e)}var b=y,g=(a("c059"),a("2877")),k=Object(g["a"])(b,n,o,!1,null,"cbe57812",null);t["default"]=k.exports},"0ed0":function(e,t,a){},"2c34":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{style:{height:e.height,width:e.width},attrs:{id:"mountNode"}})},o=[],i=(a("99af"),a("a15b"),a("d3b7"),a("159b"),a("7c3e")),r={name:"g6-dagre",components:{},mixins:[],props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},chartData:{type:Object,default:function(){return{nodes:[],edges:[]}}}},data:function(){return{graph:null}},computed:{},watch:{},created:function(){},mounted:function(){this.initDagre(),window.addEventListener("resize",this.resize)},destroyed:function(){window.removeEventListener("resize",this.resize),this.graph=null},methods:{initDagre:function(){var e=this,t=this.chartData;t.nodes.forEach((function(e){0===e.nodeType?e.label="".concat(e.value,":").concat(e.port):1===e.nodeType?e.label="从节点\n".concat(e.value,":").concat(e.port):2===e.nodeType&&(e.label="".concat(e.value,":").concat(e.port))})),i["a"].registerNode("sql",{drawShape:function(e,t){var a=1===e.runStatus?"#67C23A":"#F56C6C",n=t.addShape("rect",{attrs:{x:-75,y:-25,width:150,height:50,radius:10,stroke:"#5B8FF9",fill:a,lineWidth:1},name:"rect-shape"});return n}},"single-node");var a=1===t.nodes.length,n=new i["a"].Graph({container:"mountNode",fitView:!0,pixelRatio:2,maxZoom:a?3:10,layout:{type:"dagre",ranksep:50,nodesep:50,controlPoints:!0,sortByCombo:!0},defaultNode:{type:"sql",style:{stroke:"#C4E3B2",radius:7}},defaultCombo:{type:"rect"},defaultEdge:{type:"polyline",style:{radius:20,offset:45,endArrow:!0,lineWidth:2,stroke:"#C2C8D5"}},comboStateStyles:{selected:{shadowBlur:1,lineWidth:1}},nodeStateStyles:{selected:{shadowColor:"#1d70f5",shadowBlur:10,lineWidth:2,cursor:"pointer"}},modes:{default:["drag-canvas","zoom-canvas","click-select",{type:"tooltip",formatText:function(e){var t=[];return t.join("\n")},offset:30}]}});n.data(t),n.render(),n.fitView(),this.graph=n,n.on("node:click",(function(t){t.target;var a=t.item,n=a.getModel();e.$emit("click-node",n)}))},resize:function(){var e=this.$el,t=e.offsetHeight,a=e.offsetWidth;this.graph.changeSize(a,t)}}},s=r,l=a("2877"),c=Object(l["a"])(s,n,o,!1,null,"7ef49858",null);t["default"]=c.exports},"2f4d":function(e,t,a){"use strict";a.r(t);a("99af"),a("caad"),a("d3b7"),a("5377"),a("ddb0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mode-page"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-content",attrs:{"element-loading-text":"加载中,请稍候......"}},[t("div",{staticClass:"main-left"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickAddNode}},[e._v("添加哨兵节点")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickAddSentinel}},[e._v("监控主从集群")]),t("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),e.linksData.length>0?t("G6Dagre",{attrs:{chartData:e.chartData,height:"500px",width:"100%"},on:{"click-node":e.clickNode}}):t("el-empty",{attrs:{description:"暂无数据"}})],1),t("div",{staticClass:"main-right"},[t("el-descriptions",{staticClass:"margin-top",attrs:{title:e.baseInfo.clusterName,column:2,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.refresh}},[e._v("刷新")])],1),t("el-descriptions-item",{attrs:{label:"模式"}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.baseInfo.clusterType,expression:"baseInfo.clusterType"}],attrs:{size:"mini"}},[e._v(e._s(e._f("F_cache_clusterTypeOptions")(e.baseInfo.clusterType)))])],1),t("el-descriptions-item",{attrs:{label:"哨兵节点数"}},[e._v(" "+e._s(e.baseInfo.totalNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"监控主节点"}},[e._v(" "+e._s(e.baseInfo.masterNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"运行节点"}},[e._v(" "+e._s(e.baseInfo.runNodeNum)+" ")])],2),e.currentNode?[t("el-descriptions",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingNode,expression:"loadingNode"}],staticClass:"mt-10",staticStyle:{"padding-top":"15px","border-top":"1px solid #c6c6c6"},attrs:{title:"".concat(e.currentNode.value,":").concat(e.currentNode.port),column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"角色",span:2}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.currentNode.flags,expression:"currentNode.flags"}],attrs:{size:"mini"}},[e._v(e._s(e.currentNode.flags))])],1),2!==e.currentNode.nodeType?t("el-descriptions-item",{attrs:{label:"主节点别名"}},[e._v(" "+e._s(e.currentNode.masterName)+" ")]):e._e(),t("el-descriptions-item",{attrs:{label:"PID"}},[e._v(" "+e._s(e.currentQueryNode.pid)+" ")]),2===e.currentNode.nodeType?t("el-descriptions-item",{attrs:{label:"客户端连接数"}},[e._v(" "+e._s(e.currentQueryNode.clients)+" ")]):e._e(),2===e.currentNode.nodeType?t("el-descriptions-item",{attrs:{label:"主节点数",span:2}},[e._v(" "+e._s(e.currentQueryNode.masterName)+" ")]):e._e(),t("el-descriptions-item",{attrs:{label:"内存"}},[e._v(" "+e._s(e.currentQueryNode.usedMemory)+"M ")]),2!==e.currentNode.nodeType?t("el-descriptions-item",{attrs:{label:"执行命令总数"}},[e._v(" "+e._s(e.currentQueryNode.totalCommandsProcessed)+" ")]):e._e(),[0,1].includes(e.currentNode.nodeType)?[t("el-descriptions-item",{attrs:{label:"Key总数"}},[e._v(" "+e._s(e.currentQueryNode.keys)+" ")]),t("el-descriptions-item",{attrs:{label:"客户端数"}},[e._v(" "+e._s(e.currentQueryNode.clients)+" ")]),t("el-descriptions-item",{attrs:{label:"过期Key"}},[e._v(" "+e._s(e.currentQueryNode.expires)+" ")])]:e._e(),t("el-descriptions-item",{attrs:{label:"运行状态",span:2,labelStyle:{lineHeight:"28px"},contentStyle:{lineHeight:"28px"}}},[e._v(" "+e._s(1===e.currentQueryNode.runStatus?"运行中":"停止")+" "),1===e.currentQueryNode.runStatus?t("el-button",{staticClass:"ml-10",attrs:{size:"mini",round:"",plain:"",type:"danger",loading:e.loadingBtn},on:{click:function(t){return e.clickStartAndStop(e.currentNode,!1)}}},[e._v(" 停止 ")]):0===e.currentQueryNode.runStatus?t("el-button",{staticClass:"ml-10",attrs:{type:"primary",size:"mini",round:"",plain:"",loading:e.loadingBtn},on:{click:function(t){return e.clickStartAndStop(e.currentNode,!0)}}},[e._v(" 启动 ")]):e._e()],1)],2),t("el-divider"),t("button-list",{attrs:{data:e.buttonList}})]:e._e()],2)]),e.addmasternode?t("DialogAddNode",{attrs:{clusterId:e.clusterId,nodeType:e.nodeType_add,rowData:e.currentNode,refresh:e.refresh},model:{value:e.addmasternode,callback:function(t){e.addmasternode=t},expression:"addmasternode"}}):e._e(),e.sentinelShow?t("ModeSentinelAdd",{attrs:{clusterId:e.clusterId,baseInfo:e.baseInfo,refresh:e.refresh},model:{value:e.sentinelShow,callback:function(t){e.sentinelShow=t},expression:"sentinelShow"}}):e._e(),e.startLogShow?t("DrawerPrismjsLog",{attrs:{show:e.startLogShow,rowData:e.currentNode},on:{"update:show":function(t){e.startLogShow=t}}}):e._e()],1)},o=[],i=a("5530"),r=a("ade3"),s=(a("7db0"),a("14d9"),a("1bf2"),a("3ca3"),a("159b"),a("2c34")),l=a("3882"),c=a("0ec7"),d=a("812d"),u=a("e0ef"),p=a("99ca"),m=a("e8b2"),f=a("ff51"),h=a("bc59"),y=a("2b0e"),v={components:{G6Dagre:s["default"],DialogAddNode:d["a"],ModeSentinelAdd:u["default"],DrawerPrismjsLog:Object(y["defineAsyncComponent"])((function(){return Promise.all([a.e("chunk-7ef164fc"),a.e("CacheStartLogs~f71cff67")]).then(a.bind(null,"21aa"))}))},data:function(){var e=this;return Object(r["a"])(Object(r["a"])(Object(r["a"])(Object(r["a"])({startLogShow:!1,baseInfo:{},loading:!1,loadingNode:!1,buttonList:[{label:"+从节点",click:this.clickSlave,get hidden(){var t;return 0!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)}},{label:"主从切换",click:function(t){e.clickSentinelFailover(t)},get hidden(){var t;return 0!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)}},{label:"移除节点",click:function(t){e.clickNodeDelete(t)},get hidden(){var t;return 0===(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)},loading:!1},{label:"配置项",click:this.clickConfigParams,get hidden(){var t;return 1!==(null===(t=e.currentQueryNode)||void 0===t?void 0:t.runStatus)}},{label:"启动日志",click:this.clickStartLog}],chartData:{edges:[],nodes:[],combos:[]},addmasternode:!1,currentNode:null,currentQueryNode:b(),linksData:[]},"loading",!1),"loadingBtn",!1),"nodeType_add",0),"sentinelShow",!1)},computed:{clusterId:function(){return this.$route.query.id},clusterType:function(){return this.$route.query.clusterType}},created:function(){this.getDetail(),this.getBaseInfo()},methods:{clickStartLog:function(){this.startLogShow=!0},getBaseInfo:function(){var e=this;this.baseInfo={},Object(l["h"])(this.clusterId).then((function(t){e.baseInfo=Object(m["a"])(null===t||void 0===t?void 0:t.data)?t.data:{}})).catch((function(e){}))},getDetail:function(){var e=this;this.loading=!0,this.currentNode=null,this.linksData=[],this.currentQueryNode=b(),this.chartData.combos=[],this.chartData.nodes=[],this.chartData.edges=[],Object(l["m"])(this.$route.query.id).then((function(t){if(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.linksData=a;var n=[],o=[],r={lineDash:[5,5],endArrow:!1};a.forEach((function(e){var t=void 0;2===e.nodeType?t="A":0===e.nodeType&&(t="B"),n.push(Object(i["a"])(Object(i["a"])({},e),{},{id:e.runId,value:e.hostIp,comboId:t,category:e.nodeType})),e.masterRunId&&"-"!==e.masterRunId&&o.push({source:e.masterRunId,target:e.runId}),0===e.nodeType&&Object(f["a"])(e.sentinelRunId)&&e.sentinelRunId.forEach((function(t){o.push({source:t,target:e.runId,color:"#722ed1",type:"line",style:r})}))})),n.some((function(e){return"A"===e.comboId}))&&e.chartData.combos.push(p["a"]),n.some((function(e){return"B"===e.comboId}))&&e.chartData.combos.push(p["b"]),e.chartData.nodes=n,e.chartData.edges=o}})).catch((function(e){})).finally((function(){e.loading=!1}))},clickAddNode:function(){this.nodeType_add=2,this.addmasternode=!0},clickSlave:function(){this.nodeType_add=1,this.addmasternode=!0},clickAddSentinel:function(){this.sentinelShow=!0},clickConfigParams:function(){var e="";e=2==this.currentNode.nodeType?"/cacheCluster/cache-config-params-sentinel":"/cacheCluster/cache-config-params",this.$router.push({path:e,query:{clusterId:this.clusterId,clusterNodeId:this.currentNode.clusterNodeId,nodeType:this.currentNode.nodeType}})},clickNodeDelete:function(e){var t=this;this.$confirm("确定要移除".concat(this.currentNode.hostIp,":").concat(this.currentNode.port,"吗?"),{type:"warning"}).then((function(){t.removeNodeDeleteFile(e)})).catch((function(e){}))},removeNodeDeleteFile:function(e){var t=this;this.$confirm("移除节点的同时是否删除本地文件?",{type:"warning",cancelButtonText:"否",confirmButtonText:"是",showClose:!1,beforeClose:function(e,a,n){var o={id:t.currentNode.clusterNodeId,deleteFile:"0"};"confirm"===e?(o.deleteFile="1",a.confirmButtonLoading=!0,a.confirmButtonText="执行中..."):(a.cancelButtonLoading=!0,a.cancelButtonText="执行中..."),Object(c["c"])(o).then((function(e){200===e.code&&(t.$message.success("移除成功"),t.refresh())})).catch((function(e){})).finally((function(){n(),a.cancelButtonLoading=!1,a.confirmButtonLoading=!1}))}})},clickSentinelFailover:function(e){var t=this;this.$confirm("确定要对主机".concat(this.currentNode.hostIp,":").concat(this.currentNode.port,"切换新主节点吗?"),{type:"warning"}).then((function(){t.$set(e,"loading",!0),Object(c["h"])({clusterId:t.clusterId,masterName:t.currentNode.masterName}).then((function(e){200===e.code&&t.$message.success("操作成功")})).catch((function(e){}))})).catch((function(e){})).finally((function(){t.$set(e,"loading",!1)}))},clickNode:function(e){var t=this;this.currentNode=e,this.loadingNode=!0,this.loadingBtn=!1;var a=this.buttonList.find((function(e){return"移除节点"===e.label}));a&&this.$set(a,"loading",!1),Object(c["e"])(e.clusterNodeId).then((function(e){t.currentQueryNode=b(null===e||void 0===e?void 0:e.data)})).catch((function(e){})).finally((function(){t.loadingNode=!1}))},refresh:function(){this.getBaseInfo(),this.getDetail()},clickStartAndStop:function(e,t){var a=this,n=t?"启动":"停止";this.$confirm("确定要".concat(n,"【").concat(e.label,"】吗?")).then((function(){a.loadingBtn=!0;var o={method:t?"start":"stop",clusterNodeId:e.clusterNodeId,clusterId:a.clusterId};Object(c["f"])(o).then((function(e){200===e.code&&(a.$message.success(n+"成功"),a.refresh())})).catch((function(e){})).finally((function(){a.loadingBtn=!1}))}))}}};function b(e){var t={pid:"",usedMemory:"",usedCpuSys:"",keys:"",clients:"",expires:"",masterName:"",totalCommandsProcessed:"",runStatus:""};return e&&Reflect.ownKeys(t).forEach((function(a){Object(h["a"])(e,a)&&(t[a]=e[a])})),Object.assign(t,e)}var g=v,k=(a("9ad3"),a("2877")),N=Object(k["a"])(g,n,o,!1,null,"65723df0",null);t["default"]=N.exports},"31ad":function(e,t,a){},"37c2":function(e,t,a){"use strict";a("9e36")},"45db":function(e,t,a){},"4af4":function(e,t,a){"use strict";a.r(t);a("a4d3"),a("e01a"),a("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e._l(e.tableData,(function(a,n){return t("el-row",{key:n},[t("el-descriptions",{attrs:{size:"medium",title:"",column:4,contentStyle:{"font-weight":"bold"},labelStyle:{"font-weight":"bold"}}},[t("el-descriptions-item",{attrs:{label:"主从集群别名"}},[e._v(e._s(a.name))]),t("el-descriptions-item",{attrs:{label:"主节点"}},[e._v(e._s(a.hostIp)+":"+e._s(a.port))])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:a.sentinelTableData,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"key",label:"参数项",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[""==a.row.description&&a.row.description?t("span",[e._v(e._s(a.row.key))]):t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.row.description,placement:"top-start"}},[t("span",[e._v(e._s(a.row.key))])])]}}],null,!0)}),t("el-table-column",{attrs:{prop:"title",label:"中文名称",width:"300"}}),t("el-table-column",{attrs:{label:"参数值"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return[t("el-input",{attrs:{size:"mini",disabled:n.readonly},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"row.value"}})]}}],null,!0)})],1)],1)})),t("el-form",[t("el-form-item",{attrs:{label:"是否应用于全部节点"}},[t("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.flag,callback:function(t){e.flag=t},expression:"flag"}})],1)],1),t("footer",{staticClass:"mt-10",staticStyle:{"padding-bottom":"100px"}},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.confirmSave}},[e._v("保存")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],2)},o=[],i=(a("d81d"),a("14d9"),a("b64b"),a("d3b7"),a("159b"),a("3882")),r=[{id:1,key:"down-after-milliseconds",label:"downAfterMilliseconds",value:"",type:"input",params:"",options:[],title:"哨兵主观上认为主节点下线时间，默认30秒",description:"指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒",elementType:"文本框",readonly:!1},{id:2,key:"failover-timeout",label:"failoverTimeout",value:"",type:"input",params:"",options:[],title:"故障转移的超时时间 failover-timeout",description:"故障转移的超时时间 failover-timeout 可以用在以下这些方面： #1. 同一个sentinel对同一个master两次failover之间的间隔时间。 #2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。#3.当想要取消一个正在进行的failover所需要的时间。  #4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向mast",elementType:"文本框%（带有百分号）默认75%",readonly:!1},{id:3,key:"quorum",label:"quorum",value:"",type:"input",params:"",options:[],title:"自动故障转移触发条件。",description:"将master判断为失效至少需要N个Sentinel同意，仅用于检测master连接失败。如redis集群中有5个sentinel实例，若这里的票数是2，master挂掉，表示有2个sentinel认为master挂掉才能被认为是真正的挂掉，此时会触发自动故障转移。",elementType:"文本框",readonly:!1},{id:4,key:"parallel-syncs",label:"parallelSyncs",value:"",type:"input",params:"",options:[],title:"在发生failover主备切换时最多可以有多少个slave同时对新的master进行",description:"这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态",elementType:"文本框",readonly:!1}],s=a("ec41"),l=a("ff51"),c={name:"cache-config-params",components:{},data:function(){return{fileList:[],tableData:[],flag:"1",loading:!1}},computed:{clusterId:function(){return this.$route.query.clusterId},clusterNodeId:function(){return this.$route.query.clusterNodeId},nodeType:function(){return this.$route.query.nodeType}},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e=this,t={clusterId:this.clusterId,clusterNodeId:this.clusterNodeId,nodeType:this.nodeType};this.loading=!0,Object(i["t"])(t).then((function(t){var a=Object(s["a"])(t,"data.sentinelMasterList"),n=Object(l["a"])(a)?a:[],o=n.map((function(e){var t=[];r.forEach((function(a){var n={};Object.keys(e).forEach((function(t){t===a.label&&(n.label=a.label,n.value=e[t],n.title=a.title,n.description=a.description,n.key=a.key)})),t.push(n)}));var a={sentinelTableData:t,name:e.name,hostIp:e.hostIp,port:e.port};return a}));e.tableData=o})).catch((function(e){})).finally((function(){e.loading=!1}))},clickCancel:function(){this.$router.go(-1)},confirmSave:function(){var e=this,t=[];this.tableData.forEach((function(e){var a={};e.sentinelTableData.forEach((function(t){a[t.label]=t.value,a.name=e.name})),t.push(a)}));var a={clusterId:this.clusterId,clusterNodeId:this.clusterNodeId,nodeType:this.nodeType,flag:this.flag,sentinelMasterList:t};this.loading=!0,Object(i["n"])(a).then((function(t){200===t.code&&e.$message.success("保存成功")})).catch((function(e){})).finally((function(){e.loading=!1}))}}},d=c,u=a("2877"),p=Object(u["a"])(d,n,o,!1,null,"3988d360",null);t["default"]=p.exports},"6a82":function(e,t,a){"use strict";a.r(t);a("a4d3"),a("e01a");var n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("el-row",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",height:"auto","row-class-name":e.tableRowClassName}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"name",label:"参数项",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[""==a.row.description&&a.row.description?t("span",[e._v(e._s(a.row.key))]):t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.row.description,placement:"top-start"}},[t("span",[e._v(e._s(a.row.key))])])]}}])}),t("el-table-column",{attrs:{prop:"title",label:"中文名称",width:"300"}}),t("el-table-column",{attrs:{label:"参数值"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return[t("div",["radio"===n.type?t("span",[t("el-radio-group",{model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"row.value"}},e._l(n.options,(function(a){return t("el-radio",{key:a.id,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1):e._e(),"input"===n.type?t("span",[t("el-input",{attrs:{size:"mini",disabled:n.readonly},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"row.value"}})],1):e._e(),"inputNumber"===n.type?t("span",[t("el-input-number",{attrs:{min:n.min,size:"mini",disabled:n.readonly},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"row.value"}})],1):e._e(),"select"===n.type?t("el-select",{model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"row.value"}},e._l(n.options,(function(a){return t("el-option",{key:a.id,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1):e._e(),"text"===n.type?t("span",[e._v(" "+e._s(n.value)+" ")]):e._e()],1)]}}])})],1)],1),t("el-form",[t("el-form-item",{attrs:{label:"是否应用于全部节点"}},[t("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.flag,callback:function(t){e.flag=t},expression:"flag"}})],1)],1),t("footer",{staticClass:"mt-10",staticStyle:{"padding-bottom":"100px"}},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.confirmSave}},[e._v("保存")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=(a("99af"),a("4de4"),a("caad"),a("d81d"),a("b0c0"),a("4ec9"),a("d3b7"),a("2532"),a("3ca3"),a("159b"),a("ddb0"),a("3882")),r=[{label:"yes",value:"yes"},{label:"no",value:"no"}],s=["pidfile","dir","logfile","dbfilename"],l=[{id:1,key:"zset-max-ziplist-entries",value:"",type:"input",params:"",options:[],title:"zset压缩列表元素的最大值",description:"zset中压缩列表ziplist最大的元素是128个，超过128将会使用跳表skiplist+dict来存储",elementType:"文本框",readonly:!1},{id:2,key:"min-slaves-max-lag",value:"",type:"input",params:"",options:[],title:"不大于三个服务器时的延迟值得最大值",description:"在从服务器的数量少于3个，或者三个从服务器的延迟（lag）值都大于或等于10秒时，主服务器将拒绝执行写命令，这里的延迟值就是上面提到的INFO replication命令的lag值",elementType:"文本框",readonly:!1},{id:3,key:"active-defrag-cycle-max",value:"",type:"input",params:"",options:[],title:"自动清理过程所用CPU时间的比例",description:"表示自动清理过程所用CPU时间的比例不高于75%，一旦超过，就停止清理，从而避免在清理时，大量的内存拷贝阻塞Redis，导致响应延迟升高",elementType:"文本框%（带有百分号）默认75%",readonly:!1},{id:4,key:"replica-read-only",value:"yes",type:"radio",params:"",options:r,title:"副本从节点只读",description:"副本从节点只读，为了保持从节点和主节点的一致性，从节点一般都是只读的",elementType:"单选下拉框（yes,no）默认yes",readonly:!1},{id:6,key:"hz",value:"",type:"input",params:"",options:[],title:"redis处理同时到期的许多key的参数",description:"默认设为10，提高它的值将会占用更多的cpu，当然相应的redis将会更快的处理同时到期的许多key，以及更精确的去处理超时",elementType:"文本框",readonly:!1},{id:8,key:"hash-max-ziplist-value",value:"",type:"input",params:"",options:[],title:"当hash中的value长度超过64的时候转为dict",description:"表示当hash中的value长度超过64的时候转为dict",elementType:"文本框",readonly:!1},{id:9,key:"slave-ignore-maxmemory",value:"",type:"input",params:"",options:[],title:"从节点是否忽略maxmemory配置",description:"从节点是否忽略maxmemory配置,默认yes",elementType:"文本框",readonly:!1},{id:10,key:"list-compress-depth",value:"",type:"input",params:"",options:[],title:"不压缩quicklist 距离首尾节点小于等于这个值的ziplist节点",description:"不压缩quicklist 距离首尾节点小于等于这个值的ziplist节点",elementType:"文本框",readonly:!1},{id:11,key:"databases",value:"",type:"input",params:"",options:[],title:"数据库的数量，默认数据库为0",description:"设置数据库的数量，默认数据库为0，可以使用SELECT 命令在连接上指定数据库id",elementType:"文本框",readonly:!1},{id:12,key:"latency-monitor-threshold",value:"",type:"input",params:"",options:[],title:"延迟峰值(尖峰) 是指运行时间超过latency-monitor-threshold 配置的阈值的事件",description:"延迟峰值(尖峰) 是指运行时间超过latency-monitor-threshold 配置的阈值的事件",elementType:"文本框",readonly:!1},{id:13,key:"hash-max-ziplist-entries",value:"",type:"input",params:"",options:[],title:"表示当hash项（field，value）数＞512即ziplist项＞1024的时候转为dict",description:"表示当hash项（field，value）数＞512即ziplist项＞1024的时候转为dict",elementType:"文本框",readonly:!1},{id:14,key:"proto-max-bulk-len",value:"",type:"input",params:"",options:[],title:"批量请求的大小限制",description:"批量请求的大小限制",elementType:"文本框",readonly:!1},{id:15,key:"maxclients",value:"",type:"inputNumber",max:"",min:1,params:"",options:[],title:"同时最大的连接数,默认1000,如果小于1启动失败",description:"同时最大的连接数,默认1000,如果小于1启动失败",elementType:"文本框",readonly:!1},{id:16,key:"lazyfree-lazy-eviction",value:"no",type:"radio",params:"",options:r,title:"针对redis内存使用达到maxmeory",description:"针对redis内存使用达到maxmeory，并设置有淘汰策略时；在被动淘汰键时，是否采用lazy free机制",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:17,key:"hll-sparse-max-bytes",value:"",type:"input",params:"",options:[],title:"大于这个值,hyperloglog使用稠密结构，小于等于这个值,使用稀疏结构大于16000无意义",description:"大于这个值,hyperloglog使用稠密结构，小于等于这个值,使用稀疏结构大于16000无意义,建议设置3000",elementType:"文本框",readonly:!1},{id:18,key:"active-defrag-threshold-lower",value:"",type:"input",params:"",options:[],title:"内存碎片空间占操作系统分配给Redis的总空间比例达到10%时",description:"表示内存碎片空间占操作系统分配给Redis的总空间比例达到10%时，开始清理",elementType:"文本框%（带有百分号）默认10%",readonly:!1},{id:19,key:"stream-node-max-entries",value:"",type:"input",params:"",options:[],title:"stream 的最大项数量",description:"stream 的最大项数量",elementType:"文本框",readonly:!1},{id:20,key:"slowlog-max-len",value:"",type:"input",params:"",options:[],title:"stream 的最大项数量",description:"慢查询日志长度。当一个新的命令被写进日志的时候，最老的那个记录会被删掉",elementType:"文本框",readonly:!1},{id:21,key:"zset-max-ziplist-value",value:"",type:"input",params:"",options:[],title:"zset中压缩列表ziplist中每个元素最大的个数是64个，超过64将会使用跳表skiplist+dict来存储",description:"zset中压缩列表ziplist中每个元素最大的个数是64个，超过64将会使用跳表skiplist+dict来存储",elementType:"文本框",readonly:!1},{id:22,key:"cluster-slave-no-failover",value:"",type:"radio",params:"no",options:r,title:"在主节点失效期间,从节点不允许对master失效转移",description:"在主节点失效期间,从节点不允许对master失效转移",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:24,key:"lua-time-limit",value:"",type:"input",params:"",options:[],title:"如果设置每次执行Lua脚本之前，服务器都会在Lua环境里面设置一个超时处理钩子（hook）",description:"如果设置每次执行Lua脚本之前，服务器都会在Lua环境里面设置一个超时处理钩子（hook）",elementType:"文本框",readonly:!1},{id:25,key:"slowlog-log-slower-than",value:"",type:"input",params:"",options:[],title:"执行时间比此参数大的请求记录到slowlog里面，单位是微秒",description:"执行时间比此参数大的请求记录到slowlog里面，单位是微秒",elementType:"文本框",readonly:!1},{id:26,key:"active-defrag-ignore-bytes",value:"",type:"input",params:"",options:[],title:"表示内存碎片的字节数达到100MB时，开始清理",description:"表示内存碎片的字节数达到100MB时，开始清理",elementType:"文本框",isEdit:"是"},{id:27,key:"activerehashing",value:"yes",type:"radio",params:"",options:r,title:"是否重置Hash表,设置成yes后redis将每100毫秒使用1毫秒CPU时间来对redis的hash表重新hash",description:"是否重置Hash表,设置成yes后redis将每100毫秒使用1毫秒CPU时间来对redis的hash表重新hash",elementType:"单选下拉框（yes,no）默认yes",readonly:!1},{id:28,key:"stream-node-max-bytes",value:"",type:"input",params:"",options:[],title:"每个宏节点占用的内存容量上限为4096 Bytes",description:"单位为Byte，默认值为4096，即每个宏节点占用的内存容量上限为4096 Bytes。取值范围：0~999,999,999,999,999。0表示无限制",elementType:"文本框",readonly:!1},{id:29,key:"slave-lazy-flush",value:"no",type:"radio",params:"",options:r,title:"redis是否同步清空数据库的参数，默认yes",description:"默认no,那么redis是同步清空数据库,也就是停止完成其他请求来做清空数据库,如果遇到数据库很大会增加请求延时如果yes,那么则新建dict等数据结构,然后把清空数据库提交给后台线程做",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:30,key:"list-max-ziplist-size",value:"",type:"input",params:"",options:[],title:"用于配置 quicklist 中的每个节点的 ziplist 的大小",description:"用于配置 quicklist 中的每个节点的 ziplist 的大小",elementType:"文本框",isEdit:"是"},{id:32,key:"activedefrag",value:"no",type:"radio",params:"",options:r,title:"开启自动内存碎片整理(总开关)",description:"开启自动内存碎片整理(总开关)",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:33,key:"no-appendfsync-on-rewrite",value:"no",type:"radio",params:"",options:r,title:"是否在后台写时同步单写，默认值no(表示需要同步)",description:"是否在后台写时同步单写，默认值no(表示需要同步)",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:34,key:"client-output-buffer-limit",value:"",type:"input",params:"",options:[],title:"格式达到hard limit或者保持超过soft limit 持续sof seconds则断开连接",description:"格式client-output-buffer-limit <class> <hard limit> <soft limit> <soft seconds> client-output-buffer达到hard limit或者保持超过soft limit 持续sof seconds则断开连接",elementType:"文本框",readonly:!1},{id:35,key:"repl-disable-tcp-nodelay",value:"no",type:"radio",params:"",options:r,title:"yes表示redis会合并小的TCP包从而节省带宽，no则redis master会立即发送同步数据",description:"在slave和master同步后（发送psync/sync），后续的同步是否设置成TCP_NODELAY，yes表示redis会合并小的TCP包从而节省带宽，但会增加同步延迟（40ms），造成master与slave数据不一致no则redis master会立即发送同步数据，没有延迟前者关注性能，后者关注一致性",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:36,key:"loglevel",value:"notice",type:"radio",params:"",options:[{label:"debug",value:"debug"},{label:"verbose",value:"verbose"},{label:"notice",value:"notice"},{label:"warning",value:"warning"}],title:"日志记录级别",description:"指定日志记录级别，Redis 总共支持四个级别：debug、verbose、notice、warning，默认为 notice",elementType:"单选下拉框 debug verbose notice warning 默认为 notice ",readonly:!1},{id:37,key:"cluster-migration-barrier",value:"",type:"input",params:"",options:[],title:"当存在孤立主节点后,其他从节点会迁移作为这个孤立的主节点的从节点",description:"当存在孤立主节点后(没有从节点),其他从节点会迁移作为这个孤立的主节点的从节点(前提是这个从节点之前的主节点至少还有这个数额个从节点)",elementType:"文本框",readonly:!1},{id:38,key:"lfu-decay-time",value:"",type:"input",params:"",options:[],title:"小于0则启动失败",description:"小于0则启动失败",elementType:"文本框",readonly:!1},{id:39,key:"replica-lazy-flush",value:"no",type:"radio",params:"",options:r,title:"是否同步清空数据库",description:"默认no,那么redis是同步清空数据库,也就是停止完成其他请求来做清空数据库,如果遇到数据库很大会增加请求延时如果yes,那么则新建dict等数据结构,然后把清空数据库提交给后台线程做",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:40,key:"maxmemory-samples",value:"",type:"input",params:"",options:[],title:"lru,lfu会对这个数量的key进行检查",description:"lru,lfu会对这个数量的key进行检查,设置过高会消耗cpu,如果小于0则启动失败",elementType:"文本框",readonly:!1},{id:41,key:"tcp-keepalive",value:"",type:"input",params:"",options:[],title:"用于检测tcp连接是否还存活",description:"用于检测tcp连接是否还存活,建议设置300(单位是秒),如果小于0启动失败",elementType:"文本框",readonly:!1},{id:42,key:"stop-writes-on-bgsave-error",value:"yes",type:"radio",params:"",options:r,title:"basave错误后是否停止接受写请求",description:"basave错误后是否停止接受写请求",elementType:"单选下拉框（yes,no）默认yes",readonly:!1},{id:45,key:"min-slaves-to-write",value:"",type:"input",params:"",options:[],title:"从服务器延迟时间",description:"在从服务器的数量少于3个，或者三个从服务器的延迟（lag）值都大于或等于10秒时，主服务器将拒绝执行写命令，这里的延迟值就是上面提到的INFO replication命令的lag值",elementType:"文本框",readonly:!1},{id:46,key:"syslog-facility",value:"local0",type:"radio",params:"",options:[{label:"user",value:"user"},{label:"local0",value:"local0"},{label:"local1",value:"local1"},{label:"local2",value:"local2"},{label:"local3",value:"local3"},{label:"local4",value:"local4"},{label:"local5",value:"local5"},{label:"local6",value:"local6"},{label:"local7",value:"local7"}],title:"syslog的facility,取值范围",description:"syslog的facility,取值范围,user,local0-local7",elementType:"单选下拉框 user local0 local1 local2 local3 local4 local5 local6 local7 默认 local0 ",readonly:!1},{id:47,key:"repl-timeout",value:"",type:"input",params:"",options:[],title:"从库向主库PING的超时时长",description:"从库向主库PING的超时时长，应大于 repl-ping-slave-period",elementType:"文本框",readonly:!1},{id:48,key:"dynamic-hz",value:"yes",type:"radio",params:"",options:r,title:"设置yes,则根据客户端连接数可以自动调节hz",description:"设置yes,则根据客户端连接数可以自动调节hz",elementType:"单选下拉框（yes,no）默认yes",readonly:!1},{id:50,key:"notify-keyspace-events",value:"",type:"input",params:"",options:[],title:"空字符串表示通知已禁用",description:"#事件通知 #零个或多个字符。空字符串表示通知已禁用。",elementType:"文本框",readonly:!1},{id:52,key:"lfu-log-factor",value:"",type:"input",params:"",options:[],title:"根据LRU counter计数规则 lfu-log-factor设置越大，递增概率越低",description:"根据LRU counter计数规则 lfu-log-factor设置越大，递增概率越低",elementType:"文本框",readonly:!1},{id:53,key:"tcp-backlog",value:"",type:"input",params:"",options:[],title:"TCP 监听的最大容纳数量",description:"TCP 监听的最大容纳数量",elementType:"文本框",readonly:!1},{id:54,key:"protected-mode",value:"yes",type:"radio",params:"",options:r,title:"默认是yes，即开启。设置外部网络连接redis服务",description:"默认是yes，即开启。设置外部网络连接redis服务",elementType:"单选下拉框（yes,no）默认yes",readonly:!1},{id:55,key:"lazyfree-lazy-expire",value:"no",type:"radio",params:"",options:r,title:"删除过期key的参数",description:"默认no,那么redis是同步删除过期key,也就是停止完成其他请求来做删除过期key,如果遇到key复杂度很大时(0(n))的会增加请求延时如果yes,把删除key的任务提交给后台线程做",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:56,key:"slave-serve-stale-data",value:"yes",type:"radio",params:"",options:r,title:"回复客户端请求的数据参数",description:"当slave跟master失去连接,复制进程却还在运行，设置yes slave将回复客户端的请求 但数据可能是过期的,如果是第一次同步 数据是空的 ，设置no slave将对各种命令回复”sync with master”错误,除了info和slaveof",elementType:"单选下拉框（yes,no）默认yes",readonly:!1},{id:57,key:"timeout",value:"",type:"input",params:"",options:[],title:"客户端超时",description:"当客户端闲置多长秒后关闭连接，如果指定为 0 ，表示关闭该功能",elementType:"文本框",readonly:!1},{id:58,key:"repl-ping-slave-period",value:"",type:"input",params:"",options:[],title:"从库向主库PING的间隔（秒）,从发给主的心跳周期,如果小于0则启动失败",description:"从库向主库PING的间隔（秒）,从发给主的心跳周期,如果小于0则启动失败",elementType:"文本框",readonly:!1},{id:59,key:"watchdog-period",value:"",type:"input",params:"",options:[],title:"单位为毫秒，运行时间超过设置时间的操作将会被记录下来",description:"单位为毫秒，运行时间超过设置时间的操作将会被记录下来",elementType:"文本框",readonly:!1},{id:60,key:"cluster-node-timeout",value:"",type:"input",params:"",options:[],title:"节点超时时限",description:"节点超时时限",elementType:"文本框",readonly:!1},{id:61,key:"repl-backlog-size",value:"",type:"input",params:"",options:[],title:"环形缓冲复制队列大小",description:"环形缓冲复制队列大小,可不带单位,但同时支持单位:b、k、kb、m、mb、g、gb,单位不区分大小写",elementType:"文本框",readonly:!1},{id:62,key:"lazyfree-lazy-server-del",value:"no",type:"radio",params:"",options:r,title:"隐式的DEL键的操作",description:"针对有些指令在处理已存在的键时，会带有一个隐式的DEL键的操作",elementType:"单选下拉框（yes,no）默认no",readonly:!1},{id:63,key:"active-defrag-threshold-upper",value:"",type:"input",params:"",options:[],title:"内存碎片超过 设置百分比",description:"内存碎片超过 设置百分比，则尽最大努力整理",elementType:"文本框%（带有百分号）默认100%",readonly:!1},{id:64,key:"active-defrag-max-scan-fields",value:"",type:"input",params:"",options:[],title:"key的随便整理阈值参数设置",description:"碎片整理 扫描set/hash/zset/list时，仅当 set/hash/zset/list 的长度小于此阀值时，才会将此key加入碎片整理；",elementType:"文本框",readonly:!1},{id:65,key:"client-query-buffer-limit",value:"",type:"input",params:"",options:[],title:"客户端查询缓存大小限制",description:"客户端查询缓存大小限制,如果multi/exec 大可以考虑调节",elementType:"文本框",readonly:!1},{id:67,key:"repl-backlog-ttl",value:"",type:"input",params:"",options:[],title:"复制积压的生命期,超过多长时间从节点还没重连,则释放内存",description:"复制积压的生命期,超过多长时间从节点还没重连,则释放内存",elementType:"文本框",isEdit:"是"},{id:68,key:"slave-priority",value:"",type:"input",params:"",options:[],title:"当master不在工作后,从节点提升为master的优先级",description:"当master不在工作后,从节点提升为master的优先级,0则不会提升为master越小优先级越高",elementType:"文本框",readonly:!1},{id:69,key:"set-max-intset-entries",value:"",type:"input",params:"",options:[],title:"set类型的元素设置",description:"当set 的元素数量小于这个值且元素可以用int64范围的整型表示时,使用inset,节约内存大于或者元素无法用int64范围的整型表示时用set表示",elementType:"文本框",readonly:!1},{id:70,key:"active-defrag-cycle-min",value:"",type:"input",params:"",options:[],title:"自动清理过程所用CPU时间的比例不低于25%",description:"表示自动清理过程所用CPU时间的比例不低于25%，保证清理能正常开展",elementType:"文本框%（带有百分号）默认5%",readonly:!1},{id:5,key:"pidfile",value:"",type:"text",params:"",options:[],title:"存储redis.pid的文件",description:"当 Redis 以守护进程方式运行时，Redis 默认会把 pid 写入 /var/run/redis.pid 文件，可以通过 pidfile 指定",elementType:"文本框",readonly:!1},{id:43,key:"dir",value:"",type:"text",params:"",options:[],title:"工作目录",description:"工作目录",elementType:"文本框",readonly:!1},{id:49,key:"logfile",value:"",type:"text",params:"",options:[],title:"日志记录文件",description:"日志记录方式，默认为标准输出，如果配置 Redis 为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给 /dev/null",elementType:"文本框",readonly:!1},{id:44,key:"dbfilename",value:"",type:"text",params:"",options:[],title:"设置 dump 的文件位置",description:"设置 dump 的文件位置",elementType:"文本框",readonly:!1}],c=a("ec41"),d=a("ff51"),u={name:"cache-config-params",components:{},data:function(){return{fileList:[],tableData:l,flag:"1",loading:!1}},computed:{clusterId:function(){return this.$route.query.clusterId},clusterNodeId:function(){return this.$route.query.clusterNodeId},nodeType:function(){return this.$route.query.nodeType},deployModel:function(){return this.$route.query.deployModel}},created:function(){},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e=this,t={clusterId:this.clusterId,clusterNodeId:this.clusterNodeId,nodeType:this.nodeType};this.loading=!0,Object(i["t"])(t).then((function(t){var a=Object(c["a"])(t,"data.redisConfigList"),n=Object(d["a"])(a)?a:[],o=new Map;n.forEach((function(e){o.set(e.configKey,e.configValue)})),e.tableData.forEach((function(e){o.has(e.key)&&(e.value=o.get(e.key))}))})).catch((function(e){})).finally((function(){e.loading=!1}))},clickCancel:function(){this.$router.go(-1)},confirmSave:function(){var e=this,t=this.tableData.map((function(e){return{configKey:e.key,configValue:e.value}}));0!=this.clusterType&&2!=this.clusterType||(t=t.filter((function(e){return!s.includes(e.configKey)})));var a={clusterId:this.clusterId,clusterNodeId:this.clusterNodeId,nodeType:this.nodeType,flag:this.flag,redisConfigList:t};this.loading=!0,Object(i["n"])(a).then((function(t){200===t.code&&e.$message.success("保存成功")})).catch((function(e){})).finally((function(){e.loading=!1}))},downLoad:function(){},beforeUpload:function(e){var t=e.name.split(".")[1];return"xls"==t||"xlsx"==t||(this.$message.error("请上传xl或者xlsx格式的文件"),!1)},handleRemove:function(e,t){},handlePreview:function(e){},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},beforeRemove:function(e,t){return this.$confirm("确定移除 ".concat(e.name,"？"))},handleSuccess:function(e,t,a){this.$message.success("上传成功")},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"text"===t.type?"readonly-text-item":""}}},p=u,m=(a("37c2"),a("2877")),f=Object(m["a"])(p,n,o,!1,null,"9436ab60",null);t["default"]=f.exports},"812d":function(e,t,a){"use strict";a("99af"),a("b0c0"),a("498a");var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.title,visible:e.visible,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[1===e.nodeType?t("el-form-item",{attrs:{label:"父节点"}},[e._v(" "+e._s("".concat(e.rowData.hostIp,":").concat(e.rowData.port))+" ")]):e._e(),t("el-form-item",{attrs:{label:"节点",prop:"machineId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择节点",filterable:""},on:{change:e.changeIp},model:{value:e.formData.machineId,callback:function(t){e.$set(e.formData,"machineId",t)},expression:"formData.machineId"}},e._l(e.csMixMachine,(function(a){return t("el-option",{key:a.value,staticClass:"el-option-box",attrs:{label:"".concat(a.label,"(").concat(a.hostSshAccount,")"),value:a.value}},[t("ul",{staticClass:"el-option-ul-between"},[t("li",[e._v(e._s(a.label))]),t("li",[e._v(e._s(a.hostSshAccount))])])])})),1)],1),t("el-form-item",{attrs:{label:"节点端口",prop:"port"}},[t("el-input-number",{staticClass:"w-100",attrs:{"controls-position":"right",min:0,max:65535,placeholder:"端口"},model:{value:e.formData.port,callback:function(t){e.$set(e.formData,"port",t)},expression:"formData.port"}})],1),t("el-form-item",{attrs:{label:"路径",prop:"deployPath"}},[t("el-input",{staticClass:"w-100",attrs:{placeholder:"请输入路径"},model:{value:e.formData.deployPath,callback:function(t){e.$set(e.formData,"deployPath","string"===typeof t?t.trim():t)},expression:"formData.deployPath"}})],1),t("el-form-item",{attrs:{label:"配置模板",prop:"name"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}},e._l(e.opts_name,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("5530"),r=(a("7db0"),a("a9e3"),a("d3b7"),a("0ec7")),s=a("082f"),l=a("ff51"),c=a("1b62"),d=c["a"].CommonSelectCreaterMix,u={components:{},mixins:[d("csMixMachine")],model:{prop:"show",event:"change"},props:{show:Boolean,refresh:Function,rowData:{type:Object,default:function(){return{}}},clusterId:{type:String,default:void 0},nodeType:{type:Number,default:void 0}},data:function(){return{formData:{machineId:"",deployPath:"",port:"",name:""},opts_name:[],rules:{machineId:[{required:!0,trigger:"change",message:"请选择节点"}],port:[{required:!0,trigger:"blur",message:"请输入端口"}],deployPath:[{required:!0,trigger:"blur",message:"请输入路径"}],name:[{required:!1,trigger:"change",message:"请选择配置模板"}]},options:[],loading:!1}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},title:function(){return 0===this.nodeType?"添加主节点":1===this.nodeType?"添加从节点":2===this.nodeType?"添加哨兵节点":"添加--"}},watch:{},created:function(){this.getOpts_name()},mounted:function(){var e="";0===this.nodeType?e=20001:1===this.nodeType?e=20002:2===this.nodeType&&(e=23001),this.formData.port=e},methods:{getOpts_name:function(){var e=this,t={moduleType:"REDIS",componentType:"CACHE"};this.opts_name=[],Object(s["c"])(t).then((function(t){e.opts_name=Object(l["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},changeIp:function(e){var t=this.csMixMachine.find((function(t){return t.id===e})),a="";t&&t.deploymentPath&&(a=t.deploymentPath+"/redis-cluster"),this.formData.deployPath=a},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a;e.loading=!0;var n=Object(i["a"])({clusterId:e.clusterId,nodeType:e.nodeType,parentId:""},e.formData);if(1===e.nodeType&&null!==(a=e.rowData)&&void 0!==a&&a.clusterNodeId&&(n.parentId=e.rowData.clusterNodeId,n.masterRunId=e.rowData.runId),!n)return;Object(r["a"])(n).then((function(t){e.$message.success("检测通过,正在进行新增"),e.loading=!0,Object(r["b"])(n).then((function(t){t&&200===t.code&&(e.$message.success(e.title+"成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){})).finally((function(){e.loading=!1}))}))}}))}}},p=u,m=(a("9a86"),a("2877")),f=Object(m["a"])(p,n,o,!1,null,"4b420c7c",null);t["a"]=f.exports},"99ca":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return o}));var n={id:"A",label:"哨兵节点",style:{fill:"#fff",stroke:"#C4E3B2",lineWidth:1,shadowBlur:0,radius:7}},o={id:"B",label:"主节点",style:{fill:"#fff",stroke:"#C4E3B2",lineWidth:1,shadowBlur:0,radius:7}}},"9a86":function(e,t,a){"use strict";a("31ad")},"9ad3":function(e,t,a){"use strict";a("daaf")},"9d64":function(e,t,a){},"9e36":function(e,t,a){},"9edb":function(e,t,a){"use strict";a("45db")},b633:function(e,t,a){"use strict";a("0ed0")},c059:function(e,t,a){"use strict";a("9d64")},c3da:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{class:e.className,style:{height:e.height,width:e.width}})},o=[],i=(a("b0c0"),a("313e")),r=a.n(i),s=a("f42c"),l=a("6c0a");a("817d");var c={mixins:[s["a"]],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"100%"},chartData:{type:Object}},data:function(){return{chart:null}},mounted:function(){var e=this;this.$nextTick((function(){e.initChart()}))},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){var e=this;this.chart=r.a.init(this.$el,"macarons"),this.chart.setOption({tooltip:{show:!1},animationEasingUpdate:"quarticInOut",series:[{type:"graph",layout:"none",force:{edgeLength:225,repulsion:1e3,gravity:.1},left:"7%",top:"8%",animation:!1,tooltip:{formatter:"{c}",backgroundColor:"rgba(73, 132, 230, 0.7)"},itemStyle:{normal:{color:function(e){return 4!=e.data.category?"error"===e.data.status?"#d81e06":"#1296db":"transparent"}}},label:{normal:{show:!0,position:"bottom",fontSize:12,formatter:function(e){var t=e.value,a=(e.status,e.name,e.data);return"error"===a.status?"{a| "+t+"}":"{b| "+t+"}"},rich:{a:{color:"#ff0000"},b:{color:"#303133"}}}},lineStyle:{normal:{width:1,shadowColor:"none",color:"rgba(64, 158, 255,1)"}},categories:[{name:"主节点",symbol:"path://".concat(l["a"].hostPath),symbolSize:[30,30]},{name:"从节点",symbol:"path://".concat(l["a"].nodePath),symbolSize:[30,30]},{name:"哨兵节点",symbol:"path://".concat(l["a"].sentinelPath),symbolSize:[30,30]},{name:"Namesvr",label:{formatter:"{c}",fontSize:12,color:"#303133"},symbol:"path://".concat(l["a"].sentinelPath),symbolSize:[30,30],z:1,zlevel:1},{name:"网格",symbol:"rect",symbolSize:[600,80],itemStyle:{normal:{borderWidth:.5,borderColor:"#1296db",shadowColor:"transparent",shadowBlur:0,shadowOffsetX:0},emphasis:{show:!1}},label:{normal:{show:!1},emphasis:{show:!1}},z:0,zlevel:0}],data:this.chartData.data,links:this.chartData.links}]}),this.chart.on("click",(function(t){e.$emit("click-node",t)}))}}},d=c,u=a("2877"),p=Object(u["a"])(d,n,o,!1,null,null,null);t["default"]=p.exports},daaf:function(e,t,a){},e0ef:function(e,t,a){"use strict";a.r(t);a("99af"),a("caad"),a("b0c0"),a("2532"),a("498a");var n=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"添加监控主从集群",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"150px",rules:e.rules}},[t("el-form-item",{attrs:{label:"哨兵节点"}},e._l(e.baseInfoWacherNodes,(function(a,n){return t("el-tag",{key:n,staticClass:"ml-10"},[e._v(e._s(a))])})),1),t("el-form-item",{attrs:{label:"已监控主从集群",prop:"clusterName"}},[t("table",{staticClass:"w-100 custom-table"},[t("thead",[t("tr",[t("th",[e._v("集群名称")]),t("th",[e._v("主节点别名")]),t("th",[e._v("节点")]),t("th",{staticClass:"custom-table-actions"},[e._v("操作")])])]),t("tbody",e._l(e.clusterListWacher,(function(a,n){return t("tr",{key:n},[t("td",[e._v(e._s(a.clusterName))]),t("td",[e._v(e._s(a.masterName))]),t("td",e._l(a.nodeList,(function(a,o){return t("el-tag",{key:"".concat(n,"-").concat(o),staticClass:"m-5"},[e._v(e._s(a))])})),1),t("td",{staticClass:"custom-table-actions"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeWatcher(a.id)}}},[e._v("解除监控")])],1)])})),0)])]),t("el-form-item",{attrs:{label:"可监控主从集群",prop:"masterName"}},[t("el-checkbox-group",{model:{value:e.monitorList,callback:function(t){e.monitorList=t},expression:"monitorList"}},[t("el-form",{ref:"checkFormRef",attrs:{model:e.checkFormData,inline:!0}},[t("el-row",e._l(e.clusterListNoWacher,(function(a,n){return t("el-col",{key:a.clusterId,attrs:{span:24}},[t("el-checkbox",{attrs:{label:a}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:!a.nodes,placement:"top"}},[t("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(a.nodes)},slot:"content"}),t("span",{staticStyle:{"line-height":"28px"}},[e._v(e._s(a.name))])]),e.monitorListIds.includes(a.clusterId)?t("el-form-item",{staticClass:"ml-20",attrs:{label:"主节点别名",prop:"clusterList.".concat(n,".masterName"),rules:[{required:!0,message:"请输入主节点别名",trigger:"blur"},{pattern:/^[0-9a-zA-z]+$/,message:"只能输入数字,字母组合",trigger:"blur"}]}},[t("el-input",{staticClass:"ml-10",attrs:{placeholder:"请输入名称",size:"mini"},model:{value:a.masterName,callback:function(t){e.$set(a,"masterName","string"===typeof t?t.trim():t)},expression:"item.masterName"}})],1):e._e()],1)],1)})),1)],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},o=[],i=a("c7eb"),r=a("1da1"),s=(a("d81d"),a("d3b7"),a("ac1f"),a("5319"),a("5b81"),a("159b"),a("3882")),l=a("8121"),c=a("ff51"),d={name:"mode-sentinel-add",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,baseInfo:{type:Object,default:function(){return{}}},refresh:Function,clusterId:{type:String,default:void 0}},data:function(){return{formData:{clusterName:"",masterName:""},rules:{},monitorList:[],clusterListNoWacher:[],clusterListWacher:[]}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},monitorListIds:function(){return this.monitorList.map((function(e){return e.clusterId}))},baseInfoWacherNodes:function(){var e,t=null===(e=this.baseInfo)||void 0===e?void 0:e.nodes;return Object(l["a"])(t)&&t?t.split(","):null},checkFormData:function(){return{clusterList:this.clusterListNoWacher}}},watch:{},created:function(){this.getNoWatcher(),this.getWatcher()},mounted:function(){},methods:{getWatcher:function(){var e=this;Object(s["k"])(this.clusterId).then((function(t){var a=Object(c["a"])(t.data)?t.data:[];a.forEach((function(e){Object(l["a"])(e.nodes)&&e.nodes&&(e.nodeList=e.nodes.split(","))})),e.clusterListWacher=a})).catch((function(e){}))},getNoWatcher:function(){var e=this;Object(s["j"])(this.clusterId).then((function(t){var a=Object(c["a"])(t.data)?t.data:[];e.clusterListNoWacher=a.map((function(e){var t=null;return Object(l["a"])(e.nodes)&&e.nodes&&(t=e.nodes.replaceAll(",","<br>")),{clusterId:e.id,name:e.clusterName,masterName:e.masterName,nodes:t}}))})).catch((function(e){}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1),this.refresh()},removeWatcher:function(e){var t=this;this.$confirm("确定要解除该集群的监控吗?",{type:"warning"}).then((function(){Object(s["u"])(e).then((function(e){e&&200===e.code&&(t.$message.success("已解除集群"),t.getNoWatcher(),t.getWatcher())})).then((function(){}))})).catch((function(e){}))},clickConfirm:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.checkFormRef.validate();case 2:if(a=t.sent,a){t.next=5;break}return t.abrupt("return");case 5:e.$refs.formRef.validate((function(t){if(t){var a={clusterId:e.clusterId,monitorList:e.monitorList};Object(s["a"])(a).then((function(t){200===t.code&&(e.$message.success("添加成功"),e.$emit("change",!1),e.refresh())})).catch((function(e){}))}}));case 6:case"end":return t.stop()}}),t)})))()}}},u=d,p=(a("b633"),a("2877")),m=Object(p["a"])(u,n,o,!1,null,"54b2b5aa",null);t["default"]=m.exports},fc5ea:function(e,t,a){"use strict";a.r(t);a("99af"),a("d3b7"),a("5377"),a("ddb0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mode-page"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-content",attrs:{"element-loading-text":"加载中,请稍候......"}},[t("div",{staticClass:"main-left"},[e.isContainerDeploy?t("el-button",{attrs:{type:"primary"},on:{click:e.clickCapacity}},[e._v("扩缩容")]):t("el-button",{attrs:{type:"primary"},on:{click:e.clickAddNode}},[e._v("添加主节点")]),t("el-button",{attrs:{type:"primary"},on:{click:e.clickMoveTo}},[e._v("数据迁移")]),t("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),e.linksData.length>0?t("G6Dagre",{attrs:{chartData:e.chartData,height:"500px",width:"100%"},on:{"click-node":e.clickNode}}):t("el-empty",{attrs:{description:"暂无数据"}})],1),t("div",{staticClass:"main-right"},[t("el-descriptions",{staticClass:"margin-top",attrs:{title:e.baseInfo.clusterName,column:2,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.refresh}},[e._v("刷新")])],1),t("el-descriptions-item",{attrs:{label:"模式"}},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e._f("F_cache_clusterTypeOptions")(e.baseInfo.clusterType)))])],1),t("el-descriptions-item",{attrs:{label:"节点总数"}},[e._v(" "+e._s(e.baseInfo.totalNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"主节点数"}},[e._v(" "+e._s(e.baseInfo.masterNodes)+" ")]),t("el-descriptions-item",{attrs:{label:"运行节点"}},[e._v(" "+e._s(e.baseInfo.runNodeNum)+" ")])],2),e.currentNode?[t("el-descriptions",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingNode,expression:"loadingNode"}],staticClass:"mt-10",staticStyle:{"padding-top":"15px","border-top":"1px solid #c6c6c6"},attrs:{title:"".concat(e.currentNode.value,":").concat(e.currentNode.port),column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"角色"}},[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.currentQueryNode.flags,expression:"currentQueryNode.flags"}],attrs:{size:"mini"}},[e._v(e._s(e.currentQueryNode.flags))])],1),t("el-descriptions-item",{attrs:{label:"PID"}},[e._v(" "+e._s(e.currentQueryNode.pid)+" ")]),t("el-descriptions-item",{directives:[{name:"show",rawName:"v-show",value:0===e.currentNode.nodeType,expression:"currentNode.nodeType === 0"}],attrs:{label:"卡槽",span:2}},[e._v(" "+e._s(e.currentNode.slotRange)+" ")]),t("el-descriptions-item",{attrs:{label:"内存"}},[e._v(" "+e._s(e.currentQueryNode.usedMemory)+"M ")]),t("el-descriptions-item",{attrs:{label:"执行命令总数"}},[e._v(" "+e._s(e.currentQueryNode.totalCommandsProcessed)+" ")]),0===e.currentNode.nodeType?[t("el-descriptions-item",{attrs:{label:"Key总数"}},[e._v(" "+e._s(e.currentQueryNode.keys)+" ")]),t("el-descriptions-item",{attrs:{label:"客户端数"}},[e._v(" "+e._s(e.currentQueryNode.clients)+" ")]),t("el-descriptions-item",{attrs:{label:"过期Key"}},[e._v(" "+e._s(e.currentQueryNode.expires)+" ")])]:e._e(),t("el-descriptions-item",{attrs:{label:"运行状态",span:2,labelStyle:{lineHeight:"28px"},contentStyle:{lineHeight:"28px"}}},[e._v(" "+e._s(1===e.currentQueryNode.runStatus?"运行中":"停止")+" "),e.isContainerDeploy?e._e():[1===e.currentQueryNode.runStatus?t("el-button",{staticClass:"ml-10",attrs:{size:"mini",round:"",plain:"",type:"danger",loading:e.loadingBtn},on:{click:function(t){return e.clickStartAndStop(e.currentNode,!1)}}},[e._v(" 停止 ")]):0===e.currentQueryNode.runStatus?t("el-button",{staticClass:"ml-10",attrs:{type:"primary",size:"mini",round:"",plain:"",loading:e.loadingBtn},on:{click:function(t){return e.clickStartAndStop(e.currentNode,!0)}}},[e._v(" 启动 ")]):e._e()]],2)],2),t("el-divider"),t("button-list",{attrs:{data:e.buttonList}})]:e._e()],2)]),e.addmasternode?t("DialogAddNode",{attrs:{clusterId:e.clusterId,nodeType:e.nodeType_add,rowData:e.currentNode,refresh:e.refresh},model:{value:e.addmasternode,callback:function(t){e.addmasternode=t},expression:"addmasternode"}}):e._e(),e.moveToShow?t("DialogDataMoveTo",{attrs:{clusterId:e.clusterId,refresh:e.refresh},model:{value:e.moveToShow,callback:function(t){e.moveToShow=t},expression:"moveToShow"}}):e._e(),e.update2mainShow?t("DialogUpdateToMain",{attrs:{clusterId:e.clusterId,currentNode:e.currentNode,refresh:e.refresh},model:{value:e.update2mainShow,callback:function(t){e.update2mainShow=t},expression:"update2mainShow"}}):e._e(),e.startLogShow?t("DrawerPrismjsLog",{attrs:{show:e.startLogShow,rowData:e.currentNode},on:{"update:show":function(t){e.startLogShow=t}}}):e._e(),e.showCapacity?t("ChangeCapacity",{attrs:{refresh:e.refresh,rowData:null},model:{value:e.showCapacity,callback:function(t){e.showCapacity=t},expression:"showCapacity"}}):e._e()],1)},o=[],i=a("5530"),r=a("ade3"),s=(a("7db0"),a("14d9"),a("1bf2"),a("3ca3"),a("159b"),a("2c34")),l=a("3882"),c=a("0ec7"),d=a("812d"),u=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"数据迁移",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("tableView",{attrs:{loading:e.tableConfig.loading,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,rowKey:"id"}}),t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"120px",rules:e.rules}},[t("el-form-item",{attrs:{label:"源节点",prop:"sourceNodeId"}},[t("el-select",{key:"sourceNodeId",staticClass:"w-100",attrs:{size:"mini",placeholder:"请选择源节点",clearable:"",filterable:""},model:{value:e.formData.sourceNodeId,callback:function(t){e.$set(e.formData,"sourceNodeId",t)},expression:"formData.sourceNodeId"}},e._l(e.srcNodeList,(function(a){return t("el-option",{key:a.clusterNodeId,staticClass:"el-option-box",attrs:{label:"".concat(a.hostIp,"(").concat(a.port,")"),value:a.clusterNodeId,disabled:e.formData.targetNodeId===a.clusterNodeId}})})),1)],1),t("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"slot区间",prop:"slot"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"startSlot",label:"开始","label-width":"60px"}},[t("el-input-number",{staticStyle:{width:"calc(100% - 20px)"},attrs:{size:"mini","controls-position":"right",min:0,max:16383,placeholder:"开始区间"},model:{value:e.formData.startSlot,callback:function(t){e.$set(e.formData,"startSlot",t)},expression:"formData.startSlot"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"endSlot",label:"结束","label-width":"60px"}},[t("el-input-number",{staticStyle:{width:"calc(100% - 20px)"},attrs:{size:"mini","controls-position":"right",min:0,max:16383,placeholder:"结束区间"},model:{value:e.formData.endSlot,callback:function(t){e.$set(e.formData,"endSlot",t)},expression:"formData.endSlot"}})],1)],1)],1)],1),t("el-form-item",{attrs:{label:"目标节点",prop:"targetNodeId"}},[t("el-select",{key:"targetNodeId",staticClass:"w-100",attrs:{size:"mini",placeholder:"请选择目标节点",clearable:"",filterable:""},model:{value:e.formData.targetNodeId,callback:function(t){e.$set(e.formData,"targetNodeId",t)},expression:"formData.targetNodeId"}},e._l(e.nodeList,(function(a){return t("el-option",{key:a.clusterNodeId,staticClass:"el-option-box",attrs:{label:"".concat(a.hostIp,"(").concat(a.port,")"),value:a.clusterNodeId,disabled:e.formData.sourceNodeId===a.clusterNodeId}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.moveToLoading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},p=[],m=(a("d9e2"),a("4de4"),a("cfcc")),f=a("ff51"),h={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,clusterId:String},data:function(){var e=this,t=function(t,a,n){var o=e.formData,i=o.startSlot,r=o.endSlot;return i<=r?n():n(new Error("开始区间不能大于结束区间"))};return{moveToLoading:!1,tableConfig:{isPage:!1,loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"hostIp",label:"主节点IP"},{prop:"port",label:"主节点端口"},{prop:"runStatus",label:"状态",format:function(e){return Object(m["f"])(e,"runStatusOptions")}},{prop:"slotRange",label:"slot"},{prop:"keyCount",label:"key总数"}]},formData:{sourceNodeId:"",startSlot:0,endSlot:0,targetNodeId:""},rules:{sourceNodeId:[{required:!0,trigger:"change",message:"请选择源节点"}],startSlot:[{required:!0,trigger:"blur",message:"请输入开始区间"}],endSlot:[{required:!0,trigger:"blur",message:"请输入结束区间"},{validator:t,trigger:"blur"}],targetNodeId:[{required:!0,trigger:"change",message:"请选择目标节点"},{validator:t,trigger:"blur"}]}}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},srcNodeList:function(){var e=this.tableConfig.tableData;return e.filter((function(e){var t;return null!==(t=e.slotRange)&&void 0!==t&&t}))},nodeList:function(){return this.tableConfig.tableData}},watch:{},created:function(){},mounted:function(){this.getList()},methods:{getList:function(){var e=this;this.tableConfig.loading=!0,Object(l["r"])(this.clusterId).then((function(t){e.tableConfig.tableData=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate((function(t){if(t){var a=Object(i["a"])({clusterId:e.clusterId},e.formData);e.moveToLoading=!0,Object(l["p"])(a).then((function(t){t&&200===t.code&&(e.$message.success("数据迁移成功"),e.$emit("change",!1))})).finally((function(){e.moveToLoading=!1}))}}))}}},y=h,v=a("2877"),b=Object(v["a"])(y,u,p,!1,null,"ad50b230",null),g=b.exports,k=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"更换主",visible:e.visible,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("span",[e._v("当前节点："+e._s(e.currentNodeTitle))]),t("tableView",{attrs:{loading:e.tableConfig.loading,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,disabledRadio:e.disabledRadioUpdate2main,isRadio:!0,isPage:e.tableConfig.isPage,rowKey:"id"},on:{changeRadio:e.changeRadio}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},N=[],_={components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,clusterId:String,refresh:Function,currentNode:{type:Object,default:function(){return{}}}},data:function(){return{tableConfig:{isPage:!1,loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"hostIp",label:"主节点IP"},{prop:"port",label:"主节点端口"},{prop:"runStatus",label:"状态",format:function(e){return Object(m["f"])(e,"runStatusOptions")}},{prop:"slotRange",label:"slot"}]},selectedRadio:null}},computed:{visible:{get:function(){return this.show},set:function(e){this.$emit("change",!1)}},currentNodeTitle:function(){var e,t=null!==(e=this.currentNode)&&void 0!==e?e:{},a=t.hostIp,n=t.port;return"".concat(a,":").concat(n)}},watch:{},created:function(){},mounted:function(){this.getList()},methods:{getList:function(){var e=this;this.tableConfig.loading=!0,Object(l["r"])(this.clusterId).then((function(t){e.tableConfig.tableData=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},clickCancel:function(){this.$emit("change",!1)},disabledRadioUpdate2main:function(e){var t;return e.runId===(null===(t=this.currentNode)||void 0===t?void 0:t.masterRunId)},changeRadio:function(e){this.selectedRadio=e},clickConfirm:function(){var e=this;if(this.selectedRadio&&this.selectedRadio.runId){var t={masterRunId:this.selectedRadio.runId,clusterNodeId:this.currentNode.clusterNodeId};Object(c["g"])(t).then((function(t){t&&200===t.code&&(e.$emit("change",!1),e.refresh())}))}else this.$message.warning("请选择一条数据")}}},w=_,I=Object(v["a"])(w,k,N,!1,null,"31b3ebf4",null),T=I.exports,D=a("99ca"),C=a("e8b2"),S=a("bc59"),x=a("2b0e"),O={components:{G6Dagre:s["default"],DialogAddNode:d["a"],DialogDataMoveTo:g,DialogUpdateToMain:T,DrawerPrismjsLog:Object(x["defineAsyncComponent"])((function(){return Promise.all([a.e("chunk-7ef164fc"),a.e("CacheStartLogs~f71cff67")]).then(a.bind(null,"21aa"))})),ChangeCapacity:Object(x["defineAsyncComponent"])((function(){return Promise.resolve().then(a.bind(null,"3ab8"))}))},data:function(){var e=this;return Object(r["a"])(Object(r["a"])(Object(r["a"])(Object(r["a"])(Object(r["a"])(Object(r["a"])({startLogShow:!1,baseInfo:{},loading:!1,loadingNode:!1,buttonList:[{label:"+从节点",click:this.clickSlave,get hidden(){var t;return!!e.isContainerDeploy||0!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)}},{label:"故障切换",click:this.clickFailover,title:"从节点会升为主节点",get hidden(){var t;return 1!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)||1!==e.currentNode.runStatus}},{label:"关联新主",click:this.clickUpdate2main,title:"重新配置一个从节点成为指定 master 的 salve 节点",get hidden(){var t;return 1!==(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)||1!==e.currentNode.runStatus}},{label:"移除节点",click:function(t){e.clickNodeDelete(t)},loading:!1,get hidden(){var t,a;return!!e.isContainerDeploy||0===(null===(t=e.currentNode)||void 0===t?void 0:t.nodeType)&&"connected"===(null===(a=e.currentNode)||void 0===a?void 0:a.linkState)}},{label:"配置项",click:this.clickConfigParams,get hidden(){var t;return 1!==(null===(t=e.currentQueryNode)||void 0===t?void 0:t.runStatus)}},{label:"启动日志",click:this.clickStartLog}],chartData:{edges:[],nodes:[],combos:[]},addmasternode:!1,currentNode:null,currentQueryNode:j(),linksData:[]},"loading",!1),"nodeType_add",0),"loadingBtn",!1),"moveToShow",!1),"update2mainShow",!1),"showCapacity",!1)},computed:{clusterId:function(){return this.$route.query.id},clusterType:function(){return this.$route.query.clusterType},isContainerDeploy:function(){return 1==this.$route.query.deployMode}},created:function(){this.getDetail(),this.getBaseInfo()},methods:{clickStartLog:function(){this.startLogShow=!0},getBaseInfo:function(){var e=this;this.baseInfo={},Object(l["h"])(this.clusterId).then((function(t){e.baseInfo=Object(C["a"])(null===t||void 0===t?void 0:t.data)?t.data:{}})).catch((function(e){}))},getDetail:function(){var e=this;this.loading=!0,this.currentNode=null,this.linksData=[],this.currentQueryNode=j(),this.chartData.combos=[],this.chartData.nodes=[],this.chartData.edges=[],Object(l["m"])(this.$route.query.id).then((function(t){if(t){var a=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.linksData=a;var n=[],o=[];a.forEach((function(e){var t=void 0;2===e.nodeType?t="A":0===e.nodeType&&(t="B"),n.push(Object(i["a"])(Object(i["a"])({},e),{},{id:e.runId,value:e.hostIp,comboId:t,category:e.nodeType})),e.masterRunId&&"-"!==e.masterRunId&&o.push({source:e.masterRunId,target:e.runId})})),e.chartData.nodes=n,e.chartData.edges=o,n.some((function(e){return"B"===e.comboId}))&&e.chartData.combos.push(D["b"])}})).catch((function(e){})).finally((function(){e.loading=!1}))},clickAddNode:function(){this.nodeType_add=0,this.addmasternode=!0},clickSlave:function(){0!==this.currentNode.nodeType||this.currentNode.slotRange?(this.nodeType_add=1,this.addmasternode=!0):this.$message.warning(" 当前主节点无卡槽，请先数据迁移再处理")},clickCapacity:function(){this.showCapacity=!0},clickMoveTo:function(){this.moveToShow=!0},clickUpdate2main:function(){this.update2mainShow=!0},clickConfigParams:function(){var e="";e=2==this.currentNode.nodeType?"/cacheCluster/cache-config-params-sentinel":"/cacheCluster/cache-config-params",this.$router.push({path:e,query:{clusterId:this.clusterId,clusterNodeId:this.currentNode.clusterNodeId,nodeType:this.currentNode.nodeType,deployMode:this.$route.query.deployMode}})},clickNodeDelete:function(e){var t=this;this.$confirm("确定要移除".concat(this.currentNode.hostIp,":").concat(this.currentNode.port,"吗?"),{type:"warning"}).then((function(a){t.removeNodeDeleteFile(e)})).catch((function(e){}))},removeNodeDeleteFile:function(e){var t=this;this.$confirm("移除节点的同时是否删除本地文件?",{type:"warning",cancelButtonText:"否",confirmButtonText:"是",showClose:!1,beforeClose:function(e,a,n){var o={id:t.currentNode.clusterNodeId,deleteFile:"0"};"confirm"===e?(o.deleteFile="1",a.confirmButtonLoading=!0,a.confirmButtonText="执行中..."):(a.cancelButtonLoading=!0,a.cancelButtonText="执行中..."),Object(c["c"])(o).then((function(e){200===e.code&&(t.$message.success("移除成功"),t.refresh())})).catch((function(e){})).finally((function(){n(),a.cancelButtonLoading=!1,a.confirmButtonLoading=!1}))}})},clickNode:function(e){var t=this;this.currentNode=e,this.loadingNode=!0,this.loadingBtn=!1;var a=this.buttonList.find((function(e){return"移除节点"===e.label}));a&&this.$set(a,"loading",!1),Object(c["e"])(e.clusterNodeId).then((function(e){t.currentQueryNode=j(null===e||void 0===e?void 0:e.data)})).catch((function(e){})).finally((function(){t.loadingNode=!1}))},refresh:function(){this.getBaseInfo(),this.getDetail()},clickFailover:function(){var e=this;this.$confirm("确定要进行故障切换吗?","成功后从节点会升为主节点",{type:"warning"}).then((function(){Object(c["d"])({clusterNodeId:e.currentNode.clusterNodeId}).then((function(t){200===t.code&&(e.$message.success("切换成功"),e.refresh())})).catch((function(e){}))}))},clickStartAndStop:function(e,t){var a=this,n=t?"启动":"停止";this.$confirm("确定要".concat(n,"【").concat(e.label,"】吗?")).then((function(){a.loadingBtn=!0;var o={method:t?"start":"stop",clusterNodeId:e.clusterNodeId,clusterId:a.clusterId};Object(c["f"])(o).then((function(e){200===e.code&&(a.$message.success(n+"成功"),a.refresh())})).catch((function(e){})).finally((function(){a.loadingBtn=!1}))}))}}};function j(e){var t={pid:"",usedMemory:"",usedCpuSys:"",keys:"",clients:"",expires:""};return e&&Reflect.ownKeys(t).forEach((function(a){Object(S["a"])(e,a)&&(t[a]=e[a])})),Object.assign(t,e)}var L=O,$=(a("9edb"),Object(v["a"])(L,n,o,!1,null,"261e190a",null));t["default"]=$.exports}}]);