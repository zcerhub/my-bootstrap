(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~4412ac43"],{"0718":function(e,t,a){},"1c2b":function(e,t,a){"use strict";a("0718")},"30b8":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("search-form",{attrs:{searchConfig:e.searchModel},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.total,rowKey:"id",currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAddDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,deployMode:"1",refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e(),e.showInstancesDialog?t("InstancesTable",{attrs:{rowData:e.instancesData,refresh:e.getList},model:{value:e.showInstancesDialog,callback:function(t){e.showInstancesDialog=t},expression:"showInstancesDialog"}}):e._e(),e.showACLDialog?t("ACLManagement",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showACLDialog,callback:function(t){e.showACLDialog=t},expression:"showACLDialog"}}):e._e(),e.showEmployDialog?t("EmployPortDialog",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showEmployDialog,callback:function(t){e.showEmployDialog=t},expression:"showEmployDialog"}}):e._e(),e.showDeploymentDialog?t("el-drawer",{attrs:{title:"部署计划",visible:e.showDeploymentDialog,size:"medium"},on:{"update:visible":function(t){e.showDeploymentDialog=t},close:e.clickDeployCancel}},[t("DeploymentPlan",{ref:"deploymentRef",staticClass:"pl-10 pr-20",attrs:{rowData:e.rowData,refresh:e.getList}}),t("span",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickDeployCancel}},[e._v("取消")])],1)],1):e._e(),e.deployVisible?t("el-drawer",{attrs:{title:"部署信息",visible:e.deployVisible,size:"70%"},on:{"update:visible":function(t){e.deployVisible=t},close:e.clickCancel}},[t("my-xterm",{ref:"xterm",attrs:{terminal:e.terminal,socketUrl:e.socketUrl}})],1):e._e(),e.showContainerDialog?t("DeployPlanContainer",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showContainerDialog,callback:function(t){e.showContainerDialog=t},expression:"showContainerDialog"}}):e._e(),e.showEditClusterDialog?t("EditZkAndBroker",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showEditClusterDialog,callback:function(t){e.showEditClusterDialog=t},expression:"showEditClusterDialog"}}):e._e(),e.showFlexClusterDialog?t("FlexZkAndBroker",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showFlexClusterDialog,callback:function(t){e.showFlexClusterDialog=t},expression:"showFlexClusterDialog"}}):e._e()],1)},i=[],n=a("5530"),s=(a("14d9"),a("d3b7"),a("2a7b")),l=a("b263"),r=a("9b11"),c=a("d8ed"),d=a("dfe5"),u=a("f175"),f=a("8b5b"),p=a("ff51"),m=a("ec41"),h=(a("498a"),function(){var e,t,a=this,o=a._self._c;return o("el-dialog-limit",{attrs:{title:a.isEdit?"编辑":"新增",visible:a.show,size:"small",loading:a.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:a.clickCancel}},[o("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":a.labelPosition,"label-width":"150px",model:a.form,rules:a.rules}},[o("el-form-item",{attrs:{label:"名称",prop:"clusterName"}},[o("el-input",{attrs:{placeholder:"请输入",disabled:a.isEdit},model:{value:a.form.clusterName,callback:function(e){a.$set(a.form,"clusterName","string"===typeof e?e.trim():e)},expression:"form.clusterName"}})],1),o("el-form-item",{attrs:{label:"部署模式",prop:"deployMode"}},[o("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择部署模式",clearable:"",filterable:"",disabled:""},model:{value:a.form.deployMode,callback:function(e){a.$set(a.form,"deployMode",e)},expression:"form.deployMode"}},a._l(a.dict_deployMode.options,(function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),o("el-form-item",{attrs:{label:"容器代理服务名称",prop:"agentId"}},[o("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择容器代理服务名称",clearable:"",filterable:"",disabled:"1"===(null===(e=a.rowData)||void 0===e?void 0:e.clusterState),"filter-method":a.filterClusterMethod},on:{change:a.getOptionsK8s_namespaces},model:{value:a.form.agentId,callback:function(e){a.$set(a.form,"agentId",e)},expression:"form.agentId"}},a._l(a.clusterK8s_options,(function(e){return o("el-option",{key:e.id,attrs:{label:e.clusterName,value:e.id}})})),1)],1),o("el-form-item",{attrs:{label:"命名空间",prop:"namespace"}},[o("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择命名空间",disabled:"1"===(null===(t=a.rowData)||void 0===t?void 0:t.clusterState),clearable:"",filterable:"","filter-method":a.filterNamespaceMethod},on:{change:a.namespaceChange},model:{value:a.form.namespace,callback:function(e){a.$set(a.form,"namespace",e)},expression:"form.namespace"}},a._l(a.namespaceK8s_options,(function(e,t){return o("el-option",{key:t,attrs:{label:e.label,value:e.label}})})),1)],1),o("el-form-item",{attrs:{label:"对接外部Zookeeper",prop:"buttOutsideZk"}},[o("el-switch",{attrs:{"active-value":"1","inactive-value":"0",disabled:"1"===a.form.clusterState},model:{value:a.form.buttOutsideZk,callback:function(e){a.$set(a.form,"buttOutsideZk",e)},expression:"form.buttOutsideZk"}})],1),"1"===a.form.buttOutsideZk?o("el-form-item",{attrs:{label:"Zookeeper连接地址",prop:"zookeeperConnect"}},[o("el-input",{attrs:{disabled:"1"===a.form.clusterState,placeholder:"请输入Zookeeper连接地址,多个连接用逗号隔开"},model:{value:a.form.zookeeperConnect,callback:function(e){a.$set(a.form,"zookeeperConnect","string"===typeof e?e.trim():e)},expression:"form.zookeeperConnect"}})],1):a._e(),o("el-form-item",{attrs:{label:"集群版本",prop:"version"}},[o("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择版本"},model:{value:a.form.version,callback:function(e){a.$set(a.form,"version",e)},expression:"form.version"}},a._l(a.kafkaVersionOptions,(function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:a.clickConfirm}},[a._v("确定")]),o("el-button",{on:{click:a.clickCancel}},[a._v("取消")])],1)],1)}),g=[],b=a("c7eb"),v=a("1da1"),w=(a("d9e2"),a("99af"),a("4de4"),a("7db0"),a("a15b"),a("d81d"),a("4e82"),a("b64b"),a("07ac"),a("ac1f"),a("00b4"),a("159b"),a("a4ed")),k=a("5c8a"),y=a("e8b2"),C=a("49bb"),D=a("4879"),O=a("61f7");function I(e){var t={id:"",clusterName:"",version:"",cityId:"",machineRoomId:"",zkInfo:"",appIds:[],machineId:[],clusterState:"",deployMode:"1",agentId:"",containerAgentName:"",namespace:"",buttOutsideZk:"0",zookeeperConnect:""};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var _={name:"AddAndEdit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},deployMode:String,refresh:Function},data:function(){var e=function(e,t,a){t||a();var o=/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}(,\s*(\d{1,3}\.){3}\d{1,3}:\d{1,5})*$/;if(!o.test(t))return a(new Error("输入正确连接用英文,隔开"));a()};return{clusterK8s_options:[],clusterK8s_optionsCopy:[],namespaceK8s_options:[],namespaceK8s_optionsCopy:[],dict_deployMode:D["d"],loading:!1,kafkaVersionOptions:C["h"],labelPosition:"right",form:I(),rules:{clusterName:[{required:!0,message:"请输入名称",trigger:"change"},{validator:O["b"],trigger:"blur"}],clusterMode:[{required:!0,message:"请选择集群模式",trigger:"change"}],version:[{required:!0,message:"请输入版本",trigger:"change"}],agentId:[{required:!0,message:"请选择容器代理服务名称",trigger:"change"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],zookeeperConnect:[{required:!0,validator:e,trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)},containerAgentName:function(){var e=this,t=this.clusterK8s_options.find((function(t){return t.id===e.form.agentId}));return null===t||void 0===t?void 0:t.clusterName}},watch:{"form.agentId":function(e){e||(this.clusterK8s_options=this.clusterK8s_optionsCopy)},"form.namespace":function(e){e||(this.namespaceK8s_options=this.namespaceK8s_optionsCopy)}},created:function(){this.getZkInfo()},mounted:function(){this.form.deployMode=this.deployMode,this.isEdit&&this.getClusterDetail(),this.getOptionsK8s_cluster()},methods:{filterClusterMethod:function(e){this.form.agentId=e,this.clusterK8s_options=e?this.clusterK8s_optionsCopy.filter((function(t){if(~t.clusterName.indexOf(e)||~t.clusterName.toUpperCase().indexOf(e.toUpperCase()))return!0})).sort((function(t,a){var o=t.clusterName.indexOf(e),i=a.clusterName.indexOf(e);return o-i})):this.clusterK8s_optionsCopy},filterNamespaceMethod:function(e){this.form.namespace=e,this.namespaceK8s_options=e?this.namespaceK8s_optionsCopy.filter((function(t){if(~t.label.indexOf(e)||~t.label.toUpperCase().indexOf(e.toUpperCase()))return!0})).sort((function(t,a){var o=t.label.indexOf(e),i=a.label.indexOf(e);return o-i})):this.namespaceK8s_optionsCopy},getOptionsK8s_cluster:function(){var e=this;Object(w["g"])({agentType:"2"}).then((function(t){var a=Object(m["a"])(t,"data"),o=Object(p["a"])(a)?a:[];e.clusterK8s_options=o,e.clusterK8s_optionsCopy=o}))},getOptionsK8s_namespaces:function(){var e=this;this.clusterK8s_options=this.clusterK8s_optionsCopy,Object(w["d"])({agentId:this.form.agentId}).then((function(t){var a=Object(m["a"])(t,"data.items"),o=a.map((function(e){var t=Object(m["a"])(e,"metadata.name");return{label:t}}));e.namespaceK8s_options=o,e.namespaceK8s_optionsCopy=o}))},namespaceChange:function(){this.namespaceK8s_options=this.namespaceK8s_optionsCopy},getClusterDetail:function(){var e=this;Object(l["k"])(this.rowData.id).then((function(t){var a=Object(m["a"])(t,"data.kafkaCluster"),o=Object(m["a"])(t,"data.kafkaMachine");a&&(a.machineId=Object(p["a"])(o)?o.map((function(e){return e.machineId})):[],a.appIds=a.appIds?a.appIds.split(","):[]),e.form=I(a),e.form.zookeeperConnect=e.form.zkInfo,e.getOptionsK8s_namespaces()}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this,t=Object(k["a"])(this.form);t.machineId=this.form.machineId.join(","),t.appIds=this.form.appIds.join(","),t.containerAgentName=this.containerAgentName,t.zkInfo=t.zookeeperConnect,this.$refs.formRef.validate(function(){var a=Object(v["a"])(Object(b["a"])().mark((function a(o){return Object(b["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o){a.next=2;break}return a.abrupt("return");case 2:e.loading=!0,e.isEdit?Object(l["a"])(t).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})):(delete t.id,Object(l["c"])(t).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},getZkInfo:function(){var e=this;Object(l["m"])().then((function(t){var a=[];Object(y["a"])(null===t||void 0===t?void 0:t.data)&&Object.values(t.data).forEach((function(e){if(Object(p["a"])(e)&&e.length>0){var t=e.map((function(e){return"".concat(e.ip,":").concat(e.port)})),o=e[0].clusterName;a.push({value:t.join(","),address:t,clusterName:o})}})),e.zkInfoList=a})).catch((function(e){}))},querySearch:function(e,t){var a=this.zkInfoList,o=e?a.filter(this.createFilter(e)):a;t(o)},createFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){},handleIconClick:function(e){this.form.zkInfo=""}}},j=_,x=(a("1c2b"),a("2877")),N=Object(x["a"])(j,h,g,!1,null,"7ba1cb2d",null),A=N.exports,$=a("d82b"),S=a("3b21"),E={filters:{},components:{DeployPlanContainer:c["default"],AddAndEdit:A,InstancesTable:$["default"],DeploymentPlan:f["default"],ACLManagement:r["default"],EmployPortDialog:S["a"],EditZkAndBroker:d["default"],FlexZkAndBroker:u["default"]},data:function(){return{showFlexClusterDialog:!1,showEditClusterDialog:!1,showContainerDialog:!1,showEmployDialog:!1,showACLDialog:!1,showDeploymentDialog:!1,sendParams:null,socketUrl:"",terminal:{pid:1,name:"terminal"},deployVisible:!1,instancesData:null,showInstancesDialog:!1,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"clusterName",label:"名称",align:"center"},{prop:"containerAgentName",label:"容器代理服务名称",align:"center"},{prop:"namespace",label:"命名空间",align:"center"},{prop:"version",label:"版本",align:"center"},{prop:"clusterState",label:"部署状态",align:"center",format:function(e){return Object(C["g"])(e,"dict_containerStatus")}}],operate:{width:270,align:"left",columnAlign:"left",list:[{label:"节点管理",id:"manage",btnPermCode:"config"},{label:"一键部署",id:"fast_deploy",btnPermCode:"import",isShow:function(e){return"0"===e.clusterState}},{label:"zk配置修改",id:"editZk",isShow:function(e){return"1"===e.clusterState&&"0"===e.buttOutsideZk}},{label:"broker配置修改",id:"editBroker",isShow:function(e){return"1"===e.clusterState}},{label:"zk扩缩容",id:"flexZk",isShow:function(e){return"1"===e.clusterState&&"0"===e.buttOutsideZk}},{label:"broker扩缩容",id:"flexBroker",isShow:function(e){return"1"===e.clusterState}},{label:"编辑",id:"edit",btnPermCode:"edit"},{label:"删除",id:"delete",btnPermCode:"delete"}]}},searchModel:{searchData:{clusterName:"",deployMode:"1"},searchItem:[{type:"input",label:"集群名称",prop:"clusterName",labelWidth:"80px"}],rules:{}},buttonList:[{label:"新增",type:"add",click:this.addInfo,btnPermCode:"add"}],showAddDialog:!1,rowData:null}},mounted:function(){this.getList()},methods:{clickConfirm:function(){var e=this,t=this.$refs.deploymentRef.deploymentPlaneList;Object(l["g"])({clusterId:this.rowData.id,instanceVos:t}).then((function(t){200===t.code&&e.$message({type:"success",message:t.msg})})),this.showDeploymentDialog=!1,this.socketStart(this.rowData)},clickDeployCancel:function(){this.showDeploymentDialog=!1},clickCancel:function(){this.deployVisible=!1,this.getList()},addInfo:function(){this.showAddDialog=!0,this.rowData=null},onSearch:function(){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(n["a"])({},this.searchModel.searchData)};this.tableConfig.loading=!0,Object(l["l"])(t).then((function(t){Object(p["a"])(null===t||void 0===t?void 0:t.data.data)&&(e.tableConfig.tableData=t.data.data),e.tableConfig.pagination.total=Object(m["a"])(t,"data.totalCount")||0})).finally((function(){e.tableConfig.loading=!1}))},getIndex:function(e){var t=this,a=(e.index,e.row),o=e.operate;"delete"===o.id?this.$confirm("确定要删除【".concat(a.clusterName,"】吗?"),{type:"warning"}).then((function(){t.deleteCluster(a.id)})).catch((function(e){})):"edit"===o.id?(this.rowData=a,this.showAddDialog=!0):"manage"===o.id?this.$router.push({path:"/kafka/clusterManagement/kafka-node-manage-container",query:{id:a.id,agentId:a.agentId,clusterName:a.clusterName,clusterMode:a.clusterMode,namespace:a.namespace}}):"topic"===o.id?this.toTopic():"fast_deploy"===o.id?this.fast_deploy(a):"editZk"===o.id?(this.showEditClusterDialog=!0,this.rowData=Object(n["a"])(Object(n["a"])({},a),{},{clusterType:"zk"})):"editBroker"===o.id?(this.showEditClusterDialog=!0,this.rowData=Object(n["a"])(Object(n["a"])({},a),{},{clusterType:"broker"})):"flexZk"===o.id?(this.showFlexClusterDialog=!0,this.rowData=Object(n["a"])(Object(n["a"])({},a),{},{clusterType:"zk"})):"flexBroker"===o.id&&(this.showFlexClusterDialog=!0,this.rowData=Object(n["a"])(Object(n["a"])({},a),{},{clusterType:"broker"}))},fast_deploy:function(e){this.rowData=e,this.showContainerDialog=!0},socketStart:function(e){this.socketUrl="/echo?logId=".concat(e.id),this.deployVisible=!0},deleteCluster:function(e){var t=this;Object(s["a"])(e).then((function(e){Object(p["a"])(null===e||void 0===e?void 0:e.data)?(t.showInstancesDialog=!0,t.instancesData=e.data):(t.$message.success("删除成功"),t.getList())})).catch((function(e){}))},toTopic:function(){this.$router.push({path:"/clusterManagement/KafkaManagement/KafkaTopic"})}}},L=E,M=(a("fdc3"),Object(x["a"])(L,o,i,!1,null,"f61164f0",null));t["default"]=M.exports},"43ad":function(e,t,a){},"4a10":function(e,t,a){},"4bd3":function(e,t,a){},6592:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"name-container"},[t("search-form",{attrs:{searchConfig:e.searchModel},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.total,rowKey:"id",currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage,operate:e.getIndex}}),e.showAddDialog?t("AddAndEdit",{attrs:{rowData:e.rowData,deployMode:"2",refresh:e.getList},model:{value:e.showAddDialog,callback:function(t){e.showAddDialog=t},expression:"showAddDialog"}}):e._e(),e.showInstancesDialog?t("InstancesTable",{attrs:{rowData:e.instancesData,refresh:e.getList},model:{value:e.showInstancesDialog,callback:function(t){e.showInstancesDialog=t},expression:"showInstancesDialog"}}):e._e(),e.showACLDialog?t("ACLManagement",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showACLDialog,callback:function(t){e.showACLDialog=t},expression:"showACLDialog"}}):e._e(),e.showEmployDialog?t("EmployPortDialog",{attrs:{rowData:e.rowData,refresh:e.getList},model:{value:e.showEmployDialog,callback:function(t){e.showEmployDialog=t},expression:"showEmployDialog"}}):e._e(),e.showDeploymentDialog?t("el-drawer",{attrs:{title:"部署计划",visible:e.showDeploymentDialog,size:"70%"},on:{"update:visible":function(t){e.showDeploymentDialog=t},close:e.clickDeployCancel}},[t("DeploymentPlan",{ref:"deploymentRef",staticClass:"ml-10 mr-20",staticStyle:{"margin-bottom":"50px"},attrs:{rowData:e.rowData,refresh:e.getList}}),t("span",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickDeployCancel}},[e._v("取消")])],1)],1):e._e(),e.deployVisible?t("el-drawer",{attrs:{title:"部署信息",visible:e.deployVisible,size:"medium"},on:{"update:visible":function(t){e.deployVisible=t},close:e.clickCancel}},[t("my-xterm",{ref:"xterm",attrs:{terminal:e.terminal,socketUrl:e.socketUrl}})],1):e._e()],1)},i=[],n=a("5530"),s=(a("a15b"),a("14d9"),a("d3b7"),a("2ca0"),a("b263")),l=a("9b11"),r=a("8b5b"),c=a("ff51"),d=a("ec41"),u=(a("498a"),function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:e.isEdit?"编辑":"新增",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"150px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"clusterName"}},[t("el-input",{attrs:{placeholder:"请输入",disabled:e.isEdit},model:{value:e.form.clusterName,callback:function(t){e.$set(e.form,"clusterName","string"===typeof t?t.trim():t)},expression:"form.clusterName"}})],1),t("el-form-item",{attrs:{label:"部署模式",prop:"deployMode"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择部署模式",clearable:"",filterable:"",disabled:""},model:{value:e.form.deployMode,callback:function(t){e.$set(e.form,"deployMode",t)},expression:"form.deployMode"}},e._l(e.dict_deployMode.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"版本",prop:"version"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择版本"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}},e._l(e.kafkaVersionOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"地区",prop:"cityId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择地区",disabled:e.isEdit},on:{change:e.changeCityId},model:{value:e.form.cityId,callback:function(t){e.$set(e.form,"cityId",t)},expression:"form.cityId"}},e._l(e.cityOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.cityName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"数据中心",prop:"machineRoomId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据中心","value-key":"id",disabled:e.isEdit},on:{change:e.changeMachineRoomId},model:{value:e.form.machineRoomId,callback:function(t){e.$set(e.form,"machineRoomId",t)},expression:"form.machineRoomId"}},e._l(e.roomOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.machineRoomName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"ZK信息",prop:"zkInfo"}},[t("el-autocomplete",{staticClass:"w-100",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":e.querySearch,placeholder:"请输入内容",disabled:e.isEdit},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(a){var o=a.item;return[t("div",[t("div",{staticClass:"my-autocomplete-div"},[e._v(" 所属注册中心："+e._s(o.clusterName)+" ")]),t("div",{staticClass:"my-autocomplete-ul"},e._l(o.address,(function(a,o){return t("el-tag",{key:o,staticClass:"mr-5 mb-5"},[e._v(" "+e._s(a)+" ")])})),1)])]}}]),model:{value:e.form.zkInfo,callback:function(t){e.$set(e.form,"zkInfo",t)},expression:"form.zkInfo"}},[t("i",{staticClass:"el-icon-delete el-input__icon",attrs:{slot:"suffix"},on:{click:e.handleIconClick},slot:"suffix"})])],1),t("el-form-item",{attrs:{label:"机器信息",prop:"machineId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择机器信息"},on:{"remove-tag":e.cancelMachine},model:{value:e.form.machineId,callback:function(t){e.$set(e.form,"machineId",t)},expression:"form.machineId"}},e._l(e.machineOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.hostIp+"("+e.hostSshAccount+")",value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"适配应用"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择适配应用"},model:{value:e.form.appIds,callback:function(t){e.$set(e.form,"appIds",t)},expression:"form.appIds"}},e._l(e.appOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.applicationName,value:e.id}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)}),f=[],p=a("c7eb"),m=a("1da1"),h=(a("d9e2"),a("99af"),a("4de4"),a("7db0"),a("d81d"),a("b64b"),a("07ac"),a("ac1f"),a("00b4"),a("159b"),a("fbd2")),g=a("0eed"),b=a("5c8a"),v=a("e8b2"),w=a("49bb"),k=a("aa89"),y=a("4879");function C(e){var t={id:"",clusterName:"",version:"",cityId:"",machineRoomId:"",zkInfo:"",appIds:[],machineId:[],clusterState:"",deployMode:"1"};return e&&Object.keys(t).forEach((function(a){t[a]=e[a]})),t}var D={name:"AddAndEdit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},deployMode:String,refresh:Function},data:function(){return{clusterModeOptions:[{value:"master-slave",label:"master-slave"},{value:"dleger",label:"dledger"}],clusterK8s_options:[],namespaceK8s_options:[],dict_deployMode:y["d"],loading:!1,cityOptions:[],roomOptions:[],machineOptions:[],kafkaVersionOptions:w["h"],labelPosition:"right",form:C(),rules:{clusterName:[{required:!0,message:"请输入名称",trigger:"change"},{pattern:/^[^\u4e00-\u9fa5]+$/,message:"不允许输入中文",trigger:"blur"}],clusterMode:[{required:!0,message:"请选择集群模式",trigger:"change"}],version:[{required:!0,message:"请输入版本",trigger:"change"}],cityId:[{required:!0,message:"请选择地区",trigger:"change"}],machineRoomId:[{required:!0,message:"请选择数据中心",trigger:"change"}],machineId:[{required:!0,message:"请选择机器",trigger:"change"}],zkInfo:[{required:!0,message:"请输入ZK信息",trigger:["blur","change"]}]},machineIdOld:[],zkInfoList:[],appOptions:[]}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)},containerAgentName:function(){var e=this,t=this.clusterK8s_options.find((function(t){return t.id===e.form.agentId}));return null===t||void 0===t?void 0:t.clusterName}},watch:{"form.machineId":{handler:function(e,t){this.machineIdOld=t},deep:!0,immediate:!0}},created:function(){this.getZkInfo()},mounted:function(){this.form.deployMode=this.deployMode,this.isEdit&&this.getClusterDetail(),this.getCitys(),this.getOpts_AppList()},methods:{getOpts_AppList:function(){var e=this;return Object(m["a"])(Object(p["a"])().mark((function t(){return Object(p["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(g["a"])().then((function(t){Object(c["a"])(t.data)&&(e.appOptions=t.data)}));case 2:case"end":return t.stop()}}),t)})))()},cancelMachine:function(e){var t=this;this.isEdit&&Object(s["f"])({clusterId:this.rowData.id,machineId:e}).then((function(e){0===e.data&&(t.form.machineId=t.machineIdOld,t.$message.error("该机器已存在节点数据"))})).catch((function(e){}))},getCitys:function(){var e=this;Object(h["a"])().then((function(t){e.cityOptions=t.data}))},getRooms:function(){var e=this,t=this.form.cityId;t&&Object(h["d"])({cityId:t}).then((function(t){e.roomOptions=t.data}))},changeCityId:function(e){this.form.machineRoomId="",this.roomOptions=[],e&&this.getRooms()},changeMachineRoomId:function(e){this.form.machineId=[],this.machineOptions=[],this.getMachine()},getMachine:function(){var e=this;return Object(m["a"])(Object(p["a"])().mark((function t(){var a;return Object(p["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.form.machineRoomId,a){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,Object(k["a"])(a).then((function(t){e.machineOptions=t.data}));case 5:case"end":return t.stop()}}),t)})))()},getClusterDetail:function(){var e=this;Object(s["k"])(this.rowData.id).then((function(t){var a=Object(d["a"])(t,"data.kafkaCluster"),o=Object(d["a"])(t,"data.kafkaMachine");a&&(a.machineId=Object(c["a"])(o)?o.map((function(e){return e.machineId})):[],a.appIds=a.appIds?a.appIds.split(","):[]),e.form=C(a),e.getRooms(),e.getMachine()}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this,t=Object(b["a"])(this.form);t.machineId=this.form.machineId.join(","),t.appIds=this.form.appIds.join(","),t.containerAgentName=this.containerAgentName,this.$refs.formRef.validate(function(){var a=Object(m["a"])(Object(p["a"])().mark((function a(o){return Object(p["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o){a.next=2;break}return a.abrupt("return");case 2:e.loading=!0,e.isEdit?Object(s["a"])(t).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})):(delete t.id,Object(s["c"])(t).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},getZkInfo:function(){var e=this;Object(s["m"])().then((function(t){var a=[];Object(v["a"])(null===t||void 0===t?void 0:t.data)&&Object.values(t.data).forEach((function(e){if(Object(c["a"])(e)&&e.length>0){var t=e.map((function(e){return"".concat(e.ip,":").concat(e.port)})),o=e[0].clusterName;a.push({value:t.join(","),address:t,clusterName:o})}})),e.zkInfoList=a})).catch((function(e){}))},querySearch:function(e,t){var a=this.zkInfoList,o=e?a.filter(this.createFilter(e)):a;t(o)},createFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){},handleIconClick:function(e){this.form.zkInfo=""}}},O=D,I=(a("cf76"),a("2877")),_=Object(I["a"])(O,u,f,!1,null,"3578d5e4",null),j=_.exports,x=a("d82b"),N=a("3b21"),A={filters:{},components:{AddAndEdit:j,InstancesTable:x["default"],DeploymentPlan:r["default"],ACLManagement:l["default"],EmployPortDialog:N["a"]},data:function(){this.$createElement;return{showEmployDialog:!1,showACLDialog:!1,showDeploymentDialog:!1,sendParams:null,socketUrl:"",terminal:{pid:1,name:"terminal"},deployVisible:!1,instancesData:null,showInstancesDialog:!1,tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,total:0},tableData:[],columns:[{prop:"clusterName",label:"名称",align:"center"},{prop:"version",label:"版本",align:"center"},{prop:"nodeNumber",label:"节点数",align:"center"},{prop:"runNodeNumber",label:"运行节点",align:"center"},{prop:"cityName",label:"地区",align:"center"},{prop:"machineRoomName",label:"数据中心",align:"center"},{prop:"apps",label:"适配应用",align:"center",render:function(e,t){var a=t.row,o=a.apps;return e("span",[o&&Object(c["a"])(o)?o.join(","):""])}}],operate:{width:220,align:"left",columnAlign:"left",list:[{label:"节点管理",id:"manage",btnPermCode:"config"},{label:"一键部署",id:"fast_deploy",btnPermCode:"import"},{label:"一键停止",id:"fast_stop",btnPermCode:"stop"},{label:"一键启动",id:"fast_start",btnPermCode:"start"},{label:"占用端口",id:"employ"},{label:"编辑",id:"edit",btnPermCode:"edit"},{label:"删除",id:"delete",btnPermCode:"delete"}]}},searchModel:{searchData:{clusterName:"",deployMode:"2"},searchItem:[{type:"input",label:"集群名称",prop:"clusterName"}],rules:{}},buttonList:[{label:"新增",type:"add",click:this.addInfo,btnPermCode:"add"}],showAddDialog:!1,rowData:null}},mounted:function(){this.getList()},methods:{clickConfirm:function(){var e=this,t=this.$refs.deploymentRef.form.deploymentPlaneList;this.$refs.deploymentRef.$refs.formRef.validate((function(a){if(a){var o=e.$refs.deploymentRef.checkAllIpPort();if(!o.isPass)return e.$message.warning(o.message);Object(s["g"])({clusterId:e.rowData.id,instanceVos:t}).then((function(t){200===t.code&&e.$message({type:"success",message:t.msg})})),e.showDeploymentDialog=!1,e.socketStart(e.rowData)}}))},clickDeployCancel:function(){this.showDeploymentDialog=!1},clickCancel:function(){this.deployVisible=!1,this.getList()},addInfo:function(){this.showAddDialog=!0,this.rowData=null},onSearch:function(){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()},getList:function(){var e=this,t={pageNo:this.tableConfig.pagination.pageNo,pageSize:this.tableConfig.pagination.pageSize,requestObject:Object(n["a"])({},this.searchModel.searchData)};this.tableConfig.loading=!0,Object(s["l"])(t).then((function(t){Object(c["a"])(null===t||void 0===t?void 0:t.data.data)&&(e.tableConfig.tableData=t.data.data),e.tableConfig.pagination.total=Object(d["a"])(t,"data.totalCount")||0})).finally((function(){e.tableConfig.loading=!1}))},getIndex:function(e){var t=this,a=(e.index,e.row),o=e.operate;"delete"===o.id?this.$confirm("确定要删除【".concat(a.clusterName,"】吗?"),{type:"warning"}).then((function(){t.deleteCluster(a.id)})).catch((function(e){})):"edit"===o.id?(this.rowData=a,this.showAddDialog=!0):"manage"===o.id?this.$router.push({path:"/kafka/clusterManagement/kafka-node-manage",query:{id:a.id,clusterName:a.clusterName,machineRoomName:a.machineRoomName}}):"topic"===o.id?this.toTopic():o.id.startsWith("fast_")?this[o.id](a):"ACL_manage"===o.id?(this.rowData=a,this.showACLDialog=!0):"employ"===o.id&&(this.rowData=a,this.showEmployDialog=!0)},fast_stop:function(e){var t=this;this.$confirm("确定要一键停止【".concat(e.clusterName,"】吗?"),{type:"warning"}).then((function(){t.socketStart(e),Object(s["j"])(e.id).then((function(e){t.$message.success("一键停止成功"),t.getList()})).catch((function(e){}))})).catch((function(e){}))},fast_start:function(e){var t=this;this.$confirm("确定要一键启动【".concat(e.clusterName,"】吗?"),{type:"warning"}).then((function(){t.socketStart(e),Object(s["i"])(e.id).then((function(e){t.$message.success("一键启动成功"),t.getList()})).catch((function(e){}))})).catch((function(e){}))},fast_deploy:function(e){this.rowData=e,this.showDeploymentDialog=!0},socketStart:function(e){this.socketUrl="/echo?logId=".concat(e.id),this.deployVisible=!0},deleteCluster:function(e){var t=this;Object(s["b"])(e).then((function(e){Object(c["a"])(null===e||void 0===e?void 0:e.data)?(t.showInstancesDialog=!0,t.instancesData=e.data):(t.$message.success("删除成功"),t.getList())})).catch((function(e){}))},toTopic:function(){this.$router.push({path:"/clusterManagement/KafkaManagement/KafkaTopic"})}}},$=A,S=(a("ce3b4"),Object(I["a"])($,o,i,!1,null,"0e7a01b8",null));t["default"]=S.exports},"9b11":function(e,t,a){"use strict";a.r(t);a("498a");var o=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"ACL管理",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"100px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"是否开始acl",prop:"aclEnabled"}},[t("el-switch",{attrs:{"inactive-value":0,"active-value":1},model:{value:e.form.aclEnabled,callback:function(t){e.$set(e.form,"aclEnabled",t)},expression:"form.aclEnabled"}}),t("span",{staticStyle:{color:"red",margin:"left:10px"}},[e._v(" 注：修改开关后须重启集群")])],1),e.form.aclEnabled?t("div",[t("el-form-item",{attrs:{label:"acl账号",prop:"aclAccount"}},[t("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.form.aclAccount,callback:function(t){e.$set(e.form,"aclAccount","string"===typeof t?t.trim():t)},expression:"form.aclAccount"}})],1),t("el-form-item",{attrs:{label:"acl密码",prop:"aclPassWord"}},[t("el-input",{attrs:{type:"password","show-password":!0,autocomplete:"off",placeholder:"请输入名称"},model:{value:e.form.aclPassWord,callback:function(t){e.$set(e.form,"aclPassWord","string"===typeof t?t.trim():t)},expression:"form.aclPassWord"}})],1)],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},i=[],n=a("c7eb"),s=a("1da1"),l=(a("b64b"),a("d3b7"),a("159b"),a("3775")),r=a("bc59");function c(e){var t={id:"",aclAccount:"",aclPassWord:"",aclEnabled:""};return e&&Object.keys(t).forEach((function(a){Object(r["a"])(e,a)&&(t[a]=e[a])})),t}var d={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{labelPosition:"right",form:c(),rules:{aclAccount:[{required:!0,message:"请输入acl账号",trigger:"blur"}],aclPassWord:[{required:!0,message:"请输入acl密码",trigger:"blur"},{min:6,message:"长度必须大于6个字符",trigger:"blur"}],aclEnabled:[{required:!0,message:"请选择是否开启",trigger:"change"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){this.isEdit&&this.getClusterById()},methods:{getClusterById:function(){var e=this;Object(l["n"])(this.rowData.id).then((function(t){e.form=c(t.data)}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(s["a"])(Object(n["a"])().mark((function t(a){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a&&Object(l["r"])(e.form).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},u=d,f=(a("d28fa"),a("2877")),p=Object(f["a"])(u,o,i,!1,null,"776859b1",null);t["default"]=p.exports},a0fb:function(e,t,a){},ce3b4:function(e,t,a){"use strict";a("43ad")},cf76:function(e,t,a){"use strict";a("a0fb")},d28fa:function(e,t,a){"use strict";a("4bd3")},fdc3:function(e,t,a){"use strict";a("4a10")}}]);