(window["jsonpPaas4"]=window["jsonpPaas4"]||[]).push([["app~9ce84bd4"],{"0d70":function(e,t,o){},"3b21":function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{loading:e.instancesLoading,title:"节点信息",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("tableView",{ref:"tableView",attrs:{loading:e.tableConfig.loading,isPage:e.tableConfig.isPage,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,rowKey:"id"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],l=(o("d3b7"),o("d423")),n=o("ec41"),s={name:"AddAndEdit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{instancesLoading:!1,tableConfig:{loading:!1,isPage:!1,tableData:[],columns:[{prop:"hostIp",label:"服务器ip",align:"center"},{prop:"serverType",label:"服务类型",align:"center"},{prop:"ports",label:"占用端口号",align:"center",width:400}]}}},watch:{},created:function(){},mounted:function(){this.getMqPortDetail()},methods:{getMqPortDetail:function(){var e=this;this.tableConfig.loading=!0,Object(l["a"])(this.rowData.id).then((function(t){var o=Object(n["a"])(t,"data");e.tableConfig.tableData=o})).catch((function(e){})).finally((function(){e.tableConfig.loading=!1}))},clickCancel:function(){this.$emit("change",!1)}}},i=s,c=o("2877"),p=Object(c["a"])(i,a,r,!1,null,"b8dbd304",null);t["a"]=p.exports},"3bfd":function(e,t,o){"use strict";o("db9c")},"66a9":function(e,t,o){},"81c3":function(e,t,o){"use strict";o.d(t,"b",(function(){return c})),o.d(t,"a",(function(){return p}));var a=o("d4ec"),r=o("bee2"),l=(o("a15b"),o("d81d"),o("5c8a")),n=o("bc48"),s=o("ec41"),i=o("cf45");function c(e){return{id:e.id,clusterName:e.clusterName,showZookeeper:"1"===e.buttOutsideZk,version:e.version,clusterMode:e.clusterMode,zkDeployInfo:{size:3,image:"",listenPort:8888,connectPort:6666,electionPort:7777,storageClassName:"",storage:1,hostNetwork:!1,limitsCpu:500,limitsMemory:1024,requestCpu:250,requestMemory:512,imagePullPolicy:"IfNotPresent",imagePullSecrets:"",serviceType:"ClusterIP",nodePort:"",nodeSelector:[]},brokerDeployInfo:{configTemplateId:"",jvmParam:"-Xms1g -Xmx1g -Xmn256m",image:"",size:3,listenPort:8888,externalPort:9095,jmxPort:9999,storageClassName:"",storage:1,hostNetwork:!1,zookeeperConnect:e.zkInfo,limitsCpu:500,limitsMemory:2048,requestCpu:250,requestMemory:2048,imagePullPolicy:"IfNotPresent",imagePullSecrets:"",serviceType:"ClusterIP",nodePorts:"",nodeSelector:[]}}}var p=function(){function e(t){Object(a["a"])(this,e),this.data=Object(l["a"])(t)}return Object(r["a"])(e,[{key:"result",value:function(){var e=this.data,t=e.id,o=e.showZookeeper,a={clusterId:t,brokerDeployInfo:this._processBroker()};return o||Object(n["a"])(a,"zkDeployInfo",this._processZk()),a}},{key:"_processZk",value:function(){var e=this.data,t=e.clusterName,o=e.zkDeployInfo,a=o.image,r=o.size,l=o.listenPort,s=o.connectPort,c=o.electionPort,p=o.storageClassName,m=o.storage,u=o.hostNetwork,f=o.limitsCpu,b=o.limitsMemory,d=o.requestCpu,y=o.requestMemory,k=o.imagePullPolicy,g=o.imagePullSecrets,D=o.serviceType,h=o.nodePort,v=o.nodeSelector,I={apiVersion:"kafka.gientech.io/v1alpha1",kind:"Zookeeper",metadata:{name:t+"-zk",annotations:{imageId:a.id}},spec:{size:r,image:a.value,listenPort:l,connectPort:s,electionPort:c,imagePullPolicy:k,serviceType:D,resources:{requests:{memory:y+"Mi",cpu:d+"m"},limits:{memory:b+"Mi",cpu:f+"m"}},volumeClaimTemplate:{spec:{storageClassName:p,accessModes:["ReadWriteOnce"],resources:{requests:{storage:m+"Gi"}}}}}};return u&&Object(n["a"])(I,"spec.hostNetwork",u),h&&Object(n["a"])(I,"spec.nodePort",h),g&&Object(n["a"])(I,"spec.imagePullSecrets",g),v.length&&Object(n["a"])(I,"spec.nodeSelector",new i["a"](v)),I}},{key:"_processBroker",value:function(){var e=this.data,t=e.clusterName,o=e.brokerDeployInfo,a=e.showZookeeper,r=e.clusterMode,l=o.image,s=o.configTemplateId,c=o.jvmParam,p=o.size,m=o.listenPort,u=o.jmxPort,f=o.externalPort,b=o.storageClassName,d=o.storage,y=o.hostNetwork,k=o.limitsCpu,g=o.limitsMemory,D=o.requestCpu,h=o.requestMemory,v=o.zookeeperConnect,I=o.imagePullPolicy,P=o.imagePullSecrets,w=o.serviceType,j=o.nodePorts,z=o.nodeSelector,C={apiVersion:"kafka.gientech.io/v1alpha1",kind:"Kafka",metadata:{name:t+"-broker",annotations:{configName:s.label,imageId:l.id}},spec:{config:s.value,jvmParam:c,size:p,image:l.value,listenPort:m,jmxPort:u,externalPort:f,imagePullPolicy:I,serviceType:w,clusterMode:r,resources:{requests:{memory:h+"Mi",cpu:D+"m"},limits:{memory:g+"Mi",cpu:k+"m"}},volumeClaimTemplate:{spec:{storageClassName:b,accessModes:["ReadWriteOnce"],resources:{requests:{storage:d+"Gi"}}}}}};return a&&Object(n["a"])(C,"spec.zookeeperConnect",v),y&&Object(n["a"])(C,"spec.hostNetwork",y),j&&Object(n["a"])(C,"spec.nodePorts",j?j.split(",").map((function(e){return parseInt(e)})):""),P&&Object(n["a"])(C,"spec.imagePullSecrets",P),z.length&&Object(n["a"])(C,"spec.nodeSelector",new i["a"](z)),C}},{key:"editBrokerResult",value:function(e){var t=this.data,o=t.brokerDeployInfo,a=(t.showZookeeper,o.image),r=o.configTemplateId,l=o.jvmParam,s=o.size,c=o.listenPort,p=o.jmxPort,m=o.externalPort,u=o.storageClassName,f=o.storage,b=o.hostNetwork,d=o.limitsCpu,y=o.limitsMemory,k=o.requestCpu,g=o.requestMemory,D=o.imagePullPolicy,h=o.imagePullSecrets,v=o.serviceType,I=o.nodePorts,P=o.nodeSelector,w=o.zookeeperConnect;return Object(n["a"])(e,"spec.image",a.value),Object(n["a"])(e,"metadata.annotations.imageId",a.id),Object(n["a"])(e,"metadata.annotations.configName",r.label),Object(n["a"])(e,"spec.config",r.value),Object(n["a"])(e,"spec.jvmParam",l),Object(n["a"])(e,"spec.size",s),Object(n["a"])(e,"spec.listenPort",c),Object(n["a"])(e,"spec.jmxPort",p),Object(n["a"])(e,"spec.externalPort",m),Object(n["a"])(e,"spec.resources.requests.memory",g+"Mi"),Object(n["a"])(e,"spec.resources.requests.cpu",k+"m"),Object(n["a"])(e,"spec.resources.limits.memory",y+"Mi"),Object(n["a"])(e,"spec.resources.limits.cpu",d+"m"),Object(n["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage",f+"Gi"),Object(n["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName",u),Object(n["a"])(e,"spec.imagePullPolicy",D),Object(n["a"])(e,"spec.serviceType",v),w?Object(n["a"])(e,"spec.zookeeperConnect",w):delete e.spec.zookeeperConnect,b?Object(n["a"])(e,"spec.hostNetwork",b):delete e.spec.hostNetwork,I?Object(n["a"])(e,"spec.nodePorts",I.split(",").map((function(e){return parseInt(e)}))):delete e.spec.nodePorts,h?Object(n["a"])(e,"spec.imagePullSecrets",h):delete e.spec.imagePullSecrets,P.length?Object(n["a"])(e,"spec.nodeSelector",new i["a"](P)):delete e.spec.nodeSelector,e}},{key:"editZkResult",value:function(e){var t=this.data,o=t.showZookeeper,a=t.zkDeployInfo;if(!o){var r=a.image,l=a.size,s=a.listenPort,c=a.connectPort,p=a.electionPort,m=a.storageClassName,u=a.storage,f=a.hostNetwork,b=a.limitsCpu,d=a.limitsMemory,y=a.requestCpu,k=a.requestMemory,g=a.imagePullPolicy,D=a.imagePullSecrets,h=a.serviceType,v=a.nodePort,I=a.nodeSelector;Object(n["a"])(e,"spec.image",r.value),Object(n["a"])(e,"metadata.annotations.imageId",r.id),Object(n["a"])(e,"spec.size",l),Object(n["a"])(e,"spec.listenPort",s),Object(n["a"])(e,"spec.connectPort",c),Object(n["a"])(e,"spec.electionPort",p),Object(n["a"])(e,"spec.resources.requests.memory",k+"Mi"),Object(n["a"])(e,"spec.resources.requests.cpu",y+"m"),Object(n["a"])(e,"spec.resources.limits.memory",d+"Mi"),Object(n["a"])(e,"spec.resources.limits.cpu",b+"m"),Object(n["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage",u+"Gi"),Object(n["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName",m),Object(n["a"])(e,"spec.imagePullPolicy",g),Object(n["a"])(e,"spec.serviceType",h),f?Object(n["a"])(e,"spec.hostNetwork",f):delete e.spec.hostNetwork,v?Object(n["a"])(e,"spec.nodePort",v):delete e.spec.nodePort,D?Object(n["a"])(e,"spec.imagePullSecrets",D):delete e.spec.imagePullSecrets,I.length?Object(n["a"])(e,"spec.nodeSelector",new i["a"](I)):delete e.spec.nodeSelector}return e}},{key:"init",value:function(e){var t=c(e);return t.zkDeployInfo=this._matchZk(t),t.brokerDeployInfo=this._matchBroker(),t}},{key:"_matchZk",value:function(e){var t=this.data;e.clusterName=Object(s["a"])(t,"metadata.name");var o=Object(s["a"])(t,"spec.size"),a=Object(s["a"])(t,"spec.image"),r=Object(s["a"])(t,"metadata.annotations.imageId"),l=Object(s["a"])(t,"spec.listenPort"),n=Object(s["a"])(t,"spec.connectPort"),c=Object(s["a"])(t,"spec.electionPort"),p=Object(s["a"])(t,"spec.hostNetwork",!1),m=Object(s["a"])(t,"spec.volumeClaimTemplate.spec.resources.requests.storage"),u=Object(s["a"])(t,"spec.volumeClaimTemplate.spec.storageClassName"),f=Object(s["a"])(t,"spec.resources.limits.cpu"),b=Object(s["a"])(t,"spec.resources.limits.memory"),d=Object(s["a"])(t,"spec.resources.requests.cpu"),y=Object(s["a"])(t,"spec.resources.requests.memory"),k=Object(s["a"])(t,"spec.imagePullPolicy"),g=Object(s["a"])(t,"spec.imagePullSecrets"),D=Object(s["a"])(t,"spec.serviceType"),h=Object(s["a"])(t,"spec.nodePort"),v=Object(s["a"])(t,"spec.nodeSelector",{});return{size:o,image:{id:r,value:a},listenPort:l,connectPort:n,electionPort:c,hostNetwork:p,storage:m.split("Gi")[0],storageClassName:u,limitsCpu:f.split("m")[0],limitsMemory:b.split("Mi")[0],requestCpu:d.split("m")[0],requestMemory:y.split("Mi")[0],imagePullPolicy:k,imagePullSecrets:g,serviceType:D,nodePort:h,nodeSelector:new i["a"](v)}}},{key:"_matchBroker",value:function(){var e=this.data,t=Object(s["a"])(e,"spec.image"),o=Object(s["a"])(e,"metadata.annotations.imageId"),a=Object(s["a"])(e,"metadata.annotations.configName"),r=Object(s["a"])(e,"spec.config"),l=Object(s["a"])(e,"spec.jvmParam","-Xms1g -Xmx1g -Xmn256m"),n=Object(s["a"])(e,"spec.size"),c=Object(s["a"])(e,"spec.listenPort"),p=Object(s["a"])(e,"spec.jmxPort"),m=Object(s["a"])(e,"spec.externalPort"),u=Object(s["a"])(e,"spec.hostNetwork",!1),f=Object(s["a"])(e,"spec.volumeClaimTemplate.spec.resources.requests.storage"),b=Object(s["a"])(e,"spec.volumeClaimTemplate.spec.storageClassName"),d=Object(s["a"])(e,"spec.resources.limits.cpu"),y=Object(s["a"])(e,"spec.resources.limits.memory"),k=Object(s["a"])(e,"spec.resources.requests.cpu"),g=Object(s["a"])(e,"spec.resources.requests.memory"),D=Object(s["a"])(e,"spec.imagePullPolicy"),h=Object(s["a"])(e,"spec.imagePullSecrets"),v=Object(s["a"])(e,"spec.serviceType"),I=Object(s["a"])(e,"spec.nodePorts"),P=Object(s["a"])(e,"spec.nodeSelector",{}),w=Object(s["a"])(e,"spec.zookeeperConnect");return{configTemplateId:{value:r,label:a},jvmParam:l,image:{id:o,value:t},size:n,listenPort:c,jmxPort:p,externalPort:m,hostNetwork:u,zookeeperConnect:w,storage:f.split("Gi")[0],storageClassName:b,limitsCpu:d.split("m")[0],limitsMemory:y.split("Mi")[0],requestCpu:k.split("m")[0],requestMemory:g.split("Mi")[0],imagePullPolicy:D,imagePullSecrets:h,serviceType:v,nodePorts:I?I.join(","):I,nodeSelector:new i["a"](P)}}}])}()},"8b5b":function(e,t,o){"use strict";o.r(t);o("b0c0"),o("498a");var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.deployLoading,expression:"deployLoading"}],staticClass:"deployment-plan"},[t("el-form",{ref:"formRef",attrs:{"label-position":e.labelPosition,"label-width":"90px",model:e.form,rules:e.rules}},[t("header-line",[e._v(" Broker(端口为0自动分配) "),t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.addBroker}},[e._v("新增")])],1),e._l(e.form.deploymentPlaneList,(function(o,a){return t("el-card",{key:a,staticClass:"mb-20"},[t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:20}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"机器:",prop:"deploymentPlaneList.".concat(a,".machine"),rules:e.rules.machine}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择机器","value-key":"id"},on:{change:function(t){return e.changeMachine(t,o)}},model:{value:o.machine,callback:function(t){e.$set(o,"machine",t)},expression:"item.machine"}},e._l(e.kafkaMachineOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.ip,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"端口:",prop:"deploymentPlaneList.".concat(a,".port"),rules:e.rules.port}},[t("el-input",{attrs:{placeholder:"请输入端口"},model:{value:o.port,callback:function(t){e.$set(o,"port","string"===typeof t?t.trim():t)},expression:"item.port"}})],1)],1)],1),t("el-form-item",{attrs:{label:"部署路径:",prop:"deploymentPlaneList.".concat(a,".deployPath"),rules:e.rules.deployPath}},[t("el-input",{attrs:{placeholder:"请输入部署路径"},model:{value:o.deployPath,callback:function(t){e.$set(o,"deployPath","string"===typeof t?t.trim():t)},expression:"item.deployPath"}})],1),t("el-form-item",{attrs:{label:"配置模板",prop:"configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板"},model:{value:o.configTemplateId,callback:function(t){e.$set(o,"configTemplateId",t)},expression:"item.configTemplateId"}},e._l(e.opts_kafkaTemplate,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"运行内存",prop:"deploymentPlaneList.".concat(a,".jvmParam"),rules:e.rules.jvmParam}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:o.jvmParam,callback:function(t){e.$set(o,"jvmParam",t)},expression:"item.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delBroker(o,a)}}},[e._v("删除")])],1)],1)],1)}))],2)],1)},r=[],l=o("3835"),n=o("b85c"),s=o("2909"),i=o("5530"),c=(o("99af"),o("caad"),o("a15b"),o("d81d"),o("14d9"),o("a434"),o("4fad"),o("0541"),o("b64b"),o("d3b7"),o("159b"),o("b263")),p=o("082f"),m=o("49bb"),u=o("61f7"),f=o("ff51"),b=o("ec41"),d=o("5c8a"),y={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{opts_startupTemplate:m["i"],opts_kafkaTemplate:[],deployLoading:!1,deploymentPlaneList:[],kafkaMachineOptions:[],labelPosition:"right",form:{deploymentPlaneList:[]},rules:{jvmParam:[{required:!0,validator:u["h"],trigger:"change"}],machine:[{required:!0,message:"请选择机器",trigger:"change"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}],deployPath:[{required:!0,message:"请输入部署路径",trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){this.getKafkaConfigTemplate()},mounted:function(){this.isEdit&&(this.getDeployplanById(),this.getAllMachine())},methods:{getKafkaConfigTemplate:function(){var e=this,t={moduleType:"KAFKA",componentType:"KAFKA"};Object(p["c"])(t).then((function(t){e.opts_kafkaTemplate=Object(f["a"])(null===t||void 0===t?void 0:t.data)?t.data:[]}))},changeMachine:function(e,t){var o=Object(b["a"])(e,"deployPath","");this.$set(t,"deployPath",o)},addBroker:function(){var e={clusterId:this.rowData.id,deployPath:"",machine:null,port:"",configTemplateId:""};this.form.deploymentPlaneList.push(e)},delBroker:function(e,t){this.form.deploymentPlaneList.splice(t,1)},getDeployplanById:function(){var e=this;this.deployLoading=!0,Object(c["h"])(this.rowData.id).then((function(t){e.form.deploymentPlaneList=Object(b["a"])(t,"data",[])})).finally((function(){e.deployLoading=!1}))},getAllMachine:function(){var e=this;Object(c["e"])(this.rowData.id).then((function(t){var o=Object(b["a"])(t,"data",[]);e.kafkaMachineOptions=o.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{ip:e.machineIp,id:e.machineId,userName:e.machineUserName})}))}))},checkAllIpPort:function(){var e=k(this.form);return g(e)}}};function k(e){var t=Object(d["a"])(e),o=Object(s["a"])(t.deploymentPlaneList),a=[];function r(e){var t,o=Object(n["a"])(e);try{for(o.s();!(t=o.n()).done;){var l=t.value;[0,"0"].includes(l.port)||a.push({address:l.machine.ip,port:l.port}),Array.isArray(l.childList)&&r(l.childList)}}catch(s){o.e(s)}finally{o.f()}}return r(o),a}function g(e){var t,o=e.length,a=e.map((function(e){return"".concat(e.address,":").concat(e.port)})),r={},s=Object(n["a"])(a);try{for(s.s();!(t=s.n()).done;){var i=t.value;Object.hasOwn(r,i)?r[i]+=1:r[i]=1}}catch(p){s.e(p)}finally{s.f()}var c=[];return Object.entries(r).forEach((function(e){var t=Object(l["a"])(e,2),o=t[0],a=t[1];a>1&&c.push("".concat(o,"重复 ").concat(a,"次"))})),{message:c.join("; "),isPass:Object.keys(r).length===o}}var D=y,h=(o("9549"),o("2877")),v=Object(h["a"])(D,a,r,!1,null,"227c98b0",null);t["default"]=v.exports},"90be":function(e,t,o){},9549:function(e,t,o){"use strict";o("90be")},"9bde":function(e,t,o){"use strict";o("66a9")},"9d78":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"g-page"},[t("el-page-header",{staticStyle:{"margin-bottom":"20px"},attrs:{content:"部署记录"},on:{back:e.goBack}}),t("search-form",{attrs:{searchConfig:e.searchConfig},on:{onSearch:e.onSearch}}),t("button-list",{attrs:{data:e.buttonList}}),t("tableView",{attrs:{loading:e.tableConfig.loading,operateObj:e.tableConfig.operate,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,isPage:e.tableConfig.isPage,total:e.tableConfig.pagination.totalCount,rowKey:"id",operateSlice:2,currentPage:e.tableConfig.pagination.pageNo,pageSize:e.tableConfig.pagination.pageSize},on:{"update:currentPage":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:current-page":function(t){return e.$set(e.tableConfig.pagination,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tableConfig.pagination,"pageSize",t)},changePage:e.changePage}})],1)},r=[],l=o("c7eb"),n=o("5530"),s=o("1da1"),i=o("23a6"),c=o("ec41"),p=o("ff51"),m={name:"deploy-record",components:{},mixins:[],props:{},data:function(){return{buttonList:[],searchConfig:{searchData:{cluster:"",machineIp:""},searchItem:[{prop:"cluster",label:"集群",type:"input"},{prop:"machineIp",label:"机器",type:"input"}],rules:{}},tableConfig:{loading:!1,pagination:{pageNo:1,pageSize:10,totalCount:0},tableData:[],columns:[{prop:"cluster",label:"集群"},{prop:"machineIp",label:"机器ip"},{prop:"machinePort",label:"机器端口"},{prop:"deployStatus",label:"部署状态"},{prop:"deployPath",label:"部署路径"},{prop:"content",label:"内容"},{prop:"detail",label:"详情"},{prop:"createDate",label:"部署时间"}],operate:{width:160,list:[]}},rowData:null}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},getList:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var o,a,r;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableConfig.loading=!0,t.prev=1,o=Object(n["a"])(Object(n["a"])({},e.tableConfig.pagination),{},{requestObject:Object(n["a"])({componentType:"12"},e.searchConfig.searchData)}),t.next=5,Object(i["f"])(o);case 5:a=t.sent,r=Object(c["a"])(a,"data.data"),e.tableConfig.tableData=Object(p["a"])(r)?r:[],e.tableConfig.pagination.totalCount=Object(c["a"])(a,"data.totalCount")||0,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1);case 14:e.tableConfig.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},onSearch:function(e){this.tableConfig.pagination.pageNo=1,this.getList()},changePage:function(e,t){e&&(this.tableConfig.pagination.pageNo=e),t&&(this.tableConfig.pagination.pageNo=1,this.tableConfig.pagination.pageSize=t),this.getList()}}},u=m,f=o("2877"),b=Object(f["a"])(u,a,r,!1,null,"42ee6cd0",null);t["default"]=b.exports},ce3b:function(e,t,o){"use strict";o("0d70")},d82b:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"集群存在已下节点数据,确认全部删除?",visible:e.show,size:"small","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("tableView",{ref:"tableView",attrs:{isPage:e.tableConfig.isPage,columns:e.tableConfig.columns,tableData:e.tableConfig.tableData,rowKey:"id"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],l=o("b263"),n={name:"AddAndEdit",components:{},mixins:[],model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Array,default:null},refresh:Function},data:function(){return{tableConfig:{loading:!1,isPage:!1,tableData:[],columns:[{prop:"nodeIp",label:"IP",align:"center"},{prop:"nodePort",label:"端口",align:"center"}]}}},watch:{},created:function(){},mounted:function(){this.tableConfig.tableData=this.rowData},methods:{clickCancel:function(){this.$emit("change",!1)},clickConfirm:function(){var e=this;Object(l["d"])(this.rowData).then((function(t){e.$message.success(t.data),e.$emit("change",!1),e.refresh()}))}}},s=n,i=o("2877"),c=Object(i["a"])(s,a,r,!1,null,"673b7c1c",null);t["default"]=c.exports},d8ed:function(e,t,o){"use strict";o.r(t);o("b0c0");var a=function(){var e=this,t=e._self._c;return t("div",[t("el-drawer",{attrs:{title:"一键部署(容器)",visible:e.show,size:"900px","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.deployLoading,expression:"deployLoading"}],ref:"formRef",staticClass:"cluster-form ml-10 mr-20",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},["0"===e.rowData.buttOutsideZk?t("div",[t("header-line",[e._v("zookeeper")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"zkDeployInfo.image"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.zkDeployInfo.image,callback:function(t){e.$set(e.formData.zkDeployInfo,"image",t)},expression:"formData.zkDeployInfo.image"}},e._l(e.opts_imageZk,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实例数",prop:"zkDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.zkDeployInfo.size,callback:function(t){e.$set(e.formData.zkDeployInfo,"size",e._n(t))},expression:"formData.zkDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"监听端口",prop:"zkDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入监听端口"},model:{value:e.formData.zkDeployInfo.listenPort,callback:function(t){e.$set(e.formData.zkDeployInfo,"listenPort",e._n(t))},expression:"formData.zkDeployInfo.listenPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"通信端口",prop:"zkDeployInfo.connectPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入通信端口"},model:{value:e.formData.zkDeployInfo.connectPort,callback:function(t){e.$set(e.formData.zkDeployInfo,"connectPort",e._n(t))},expression:"formData.zkDeployInfo.connectPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"选举端口",prop:"zkDeployInfo.electionPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入选举端口"},model:{value:e.formData.zkDeployInfo.electionPort,callback:function(t){e.$set(e.formData.zkDeployInfo,"electionPort",e._n(t))},expression:"formData.zkDeployInfo.electionPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"zkDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.zkDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.zkDeployInfo,"storageClassName",t)},expression:"formData.zkDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"zkDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入存储卷大小"},model:{value:e.formData.zkDeployInfo.storage,callback:function(t){e.$set(e.formData.zkDeployInfo,"storage",e._n(t))},expression:"formData.zkDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.zkDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.zkDeployInfo,"imagePullPolicy",t)},expression:"formData.zkDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.zkDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.zkDeployInfo,"imagePullSecrets",t)},expression:"formData.zkDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.zkDeployInfo.serviceType,callback:function(t){e.$set(e.formData.zkDeployInfo,"serviceType",t)},expression:"formData.zkDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.zkDeployInfo.serviceType?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"外部服务端口",prop:"zkDeployInfo.nodePort"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入外部服务端口"},model:{value:e.formData.zkDeployInfo.nodePort,callback:function(t){e.$set(e.formData.zkDeployInfo,"nodePort",e._n(t))},expression:"formData.zkDeployInfo.nodePort"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.zkDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.zkDeployInfo,"hostNetwork",t)},expression:"formData.zkDeployInfo.hostNetwork"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"支持虚机会为Pod使用主机网络，请确保主机端口可用",type:"warning","show-icon":"",closable:!1}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.zkDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"row.key"}})]}}],null,!1,3247490804)}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"row.value"}})]}}],null,!1,366466804)}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("zk")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(o){var a=o.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.zkDeployInfo.nodeSelector,a)}}},[e._v("删除")])]}}],null,!1,3493744063)})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"zkDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.zkDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.zkDeployInfo,"limitsCpu",e._n(t))},expression:"formData.zkDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"zkDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入memory"},model:{value:e.formData.zkDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.zkDeployInfo,"limitsMemory",e._n(t))},expression:"formData.zkDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"zkDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.zkDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.zkDeployInfo,"requestCpu",e._n(t))},expression:"formData.zkDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"zkDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入memory"},model:{value:e.formData.zkDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.zkDeployInfo,"requestMemory",e._n(t))},expression:"formData.zkDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1):e._e(),t("div",[t("header-line",[e._v("broker")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"brokerDeployInfo.image"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.brokerDeployInfo.image,callback:function(t){e.$set(e.formData.brokerDeployInfo,"image",t)},expression:"formData.brokerDeployInfo.image"}},e._l(e.opts_imageBk,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模板",prop:"brokerDeployInfo.configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板","value-key":"label"},model:{value:e.formData.brokerDeployInfo.configTemplateId,callback:function(t){e.$set(e.formData.brokerDeployInfo,"configTemplateId",t)},expression:"formData.brokerDeployInfo.configTemplateId"}},e._l(e.opts_kafkaTemplate,(function(e){return t("el-option",{key:e.label,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行内存",prop:"brokerDeployInfo.jvmParam"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:e.formData.brokerDeployInfo.jvmParam,callback:function(t){e.$set(e.formData.brokerDeployInfo,"jvmParam",t)},expression:"formData.brokerDeployInfo.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实例数",prop:"brokerDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.brokerDeployInfo.size,callback:function(t){e.$set(e.formData.brokerDeployInfo,"size",e._n(t))},expression:"formData.brokerDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"监听端口",prop:"brokerDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入监听端口"},model:{value:e.formData.brokerDeployInfo.listenPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"listenPort",e._n(t))},expression:"formData.brokerDeployInfo.listenPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"广播监听端口",prop:"brokerDeployInfo.externalPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入广播监听端口"},model:{value:e.formData.brokerDeployInfo.externalPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"externalPort",e._n(t))},expression:"formData.brokerDeployInfo.externalPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"jmxPort",prop:"brokerDeployInfo.jmxPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入jmxPort"},model:{value:e.formData.brokerDeployInfo.jmxPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"jmxPort",e._n(t))},expression:"formData.brokerDeployInfo.jmxPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"brokerDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.brokerDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storageClassName",t)},expression:"formData.brokerDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"brokerDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入存储大小"},model:{value:e.formData.brokerDeployInfo.storage,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storage",e._n(t))},expression:"formData.brokerDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.brokerDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullPolicy",t)},expression:"formData.brokerDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.brokerDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullSecrets",t)},expression:"formData.brokerDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.brokerDeployInfo.serviceType,callback:function(t){e.$set(e.formData.brokerDeployInfo,"serviceType",t)},expression:"formData.brokerDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.brokerDeployInfo.serviceType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"外部服务端口",prop:"brokerDeployInfo.nodePorts"}},[t("el-input",{staticStyle:{width:"37%"},attrs:{placeholder:"请输入外部服务端口,多个端口用逗号隔开"},model:{value:e.formData.brokerDeployInfo.nodePorts,callback:function(t){e.$set(e.formData.brokerDeployInfo,"nodePorts",t)},expression:"formData.brokerDeployInfo.nodePorts"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"请确保为每个实例都设置了外部服务端口",type:"warning","show-icon":"",closable:!1}})],1)],1):e._e(),"1"===e.rowData.buttOutsideZk?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"zk链接地址",prop:"brokerDeployInfo.zookeeperConnect"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请输入zk链接地址"},model:{value:e.formData.brokerDeployInfo.zookeeperConnect,callback:function(t){e.$set(e.formData.brokerDeployInfo,"zookeeperConnect",t)},expression:"formData.brokerDeployInfo.zookeeperConnect"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.brokerDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.brokerDeployInfo,"hostNetwork",t)},expression:"formData.brokerDeployInfo.hostNetwork"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"支持虚机会为Pod使用主机网络，请确保主机端口可用",type:"warning","show-icon":"",closable:!1}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.brokerDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"row.key"}})]}}])}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"row.value"}})]}}])}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("bk")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(o){var a=o.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.brokerDeployInfo.nodeSelector,a)}}},[e._v("删除")])]}}])})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsCpu",e._n(t))},expression:"formData.brokerDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsMemory",e._n(t))},expression:"formData.brokerDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestCpu",e._n(t))},expression:"formData.brokerDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestMemory",e._n(t))},expression:"formData.brokerDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1)]),t("span",{staticClass:"drawer-footer"},[t("el-button",{attrs:{type:"primary",disabled:e.deployLoading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1),e.deployVisible?t("el-drawer",{attrs:{title:"部署信息",visible:e.deployVisible,size:"70%","append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.deployVisible=t},close:e.clickDeployCancel}},[t("my-xterm",{ref:"xterm",attrs:{terminal:e.terminal,socketUrl:e.socketUrl}})],1):e._e()],1)},r=[],l=o("c7eb"),n=o("1da1"),s=(o("99af"),o("a15b"),o("d81d"),o("14d9"),o("a434"),o("b64b"),o("d3b7"),o("ac1f"),o("00b4"),o("159b"),o("a4ed")),i=o("2a7b"),c=o("082f"),p=o("49bb"),m=o("982b"),u=o("81c3"),f=o("ec41"),b=o("ff51"),d=o("61f7"),y=o("957c"),k={components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=function(e,t,o){return Object(d["g"])(e,t,o)};return{minBkMemory:2048,socketUrl:"",terminal:{pid:1,name:"terminal"},deployVisible:!1,dict_imagePullPolicy:p["d"],opts_imagePullSecrets:[],opts_imageZk:[],opts_imageBk:[],dict_serviceType:p["f"],opts_startupTemplate:p["i"],versionZKOptions:m["e"],opts_storageClass:[],opts_kafkaTemplate:[],deployLoading:!1,nameSrvList:[],brokerList:[],labelPosition:"right",formData:Object(u["b"])(this.rowData),rules:{"zkDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"brokerDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"brokerDeployInfo.configTemplateId":[{required:!0,message:"请选择配置模板",trigger:"change"}],"brokerDeployInfo.jvmParam":[{required:!0,validator:d["h"],trigger:"change"}],"zkDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"zkDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.jmxPort":[{required:!0,message:"请输入jmxPort",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"zkDeployInfo.connectPort":[{required:!0,message:"请输入通信端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.externalPort":[{required:!0,message:"请输入广播监听端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"zkDeployInfo.electionPort":[{required:!0,message:"请输入选举端口",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"zkDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"brokerDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"zkDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:d["d"],trigger:"blur"}],"zkDeployInfo.nodePort":[{validator:d["f"],trigger:"blur"}],"brokerDeployInfo.nodePorts":[{validator:e,trigger:"blur"}],"zkDeployInfo.limitsCpu":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.limitsCpu":[{validator:d["d"],trigger:"blur"}],"zkDeployInfo.limitsMemory":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.limitsMemory":[{validator:d["d"],trigger:"blur"}],"zkDeployInfo.requestCpu":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.requestCpu":[{validator:d["d"],trigger:"blur"}],"zkDeployInfo.requestMemory":[{validator:d["d"],trigger:"blur"}],"brokerDeployInfo.requestMemory":[{validator:d["d"],trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{"formData.brokerDeployInfo.jvmParam":function(e){if(e){var t=/^(?=.*-Xms)(?=.*-Xmx)(?=.*-Xmn).*$/,o=t.test(e);if(o){var a=e.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],r=1024*a+1024;this.minBkMemory=r,this.formData.brokerDeployInfo.limitsMemory=r,this.formData.brokerDeployInfo.requestMemory=r}}}},created:function(){this.getKafkaConfigTemplate(),this.getK8sStorageClass(),this.getContainerManage(),this.getContainerImageZk(),this.getContainerImageBk()},mounted:function(){},methods:{socketStart:function(e){this.socketUrl="/echo?logId=".concat(e.id),this.deployVisible=!0},clickDeployCancel:function(){this.deployVisible=!1,this.$emit("change",!1),this.refresh()},clickAction:function(e){switch(e){case"zk":this.formData.zkDeployInfo.nodeSelector.push({key:"",value:""});break;case"bk":this.formData.brokerDeployInfo.nodeSelector.push({key:"",value:""})}},clickDelete:function(e,t){e.splice(t,1)},getContainerImageZk:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var o,a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(y["c"])("ZOOKEEPER").catch((function(e){}));case 2:o=t.sent,a=Object(f["a"])(o,"data",[]),e.opts_imageZk=a.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerImageBk:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var o,a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(y["c"])("KAFKA_BROKER").catch((function(e){}));case 2:o=t.sent,a=Object(f["a"])(o,"data",[]),e.opts_imageBk=a.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerManage:function(){var e=this;Object(s["a"])({agentId:this.rowData.agentId,namespace:this.rowData.namespace}).then((function(t){var o=Object(b["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_imagePullSecrets=o.map((function(e){return{name:Object(f["a"])(e,"metadata.name")}}))}))},getKafkaConfigTemplate:function(){var e=this,t={moduleType:"KAFKA",componentType:"KAFKA"};Object(c["d"])(t).then((function(t){var o=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_kafkaTemplate=o.map((function(e){var t=e.content?JSON.parse(e.content):"",o=[];return t&&t.forEach((function(e){var t=e.configKey;o.push("".concat(t,"=").concat(e.configValue))})),{label:e.name,value:o.join("\n")}}))}))},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n["a"])(Object(l["a"])().mark((function t(o){var a,r,n,s,c,p,m,f,b,d,y,k,D,h,v,I,P,w,j,z,C;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o){t.next=38;break}if(a=e.formData.zkDeployInfo,r=a.listenPort,n=a.connectPort,s=a.electionPort,c=a.limitsCpu,p=a.limitsMemory,m=a.requestCpu,f=a.requestMemory,b=e.formData.brokerDeployInfo,d=b.jvmParam,y=b.listenPort,k=b.externalPort,D=b.limitsCpu,h=b.limitsMemory,v=b.requestCpu,I=b.requestMemory,e.formData.showZookeeper){t.next=14;break}if(P=g([r,n,s]),P){t.next=8;break}return e.$message.error("zookeeper监听端口、通信端口、选举端口"),t.abrupt("return",!1);case 8:if(!(c<m)){t.next=11;break}return e.$message.error("zookeeper request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 11:if(!(p<f)){t.next=14;break}return e.$message.error("zookeeper request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 14:if(w=g([y,k]),w){t.next=18;break}return e.$message.error("broker监听端口、广播监听端口不能相同"),t.abrupt("return",!1);case 18:if(!(D<v)){t.next=21;break}return e.$message.error("broker request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 21:if(!(h<I)){t.next=24;break}return e.$message.error("broker request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 24:if(!d){t.next=33;break}if(j=d.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],z=1024*j,!(z>=h)){t.next=30;break}return e.$message.error("broker limits-memory须小于运行内存"),t.abrupt("return",!1);case 30:if(!(z>=I)){t.next=33;break}return e.$message.error("broker request-memory须小于运行内存"),t.abrupt("return",!1);case 33:e.deployLoading=!0,C=new u["a"](e.formData).result(),Object(i["d"])(C).then((function(t){200===t.code&&e.$message({type:"success",message:t.msg})})).finally((function(){e.deployLoading=!1})),e.socketStart(e.rowData);case 38:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getK8sStorageClass:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(s["e"])({agentId:e.rowData.agentId}).then((function(t){var o=Object(b["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_storageClass=o.map((function(e){return{label:Object(f["a"])(e,"metadata.name"),value:Object(f["a"])(e,"metadata.name")}}))}));case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})))()}}};function g(e){for(var t=0;t<e.length;t++)for(var o=t+1;o<e.length;o++)if(e[t]===e[o])return!1;return!0}var D=k,h=(o("ce3b"),o("2877")),v=Object(h["a"])(D,a,r,!1,null,"5942aa75",null);t["default"]=v.exports},db9c:function(e,t,o){},dfe5:function(e,t,o){"use strict";o.r(t);o("b0c0");var a=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"编辑"+e.rowData.clusterType+"集群",visible:e.show,size:"medium","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formData,rules:e.rules}},["zk"===e.rowData.clusterType?t("div",[t("header-line",[e._v("zookeeper")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"zkDeployInfo.image"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.zkDeployInfo.image,callback:function(t){e.$set(e.formData.zkDeployInfo,"image",t)},expression:"formData.zkDeployInfo.image"}},e._l(e.opts_imageZk,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实例数",prop:"size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.zkDeployInfo.size,callback:function(t){e.$set(e.formData.zkDeployInfo,"size",e._n(t))},expression:"formData.zkDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"监听端口",prop:"zkDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入listenPort"},model:{value:e.formData.zkDeployInfo.listenPort,callback:function(t){e.$set(e.formData.zkDeployInfo,"listenPort",e._n(t))},expression:"formData.zkDeployInfo.listenPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"通信端口",prop:"zkDeployInfo.connectPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入通信端口"},model:{value:e.formData.zkDeployInfo.connectPort,callback:function(t){e.$set(e.formData.zkDeployInfo,"connectPort",e._n(t))},expression:"formData.zkDeployInfo.connectPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"选举端口",prop:"zkDeployInfo.electionPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入选举端口"},model:{value:e.formData.zkDeployInfo.electionPort,callback:function(t){e.$set(e.formData.zkDeployInfo,"electionPort",e._n(t))},expression:"formData.zkDeployInfo.electionPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"zkDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:"",placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.zkDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.zkDeployInfo,"storageClassName",t)},expression:"formData.zkDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"zkDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入存储卷大小"},model:{value:e.formData.zkDeployInfo.storage,callback:function(t){e.$set(e.formData.zkDeployInfo,"storage",e._n(t))},expression:"formData.zkDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.zkDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.zkDeployInfo,"imagePullPolicy",t)},expression:"formData.zkDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.zkDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.zkDeployInfo,"imagePullSecrets",t)},expression:"formData.zkDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.zkDeployInfo.serviceType,callback:function(t){e.$set(e.formData.zkDeployInfo,"serviceType",t)},expression:"formData.zkDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.zkDeployInfo.serviceType?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"nodePort",prop:"zkDeployInfo.nodePort"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入nodePort"},model:{value:e.formData.zkDeployInfo.nodePort,callback:function(t){e.$set(e.formData.zkDeployInfo,"nodePort",e._n(t))},expression:"formData.zkDeployInfo.nodePort"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.zkDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.zkDeployInfo,"hostNetwork",t)},expression:"formData.zkDeployInfo.hostNetwork"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.zkDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"row.key"}})]}}],null,!1,3247490804)}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"row.value"}})]}}],null,!1,366466804)}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("zk")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(o){var a=o.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.zkDeployInfo.nodeSelector,a)}}},[e._v("删除")])]}}],null,!1,2129424565)})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"zkDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.zkDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.zkDeployInfo,"limitsCpu",e._n(t))},expression:"formData.zkDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"zkDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入memory"},model:{value:e.formData.zkDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.zkDeployInfo,"limitsMemory",e._n(t))},expression:"formData.zkDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"zkDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.zkDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.zkDeployInfo,"requestCpu",e._n(t))},expression:"formData.zkDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"zkDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入memory"},model:{value:e.formData.zkDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.zkDeployInfo,"requestMemory",e._n(t))},expression:"formData.zkDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1):t("div",[t("header-line",[e._v("broker")]),t("el-card",{staticStyle:{"margin-bottom":"20px"}},[t("el-row",{staticStyle:{"line-height":"90px"},attrs:{gutter:40}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"镜像地址",prop:"brokerDeployInfo.image"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择",clearable:"",filterable:"","value-key":"id"},model:{value:e.formData.brokerDeployInfo.image,callback:function(t){e.$set(e.formData.brokerDeployInfo,"image",t)},expression:"formData.brokerDeployInfo.image"}},e._l(e.opts_imageBk,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模板",prop:"brokerDeployInfo.configTemplateId"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择配置模板","value-key":"label"},model:{value:e.formData.brokerDeployInfo.configTemplateId,callback:function(t){e.$set(e.formData.brokerDeployInfo,"configTemplateId",t)},expression:"formData.brokerDeployInfo.configTemplateId"}},e._l(e.opts_kafkaTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运行内存",prop:"brokerDeployInfo.jvmParam"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择运行内存","allow-create":"",filterable:""},model:{value:e.formData.brokerDeployInfo.jvmParam,callback:function(t){e.$set(e.formData.brokerDeployInfo,"jvmParam",t)},expression:"formData.brokerDeployInfo.jvmParam"}},e._l(e.opts_startupTemplate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实例数",prop:"brokerDeployInfo.size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.brokerDeployInfo.size,callback:function(t){e.$set(e.formData.brokerDeployInfo,"size",e._n(t))},expression:"formData.brokerDeployInfo.size"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"监听端口",prop:"brokerDeployInfo.listenPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入监听端口"},model:{value:e.formData.brokerDeployInfo.listenPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"listenPort",e._n(t))},expression:"formData.brokerDeployInfo.listenPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"广播监听端口",prop:"brokerDeployInfo.externalPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入广播监听端口"},model:{value:e.formData.brokerDeployInfo.externalPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"externalPort",e._n(t))},expression:"formData.brokerDeployInfo.externalPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"jmxPort",prop:"brokerDeployInfo.jmxPort"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入jmxPort"},model:{value:e.formData.brokerDeployInfo.jmxPort,callback:function(t){e.$set(e.formData.brokerDeployInfo,"jmxPort",e._n(t))},expression:"formData.brokerDeployInfo.jmxPort"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储类",prop:"brokerDeployInfo.storageClassName"}},[t("el-select",{staticClass:"w-100",attrs:{disabled:"",placeholder:"请选择存储类","value-key":"id"},model:{value:e.formData.brokerDeployInfo.storageClassName,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storageClassName",t)},expression:"formData.brokerDeployInfo.storageClassName"}},e._l(e.opts_storageClass,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"存储卷大小(Gi)",prop:"brokerDeployInfo.storage"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{disabled:"","controls-position":"right",min:0,placeholder:"请输入存储卷大小"},model:{value:e.formData.brokerDeployInfo.storage,callback:function(t){e.$set(e.formData.brokerDeployInfo,"storage",e._n(t))},expression:"formData.brokerDeployInfo.storage"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取策略"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取策略"},model:{value:e.formData.brokerDeployInfo.imagePullPolicy,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullPolicy",t)},expression:"formData.brokerDeployInfo.imagePullPolicy"}},e._l(e.dict_imagePullPolicy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"镜像拉取秘钥"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择镜像拉取秘钥"},model:{value:e.formData.brokerDeployInfo.imagePullSecrets,callback:function(t){e.$set(e.formData.brokerDeployInfo,"imagePullSecrets",t)},expression:"formData.brokerDeployInfo.imagePullSecrets"}},e._l(e.opts_imagePullSecrets,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"服务类型"}},[t("el-select",{staticClass:"w-100",attrs:{placeholder:"请选择服务类型"},model:{value:e.formData.brokerDeployInfo.serviceType,callback:function(t){e.$set(e.formData.brokerDeployInfo,"serviceType",t)},expression:"formData.brokerDeployInfo.serviceType"}},e._l(e.dict_serviceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"NodePort"===e.formData.brokerDeployInfo.serviceType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"外部服务端口",prop:"brokerDeployInfo.nodePorts"}},[t("el-input",{staticStyle:{width:"37%"},attrs:{placeholder:"请输入外部服务端口,多个端口用逗号隔开"},model:{value:e.formData.brokerDeployInfo.nodePorts,callback:function(t){e.$set(e.formData.brokerDeployInfo,"nodePorts",t)},expression:"formData.brokerDeployInfo.nodePorts"}}),t("el-alert",{staticStyle:{display:"inline","margin-left":"10px"},attrs:{title:"请确保为每个实例都设置了外部服务端口",type:"warning","show-icon":"",closable:!1}})],1)],1):e._e(),"1"===e.rowData.buttOutsideZk?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"zk链接地址",prop:"brokerDeployInfo.zookeeperConnect"}},[t("el-input",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请输入zk链接地址"},model:{value:e.formData.brokerDeployInfo.zookeeperConnect,callback:function(t){e.$set(e.formData.brokerDeployInfo,"zookeeperConnect",t)},expression:"formData.brokerDeployInfo.zookeeperConnect"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"支持虚机"}},[t("el-checkbox",{model:{value:e.formData.brokerDeployInfo.hostNetwork,callback:function(t){e.$set(e.formData.brokerDeployInfo,"hostNetwork",t)},expression:"formData.brokerDeployInfo.hostNetwork"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"节点选择器"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.brokerDeployInfo.nodeSelector}},[t("el-table-column",{attrs:{prop:"key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入key"},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"row.key"}})]}}])}),t("el-table-column",{attrs:{prop:"value",label:"value"},scopedSlots:e._u([{key:"default",fn:function(o){var a=o.row;return[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入value"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"row.value"}})]}}])}),t("el-table-column",{attrs:{prop:"actions",label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickAction("bk")}}},[e._v("添加")])]},proxy:!0},{key:"default",fn:function(o){var a=o.$index;return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clickDelete(e.formData.brokerDeployInfo.nodeSelector,a)}}},[e._v("删除")])]}}])})],1)],1)],1)],1),t("div",[t("span",{staticStyle:{"margin-left":"10px"}},[e._v("limits")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.limitsCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.limitsCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsCpu",e._n(t))},expression:"formData.brokerDeployInfo.limitsCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.limitsMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.limitsMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"limitsMemory",e._n(t))},expression:"formData.brokerDeployInfo.limitsMemory"}})],1)],1)],1),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("request")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"cpu(m)",prop:"brokerDeployInfo.requestCpu"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入cpu大小"},model:{value:e.formData.brokerDeployInfo.requestCpu,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestCpu",e._n(t))},expression:"formData.brokerDeployInfo.requestCpu"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"memory(Mi)",prop:"brokerDeployInfo.requestMemory"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:e.minBkMemory,placeholder:"请输入memory"},model:{value:e.formData.brokerDeployInfo.requestMemory,callback:function(t){e.$set(e.formData.brokerDeployInfo,"requestMemory",e._n(t))},expression:"formData.brokerDeployInfo.requestMemory"}})],1)],1)],1)],1)],1)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],l=o("c7eb"),n=o("1da1"),s=(o("99af"),o("7db0"),o("a15b"),o("d81d"),o("14d9"),o("a434"),o("b64b"),o("d3b7"),o("ac1f"),o("00b4"),o("159b"),o("a4ed")),i=o("982b"),c=o("082f"),p=o("61f7"),m=o("81c3"),u=o("2a7b"),f=o("ec41"),b=o("ff51"),d=o("49bb"),y=o("957c"),k={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){var e=this,t=function(t,o,a){return Object(p["g"])(t,o,a,e.formData.brokerDeployInfo.size)};return{minBkMemory:2048,dict_imagePullPolicy:d["d"],opts_imageZk:[],opts_imageBk:[],opts_imagePullSecrets:[],dict_serviceType:d["f"],opts_startupTemplate:d["i"],versionZKOptions:i["e"],resultZkJson:null,resultBrokerJson:null,opts_storageClass:[],opts_kafkaTemplate:[],loading:!1,labelPosition:"right",formData:Object(m["b"])(this.rowData),rules:{"zkDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"brokerDeployInfo.image":[{required:!0,message:"请输入镜像地址",trigger:"blur"}],"brokerDeployInfo.configTemplateId":[{required:!0,message:"请选择配置模板",trigger:"change"}],"brokerDeployInfo.jvmParam":[{required:!0,validator:p["h"],trigger:"change"}],"zkDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.size":[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"zkDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.listenPort":[{required:!0,message:"请输入监听端口",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"zkDeployInfo.connectPort":[{required:!0,message:"请输入通信端口",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.jmxPort":[{required:!0,message:"请输入jmxPort",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.externalPort":[{required:!0,message:"请输入广播监听端口",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"zkDeployInfo.electionPort":[{required:!0,message:"请输入选举端口",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"zkDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"brokerDeployInfo.storageClassName":[{required:!0,message:"请选择存储类",trigger:"change"}],"zkDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.storage":[{required:!0,message:"请输入存储卷大小",trigger:"blur"},{validator:p["d"],trigger:"blur"}],"zkDeployInfo.nodePort":[{validator:p["f"],trigger:"blur"}],"brokerDeployInfo.nodePorts":[{validator:t,trigger:"blur"}],"zkDeployInfo.limitsCpu":[{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.limitsCpu":[{validator:p["d"],trigger:"blur"}],"zkDeployInfo.limitsMemory":[{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.limitsMemory":[{validator:p["d"],trigger:"blur"}],"zkDeployInfo.requestCpu":[{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.requestCpu":[{validator:p["d"],trigger:"blur"}],"zkDeployInfo.requestMemory":[{validator:p["d"],trigger:"blur"}],"brokerDeployInfo.requestMemory":[{validator:p["d"],trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{"formData.brokerDeployInfo.jvmParam":function(e){if(e){var t=/^(?=.*-Xms)(?=.*-Xmx)(?=.*-Xmn).*$/,o=t.test(e);if(o){var a=e.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],r=1024*a+1024;this.minBkMemory=r,this.formData.brokerDeployInfo.limitsMemory=r,this.formData.brokerDeployInfo.requestMemory=r}}}},created:function(){this.getKafkaConfigTemplate(),this.getK8sStorageClass(),this.getContainerManage()},mounted:function(){"zk"===this.rowData.clusterType?(this.getZkById(),this.getContainerImageZk()):(this.getBrokerById(),this.getContainerImageBk())},methods:{clickAction:function(e){switch(e){case"zk":this.formData.zkDeployInfo.nodeSelector.push({key:"",value:""});break;case"bk":this.formData.brokerDeployInfo.nodeSelector.push({key:"",value:""})}},clickDelete:function(e,t){e.splice(t,1)},getContainerImageZk:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var o,a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(y["c"])("ZOOKEEPER").catch((function(e){}));case 2:o=t.sent,a=Object(f["a"])(o,"data",[]),e.opts_imageZk=a.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerImageBk:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var o,a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(y["c"])("KAFKA_BROKER").catch((function(e){}));case 2:o=t.sent,a=Object(f["a"])(o,"data",[]),e.opts_imageBk=a.map((function(e){return{label:e.imageName,value:e.imageAddress,id:e.id}}));case 5:case"end":return t.stop()}}),t)})))()},getContainerManage:function(){var e=this;Object(s["a"])({agentId:this.rowData.agentId,namespace:this.rowData.namespace}).then((function(t){var o=Object(b["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_imagePullSecrets=o.map((function(e){return{name:Object(f["a"])(e,"metadata.name")}}))}))},getKafkaConfigTemplate:function(){var e=this,t={moduleType:"KAFKA",componentType:"KAFKA"};Object(c["d"])(t).then((function(t){var o=Object(b["a"])(null===t||void 0===t?void 0:t.data)?t.data:[];e.opts_kafkaTemplate=o.map((function(e){var t=e.content?JSON.parse(e.content):"",o=[];return t&&t.forEach((function(e){var t=e.configKey;o.push("".concat(t,"=").concat(e.configValue))})),{label:e.name,value:o.join("\n")}}))}))},getZkById:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(u["h"])(e.rowData.id).then((function(t){var o=null===t||void 0===t?void 0:t.data;e.resultZkJson=o;var a=new m["a"](o).init(e.rowData);e.formData.zkDeployInfo=a.zkDeployInfo}));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1);case 9:e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},getBrokerById:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(u["e"])(e.rowData.id).then((function(t){var o=null===t||void 0===t?void 0:t.data;e.resultBrokerJson=o;var a=new m["a"](o).init(e.rowData);e.formData.brokerDeployInfo=a.brokerDeployInfo;var r=e.opts_kafkaTemplate.find((function(e){var t;return e.label===(null===(t=a.brokerDeployInfo.configTemplateId)||void 0===t?void 0:t.label)}));e.formData.brokerDeployInfo.configTemplateId=r||""}));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1);case 9:e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},getK8sStorageClass:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(s["e"])({agentId:e.rowData.agentId}).then((function(t){var o=Object(b["a"])(null===t||void 0===t?void 0:t.data.items)?t.data.items:[];e.opts_storageClass=o.map((function(e){return{label:Object(f["a"])(e,"metadata.name"),value:Object(f["a"])(e,"metadata.name")}}))}));case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})))()},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n["a"])(Object(l["a"])().mark((function t(o){var a,r,n,s,i,c,p,f,b,d,y,k,g,D,h;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o){t.next=34;break}if("zk"!==e.rowData.clusterType){t.next=15;break}if(a=e.formData.zkDeployInfo,r=a.limitsCpu,n=a.limitsMemory,s=a.requestCpu,i=a.requestMemory,!(r<s)){t.next=6;break}return e.$message.error("zookeeper request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 6:if(!(n<i)){t.next=9;break}return e.$message.error("zookeeper request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 9:c=new m["a"](e.formData).editZkResult(e.resultZkJson),e.loading=!0,Object(u["k"])({clusterId:e.rowData.id,context:c}).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1})),t.next=34;break;case 15:if(p=e.formData.brokerDeployInfo,f=p.jvmParam,b=p.limitsCpu,d=p.limitsMemory,y=p.requestCpu,k=p.requestMemory,!(b<y)){t.next=19;break}return e.$message.error("broker request-cpu必须小于等于limits-cpu"),t.abrupt("return",!1);case 19:if(!(d<k)){t.next=22;break}return e.$message.error("broker request-memory必须小于等于limits-memory"),t.abrupt("return",!1);case 22:if(!f){t.next=31;break}if(g=f.split(" -Xmx")[0].split("-Xms")[1].split("g")[0],D=1024*g,!(D>=d)){t.next=28;break}return e.$message.error("broker limits-memory须小于运行内存"),t.abrupt("return",!1);case 28:if(!(D>=k)){t.next=31;break}return e.$message.error("broker request-memory须小于运行内存"),t.abrupt("return",!1);case 31:h=new m["a"](e.formData).editBrokerResult(e.resultBrokerJson),e.loading=!0,Object(u["i"])({clusterId:e.rowData.id,context:h}).then((function(t){200===t.code&&(e.$message({type:"success",message:t.msg}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}));case 34:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},g=k,D=(o("9bde"),o("2877")),h=Object(D["a"])(g,a,r,!1,null,"a9402a62",null);t["default"]=h.exports},f175:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("el-dialog-limit",{attrs:{title:"扩缩容"+e.rowData.clusterType+"集群",visible:e.show,size:"small",loading:e.loading,"append-to-body":!0,"close-on-click-modal":!1},on:{close:e.clickCancel}},[t("el-form",{ref:"formRef",staticClass:"cluster-form",attrs:{"label-position":e.labelPosition,"label-width":"90px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"broker"===e.rowData.clusterType?"master":"实例数",prop:"size"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,placeholder:"请输入实例数"},model:{value:e.formData.size,callback:function(t){e.$set(e.formData,"size",e._n(t))},expression:"formData.size"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.clickConfirm}},[e._v("确定")]),t("el-button",{on:{click:e.clickCancel}},[e._v("取消")])],1)],1)},r=[],l=o("c7eb"),n=o("1da1"),s=(o("d3b7"),o("2a7b")),i=o("ec41"),c=o("61f7"),p={name:"AddAndEdit",components:{},model:{prop:"show",event:"change"},props:{show:Boolean,rowData:{type:Object,default:null},refresh:Function},data:function(){return{loading:!1,labelPosition:"right",formData:{size:3},rules:{size:[{required:!0,message:"请输入实例数",trigger:"blur"},{validator:c["d"],trigger:"blur"}]}}},computed:{isEdit:function(){var e;return Boolean(null===(e=this.rowData)||void 0===e?void 0:e.id)}},watch:{},created:function(){},mounted:function(){"zk"===this.rowData.clusterType?this.getZkById():this.getBrokerById()},methods:{getZkById:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(s["h"])(e.rowData.id).then((function(t){var o=null===t||void 0===t?void 0:t.data;e.formData.size=Object(i["a"])(o,"spec.size")}));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1);case 9:e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},getBrokerById:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(s["e"])(e.rowData.id).then((function(t){var o=null===t||void 0===t?void 0:t.data;e.formData.size=Object(i["a"])(o,"spec.size"),e.formData.replicaPerGroup=Object(i["a"])(o,"spec.replicaPerGroup")}));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1);case 9:e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[1,6]])})))()},clickCancel:function(){this.$refs.formRef.resetFields(),this.$emit("change",!1)},clickConfirm:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n["a"])(Object(l["a"])().mark((function t(o){var a,r;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:o&&(e.loading=!0,"zk"===e.rowData.clusterType?(a={clusterId:e.rowData.id,context:{spec:{size:e.formData.size}}},Object(s["c"])(a).then((function(t){200===t.code&&(e.$message({type:"success",message:"修改成功"}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))):(r={clusterId:e.rowData.id,context:{spec:{size:e.formData.size}}},Object(s["b"])(r).then((function(t){200===t.code&&(e.$message({type:"success",message:"修改成功"}),e.$emit("change",!1),e.refresh())})).finally((function(){e.loading=!1}))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},m=p,u=(o("3bfd"),o("2877")),f=Object(u["a"])(m,a,r,!1,null,"60de6ee6",null);t["default"]=f.exports}}]);